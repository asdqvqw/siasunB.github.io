{
  "version": 3,
  "sources": ["../../blockly/core/registry.ts", "../../blockly/core/common.ts", "../../blockly/core/utils/idgenerator.ts", "../../blockly/core/events/utils.ts", "../../blockly/core/touch.ts", "../../blockly/core/browser_events.ts", "../../blockly/core/utils/array.ts", "../../blockly/core/css.ts", "../../blockly/core/utils/deprecation.ts", "../../blockly/core/utils/dom.ts", "../../blockly/core/utils/style.ts", "../../blockly/core/utils/svg_math.ts", "../../blockly/core/utils/xml.ts", "../../blockly/core/utils/toolbox.ts", "../../blockly/core/positionable_helpers.ts", "../../blockly/core/dialog.ts", "../../blockly/core/interfaces/i_variable_backed_parameter_model.ts", "../../blockly/core/interfaces/i_legacy_procedure_blocks.ts", "../../blockly/core/variables.ts", "../../blockly/core/clipboard/registry.ts", "../../blockly/core/render_management.ts", "../../blockly/core/xml.ts", "../../blockly/core/interfaces/i_serializable.ts", "../../blockly/core/serialization/registry.ts", "../../blockly/core/serialization/blocks.ts", "../../blockly/core/clipboard/block_paster.ts", "../../blockly/core/clipboard.ts", "../../blockly/core/utils/aria.ts", "../../blockly/core/widgetdiv.ts", "../../blockly/core/contextmenu.ts", "../../blockly/core/utils/math.ts", "../../blockly/core/dropdowndiv.ts", "../../blockly/core/block_animations.ts", "../../blockly/core/utils/string.ts", "../../blockly/core/tooltip.ts", "../../blockly/core/utils/object.ts", "../../blockly/core/interfaces/i_has_bubble.ts", "../../blockly/core/utils/colour.ts", "../../blockly/core/utils/parsing.ts", "../../blockly/core/interfaces/i_procedure_block.ts", "../../blockly/core/interfaces/i_observable.ts", "../../blockly/core/field_registry.ts", "../../blockly/core/field_dropdown.ts", "../../blockly/core/extensions.ts", "../../blockly/core/utils/svg_paths.ts", "../../blockly/core/icons/registry.ts", "../../blockly/core/procedures.ts", "../../blockly/core/renderers/common/constants.ts", "../../blockly/core/keyboard_nav/ast_node.ts", "../../blockly/core/connection.ts", "../../blockly/core/renderers/common/block_rendering.ts", "../../blockly/core/variables_dynamic.ts", "../../blockly/core/workspace_svg.ts", "../../blockly/core/interfaces/i_copyable.ts", "../../blockly/core/shortcut_items.ts", "../../blockly/core/serialization/procedures.ts", "../../blockly/core/serialization/workspaces.ts", "../../blockly/core/bump_objects.ts", "../../blockly/core/block_dragger.ts", "../../blockly/core/contextmenu_items.ts", "../../blockly/core/inject.ts", "../../blockly/core/interfaces/i_icon.ts", "../../blockly/core/interfaces/i_paster.ts", "../../blockly/core/interfaces/i_selectable_toolbox_item.ts", "../../blockly/core/blockly.ts", "../../blockly/core/interfaces/i_rendered_element.ts", "../../blockly/src/com/google/javascript/jscomp/js/base.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defines.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defineproperty.js", "../../blockly/src/com/google/javascript/jscomp/js/util/global.js", "../../blockly/src/com/google/javascript/jscomp/js/util/shouldpolyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/util/polyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/globalthis.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/symbol.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/values.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/flat.js", "../../blockly/src/com/google/javascript/jscomp/js/util/owns.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/entries.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/values.js", "../../blockly/core/blocks.ts", "../../blockly/core/events/events_abstract.ts", "../../blockly/core/events/events_ui_base.ts", "../../blockly/core/events/events_click.ts", "../../blockly/core/utils/useragent.ts", "../../blockly/core/component_manager.ts", "../../blockly/core/utils/coordinate.ts", "../../blockly/core/utils/svg.ts", "../../blockly/core/utils/rect.ts", "../../blockly/core/utils/size.ts", "../../blockly/core/scrollbar.ts", "../../blockly/core/sprites.ts", "../../blockly/core/zoom_controls.ts", "../../blockly/core/icons/icon_types.ts", "../../blockly/core/inputs/input_types.ts", "../../blockly/core/msg.ts", "../../blockly/core/events/events_var_base.ts", "../../blockly/core/events/events_var_create.ts", "../../blockly/core/variable_model.ts", "../../blockly/core/workspace_comment.ts", "../../blockly/core/events/events_selected.ts", "../../blockly/core/clipboard/workspace_comment_paster.ts", "../../blockly/core/workspace_comment_svg.ts", "../../blockly/core/serialization/exceptions.ts", "../../blockly/core/serialization/priorities.ts", "../../blockly/core/events/events_block_base.ts", "../../blockly/core/events/events_block_create.ts", "../../blockly/core/events/events_theme_change.ts", "../../blockly/core/events/events_viewport.ts", "../../blockly/core/config.ts", "../../blockly/core/connection_type.ts", "../../blockly/core/connection_db.ts", "../../blockly/core/menu.ts", "../../blockly/core/menuitem.ts", "../../blockly/core/contextmenu_registry.ts", "../../blockly/core/layers.ts", "../../blockly/core/bubble_dragger.ts", "../../blockly/core/internal_constants.ts", "../../blockly/core/workspace_dragger.ts", "../../blockly/core/gesture.ts", "../../blockly/core/grid.ts", "../../blockly/core/marker_manager.ts", "../../blockly/core/theme.ts", "../../blockly/core/theme/classic.ts", "../../blockly/core/options.ts", "../../blockly/core/events/events_block_change.ts", "../../blockly/core/field.ts", "../../blockly/core/names.ts", "../../blockly/core/observable_procedure_map.ts", "../../blockly/core/icons/icon.ts", "../../blockly/core/bubbles/bubble.ts", "../../blockly/core/bubbles/mini_workspace_bubble.ts", "../../blockly/core/icons/mutator_icon.ts", "../../blockly/core/utils/keycodes.ts", "../../blockly/core/utils.ts", "../../blockly/core/bubbles/text_bubble.ts", "../../blockly/core/bubbles/textinput_bubble.ts", "../../blockly/core/icons/comment_icon.ts", "../../blockly/core/icons/warning_icon.ts", "../../blockly/core/icons/exceptions.ts", "../../blockly/core/icons.ts", "../../blockly/core/renderers/measurables/types.ts", "../../blockly/core/renderers/measurables/base.ts", "../../blockly/core/renderers/measurables/row.ts", "../../blockly/core/renderers/measurables/bottom_row.ts", "../../blockly/core/renderers/measurables/connection.ts", "../../blockly/core/renderers/measurables/input_connection.ts", "../../blockly/core/renderers/measurables/external_value_input.ts", "../../blockly/core/renderers/measurables/field.ts", "../../blockly/core/renderers/measurables/hat.ts", "../../blockly/core/renderers/measurables/icon.ts", "../../blockly/core/renderers/measurables/in_row_spacer.ts", "../../blockly/core/renderers/measurables/inline_input.ts", "../../blockly/core/renderers/measurables/statement_input.ts", "../../blockly/core/renderers/measurables/input_row.ts", "../../blockly/core/renderers/measurables/jagged_edge.ts", "../../blockly/core/renderers/measurables/next_connection.ts", "../../blockly/core/renderers/measurables/output_connection.ts", "../../blockly/core/renderers/measurables/previous_connection.ts", "../../blockly/core/renderers/measurables/round_corner.ts", "../../blockly/core/renderers/measurables/spacer_row.ts", "../../blockly/core/renderers/measurables/square_corner.ts", "../../blockly/core/renderers/measurables/top_row.ts", "../../blockly/core/renderers/common/drawer.ts", "../../blockly/core/inputs/align.ts", "../../blockly/core/field_label.ts", "../../blockly/core/inputs/input.ts", "../../blockly/core/inputs/dummy_input.ts", "../../blockly/core/inputs/end_row_input.ts", "../../blockly/core/inputs/statement_input.ts", "../../blockly/core/inputs/value_input.ts", "../../blockly/core/renderers/common/info.ts", "../../blockly/core/events/events_marker_move.ts", "../../blockly/core/renderers/common/marker_svg.ts", "../../blockly/core/renderers/common/path_object.ts", "../../blockly/core/constants.ts", "../../blockly/core/insertion_marker_manager.ts", "../../blockly/core/renderers/common/renderer.ts", "../../blockly/core/theme_manager.ts", "../../blockly/core/connection_checker.ts", "../../blockly/core/events/events_var_delete.ts", "../../blockly/core/events/events_var_rename.ts", "../../blockly/core/variable_map.ts", "../../blockly/core/workspace.ts", "../../blockly/core/workspace_audio.ts", "../../blockly/core/layer_manager.ts", "../../blockly/core/events/events_trashcan_open.ts", "../../blockly/core/events/events_block_delete.ts", "../../blockly/core/block.ts", "../../blockly/core/keyboard_nav/marker.ts", "../../blockly/core/keyboard_nav/cursor.ts", "../../blockly/core/keyboard_nav/basic_cursor.ts", "../../blockly/core/keyboard_nav/tab_navigate_cursor.ts", "../../blockly/core/rendered_connection.ts", "../../blockly/core/block_svg.ts", "../../blockly/core/drag_target.ts", "../../blockly/core/delete_area.ts", "../../blockly/core/trashcan.ts", "../../blockly/core/shortcut_registry.ts", "../../blockly/core/serialization/variables.ts", "../../blockly/core/serialization.ts", "../../blockly/core/scrollbar_pair.ts", "../../blockly/core/metrics_manager.ts", "../../blockly/core/events/workspace_events.ts", "../../blockly/core/events/events_block_drag.ts", "../../blockly/core/bubbles.ts", "../../blockly/core/events/events_block_field_intermediate_change.ts", "../../blockly/core/events/events_block_move.ts", "../../blockly/core/events/events_bubble_open.ts", "../../blockly/core/events/events_comment_base.ts", "../../blockly/core/events/events_comment_change.ts", "../../blockly/core/events/events_comment_create.ts", "../../blockly/core/events/events_comment_delete.ts", "../../blockly/core/events/events_comment_move.ts", "../../blockly/core/events/events_toolbox_item_select.ts", "../../blockly/core/events/events.ts", "../../blockly/core/renderers/zelos/constants.ts", "../../blockly/core/renderers/zelos/drawer.ts", "../../blockly/core/field_image.ts", "../../blockly/core/field_input.ts", "../../blockly/core/field_textinput.ts", "../../blockly/core/renderers/zelos/measurables/bottom_row.ts", "../../blockly/core/renderers/zelos/measurables/inputs.ts", "../../blockly/core/renderers/zelos/measurables/row_elements.ts", "../../blockly/core/renderers/zelos/measurables/top_row.ts", "../../blockly/core/renderers/zelos/info.ts", "../../blockly/core/renderers/zelos/marker_svg.ts", "../../blockly/core/renderers/zelos/path_object.ts", "../../blockly/core/renderers/zelos/renderer.ts", "../../blockly/core/renderers/zelos/zelos.ts", "../../blockly/core/field_angle.ts", "../../blockly/core/field_checkbox.ts", "../../blockly/core/field_colour.ts", "../../blockly/core/field_label_serializable.ts", "../../blockly/core/field_multilineinput.ts", "../../blockly/core/field_number.ts", "../../blockly/core/field_variable.ts", "../../blockly/core/flyout_button.ts", "../../blockly/core/flyout_metrics_manager.ts", "../../blockly/core/flyout_base.ts", "../../blockly/core/flyout_horizontal.ts", "../../blockly/core/flyout_vertical.ts", "../../blockly/core/generator.ts", "../../blockly/core/inputs.ts", "../../blockly/core/renderers/geras/constants.ts", "../../blockly/core/renderers/geras/highlighter.ts", "../../blockly/core/renderers/geras/drawer.ts", "../../blockly/core/renderers/geras/highlight_constants.ts", "../../blockly/core/renderers/geras/measurables/inline_input.ts", "../../blockly/core/renderers/geras/measurables/statement_input.ts", "../../blockly/core/renderers/geras/info.ts", "../../blockly/core/renderers/geras/path_object.ts", "../../blockly/core/renderers/geras/renderer.ts", "../../blockly/core/renderers/geras/geras.ts", "../../blockly/core/renderers/minimalist/constants.ts", "../../blockly/core/renderers/minimalist/drawer.ts", "../../blockly/core/renderers/minimalist/info.ts", "../../blockly/core/renderers/minimalist/renderer.ts", "../../blockly/core/renderers/minimalist/minimalist.ts", "../../blockly/core/renderers/thrasos/info.ts", "../../blockly/core/renderers/thrasos/renderer.ts", "../../blockly/core/renderers/thrasos/thrasos.ts", "../../blockly/core/theme/zelos.ts", "../../blockly/core/theme/themes.ts", "../../blockly/core/toolbox/toolbox_item.ts", "../../blockly/core/toolbox/category.ts", "../../blockly/core/toolbox/separator.ts", "../../blockly/core/toolbox/collapsible_category.ts", "../../blockly/core/toolbox/toolbox.ts", "../../blockly/core/main.ts", "../../blockly/core/blockly_options.ts", "../../blockly/core/utils/metrics.ts", "../../blockly/core/renderers/common/i_path_object.ts", "../../blockly/core/interfaces/i_toolbox_item.ts", "../../blockly/core/interfaces/i_toolbox.ts", "../../blockly/core/interfaces/i_styleable.ts", "../../blockly/core/interfaces/i_serializer.ts", "../../blockly/core/interfaces/i_selectable.ts", "../../blockly/core/interfaces/i_registrable.ts", "../../blockly/core/interfaces/i_procedure_model.ts", "../../blockly/core/interfaces/i_procedure_map.ts", "../../blockly/core/interfaces/i_positionable.ts", "../../blockly/core/interfaces/i_parameter_model.ts", "../../blockly/core/interfaces/i_movable.ts", "../../blockly/core/interfaces/i_metrics_manager.ts", "../../blockly/core/interfaces/i_keyboard_accessible.ts", "../../blockly/core/interfaces/i_flyout.ts", "../../blockly/core/interfaces/i_draggable.ts", "../../blockly/core/interfaces/i_drag_target.ts", "../../blockly/core/interfaces/i_delete_area.ts", "../../blockly/core/interfaces/i_deletable.ts", "../../blockly/core/interfaces/i_contextmenu.ts", "../../blockly/core/interfaces/i_connection_checker.ts", "../../blockly/core/interfaces/i_component.ts", "../../blockly/core/interfaces/i_collapsible_toolbox_item.ts", "../../blockly/core/interfaces/i_bubble.ts", "../../blockly/core/interfaces/i_bounded_element.ts", "../../blockly/core/interfaces/i_block_dragger.ts", "../../blockly/core/interfaces/i_autohideable.ts", "../../blockly/core/interfaces/i_ast_node_location_with_block.ts", "../../blockly/core/interfaces/i_ast_node_location_svg.ts", "../../blockly/core/interfaces/i_ast_node_location.ts", "../../blockly/blockly.js", "../../blockly/core-browser.js", "../../blockly/generators/javascript/colour.ts", "../../blockly/generators/javascript/lists.ts", "../../blockly/generators/javascript/logic.ts", "../../blockly/generators/javascript/loops.ts", "../../blockly/generators/javascript/math.ts", "../../blockly/generators/javascript/procedures.ts", "../../blockly/generators/javascript/text.ts", "../../blockly/generators/javascript/variables.ts", "../../blockly/generators/javascript/javascript_generator.ts", "../../blockly/generators/javascript/variables_dynamic.ts", "../../blockly/generators/javascript.ts", "../../blockly/javascript.js"],
  "sourcesContent": ["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.registry\n\nimport type {Abstract} from './events/events_abstract.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport type {Input} from './inputs/input.js';\nimport type {ISerializer} from './interfaces/i_serializer.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Options} from './options.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {Theme} from './theme.js';\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\nimport {IPaster} from './interfaces/i_paster.js';\nimport {ICopyData, ICopyable} from './interfaces/i_copyable.js';\n\n/**\n * A map of maps. With the keys being the type and name of the class we are\n * registering and the value being the constructor function.\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\n */\nconst typeMap: {\n  [key: string]: {\n    [key: string]: (new () => AnyDuringMigration) | AnyDuringMigration;\n  };\n} = Object.create(null);\nexport const TEST_ONLY = {typeMap};\n\n/**\n * A map of maps. With the keys being the type and caseless name of the class we\n * are registring, and the value being the most recent cased name for that\n * registration.\n */\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\n\n/**\n * The string used to register the default class for a type of plugin.\n */\nexport const DEFAULT = 'default';\n\n/**\n * A name with the type of the element stored in the generic.\n */\nexport class Type<_T> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /**\n   * Returns the name of the type.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\n\n  static CURSOR = new Type<Cursor>('cursor');\n\n  static EVENT = new Type<Abstract>('event');\n\n  static FIELD = new Type<Field>('field');\n\n  static INPUT = new Type<Input>('input');\n\n  static RENDERER = new Type<Renderer>('renderer');\n\n  static TOOLBOX = new Type<IToolbox>('toolbox');\n\n  static THEME = new Type<Theme>('theme');\n\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\n\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\n\n  static FLYOUTS_HORIZONTAL_TOOLBOX = new Type<IFlyout>(\n    'flyoutsHorizontalToolbox',\n  );\n\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\n\n  static BLOCK_DRAGGER = new Type<IBlockDragger>('blockDragger');\n\n  /** @internal */\n  static SERIALIZER = new Type<ISerializer>('serializer');\n\n  /** @internal */\n  static ICON = new Type<IIcon>('icon');\n\n  /** @internal */\n  static PASTER = new Type<IPaster<ICopyData, ICopyable<ICopyData>>>('paster');\n}\n\n/**\n * Registers a class based on a type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param registryItem The class or object to register.\n * @param opt_allowOverrides True to prevent an error when overriding an already\n *     registered item.\n * @throws {Error} if the type or name is empty, a name with the given type has\n *     already been registered, or if the given class or object is not valid for\n *     its type.\n */\nexport function register<T>(\n  type: string | Type<T>,\n  name: string,\n  registryItem:\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null\n    | AnyDuringMigration,\n  opt_allowOverrides?: boolean,\n): void {\n  if (\n    (!(type instanceof Type) && typeof type !== 'string') ||\n    `${type}`.trim() === ''\n  ) {\n    throw Error(\n      'Invalid type \"' +\n        type +\n        '\". The type must be a' +\n        ' non-empty string or a Blockly.registry.Type.',\n    );\n  }\n  type = `${type}`.toLowerCase();\n\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error(\n      'Invalid name \"' + name + '\". The name must be a' + ' non-empty string.',\n    );\n  }\n  const caselessName = name.toLowerCase();\n  if (!registryItem) {\n    throw Error('Can not register a null value');\n  }\n  let typeRegistry = typeMap[type];\n  let nameRegistry = nameMap[type];\n  // If the type registry has not been created, create it.\n  if (!typeRegistry) {\n    typeRegistry = typeMap[type] = Object.create(null);\n    nameRegistry = nameMap[type] = Object.create(null);\n  }\n\n  // Validate that the given class has all the required properties.\n  validate(type, registryItem);\n\n  // Don't throw an error if opt_allowOverrides is true.\n  if (!opt_allowOverrides && typeRegistry[caselessName]) {\n    throw Error(\n      'Name \"' +\n        caselessName +\n        '\" with type \"' +\n        type +\n        '\" already registered.',\n    );\n  }\n  typeRegistry[caselessName] = registryItem;\n  nameRegistry[caselessName] = name;\n}\n\n/**\n * Checks the given registry item for properties that are required based on the\n * type.\n *\n * @param type The type of the plugin. (e.g. Field, Renderer)\n * @param registryItem A class or object that we are checking for the required\n *     properties.\n */\nfunction validate(type: string, registryItem: Function | AnyDuringMigration) {\n  switch (type) {\n    case String(Type.FIELD):\n      if (typeof registryItem.fromJson !== 'function') {\n        throw Error('Type \"' + type + '\" must have a fromJson function');\n      }\n      break;\n  }\n}\n\n/**\n * Unregisters the registry item with the given type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n */\nexport function unregister<T>(type: string | Type<T>, name: string) {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    console.warn(\n      'Unable to unregister [' +\n        name +\n        '][' +\n        type +\n        '] from the ' +\n        'registry.',\n    );\n    return;\n  }\n  delete typeMap[type][name];\n  delete nameMap[type][name];\n}\n\n/**\n * Gets the registry item for the given name and type. This can be either a\n * class or an object.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class or object with the given name and type or null if none\n *     exists.\n */\nfunction getItem<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null | AnyDuringMigration {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\n    if (opt_throwIfMissing) {\n      throw new Error(\n        msg + ' You must require or register a ' + type + ' plugin.',\n      );\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  return typeRegistry[name];\n}\n\n/**\n * Returns whether or not the registry contains an item with the given type and\n * name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @returns True if the registry has an item with the given type and name, false\n *     otherwise.\n */\nexport function hasItem<T>(type: string | Type<T>, name: string): boolean {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    return false;\n  }\n  return !!typeRegistry[name];\n}\n\n/**\n * Gets the class for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class with the given name and type or null if none exists.\n */\nexport function getClass<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  return getItem(type, name, opt_throwIfMissing) as\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null;\n}\n\n/**\n * Gets the object for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Category)\n * @param name The plugin's name. (Ex. logic_category)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object.\n * @returns The object with the given name and type or null if none exists.\n */\nexport function getObject<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): T | null {\n  return getItem(type, name, opt_throwIfMissing) as T;\n}\n\n/**\n * Returns a map of items registered with the given type.\n *\n * @param type The type of the plugin. (e.g. Category)\n * @param opt_cased Whether or not to return a map with cased keys (rather than\n *     caseless keys). False by default.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object. False by default.\n * @returns A map of objects with the given type, or null if none exists.\n */\nexport function getAllItems<T>(\n  type: string | Type<T>,\n  opt_cased?: boolean,\n  opt_throwIfMissing?: boolean,\n): {[key: string]: T | null | (new (...p1: AnyDuringMigration[]) => T)} | null {\n  type = `${type}`.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    const msg = `Unable to find [${type}] in the registry.`;\n    if (opt_throwIfMissing) {\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  if (!opt_cased) {\n    return typeRegistry;\n  }\n  const nameRegistry = nameMap[type];\n  const casedRegistry = Object.create(null);\n  for (const key of Object.keys(typeRegistry)) {\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\n  }\n  return casedRegistry;\n}\n\n/**\n * Gets the class from Blockly options for the given type.\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\n *\n * @param type The type of the plugin.\n * @param options The option object to check for the given plugin.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class for the plugin.\n */\nexport function getClassFromOptions<T>(\n  type: Type<T>,\n  options: Options,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  const plugin = options.plugins[String(type)] || DEFAULT;\n\n  // If the user passed in a plugin class instead of a registered plugin name.\n  if (typeof plugin === 'function') {\n    return plugin;\n  }\n  return getClass(type, plugin, opt_throwIfMissing);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.common\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Block} from './block.js';\nimport {ISelectable} from './blockly.js';\nimport {BlockDefinition, Blocks} from './blocks.js';\nimport type {Connection} from './connection.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** Database of all workspaces. */\nconst WorkspaceDB_ = Object.create(null);\n\n/**\n * Find the workspace with the specified ID.\n *\n * @param id ID of workspace to find.\n * @returns The sought after workspace or null if not found.\n */\nexport function getWorkspaceById(id: string): Workspace | null {\n  return WorkspaceDB_[id] || null;\n}\n\n/**\n * Find all workspaces.\n *\n * @returns Array of workspaces.\n */\nexport function getAllWorkspaces(): Workspace[] {\n  const workspaces = [];\n  for (const workspaceId in WorkspaceDB_) {\n    workspaces.push(WorkspaceDB_[workspaceId]);\n  }\n  return workspaces;\n}\n\n/**\n * Register a workspace in the workspace db.\n *\n * @param workspace\n */\nexport function registerWorkspace(workspace: Workspace) {\n  WorkspaceDB_[workspace.id] = workspace;\n}\n\n/**\n * Unregister a workspace from the workspace db.\n *\n * @param workspace\n */\nexport function unregisterWorkpace(workspace: Workspace) {\n  delete WorkspaceDB_[workspace.id];\n}\n\n/**\n * The main workspace most recently used.\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\n */\nlet mainWorkspace: Workspace;\n\n/**\n * Returns the last used top level workspace (based on focus).  Try not to use\n * this function, particularly if there are multiple Blockly instances on a\n * page.\n *\n * @returns The main workspace.\n */\nexport function getMainWorkspace(): Workspace {\n  return mainWorkspace;\n}\n\n/**\n * Sets last used main workspace.\n *\n * @param workspace The most recently used top level workspace.\n */\nexport function setMainWorkspace(workspace: Workspace) {\n  mainWorkspace = workspace;\n}\n\n/**\n * Currently selected copyable object.\n */\nlet selected: ISelectable | null = null;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport function getSelected(): ISelectable | null {\n  return selected;\n}\n\n/**\n * Sets the currently selected block. This function does not visually mark the\n * block as selected or fire the required events. If you wish to\n * programmatically select a block, use `BlockSvg#select`.\n *\n * @param newSelection The newly selected block.\n * @internal\n */\nexport function setSelected(newSelection: ISelectable | null) {\n  selected = newSelection;\n}\n\n/**\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\n */\nlet parentContainer: Element | null;\n\n/**\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\n * Tooltip.\n *\n * @returns The parent container.\n */\nexport function getParentContainer(): Element | null {\n  return parentContainer;\n}\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param newParent The container element.\n */\nexport function setParentContainer(newParent: Element) {\n  parentContainer = newParent;\n}\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n */\nexport function svgResize(workspace: WorkspaceSvg) {\n  let mainWorkspace = workspace;\n  while (mainWorkspace.options.parentWorkspace) {\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\n  }\n  const svg = mainWorkspace.getParentSvg();\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\n  const div = svg.parentElement;\n  if (!(div instanceof HTMLElement)) {\n    // Workspace deleted, or something.\n    return;\n  }\n\n  const width = div.offsetWidth;\n  const height = div.offsetHeight;\n  if (cachedSize.width !== width) {\n    svg.setAttribute('width', width + 'px');\n    mainWorkspace.setCachedParentSvgSize(width, null);\n  }\n  if (cachedSize.height !== height) {\n    svg.setAttribute('height', height + 'px');\n    mainWorkspace.setCachedParentSvgSize(null, height);\n  }\n  mainWorkspace.resize();\n}\n\n/**\n * All of the connections on blocks that are currently being dragged.\n */\nexport const draggingConnections: Connection[] = [];\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following\n *    statements (blocks that are not inside a value or statement input\n *    of the block).\n * @returns Map of types to type counts for descendants of the bock.\n */\nexport function getBlockTypeCounts(\n  block: Block,\n  opt_stripFollowing?: boolean,\n): {[key: string]: number} {\n  const typeCountsMap = Object.create(null);\n  const descendants = block.getDescendants(true);\n  if (opt_stripFollowing) {\n    const nextBlock = block.getNextBlock();\n    if (nextBlock) {\n      const index = descendants.indexOf(nextBlock);\n      descendants.splice(index, descendants.length - index);\n    }\n  }\n  for (let i = 0, checkBlock; (checkBlock = descendants[i]); i++) {\n    if (typeCountsMap[checkBlock.type]) {\n      typeCountsMap[checkBlock.type]++;\n    } else {\n      typeCountsMap[checkBlock.type] = 1;\n    }\n  }\n  return typeCountsMap;\n}\n\n/**\n * Helper function for defining a block from JSON.  The resulting function has\n * the correct value of jsonDef at the point in code where jsonInit is called.\n *\n * @param jsonDef The JSON definition of a block.\n * @returns A function that calls jsonInit with the correct value\n *     of jsonDef.\n */\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\n  return function (this: Block) {\n    this.jsonInit(jsonDef);\n  };\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n */\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\n}\n\n/**\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\n */\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @returns A map of the block\n *     definitions created.\n */\nexport function createBlockDefinitionsFromJsonArray(\n  jsonArray: AnyDuringMigration[],\n): {[key: string]: BlockDefinition} {\n  const blocks: {[key: string]: BlockDefinition} = {};\n  for (let i = 0; i < jsonArray.length; i++) {\n    const elem = jsonArray[i];\n    if (!elem) {\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\n      continue;\n    }\n    const type = elem['type'];\n    if (!type) {\n      console.warn(\n        `Block definition #${i} in JSON array is missing a type attribute. ` +\n          'Skipping.',\n      );\n      continue;\n    }\n    blocks[type] = {init: jsonInitFactory(elem)};\n  }\n  return blocks;\n}\n\n/**\n * Add the specified block definitions to the block definitions\n * dictionary (Blockly.Blocks).\n *\n * @param blocks A map of block\n *     type names to block definitions.\n */\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\n  // Iterate over own enumerable properties.\n  for (const type of Object.keys(blocks)) {\n    const definition = blocks[type];\n    if (type in Blocks) {\n      console.warn(`Block definiton \"${type}\" overwrites previous definition.`);\n    }\n    Blocks[type] = definition;\n  }\n}\n\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.idGenerator\n\n/**\n * Legal characters for the universally unique IDs.  Should be all on\n * a US keyboard.  No characters that conflict with XML or JSON.\n * Requests to remove additional 'problematic' characters from this\n * soup will be denied.  That's your failure to properly escape in\n * your own environment.  Issues #251, #625, #682, #1304.\n */\nconst soup =\n  '!#$%()*+,-./:;=?@[]^_`{|}~' +\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * Namespace object for internal implementations we want to be able to\n * stub in tests. Do not use externally.\n *\n * @internal\n */\nconst internal = {\n  /**\n   * Generate a random unique ID.  This should be globally unique.\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\n   *\n   * @returns A globally unique ID string.\n   */\n  genUid: () => {\n    const length = 20;\n    const soupLength = soup.length;\n    const id = [];\n    for (let i = 0; i < length; i++) {\n      id[i] = soup.charAt(Math.random() * soupLength);\n    }\n    return id.join('');\n  },\n};\nexport const TEST_ONLY = internal;\n\n/** Next unique ID to use. */\nlet nextId = 0;\n\n/**\n * Generate the next unique element IDs.\n * IDs are compatible with the HTML4 'id' attribute restrictions:\n * Use only ASCII letters, digits, '_', '-' and '.'\n *\n * For UUIDs use genUid (below) instead; this ID generator should\n * primarily be used for IDs that end up in the DOM.\n *\n * @returns The next unique identifier.\n */\nexport function getNextUniqueId(): string {\n  return 'blockly-' + (nextId++).toString(36);\n}\n\n/**\n * Generate a random unique ID.\n *\n * @see internal.genUid\n * @returns A globally unique ID string.\n */\nexport function genUid(): string {\n  return internal.genUid();\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.utils\n\nimport type {Block} from '../block.js';\nimport * as common from '../common.js';\nimport * as registry from '../registry.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type {Workspace} from '../workspace.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockChange} from './events_block_change.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {ViewportChange} from './events_viewport.js';\n\n/** Group ID for new events.  Grouped events are indivisible. */\nlet group = '';\n\n/** Sets whether the next event should be added to the undo stack. */\nlet recordUndo = true;\n\n/**\n * Sets whether events should be added to the undo stack.\n *\n * @param newValue True if events should be added to the undo stack.\n */\nexport function setRecordUndo(newValue: boolean) {\n  recordUndo = newValue;\n}\n\n/**\n * Returns whether or not events will be added to the undo stack.\n *\n * @returns True if events will be added to the undo stack.\n */\nexport function getRecordUndo(): boolean {\n  return recordUndo;\n}\n\n/** Allow change events to be created and fired. */\nlet disabled = 0;\n\n/**\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\n */\nexport const CREATE = 'create';\n\n/**\n * Name of event that creates a block.\n */\nexport const BLOCK_CREATE = CREATE;\n\n/**\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\n */\nexport const DELETE = 'delete';\n\n/**\n * Name of event that deletes a block.\n */\nexport const BLOCK_DELETE = DELETE;\n\n/**\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\n */\nexport const CHANGE = 'change';\n\n/**\n * Name of event that changes a block.\n */\nexport const BLOCK_CHANGE = CHANGE;\n\n/**\n * Name of event representing an in-progress change to a field of a block, which\n * is expected to be followed by a block change event.\n */\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\n  'block_field_intermediate_change';\n\n/**\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\n */\nexport const MOVE = 'move';\n\n/**\n * Name of event that moves a block.\n */\nexport const BLOCK_MOVE = MOVE;\n\n/**\n * Name of event that creates a variable.\n */\nexport const VAR_CREATE = 'var_create';\n\n/**\n * Name of event that deletes a variable.\n */\nexport const VAR_DELETE = 'var_delete';\n\n/**\n * Name of event that renames a variable.\n */\nexport const VAR_RENAME = 'var_rename';\n\n/**\n * Name of generic event that records a UI change.\n */\nexport const UI = 'ui';\n\n/**\n * Name of event that record a block drags a block.\n */\nexport const BLOCK_DRAG = 'drag';\n\n/**\n * Name of event that records a change in selected element.\n */\nexport const SELECTED = 'selected';\n\n/**\n * Name of event that records a click.\n */\nexport const CLICK = 'click';\n\n/**\n * Name of event that records a marker move.\n */\nexport const MARKER_MOVE = 'marker_move';\n\n/**\n * Name of event that records a bubble open.\n */\nexport const BUBBLE_OPEN = 'bubble_open';\n\n/**\n * Name of event that records a trashcan open.\n */\nexport const TRASHCAN_OPEN = 'trashcan_open';\n\n/**\n * Name of event that records a toolbox item select.\n */\nexport const TOOLBOX_ITEM_SELECT = 'toolbox_item_select';\n\n/**\n * Name of event that records a theme change.\n */\nexport const THEME_CHANGE = 'theme_change';\n\n/**\n * Name of event that records a viewport change.\n */\nexport const VIEWPORT_CHANGE = 'viewport_change';\n\n/**\n * Name of event that creates a comment.\n */\nexport const COMMENT_CREATE = 'comment_create';\n\n/**\n * Name of event that deletes a comment.\n */\nexport const COMMENT_DELETE = 'comment_delete';\n\n/**\n * Name of event that changes a comment.\n */\nexport const COMMENT_CHANGE = 'comment_change';\n\n/**\n * Name of event that moves a comment.\n */\nexport const COMMENT_MOVE = 'comment_move';\n\n/**\n * Name of event that records a workspace load.\n */\nexport const FINISHED_LOADING = 'finished_loading';\n\n/**\n * Type of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport type BumpEvent = BlockCreate | BlockMove | CommentCreate | CommentMove;\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport const BUMP_EVENTS: string[] = [\n  BLOCK_CREATE,\n  BLOCK_MOVE,\n  COMMENT_CREATE,\n  COMMENT_MOVE,\n];\n\n/** List of events queued for firing. */\nconst FIRE_QUEUE: Abstract[] = [];\n\n/**\n * Create a custom event and fire it.\n *\n * @param event Custom data for event.\n */\nexport function fire(event: Abstract) {\n  TEST_ONLY.fireInternal(event);\n}\n\n/**\n * Private version of fireInternal for stubbing in tests.\n */\nfunction fireInternal(event: Abstract) {\n  if (!isEnabled()) {\n    return;\n  }\n  if (!FIRE_QUEUE.length) {\n    // First event added; schedule a firing of the event queue.\n    try {\n      // If we are in a browser context, we want to make sure that the event\n      // fires after blocks have been rerendered this frame.\n      requestAnimationFrame(() => {\n        setTimeout(fireNow, 0);\n      });\n    } catch (e) {\n      // Otherwise we just want to delay so events can be coallesced.\n      // requestAnimationFrame will error triggering this.\n      setTimeout(fireNow, 0);\n    }\n  }\n  FIRE_QUEUE.push(event);\n}\n\n/** Fire all queued events. */\nfunction fireNow() {\n  const queue = filter(FIRE_QUEUE, true);\n  FIRE_QUEUE.length = 0;\n  for (let i = 0, event; (event = queue[i]); i++) {\n    if (!event.workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(event.workspaceId);\n    if (eventWorkspace) {\n      eventWorkspace.fireChangeListener(event);\n    }\n  }\n\n  // Post-filter the undo stack to squash and remove any events that result in\n  // a null event\n\n  // 1. Determine which workspaces will need to have their undo stacks validated\n  const workspaceIds = new Set(queue.map((e) => e.workspaceId));\n  for (const workspaceId of workspaceIds) {\n    // Only process valid workspaces\n    if (!workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(workspaceId);\n    if (!eventWorkspace) {\n      continue;\n    }\n\n    // Find the last contiguous group of events on the stack\n    const undoStack = eventWorkspace.getUndoStack();\n    let i;\n    let group: string | undefined = undefined;\n    for (i = undoStack.length; i > 0; i--) {\n      const event = undoStack[i - 1];\n      if (event.group === '') {\n        break;\n      } else if (group === undefined) {\n        group = event.group;\n      } else if (event.group !== group) {\n        break;\n      }\n    }\n    if (!group || i == undoStack.length - 1) {\n      // Need a group of two or more events on the stack. Nothing to do here.\n      continue;\n    }\n\n    // Extract the event group, filter, and add back to the undo stack\n    let events = undoStack.splice(i, undoStack.length - i);\n    events = filter(events, true);\n    undoStack.push(...events);\n  }\n}\n\n/**\n * Filter the queued events and merge duplicates.\n *\n * @param queueIn Array of events.\n * @param forward True if forward (redo), false if backward (undo).\n * @returns Array of filtered events.\n */\nexport function filter(queueIn: Abstract[], forward: boolean): Abstract[] {\n  let queue = queueIn.slice();\n  // Shallow copy of queue.\n  if (!forward) {\n    // Undo is merged in reverse order.\n    queue.reverse();\n  }\n  const mergedQueue = [];\n  const hash = Object.create(null);\n  // Merge duplicates.\n  for (let i = 0, event; (event = queue[i]); i++) {\n    if (!event.isNull()) {\n      // Treat all UI events as the same type in hash table.\n      const eventType = event.isUiEvent ? UI : event.type;\n      // TODO(#5927): Check whether `blockId` exists before accessing it.\n      const blockId = (event as AnyDuringMigration).blockId;\n      const key = [eventType, blockId, event.workspaceId].join(' ');\n\n      const lastEntry = hash[key];\n      const lastEvent = lastEntry ? lastEntry.event : null;\n      if (!lastEntry) {\n        // Each item in the hash table has the event and the index of that event\n        // in the input array.  This lets us make sure we only merge adjacent\n        // move events.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      } else if (event.type === MOVE && lastEntry.index === i - 1) {\n        const moveEvent = event as BlockMove;\n        // Merge move events.\n        lastEvent.newParentId = moveEvent.newParentId;\n        lastEvent.newInputName = moveEvent.newInputName;\n        lastEvent.newCoordinate = moveEvent.newCoordinate;\n        if (moveEvent.reason) {\n          if (lastEvent.reason) {\n            // Concatenate reasons without duplicates.\n            const reasonSet = new Set(\n              moveEvent.reason.concat(lastEvent.reason),\n            );\n            lastEvent.reason = Array.from(reasonSet);\n          } else {\n            lastEvent.reason = moveEvent.reason;\n          }\n        }\n        lastEntry.index = i;\n      } else if (\n        event.type === CHANGE &&\n        (event as BlockChange).element === lastEvent.element &&\n        (event as BlockChange).name === lastEvent.name\n      ) {\n        const changeEvent = event as BlockChange;\n        // Merge change events.\n        lastEvent.newValue = changeEvent.newValue;\n      } else if (event.type === VIEWPORT_CHANGE) {\n        const viewportEvent = event as ViewportChange;\n        // Merge viewport change events.\n        lastEvent.viewTop = viewportEvent.viewTop;\n        lastEvent.viewLeft = viewportEvent.viewLeft;\n        lastEvent.scale = viewportEvent.scale;\n        lastEvent.oldScale = viewportEvent.oldScale;\n      } else if (event.type === CLICK && lastEvent.type === BUBBLE_OPEN) {\n        // Drop click events caused by opening/closing bubbles.\n      } else {\n        // Collision: newer events should merge into this event to maintain\n        // order.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      }\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter(function (e) {\n    return !e.isNull();\n  });\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  // Move mutation events to the top of the queue.\n  // Intentionally skip first event.\n  for (let i = 1, event; (event = queue[i]); i++) {\n    // AnyDuringMigration because:  Property 'element' does not exist on type\n    // 'Abstract'.\n    if (\n      event.type === CHANGE &&\n      (event as AnyDuringMigration).element === 'mutation'\n    ) {\n      queue.unshift(queue.splice(i, 1)[0]);\n    }\n  }\n  return queue;\n}\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Workspace.clearUndo.\n */\nexport function clearPendingUndo() {\n  for (let i = 0, event; (event = FIRE_QUEUE[i]); i++) {\n    event.recordUndo = false;\n  }\n}\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n */\nexport function disable() {\n  disabled++;\n}\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n */\nexport function enable() {\n  disabled--;\n}\n\n/**\n * Returns whether events may be fired or not.\n *\n * @returns True if enabled.\n */\nexport function isEnabled(): boolean {\n  return disabled === 0;\n}\n\n/**\n * Current group.\n *\n * @returns ID string.\n */\nexport function getGroup(): string {\n  return group;\n}\n\n/**\n * Start or stop a group.\n *\n * @param state True to start new group, false to end group.\n *   String to set group explicitly.\n */\nexport function setGroup(state: boolean | string) {\n  TEST_ONLY.setGroupInternal(state);\n}\n\n/**\n * Private version of setGroup for stubbing in tests.\n */\nfunction setGroupInternal(state: boolean | string) {\n  if (typeof state === 'boolean') {\n    group = state ? idGenerator.genUid() : '';\n  } else {\n    group = state;\n  }\n}\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n *\n * @param block The root block.\n * @returns List of block IDs.\n * @internal\n */\nexport function getDescendantIds(block: Block): string[] {\n  const ids = [];\n  const descendants = block.getDescendants(false);\n  for (let i = 0, descendant; (descendant = descendants[i]); i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n}\n\n/**\n * Decode the JSON into an event.\n *\n * @param json JSON representation.\n * @param workspace Target workspace for event.\n * @returns The event represented by the JSON.\n * @throws {Error} if an event type is not found in the registry.\n */\nexport function fromJson(\n  json: AnyDuringMigration,\n  workspace: Workspace,\n): Abstract {\n  const eventClass = get(json['type']);\n  if (!eventClass) throw Error('Unknown event type.');\n\n  return (eventClass as any).fromJson(json, workspace);\n}\n\n/**\n * Gets the class for a specific event type from the registry.\n *\n * @param eventType The type of the event to get.\n * @returns The event class with the given type.\n */\nexport function get(\n  eventType: string,\n): new (...p1: AnyDuringMigration[]) => Abstract {\n  const event = registry.getClass(registry.Type.EVENT, eventType);\n  if (!event) {\n    throw new Error(`Event type ${eventType} not found in registry.`);\n  }\n  return event;\n}\n\n/**\n * Enable/disable a block depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n * Recommend setting the 'disable' option to 'false' in the config so that\n * users don't try to re-enable disabled orphan blocks.\n *\n * @param event Custom data for event.\n */\nexport function disableOrphans(event: Abstract) {\n  if (event.type === MOVE || event.type === CREATE) {\n    const blockEvent = event as BlockMove | BlockCreate;\n    if (!blockEvent.workspaceId) {\n      return;\n    }\n    const eventWorkspace = common.getWorkspaceById(\n      blockEvent.workspaceId,\n    ) as WorkspaceSvg;\n    if (!blockEvent.blockId) {\n      throw new Error('Encountered a blockEvent without a proper blockId');\n    }\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\n    if (block) {\n      // Changing blocks as part of this event shouldn't be undoable.\n      const initialUndoFlag = recordUndo;\n      try {\n        recordUndo = false;\n        const parent = block.getParent();\n        if (parent && parent.isEnabled()) {\n          const children = block.getDescendants(false);\n          for (let i = 0, child; (child = children[i]); i++) {\n            child.setEnabled(true);\n          }\n        } else if (\n          (block.outputConnection || block.previousConnection) &&\n          !eventWorkspace.isDragging()\n        ) {\n          do {\n            block.setEnabled(false);\n            block = block.getNextBlock();\n          } while (block);\n        }\n      } finally {\n        recordUndo = initialUndoFlag;\n      }\n    }\n  }\n}\n\nexport const TEST_ONLY = {\n  FIRE_QUEUE,\n  fireNow,\n  fireInternal,\n  setGroupInternal,\n};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Touch\n\nimport type {Gesture} from './gesture.js';\n\n/** Length in ms for a touch to become a long press. */\nconst LONGPRESS = 750;\n\n/**\n * Whether touch is enabled in the browser.\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\n */\nexport const TOUCH_ENABLED =\n  'ontouchstart' in globalThis ||\n  !!(\n    globalThis['document'] &&\n    document.documentElement &&\n    'ontouchstart' in document.documentElement\n  ) || // IE10 uses non-standard touch events,\n  // so it has a different check.\n  !!(\n    globalThis['navigator'] &&\n    (globalThis['navigator']['maxTouchPoints'] ||\n      (globalThis['navigator'] as any)['msMaxTouchPoints'])\n  );\n\n/** Which touch events are we currently paying attention to? */\nlet touchIdentifier_: string | null = null;\n\n/**\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\n * in conjunction with mouse events.\n */\nexport const TOUCH_MAP: {[key: string]: string[]} = {\n  'mousedown': ['pointerdown'],\n  'mouseenter': ['pointerenter'],\n  'mouseleave': ['pointerleave'],\n  'mousemove': ['pointermove'],\n  'mouseout': ['pointerout'],\n  'mouseover': ['pointerover'],\n  'mouseup': ['pointerup', 'pointercancel'],\n  'touchend': ['pointerup'],\n  'touchcancel': ['pointercancel'],\n};\n\n/** PID of queued long-press task. */\nlet longPid_: AnyDuringMigration = 0;\n\n/**\n * Context menus on touch devices are activated using a long-press.\n * Unfortunately the contextmenu touch event is currently (2015) only supported\n * by Chrome.  This function is fired on any touchstart event, queues a task,\n * which after about a second opens the context menu.  The tasks is killed\n * if the touch event terminates early.\n *\n * @param e Touch start event.\n * @param gesture The gesture that triggered this longStart.\n * @internal\n */\nexport function longStart(e: PointerEvent, gesture: Gesture) {\n  longStop();\n  longPid_ = setTimeout(function () {\n    // Let the gesture route the right-click correctly.\n    if (gesture) {\n      gesture.handleRightClick(e);\n    }\n  }, LONGPRESS);\n}\n\n/**\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\n * or a drag hath begun.  Kill the queued long-press task.\n *\n * @internal\n */\nexport function longStop() {\n  if (longPid_) {\n    clearTimeout(longPid_);\n    longPid_ = 0;\n  }\n}\n\n/**\n * Clear the touch identifier that tracks which touch stream to pay attention\n * to.  This ends the current drag/gesture and allows other pointers to be\n * captured.\n */\nexport function clearTouchIdentifier() {\n  touchIdentifier_ = null;\n}\n\n/**\n * Decide whether Blockly should handle or ignore this event.\n * Mouse and touch events require special checks because we only want to deal\n * with one touch stream at a time.  All other events should always be handled.\n *\n * @param e The event to check.\n * @returns True if this event should be passed through to the registered\n *     handler; false if it should be blocked.\n */\nexport function shouldHandleEvent(e: Event): boolean {\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\n  // `click` and `contextmenu` are PointerEvents in some browsers,\n  // despite not starting with `pointer`, but we want to always handle them\n  // without worrying about touch identifiers.\n  return (\n    !e.type.startsWith('pointer') ||\n    (e instanceof PointerEvent && checkTouchIdentifier(e))\n  );\n}\n\n/**\n * Get the pointer identifier from the given event.\n *\n * @param e Pointer event.\n * @returns The pointerId of the event.\n */\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\n  return `${e.pointerId}`;\n}\n\n/**\n * Check whether the pointer identifier on the event matches the current saved\n * identifier. If the current identifier was unset, save the identifier from\n * the event. This starts a drag/gesture, during which pointer events with\n * other identifiers will be silently ignored.\n *\n * @param e Pointer event.\n * @returns Whether the identifier on the event matches the current saved\n *     identifier.\n */\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\n  const identifier = getTouchIdentifierFromEvent(e);\n\n  if (touchIdentifier_) {\n    // We're already tracking some touch/mouse event.  Is this from the same\n    // source?\n    return touchIdentifier_ === identifier;\n  }\n  if (e.type === 'pointerdown') {\n    // No identifier set yet, and this is the start of a drag.  Set it and\n    // return.\n    touchIdentifier_ = identifier;\n    return true;\n  }\n  // There was no identifier yet, but this wasn't a start event so we're going\n  // to ignore it.  This probably means that another drag finished while this\n  // pointer was down.\n  return false;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.browserEvents\n\nimport * as Touch from './touch.js';\nimport * as userAgent from './utils/useragent.js';\n\n/**\n * Blockly opaque event data used to unbind events when using\n * `bind` and `conditionalBind`.\n */\nexport type Data = [EventTarget, string, (e: Event) => void][];\n\n/**\n * The multiplier for scroll wheel deltas using the line delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst LINE_MODE_MULTIPLIER = 40;\n\n/**\n * The multiplier for scroll wheel deltas using the page delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst PAGE_MODE_MULTIPLIER = 125;\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function conditionalBind(\n  node: EventTarget,\n  name: string,\n  thisObject: Object | null,\n  func: Function,\n  opt_noCaptureIdentifier?: boolean,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    const captureIdentifier = !opt_noCaptureIdentifier;\n\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\n      if (thisObject) {\n        func.call(thisObject, e);\n      } else {\n        func(e);\n      }\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function bind(\n  node: EventTarget,\n  name: string,\n  thisObject: Object | null,\n  func: Function,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    if (thisObject) {\n      func.call(thisObject, e);\n    } else {\n      func(e);\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n */\nexport function unbind(bindData: Data): (e: Event) => void {\n  // Accessing an element of the last property of the array is unsafe if the\n  // bindData is an empty array. But that should never happen because developers\n  // should only pass Data from bind or conditionalBind.\n  const callback = bindData[bindData.length - 1][2];\n  while (bindData.length) {\n    const [node, name, func] = bindData.pop()!;\n    node.removeEventListener(name, func, false);\n  }\n  return callback;\n}\n\n/**\n * Returns true if this event is targeting a text input widget?\n *\n * @param e An event.\n * @returns True if text input.\n */\nexport function isTargetInput(e: Event): boolean {\n  if (e.target instanceof HTMLElement) {\n    if (\n      e.target.isContentEditable ||\n      e.target.getAttribute('data-is-text-input') === 'true'\n    ) {\n      return true;\n    }\n\n    if (e.target instanceof HTMLInputElement) {\n      const target = e.target;\n      return (\n        target.type === 'text' ||\n        target.type === 'number' ||\n        target.type === 'email' ||\n        target.type === 'password' ||\n        target.type === 'search' ||\n        target.type === 'tel' ||\n        target.type === 'url'\n      );\n    }\n\n    if (e.target instanceof HTMLTextAreaElement) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Returns true this event is a right-click.\n *\n * @param e Mouse event.\n * @returns True if right-click.\n */\nexport function isRightButton(e: MouseEvent): boolean {\n  if (e.ctrlKey && userAgent.MAC) {\n    // Control-clicking on Mac OS X is treated as a right-click.\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\n    return true;\n  }\n  return e.button === 2;\n}\n\n/**\n * Returns the converted coordinates of the given mouse event.\n * The origin (0,0) is the top-left corner of the Blockly SVG.\n *\n * @param e Mouse event.\n * @param svg SVG element.\n * @param matrix Inverted screen CTM to use.\n * @returns Object with .x and .y properties.\n */\nexport function mouseToSvg(\n  e: MouseEvent,\n  svg: SVGSVGElement,\n  matrix: SVGMatrix | null,\n): SVGPoint {\n  const svgPoint = svg.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n\n  if (!matrix) {\n    matrix = svg.getScreenCTM()!.inverse();\n  }\n  return svgPoint.matrixTransform(matrix);\n}\n\n/**\n * Returns the scroll delta of a mouse event in pixel units.\n *\n * @param e Mouse event.\n * @returns Scroll delta object with .x and .y properties.\n */\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number; y: number} {\n  switch (e.deltaMode) {\n    case 0x00: // Pixel mode.\n    default:\n      return {x: e.deltaX, y: e.deltaY};\n    case 0x01: // Line mode.\n      return {\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\n      };\n    case 0x02: // Page mode.\n      return {\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\n      };\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.array\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @internal\n */\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\n  const i = arr.indexOf(value);\n  if (i === -1) {\n    return false;\n  }\n  arr.splice(i, 1);\n  return true;\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Css\n\n/** Has CSS already been injected? */\nlet injected = false;\n\n/**\n * Add some CSS to the blob that will be injected later.  Allows optional\n * components such as fields and the toolbox to store separate CSS.\n *\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\n */\nexport function register(cssContent: string) {\n  if (injected) {\n    throw Error('CSS already injected');\n  }\n  content += '\\n' + cssContent;\n}\n\n/**\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\n * file since:\n * a) It loads synchronously and doesn't force a redraw later.\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\n * c) The CSS content may be made dynamic depending on init options.\n *\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\n *     document's responsibility).\n * @param pathToMedia Path from page to the Blockly media directory.\n */\nexport function inject(hasCss: boolean, pathToMedia: string) {\n  // Only inject the CSS once.\n  if (injected) {\n    return;\n  }\n  injected = true;\n  if (!hasCss) {\n    return;\n  }\n  // Strip off any trailing slash (either Unix or Windows).\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\n  // Cleanup the collected css content after injecting it to the DOM.\n  content = '';\n\n  // Inject CSS tag at start of head.\n  const cssNode = document.createElement('style');\n  cssNode.id = 'blockly-common-style';\n  const cssTextNode = document.createTextNode(cssContent);\n  cssNode.appendChild(cssTextNode);\n  document.head.insertBefore(cssNode, document.head.firstChild);\n}\n\n/**\n * The CSS content for Blockly.\n */\nlet content = `\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don't allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n`;\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.deprecation\n\n/**\n * Warn developers that a function or property is deprecated.\n *\n * @param name The name of the function or property.\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param opt_use The name of a function or property to use instead, if any.\n * @internal\n */\nexport function warn(\n  name: string,\n  deprecationDate: string,\n  deletionDate: string,\n  opt_use?: string,\n) {\n  let msg =\n    name +\n    ' was deprecated in ' +\n    deprecationDate +\n    ' and will be deleted in ' +\n    deletionDate +\n    '.';\n  if (opt_use) {\n    msg += '\\nUse ' + opt_use + ' instead.';\n  }\n  console.warn(msg);\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.dom\n\nimport * as deprecation from './deprecation.js';\nimport type {Svg} from './svg.js';\n\n/**\n * Required name space for SVG elements.\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Required name space for HTML elements.\n */\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\n\n/**\n * Required name space for XLINK elements.\n */\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\n\n/**\n * Node type constants.\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n */\nexport enum NodeType {\n  ELEMENT_NODE = 1,\n  TEXT_NODE = 3,\n  COMMENT_NODE = 8,\n}\n\n/** Temporary cache of text widths. */\nlet cacheWidths: {[key: string]: number} | null = null;\n\n/** Number of current references to cache. */\nlet cacheReference = 0;\n\n/** A HTML canvas context used for computing text width. */\nlet canvasContext: CanvasRenderingContext2D | null = null;\n\n/**\n * Helper method for creating SVG elements.\n *\n * @param name Element's tag name.\n * @param attrs Dictionary of attribute names and values.\n * @param opt_parent Optional parent on which to append the element.\n * @returns if name is a string or a more specific type if it a member of Svg.\n */\nexport function createSvgElement<T extends SVGElement>(\n  name: string | Svg<T>,\n  attrs: {[key: string]: string | number},\n  opt_parent?: Element | null,\n): T {\n  const e = document.createElementNS(SVG_NS, `${name}`) as T;\n  for (const key in attrs) {\n    e.setAttribute(key, `${attrs[key]}`);\n  }\n  if (opt_parent) {\n    opt_parent.appendChild(e);\n  }\n  return e;\n}\n\n/**\n * Add a CSS class to a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to add class to.\n * @param className Name of class to add.\n * @returns True if class was added, false if already present.\n */\nexport function addClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.add(...classNames);\n  return true;\n}\n\n/**\n * Removes multiple classes from an element.\n *\n * @param element DOM element to remove classes from.\n * @param classNames A string of one or multiple class names for an element.\n */\nexport function removeClasses(element: Element, classNames: string) {\n  element.classList.remove(...classNames.split(' '));\n}\n\n/**\n * Remove a CSS class from a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to remove class from.\n * @param className Name of class to remove.\n * @returns True if class was removed, false if never present.\n */\nexport function removeClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => !element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.remove(...classNames);\n  return true;\n}\n\n/**\n * Checks if an element has the specified CSS class.\n *\n * @param element DOM element to check.\n * @param className Name of class to check.\n * @returns True if class exists, false otherwise.\n */\nexport function hasClass(element: Element, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Removes a node from its parent. No-op if not attached to a parent.\n *\n * @param node The node to remove.\n * @returns The node removed if removed; else, null.\n */\n// Copied from Closure goog.dom.removeNode\nexport function removeNode(node: Node | null): Node | null {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * Insert a node after a reference node.\n * Contrast with node.insertBefore function.\n *\n * @param newNode New element to insert.\n * @param refNode Existing element to precede new node.\n */\nexport function insertAfter(newNode: Element, refNode: Element) {\n  const siblingNode = refNode.nextSibling;\n  const parentNode = refNode.parentNode;\n  if (!parentNode) {\n    throw Error('Reference node has no parent.');\n  }\n  if (siblingNode) {\n    parentNode.insertBefore(newNode, siblingNode);\n  } else {\n    parentNode.appendChild(newNode);\n  }\n}\n\n/**\n * Whether a node contains another node.\n *\n * @param parent The node that should contain the other node.\n * @param descendant The node to test presence of.\n * @returns Whether the parent node contains the descendant node.\n * @deprecated Use native 'contains' DOM method.\n */\nexport function containsNode(parent: Node, descendant: Node): boolean {\n  deprecation.warn(\n    'Blockly.utils.dom.containsNode',\n    'version 10',\n    'version 11',\n    'Use native \"contains\" DOM method',\n  );\n  return parent.contains(descendant);\n}\n\n/**\n * Sets the CSS transform property on an element. This function sets the\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\n * with older browsers. See https://caniuse.com/#feat=transforms2d\n *\n * @param element Element to which the CSS transform will be applied.\n * @param transform The value of the CSS `transform` property.\n */\nexport function setCssTransform(\n  element: HTMLElement | SVGElement,\n  transform: string,\n) {\n  element.style['transform'] = transform;\n  element.style['-webkit-transform' as any] = transform;\n}\n\n/**\n * Start caching text widths. Every call to this function MUST also call\n * stopTextWidthCache. Caches must not survive between execution threads.\n */\nexport function startTextWidthCache() {\n  cacheReference++;\n  if (!cacheWidths) {\n    cacheWidths = Object.create(null);\n  }\n}\n\n/**\n * Stop caching field widths. Unless caching was already on when the\n * corresponding call to startTextWidthCache was made.\n */\nexport function stopTextWidthCache() {\n  cacheReference--;\n  if (!cacheReference) {\n    cacheWidths = null;\n  }\n}\n\n/**\n * Gets the width of a text element, caching it in the process.\n *\n * @param textElement An SVG 'text' element.\n * @returns Width of element.\n */\nexport function getTextWidth(textElement: SVGTextElement): number {\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\n  let width;\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  // Attempt to compute fetch the width of the SVG text element.\n  try {\n    width = textElement.getComputedTextLength();\n  } catch (e) {\n    // In other cases where we fail to get the computed text. Instead, use an\n    // approximation and do not cache the result. At some later point in time\n    // when the block is inserted into the visible DOM, this method will be\n    // called again and, at that point in time, will not throw an exception.\n    return textElement.textContent!.length * 8;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidth(\n  textElement: SVGTextElement,\n  fontSize: number,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  return getFastTextWidthWithSizeString(\n    textElement,\n    fontSize + 'pt',\n    fontWeight,\n    fontFamily,\n  );\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n * This method is similar to `getFastTextWidth` but expects the font size\n * parameter to be a string.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidthWithSizeString(\n  textElement: SVGTextElement,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  const text = textElement.textContent;\n  const key = text + '\\n' + textElement.className.baseVal;\n  let width;\n\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  if (!canvasContext) {\n    // Inject the canvas element used for computing text widths.\n    const computeCanvas = document.createElement('canvas');\n    computeCanvas.className = 'blocklyComputeCanvas';\n    document.body.appendChild(computeCanvas);\n\n    // Initialize the HTML canvas context and set the font.\n    // The context font must match blocklyText's fontsize and font-family\n    // set in CSS.\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\n  }\n  // Set the desired font size and family.\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n\n  // Measure the text width using the helper canvas context.\n  if (text) {\n    width = canvasContext.measureText(text).width;\n  } else {\n    width = 0;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Measure a font's metrics. The height and baseline values.\n *\n * @param text Text to measure the font dimensions of.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Font measurements.\n */\nexport function measureFontMetrics(\n  text: string,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): {height: number; baseline: number} {\n  const span = document.createElement('span');\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n  span.textContent = text;\n\n  const block = document.createElement('div');\n  block.style.width = '1px';\n  block.style.height = '0';\n\n  const div = document.createElement('div');\n  div.style.display = 'flex';\n  div.style.position = 'fixed';\n  div.style.top = '0';\n  div.style.left = '0';\n  div.appendChild(span);\n  div.appendChild(block);\n\n  document.body.appendChild(div);\n  const result = {\n    height: 0,\n    baseline: 0,\n  };\n  try {\n    div.style.alignItems = 'baseline';\n    result.baseline = block.offsetTop - span.offsetTop;\n    div.style.alignItems = 'flex-end';\n    result.height = block.offsetTop - span.offsetTop;\n  } finally {\n    document.body.removeChild(div);\n  }\n  return result;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.style\n\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport {Size} from './size.js';\n\n/**\n * Gets the height and width of an element.\n * Similar to Closure's goog.style.getSize\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nexport function getSize(element: Element): Size {\n  return TEST_ONLY.getSizeInternal(element);\n}\n\n/**\n * Private version of getSize for stubbing in tests.\n */\nfunction getSizeInternal(element: Element): Size {\n  if (getComputedStyle(element, 'display') !== 'none') {\n    return getSizeWithDisplay(element);\n  }\n\n  // Evaluate size with a temporary element.\n  // AnyDuringMigration because:  Property 'style' does not exist on type\n  // 'Element'.\n  const style = (element as AnyDuringMigration).style;\n  const originalDisplay = style.display;\n  const originalVisibility = style.visibility;\n  const originalPosition = style.position;\n\n  style.visibility = 'hidden';\n  style.position = 'absolute';\n  style.display = 'inline';\n\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n\n  style.display = originalDisplay;\n  style.position = originalPosition;\n  style.visibility = originalVisibility;\n\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Gets the height and width of an element when the display is not none.\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nfunction getSizeWithDisplay(element: Element): Size {\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Retrieves a computed style value of a node. It returns empty string\n * if the property requested is an SVG one and it has not been\n * explicitly set (firefox and webkit).\n *\n * Copied from Closure's goog.style.getComputedStyle\n *\n * @param element Element to get style of.\n * @param property Property to get (camel-case).\n * @returns Style value.\n */\nexport function getComputedStyle(element: Element, property: string): string {\n  const styles = window.getComputedStyle(element);\n  // element.style[..] is undefined for browser specific styles\n  // as 'filter'.\n  return (\n    (styles as AnyDuringMigration)[property] ||\n    styles.getPropertyValue(property)\n  );\n}\n\n/**\n * Returns a Coordinate object relative to the top-left of the HTML document.\n * Similar to Closure's goog.style.getPageOffset\n *\n * @param el Element to get the page offset for.\n * @returns The page offset.\n */\nexport function getPageOffset(el: Element): Coordinate {\n  const pos = new Coordinate(0, 0);\n  const box = el.getBoundingClientRect();\n  const documentElement = document.documentElement;\n  // Must add the scroll coordinates in to get the absolute page offset\n  // of element since getBoundingClientRect returns relative coordinates to\n  // the viewport.\n  const scrollCoord = new Coordinate(\n    window.pageXOffset || documentElement.scrollLeft,\n    window.pageYOffset || documentElement.scrollTop,\n  );\n  pos.x = box.left + scrollCoord.x;\n  pos.y = box.top + scrollCoord.y;\n\n  return pos;\n}\n\n/**\n * Calculates the viewport coordinates relative to the document.\n * Similar to Closure's goog.style.getViewportPageOffset\n *\n * @returns The page offset of the viewport.\n */\nexport function getViewportPageOffset(): Coordinate {\n  const body = document.body;\n  const documentElement = document.documentElement;\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\n/**\n * Gets the computed border widths (on all sides) in pixels\n * Copied from Closure's goog.style.getBorderBox\n *\n * @param element  The element to get the border widths for.\n * @returns The computed border widths.\n */\nexport function getBorderBox(element: Element): Rect {\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\n\n  return new Rect(top, bottom, left, right);\n}\n\n/**\n * Changes the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.scrollIntoContainerView\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n */\nexport function scrollIntoContainerView(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n) {\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\n  container.scrollLeft = offset.x;\n  container.scrollTop = offset.y;\n}\n\n/**\n * Calculate the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @returns The new scroll position of the container.\n */\nexport function getContainerOffsetToScrollInto(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n): Coordinate {\n  // Absolute position of the element's border's top left corner.\n  const elementPos = getPageOffset(element);\n  // Absolute position of the container's border's top left corner.\n  const containerPos = getPageOffset(container);\n  const containerBorder = getBorderBox(container);\n  // Relative pos. of the element's border box to the container's content box.\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\n  // How much the element can move in the container, i.e. the difference between\n  // the element's bottom-right-most and top-left-most position where it's\n  // fully visible.\n  const elementSize = getSizeWithDisplay(element);\n  const spaceX = container.clientWidth - elementSize.width;\n  const spaceY = container.clientHeight - elementSize.height;\n  let scrollLeft = container.scrollLeft;\n  let scrollTop = container.scrollTop;\n  if (opt_center) {\n    // All browsers round non-integer scroll positions down.\n    scrollLeft += relX - spaceX / 2;\n    scrollTop += relY - spaceY / 2;\n  } else {\n    // This formula was designed to give the correct scroll values in the\n    // following cases:\n    // - element is higher than container (spaceY < 0) => scroll down by relY\n    // - element is not higher that container (spaceY >= 0):\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\n    //   - it is in the container => don't scroll\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\n  }\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\nexport const TEST_ONLY = {\n  getSizeInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgMath\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport * as style from './style.js';\n\n/**\n * Static regex to pull the x,y values out of an SVG translate() directive.\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\n * 'translate(12, 0)'.\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\n * Note that IE has been reported to return scientific notation (0.123456e-42).\n */\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\n\n/**\n * Static regex to pull the x,y values out of a translate() or translate3d()\n * style property.\n * Accounts for same exceptions as XY_REGEX.\n */\nconst XY_STYLE_REGEX =\n  /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  const xy = new Coordinate(0, 0);\n  // First, check for x and y attributes.\n  // Checking for the existence of x/y properties is faster than getAttribute.\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\n  // to get the number.\n  const x = (element as any).x && element.getAttribute('x');\n  const y = (element as any).y && element.getAttribute('y');\n  if (x) {\n    xy.x = parseInt(x);\n  }\n  if (y) {\n    xy.y = parseInt(y);\n  }\n  // Second, check for transform=\"translate(...)\" attribute.\n  const transform = element.getAttribute('transform');\n  const r = transform && transform.match(XY_REGEX);\n  if (r) {\n    xy.x += Number(r[1]);\n    if (r[3]) {\n      xy.y += Number(r[3]);\n    }\n  }\n\n  // Then check for style = transform: translate(...) or translate3d(...)\n  const style = element.getAttribute('style');\n  if (style && style.indexOf('translate') > -1) {\n    const styleComponents = style.match(XY_STYLE_REGEX);\n    if (styleComponents) {\n      xy.x += Number(styleComponents[1]);\n      if (styleComponents[3]) {\n        xy.y += Number(styleComponents[3]);\n      }\n    }\n  }\n  return xy;\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n */\nexport function getInjectionDivXY(element: Element): Coordinate {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    const xy = getRelativeXY(element);\n    x = x + xy.x;\n    y = y + xy.y;\n    const classes = element.getAttribute('class') || '';\n    if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n      break;\n    }\n    element = element.parentNode as Element;\n  }\n  return new Coordinate(x, y);\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  // Pixels, in window coordinates.\n  const scrollOffset = style.getViewportPageOffset();\n  return new Rect(\n    scrollOffset.y,\n    document.documentElement.clientHeight + scrollOffset.y,\n    scrollOffset.x,\n    document.documentElement.clientWidth + scrollOffset.x,\n  );\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n */\nexport function getDocumentScroll(): Coordinate {\n  const el = document.documentElement;\n  const win = window;\n  return new Coordinate(\n    win.pageXOffset || el.scrollLeft,\n    win.pageYOffset || el.scrollTop,\n  );\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n  ws: WorkspaceSvg,\n  screenCoordinates: Coordinate,\n): Coordinate {\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels = new Coordinate(\n    screenX - boundingRect.left,\n    screenY - boundingRect.top,\n  );\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffsetPixels = Coordinate.difference(\n    clientOffsetPixels,\n    mainOffsetPixels,\n  );\n  // The position in main workspace coordinates.\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\n  return finalOffsetMainWs;\n}\n\n/**\n * Converts workspace coordinates to screen coordinates.\n *\n * @param ws The workspace to get the coordinates out of.\n * @param workspaceCoordinates  The workspace coordinates to be converted\n *     to screen coordinates.\n * @returns The screen coordinates.\n */\nexport function wsToScreenCoordinates(\n  ws: WorkspaceSvg,\n  workspaceCoordinates: Coordinate,\n): Coordinate {\n  // Fix workspace scale vs browser scale.\n  const screenCoordinates = workspaceCoordinates.scale(ws.scale);\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  const boundingRect = injectionDiv.getBoundingClientRect();\n  const mainOffset = ws.getOriginOffsetInPixels();\n\n  // Fix workspace origin vs browser origin.\n  return new Coordinate(\n    screenX + boundingRect.left + mainOffset.x,\n    screenY + boundingRect.top + mainOffset.y,\n  );\n}\n\nexport const TEST_ONLY = {\n  XY_REGEX,\n  XY_STYLE_REGEX,\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.xml\n\nlet domParser: DOMParser = {\n  parseFromString: function () {\n    throw new Error(\n      'DOMParser was not found in the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\nlet xmlSerializer: XMLSerializer = {\n  serializeToString: function () {\n    throw new Error(\n      'XMLSerializer was not foundin the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\n/**\n * Injected dependencies.  By default these are just (and have the\n * same types as) the corresponding DOM Window properties, but the\n * Node.js wrapper for Blockly (see scripts/package/node/core.js)\n * calls injectDependencies to supply implementations from the jsdom\n * package instead.\n */\nlet {document, DOMParser, XMLSerializer} = globalThis;\nif (DOMParser) domParser = new DOMParser();\nif (XMLSerializer) xmlSerializer = new XMLSerializer();\n\n/**\n * Inject implementations of document, DOMParser and/or XMLSerializer\n * to use instead of the default ones.\n *\n * Used by the Node.js wrapper for Blockly (see\n * scripts/package/node/core.js) to supply implementations from the\n * jsdom package instead.\n *\n * While they may be set individually, it is normally the case that\n * all three will be sourced from the same JSDOM instance.  They MUST\n * at least come from the same copy of the jsdom package.  (Typically\n * this is hard to avoid satsifying this requirement, but it can be\n * inadvertently violated by using webpack to build multiple bundles\n * containing Blockly and jsdom, and then loading more than one into\n * the same JavaScript runtime.  See\n * https://github.com/google/blockly-samples/pull/1452#issuecomment-1364442135\n * for an example of how this happened.)\n *\n * @param dependencies Options object containing dependencies to set.\n */\nexport function injectDependencies(dependencies: {\n  document?: Document;\n  DOMParser?: typeof DOMParser;\n  XMLSerializer?: typeof XMLSerializer;\n}) {\n  ({\n    // Default to existing value if option not supplied.\n    document = document,\n    DOMParser = DOMParser,\n    XMLSerializer = XMLSerializer,\n  } = dependencies);\n\n  domParser = new DOMParser();\n  xmlSerializer = new XMLSerializer();\n}\n\n/**\n * Namespace for Blockly's XML.\n */\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\n\n// eslint-disable-next-line no-control-regex\nconst INVALID_CONTROL_CHARS = /[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F]/g;\n\n/**\n * Create DOM element for XML.\n *\n * @param tagName Name of DOM element.\n * @returns New DOM element.\n */\nexport function createElement(tagName: string): Element {\n  return document.createElementNS(NAME_SPACE, tagName);\n}\n\n/**\n * Create text element for XML.\n *\n * @param text Text content.\n * @returns New DOM text node.\n */\nexport function createTextNode(text: string): Text {\n  return document.createTextNode(text);\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * Control characters should be escaped. (But we will try to best-effort parse\n * unescaped characters.)\n *\n * Note that even when escaped, U+0000 will be parsed as U+FFFD (the\n * \"replacement character\") because U+0000 is never a valid XML character\n * (even in XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n */\nexport function textToDom(text: string): Element {\n  let doc = domParser.parseFromString(text, 'text/xml');\n  if (\n    doc &&\n    doc.documentElement &&\n    !doc.getElementsByTagName('parsererror').length\n  ) {\n    return doc.documentElement;\n  }\n\n  // Attempt to parse as HTML to deserialize control characters that were\n  // serialized before the serializer did proper escaping.\n  doc = domParser.parseFromString(text, 'text/html');\n  if (\n    doc &&\n    doc.body.firstChild &&\n    doc.body.firstChild.nodeName.toLowerCase() === 'xml'\n  ) {\n    return doc.body.firstChild as Element;\n  }\n\n  throw new Error(`DOMParser was unable to parse: ${text}`);\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace.\n *\n * Control characters are escaped using their decimal encodings. This includes\n * U+0000 even though it is technically never a valid XML character (even in\n * XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * When decoded U+0000 will be parsed as U+FFFD (the \"replacement character\").\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  return sanitizeText(xmlSerializer.serializeToString(dom));\n}\n\nfunction sanitizeText(text: string) {\n  return text.replace(\n    INVALID_CONTROL_CHARS,\n    (match) => `&#${match.charCodeAt(0)};`,\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.toolbox\n\nimport type {ConnectionState} from '../serialization/blocks.js';\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\nimport * as utilsXml from './xml.js';\n\n/**\n * The information needed to create a block in the toolbox.\n * Note that disabled has a different type for backwards compatibility.\n */\nexport interface BlockInfo {\n  kind: string;\n  blockxml?: string | Node;\n  type?: string;\n  gap?: string | number;\n  disabled?: string | boolean;\n  enabled?: boolean;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * The information needed to create a separator in the toolbox.\n */\nexport interface SeparatorInfo {\n  kind: string;\n  id: string | undefined;\n  gap: number | undefined;\n  cssconfig: SeparatorCssConfig | undefined;\n}\n\n/**\n * The information needed to create a button in the toolbox.\n */\nexport interface ButtonInfo {\n  kind: string;\n  text: string;\n  callbackkey: string;\n}\n\n/**\n * The information needed to create a label in the toolbox.\n */\nexport interface LabelInfo {\n  kind: string;\n  text: string;\n  id: string | undefined;\n}\n\n/**\n * The information needed to create either a button or a label in the flyout.\n */\nexport type ButtonOrLabelInfo = ButtonInfo | LabelInfo;\n\n/**\n * The information needed to create a category in the toolbox.\n */\nexport interface StaticCategoryInfo {\n  kind: string;\n  name: string;\n  contents: ToolboxItemInfo[];\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create a custom category.\n */\nexport interface DynamicCategoryInfo {\n  kind: string;\n  custom: string;\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create either a dynamic or static category.\n */\nexport type CategoryInfo = StaticCategoryInfo | DynamicCategoryInfo;\n\n/**\n * Any information that can be used to create an item in the toolbox.\n */\nexport type ToolboxItemInfo = FlyoutItemInfo | StaticCategoryInfo;\n\n/**\n * All the different types that can be displayed in a flyout.\n */\nexport type FlyoutItemInfo =\n  | BlockInfo\n  | SeparatorInfo\n  | ButtonInfo\n  | LabelInfo\n  | DynamicCategoryInfo;\n\n/**\n * The JSON definition of a toolbox.\n */\nexport interface ToolboxInfo {\n  kind?: string;\n  contents: ToolboxItemInfo[];\n}\n\n/**\n * An array holding flyout items.\n */\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\n\n/**\n * All of the different types that can create a toolbox.\n */\nexport type ToolboxDefinition = Node | ToolboxInfo | string;\n\n/**\n * All of the different types that can be used to show items in a flyout.\n */\nexport type FlyoutDefinition =\n  | FlyoutItemInfoArray\n  | NodeList\n  | ToolboxInfo\n  | Node[];\n\n/**\n * The name used to identify a toolbox that has category like items.\n * This only needs to be used if a toolbox wants to be treated like a category\n * toolbox but does not actually contain any toolbox items with the kind\n * 'category'.\n */\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\n\n/**\n * The name used to identify a toolbox that has no categories and is displayed\n * as a simple flyout displaying blocks, buttons, or labels.\n */\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\n\n/**\n * Position of the toolbox and/or flyout relative to the workspace.\n */\nexport enum Position {\n  TOP,\n  BOTTOM,\n  LEFT,\n  RIGHT,\n}\n\n/**\n * Converts the toolbox definition into toolbox JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n * @internal\n */\nexport function convertToolboxDefToJson(\n  toolboxDef: ToolboxDefinition | null,\n): ToolboxInfo | null {\n  if (!toolboxDef) {\n    return null;\n  }\n\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\n    toolboxDef = parseToolboxTree(toolboxDef);\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\n    // assignable to parameter of type 'Node'.\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\n  }\n\n  const toolboxJson = toolboxDef as ToolboxInfo;\n  validateToolbox(toolboxJson);\n  return toolboxJson;\n}\n\n/**\n * Validates the toolbox JSON fields have been set correctly.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @throws {Error} if the toolbox is not the correct format.\n */\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\n  const toolboxKind = toolboxJson['kind'];\n  const toolboxContents = toolboxJson['contents'];\n\n  if (toolboxKind) {\n    if (\n      toolboxKind !== FLYOUT_TOOLBOX_KIND &&\n      toolboxKind !== CATEGORY_TOOLBOX_KIND\n    ) {\n      throw Error(\n        'Invalid toolbox kind ' +\n          toolboxKind +\n          '.' +\n          ' Please supply either ' +\n          FLYOUT_TOOLBOX_KIND +\n          ' or ' +\n          CATEGORY_TOOLBOX_KIND,\n      );\n    }\n  }\n  if (!toolboxContents) {\n    throw Error('Toolbox must have a contents attribute.');\n  }\n}\n\n/**\n * Converts the flyout definition into a list of flyout items.\n *\n * @param flyoutDef The definition of the flyout in one of its many forms.\n * @returns A list of flyout items.\n * @internal\n */\nexport function convertFlyoutDefToJsonArray(\n  flyoutDef: FlyoutDefinition | null,\n): FlyoutItemInfoArray {\n  if (!flyoutDef) {\n    return [];\n  }\n\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\n    return (flyoutDef as AnyDuringMigration)['contents'];\n  }\n  // If it is already in the correct format return the flyoutDef.\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\n  // 'Node | FlyoutItemInfo'.\n  if (\n    Array.isArray(flyoutDef) &&\n    flyoutDef.length > 0 &&\n    !(flyoutDef[0] as AnyDuringMigration).nodeType\n  ) {\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\n    // assignable to type 'FlyoutItemInfoArray'.\n    return flyoutDef as AnyDuringMigration;\n  }\n\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\n  // is not assignable to type 'FlyoutItemInfoArray'.\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\n}\n\n/**\n * Whether or not the toolbox definition has categories.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @returns True if the toolbox has categories.\n * @internal\n */\nexport function hasCategories(toolboxJson: ToolboxInfo | null): boolean {\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\n}\n\n/**\n * Private version of hasCategories for stubbing in tests.\n */\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo | null): boolean {\n  if (!toolboxJson) {\n    return false;\n  }\n\n  const toolboxKind = toolboxJson['kind'];\n  if (toolboxKind) {\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\n  }\n\n  const categories = toolboxJson['contents'].filter(function (item) {\n    return item['kind'].toUpperCase() === 'CATEGORY';\n  });\n  return !!categories.length;\n}\n\n/**\n * Whether or not the category is collapsible.\n *\n * @param categoryInfo Object holing information for creating a category.\n * @returns True if the category has subcategories.\n * @internal\n */\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\n    return false;\n  }\n\n  const categories = (categoryInfo as AnyDuringMigration)['contents'].filter(\n    function (item: AnyDuringMigration) {\n      return item['kind'].toUpperCase() === 'CATEGORY';\n    },\n  );\n  return !!categories.length;\n}\n\n/**\n * Parses the provided toolbox definition into a consistent format.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n */\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\n  const toolboxJson = {'contents': contents};\n  if (toolboxDef instanceof Node) {\n    addAttributes(toolboxDef, toolboxJson);\n  }\n  return toolboxJson;\n}\n\n/**\n * Converts the xml for a toolbox to JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns A list of objects in the toolbox.\n */\nfunction xmlToJsonArray(\n  toolboxDef: Node | Node[] | NodeList,\n): FlyoutItemInfoArray | ToolboxItemInfo[] {\n  const arr = [];\n  // If it is a node it will have children.\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\n  // 'Node | NodeList | Node[]'.\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\n  if (!childNodes) {\n    // Otherwise the toolboxDef is an array or collection.\n    childNodes = toolboxDef;\n  }\n  for (let i = 0, child; (child = childNodes[i]); i++) {\n    if (!child.tagName) {\n      continue;\n    }\n    const obj = {};\n    const tagName = child.tagName.toUpperCase();\n    (obj as AnyDuringMigration)['kind'] = tagName;\n\n    // Store the XML for a block.\n    if (tagName === 'BLOCK') {\n      (obj as AnyDuringMigration)['blockxml'] = child;\n    } else if (child.childNodes && child.childNodes.length > 0) {\n      // Get the contents of a category\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\n    }\n\n    // Add XML attributes to object\n    addAttributes(child, obj);\n    arr.push(obj);\n  }\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\n  return arr as AnyDuringMigration;\n}\n\n/**\n * Adds the attributes on the node to the given object.\n *\n * @param node The node to copy the attributes from.\n * @param obj The object to copy the attributes to.\n */\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\n  // 'Node'.\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\n    // 'Node'.\n    const attr = (node as AnyDuringMigration).attributes[j];\n    if (attr.nodeName.indexOf('css-') > -1) {\n      obj['cssconfig'] = obj['cssconfig'] || {};\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\n    } else {\n      obj[attr.nodeName] = attr.value;\n    }\n  }\n}\n\n/**\n * Parse the provided toolbox tree into a consistent DOM format.\n *\n * @param toolboxDef DOM tree of blocks, or text representation of same.\n * @returns DOM tree of blocks, or null.\n */\nexport function parseToolboxTree(\n  toolboxDef: Element | null | string,\n): Element | null {\n  let parsedToolboxDef: Element | null = null;\n  if (toolboxDef) {\n    if (typeof toolboxDef === 'string') {\n      parsedToolboxDef = utilsXml.textToDom(toolboxDef);\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\n        throw TypeError('Toolbox should be an <xml> document.');\n      }\n    } else if (toolboxDef instanceof Element) {\n      parsedToolboxDef = toolboxDef;\n    }\n  }\n  return parsedToolboxDef;\n}\n\nexport const TEST_ONLY = {\n  hasCategoriesInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.uiPosition\n\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Enum for vertical positioning.\n *\n * @internal\n */\nexport enum verticalPosition {\n  TOP,\n  BOTTOM,\n}\n\n/**\n * Enum for horizontal positioning.\n *\n * @internal\n */\nexport enum horizontalPosition {\n  LEFT,\n  RIGHT,\n}\n\n/**\n * An object defining a horizontal and vertical positioning.\n *\n * @internal\n */\nexport interface Position {\n  horizontal: horizontalPosition;\n  vertical: verticalPosition;\n}\n\n/**\n * Enum for bump rules to use for dealing with collisions.\n *\n * @internal\n */\nexport enum bumpDirection {\n  UP,\n  DOWN,\n}\n\n/**\n * Returns a rectangle representing reasonable position for where to place a UI\n * element of the specified size given the restraints and locations of the\n * scrollbars. This method does not take into account any already placed UI\n * elements.\n *\n * @param position The starting horizontal and vertical position.\n * @param size the size of the UI element to get a start position for.\n * @param horizontalPadding The horizontal padding to use.\n * @param verticalPadding The vertical padding to use.\n * @param metrics The workspace UI metrics.\n * @param workspace The workspace.\n * @returns The suggested start position.\n * @internal\n */\nexport function getStartPositionRect(\n  position: Position,\n  size: Size,\n  horizontalPadding: number,\n  verticalPadding: number,\n  metrics: UiMetrics,\n  workspace: WorkspaceSvg,\n): Rect {\n  // Horizontal positioning.\n  let left = 0;\n  const hasVerticalScrollbar =\n    workspace.scrollbar && workspace.scrollbar.canScrollVertically();\n  if (position.horizontal === horizontalPosition.LEFT) {\n    left = metrics.absoluteMetrics.left + horizontalPadding;\n    if (hasVerticalScrollbar && workspace.RTL) {\n      left += Scrollbar.scrollbarThickness;\n    }\n  } else {\n    // position.horizontal === horizontalPosition.RIGHT\n    left =\n      metrics.absoluteMetrics.left +\n      metrics.viewMetrics.width -\n      size.width -\n      horizontalPadding;\n    if (hasVerticalScrollbar && !workspace.RTL) {\n      left -= Scrollbar.scrollbarThickness;\n    }\n  }\n  // Vertical positioning.\n  let top = 0;\n  if (position.vertical === verticalPosition.TOP) {\n    top = metrics.absoluteMetrics.top + verticalPadding;\n  } else {\n    // position.vertical === verticalPosition.BOTTOM\n    top =\n      metrics.absoluteMetrics.top +\n      metrics.viewMetrics.height -\n      size.height -\n      verticalPadding;\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\n      // The scrollbars are always positioned on the bottom if they exist.\n      top -= Scrollbar.scrollbarThickness;\n    }\n  }\n  return new Rect(top, top + size.height, left, left + size.width);\n}\n\n/**\n * Returns a corner position that is on the opposite side of the workspace from\n * the toolbox.\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\n * orientation, defaults to the right corner.\n *\n * @param workspace The workspace.\n * @param metrics The workspace metrics.\n * @returns The suggested corner position.\n * @internal\n */\nexport function getCornerOppositeToolbox(\n  workspace: WorkspaceSvg,\n  metrics: UiMetrics,\n): Position {\n  const leftCorner =\n    metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\n    (!workspace.horizontalLayout || workspace.RTL);\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\n  const hPosition = leftCorner\n    ? horizontalPosition.LEFT\n    : horizontalPosition.RIGHT;\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\n  return {horizontal: hPosition, vertical: vPosition};\n}\n\n/**\n * Returns a position Rect based on a starting position that is bumped\n * so that it doesn't intersect with any of the provided savedPositions. This\n * method does not check that the bumped position is still within bounds.\n *\n * @param startRect The starting position to use.\n * @param margin The margin to use between elements when bumping.\n * @param bumpDir The direction to bump if there is a collision with an existing\n *     UI element.\n * @param savedPositions List of rectangles that represent the positions of UI\n *     elements already placed.\n * @returns The suggested position rectangle.\n * @internal\n */\nexport function bumpPositionRect(\n  startRect: Rect,\n  margin: number,\n  bumpDir: bumpDirection,\n  savedPositions: Rect[],\n): Rect {\n  let top = startRect.top;\n  const left = startRect.left;\n  const width = startRect.right - startRect.left;\n  const height = startRect.bottom - startRect.top;\n\n  // Check for collision and bump if needed.\n  let boundingRect = startRect;\n  for (let i = 0; i < savedPositions.length; i++) {\n    const otherEl = savedPositions[i];\n    if (boundingRect.intersects(otherEl)) {\n      if (bumpDir === bumpDirection.UP) {\n        top = otherEl.top - height - margin;\n      } else {\n        // bumpDir === bumpDirection.DOWN\n        top = otherEl.bottom + margin;\n      }\n      // Recheck other savedPositions\n      boundingRect = new Rect(top, top + height, left, left + width);\n      i = -1;\n    }\n  }\n  return boundingRect;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.dialog\n\nlet alertImplementation = function (\n  message: string,\n  opt_callback?: () => void,\n) {\n  window.alert(message);\n  if (opt_callback) {\n    opt_callback();\n  }\n};\n\nlet confirmImplementation = function (\n  message: string,\n  callback: (result: boolean) => void,\n) {\n  callback(window.confirm(message));\n};\n\nlet promptImplementation = function (\n  message: string,\n  defaultValue: string,\n  callback: (result: string | null) => void,\n) {\n  callback(window.prompt(message, defaultValue));\n};\n\n/**\n * Wrapper to window.alert() that app developers may override via setAlert to\n * provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param opt_callback The callback when the alert is dismissed.\n */\nexport function alert(message: string, opt_callback?: () => void) {\n  alertImplementation(message, opt_callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.alert() is called.\n *\n * @param alertFunction The function to be run.\n * @see Blockly.dialog.alert\n */\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\n  alertImplementation = alertFunction;\n}\n\n/**\n * Wrapper to window.confirm() that app developers may override via setConfirm\n * to provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param callback The callback for handling user response.\n */\nexport function confirm(message: string, callback: (p1: boolean) => void) {\n  TEST_ONLY.confirmInternal(message, callback);\n}\n\n/**\n * Private version of confirm for stubbing in tests.\n */\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\n  confirmImplementation(message, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.confirm() is called.\n *\n * @param confirmFunction The function to be run.\n * @see Blockly.dialog.confirm\n */\nexport function setConfirm(\n  confirmFunction: (p1: string, p2: (p1: boolean) => void) => void,\n) {\n  confirmImplementation = confirmFunction;\n}\n\n/**\n * Wrapper to window.prompt() that app developers may override via setPrompt to\n * provide alternatives to the modal browser window. Built-in browser prompts\n * are often used for better text input experience on mobile device. We strongly\n * recommend testing mobile when overriding this.\n *\n * @param message The message to display to the user.\n * @param defaultValue The value to initialize the prompt with.\n * @param callback The callback for handling user response.\n */\nexport function prompt(\n  message: string,\n  defaultValue: string,\n  callback: (p1: string | null) => void,\n) {\n  promptImplementation(message, defaultValue, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.prompt() is called.\n *\n * @param promptFunction The function to be run.\n * @see Blockly.dialog.prompt\n */\nexport function setPrompt(\n  promptFunction: (\n    p1: string,\n    p2: string,\n    p3: (p1: string | null) => void,\n  ) => void,\n) {\n  promptImplementation = promptFunction;\n}\n\nexport const TEST_ONLY = {\n  confirmInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {VariableModel} from '../variable_model.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n/** Interface for a parameter model that holds a variable model. */\nexport interface IVariableBackedParameterModel extends IParameterModel {\n  /** Returns the variable model held by this type. */\n  getVariableModel(): VariableModel;\n}\n\n/**\n * Returns whether the given object is a variable holder or not.\n */\nexport function isVariableBackedParameterModel(\n  param: IParameterModel,\n): param is IVariableBackedParameterModel {\n  return (param as any).getVariableModel !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Legacy means of representing a procedure signature. The elements are\n * respectively: name, parameter names, and whether it has a return value.\n */\nexport type ProcedureTuple = [string, string[], boolean];\n\n/**\n * Procedure block type.\n *\n * @internal\n */\nexport interface ProcedureBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport interface LegacyProcedureDefBlock {\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport function isLegacyProcedureDefBlock(\n  block: Object,\n): block is LegacyProcedureDefBlock {\n  return (block as any).getProcedureDef !== undefined;\n}\n\n/** @internal */\nexport interface LegacyProcedureCallBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n}\n\n/** @internal */\nexport function isLegacyProcedureCallBlock(\n  block: Object,\n): block is LegacyProcedureCallBlock {\n  return (\n    (block as any).getProcedureCall !== undefined &&\n    (block as any).renameProcedure !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Variables\n\nimport {Blocks} from './blocks.js';\nimport * as dialog from './dialog.js';\nimport {isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\nimport {Msg} from './msg.js';\nimport {isLegacyProcedureDefBlock} from './interfaces/i_legacy_procedure_blocks.js';\nimport * as utilsXml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Procedures.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE';\n\n/**\n * Find all user-created variables that are in use in the workspace.\n * For use by generators.\n * To get a list of all variables on a workspace, including unused variables,\n * call Workspace.getAllVariables.\n *\n * @param ws The workspace to search for variables.\n * @returns Array of variable models.\n */\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\n  const blocks = ws.getAllBlocks(false);\n  const variables = new Set<VariableModel>();\n  // Iterate through every block and add each variable to the set.\n  for (let i = 0; i < blocks.length; i++) {\n    const blockVariables = blocks[i].getVarModels();\n    if (blockVariables) {\n      for (let j = 0; j < blockVariables.length; j++) {\n        const variable = blockVariables[j];\n        const id = variable.getId();\n        if (id) {\n          variables.add(variable);\n        }\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Find all developer variables used by blocks in the workspace.\n * Developer variables are never shown to the user, but are declared as global\n * variables in the generated code.\n * To declare developer variables, define the getDeveloperVariables function on\n * your block and return a list of variable names.\n * For use by generators.\n *\n * @param workspace The workspace to search.\n * @returns A list of non-duplicated variable names.\n */\nexport function allDeveloperVariables(workspace: Workspace): string[] {\n  const blocks = workspace.getAllBlocks(false);\n  const variables = new Set<string>();\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    const getDeveloperVariables = block.getDeveloperVariables;\n    if (getDeveloperVariables) {\n      const devVars = getDeveloperVariables();\n      for (let j = 0; j < devVars.length; j++) {\n        variables.add(devVars[j]);\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  const button = document.createElement('button');\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\n\n  workspace.registerButtonCallback('CREATE_VARIABLE', function (button) {\n    createVariableButtonHandler(button.getTargetWorkspace());\n  });\n\n  xmlList.push(button);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getVariablesOfType('');\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    // New variables are added to the end of the variableModelList.\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\n    if (Blocks['variables_set']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'variables_set');\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['math_change']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'math_change');\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      const value = utilsXml.textToDom(\n        '<value name=\"DELTA\">' +\n          '<shadow type=\"math_number\">' +\n          '<field name=\"NUM\">1</field>' +\n          '</shadow>' +\n          '</value>',\n      );\n      block.appendChild(value);\n      xmlList.push(block);\n    }\n\n    if (Blocks['variables_get']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = utilsXml.createElement('block');\n        block.setAttribute('type', 'variables_get');\n        block.setAttribute('gap', '8');\n        block.appendChild(generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\n\n/**\n * Return a new variable name that is not yet being used. This will try to\n * generate single letter variable names in the range 'i' to 'z' to start with.\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\n * then 'i2' to 'z2' etc.  Skip 'l'.\n *\n * @param workspace The workspace to be unique in.\n * @returns New variable name.\n */\nexport function generateUniqueName(workspace: Workspace): string {\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\n}\n\n/**\n * Private version of generateUniqueName for stubbing in tests.\n */\nfunction generateUniqueNameInternal(workspace: Workspace): string {\n  return generateUniqueNameFromOptions(\n    VAR_LETTER_OPTIONS.charAt(0),\n    workspace.getAllVariableNames(),\n  );\n}\n\n/**\n * Returns a unique name that is not present in the usedNames array. This\n * will try to generate single letter names in the range a - z (skip l). It\n * will start with the character passed to startChar.\n *\n * @param startChar The character to start the search at.\n * @param usedNames A list of all of the used names.\n * @returns A unique name that is not present in the usedNames array.\n */\nexport function generateUniqueNameFromOptions(\n  startChar: string,\n  usedNames: string[],\n): string {\n  if (!usedNames.length) {\n    return startChar;\n  }\n\n  const letters = VAR_LETTER_OPTIONS;\n  let suffix = '';\n  let letterIndex = letters.indexOf(startChar);\n  let potName = startChar;\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    let inUse = false;\n    for (let i = 0; i < usedNames.length; i++) {\n      if (usedNames[i].toLowerCase() === potName) {\n        inUse = true;\n        break;\n      }\n    }\n    if (!inUse) {\n      break;\n    }\n\n    letterIndex++;\n    if (letterIndex === letters.length) {\n      // Reached the end of the character sequence so back to 'i'.\n      letterIndex = 0;\n      suffix = `${Number(suffix) + 1}`;\n    }\n    potName = letters.charAt(letterIndex) + suffix;\n  }\n  return potName;\n}\n\n/**\n * Handles \"Create Variable\" button in the default variables toolbox category.\n * It will prompt the user for a variable name, including re-prompts if a name\n * is already in use among the workspace's variables.\n *\n * Custom button handlers can delegate to this function, allowing variables\n * types and after-creation processing. More complex customization (e.g.,\n * prompting for variable type) is beyond the scope of this function.\n *\n * @param workspace The workspace on which to create the variable.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\n *     will default to '', which is a specific type.\n */\nexport function createVariableButtonHandler(\n  workspace: Workspace,\n  opt_callback?: (p1?: string | null) => void,\n  opt_type?: string,\n) {\n  const type = opt_type || '';\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function (text) {\n      if (!text) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithAnyType(text, workspace);\n      if (!existing) {\n        // No conflict\n        workspace.createVariable(text, type);\n        if (opt_callback) opt_callback(text);\n        return;\n      }\n\n      let msg;\n      if (existing.type === type) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\n      } else {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\n        msg = msg.replace('%1', existing.name).replace('%2', existing.type);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(text);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Opens a prompt that allows the user to enter a new name for a variable.\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\n * collision.\n *\n * @param workspace The workspace on which to rename the variable.\n * @param variable Variable to rename.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n */\nexport function renameVariable(\n  workspace: Workspace,\n  variable: VariableModel,\n  opt_callback?: (p1?: string | null) => void,\n) {\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    const promptText = Msg['RENAME_VARIABLE_TITLE'].replace(\n      '%1',\n      variable.name,\n    );\n    promptName(promptText, defaultName, function (newName) {\n      if (!newName) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithOtherType(newName, variable.type, workspace);\n      const procedure = nameUsedWithConflictingParam(\n        variable.name,\n        newName,\n        workspace,\n      );\n      if (!existing && !procedure) {\n        // No conflict.\n        workspace.renameVariableById(variable.getId(), newName);\n        if (opt_callback) opt_callback(newName);\n        return;\n      }\n\n      let msg = '';\n      if (existing) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\n          .replace('%1', existing.name)\n          .replace('%2', existing.type);\n      } else if (procedure) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER']\n          .replace('%1', newName)\n          .replace('%2', procedure);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(newName);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Prompt the user for a new variable name.\n *\n * @param promptText The string of the prompt.\n * @param defaultText The default value to show in the prompt's field.\n * @param callback A callback. It will be passed the new variable name, or null\n *     if the user picked something illegal.\n */\nexport function promptName(\n  promptText: string,\n  defaultText: string,\n  callback: (p1: string | null) => void,\n) {\n  dialog.prompt(promptText, defaultText, function (newVar) {\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\n    // Beyond this, all names are legal.\n    if (newVar) {\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\n        // Ok, not ALL names are legal...\n        newVar = null;\n      }\n    }\n    callback(newVar);\n  });\n}\n/**\n * Check whether there exists a variable with the given name but a different\n * type.\n *\n * @param name The name to search for.\n * @param type The type to exclude from the search.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name and a different type, or null if\n *     none was found.\n */\nfunction nameUsedWithOtherType(\n  name: string,\n  type: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether there exists a variable with the given name of any type.\n *\n * @param name The name to search for.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name, or null if none was found.\n */\nexport function nameUsedWithAnyType(\n  name: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure with a conflicting parameter name, or null\n * if one does not exist.\n *\n * This checks the procedure map if it contains models, and the legacy procedure\n * blocks otherwise.\n *\n * @param oldName The old name of the variable.\n * @param newName The proposed name of the variable.\n * @param workspace The workspace to search for conflicting parameters.\n * @internal\n */\nexport function nameUsedWithConflictingParam(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  return workspace.getProcedureMap().getProcedures().length\n    ? checkForConflictingParamWithProcedureModels(oldName, newName, workspace)\n    : checkForConflictingParamWithLegacyProcedures(oldName, newName, workspace);\n}\n\n/**\n * Returns the name of the procedure model with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithProcedureModels(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const procedures = workspace.getProcedureMap().getProcedures();\n  for (const procedure of procedures) {\n    const params = procedure\n      .getParameters()\n      .filter(isVariableBackedParameterModel)\n      .map((param) => param.getVariableModel().name);\n    if (!params) continue;\n    const procHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const procHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (procHasOld && procHasNew) return procedure.getName();\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure block with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithLegacyProcedures(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const blocks = workspace.getAllBlocks(false);\n  for (const block of blocks) {\n    if (!isLegacyProcedureDefBlock(block)) continue;\n    const def = block.getProcedureDef();\n    const params = def[1];\n    const blockHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const blockHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (blockHasOld && blockHasNew) return def[0];\n  }\n  return null;\n}\n\n/**\n * Generate DOM objects representing a variable field.\n *\n * @param variableModel The variable model to represent.\n * @returns The generated DOM.\n */\nexport function generateVariableFieldDom(\n  variableModel: VariableModel,\n): Element {\n  /* Generates the following XML:\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\n   */\n  const field = utilsXml.createElement('field');\n  field.setAttribute('name', 'VAR');\n  field.setAttribute('id', variableModel.getId());\n  field.setAttribute('variabletype', variableModel.type);\n  const name = utilsXml.createTextNode(variableModel.name);\n  field.appendChild(name);\n  return field;\n}\n\n/**\n * Helper function to look up or create a variable on the given workspace.\n * If no variable exists, creates and returns it.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up or create the variable, or null.\n * @param opt_name The string to use to look up or create the variable.\n * @param opt_type The type to use to look up or create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nexport function getOrCreateVariablePackage(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  let variable = getVariable(workspace, id, opt_name, opt_type);\n  if (!variable) {\n    variable = createVariable(workspace, id, opt_name, opt_type);\n  }\n  return variable;\n}\n\n/**\n * Look up  a variable on the given workspace.\n * Always looks in the main workspace before looking in the flyout workspace.\n * Always prefers lookup by ID to lookup by name + type.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up the variable, or null.\n * @param opt_name The string to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @param opt_type The type to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @returns The variable corresponding to the given ID or name + type\n *     combination, or null if not found.\n */\nexport function getVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel | null {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  let variable = null;\n  // Try to just get the variable, by ID if possible.\n  if (id) {\n    // Look in the real variable map before checking the potential variable map.\n    variable = workspace.getVariableById(id);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariableById(id);\n    }\n    if (variable) {\n      return variable;\n    }\n  }\n  // If there was no ID, or there was an ID but it didn't match any variables,\n  // look up by name and type.\n  if (opt_name) {\n    if (opt_type === undefined) {\n      throw Error('Tried to look up a variable by name without a type');\n    }\n    // Otherwise look up by name and type.\n    variable = workspace.getVariable(opt_name, opt_type);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\n    }\n  }\n  return variable;\n}\n\n/**\n * Helper function to create a variable on the given workspace.\n *\n * @param workspace The workspace in which to create the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to create the variable, or null.\n * @param opt_name The string to use to create the variable.\n * @param opt_type The type to use to create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nfunction createVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  // Variables without names get uniquely named for this workspace.\n  if (!opt_name) {\n    const ws = workspace.isFlyout\n      ? (workspace as WorkspaceSvg).targetWorkspace\n      : workspace;\n    opt_name = generateUniqueName(ws!);\n  }\n\n  // Create a potential variable if in the flyout.\n  let variable = null;\n  if (potentialVariableMap) {\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\n  } else {\n    // In the main workspace, create a real variable.\n    variable = workspace.createVariable(opt_name, opt_type, id);\n  }\n  return variable;\n}\n\n/**\n * Helper function to get the list of variables that have been added to the\n * workspace after adding a new block, using the given list of variables that\n * were in the workspace before the new block was added.\n *\n * @param workspace The workspace to inspect.\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n * @returns The new array of variables that were freshly added to the workspace\n *     after creating the new block, or [] if no new variables were added to the\n *     workspace.\n * @internal\n */\nexport function getAddedVariables(\n  workspace: Workspace,\n  originalVariables: VariableModel[],\n): VariableModel[] {\n  const allCurrentVariables = workspace.getAllVariables();\n  const addedVariables = [];\n  if (originalVariables.length !== allCurrentVariables.length) {\n    for (let i = 0; i < allCurrentVariables.length; i++) {\n      const variable = allCurrentVariables[i];\n      // For any variable that is present in allCurrentVariables but not\n      // present in originalVariables, add the variable to addedVariables.\n      if (originalVariables.indexOf(variable) === -1) {\n        addedVariables.push(variable);\n      }\n    }\n  }\n  return addedVariables;\n}\n\nexport const TEST_ONLY = {\n  generateUniqueNameInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ICopyable, ICopyData} from '../interfaces/i_copyable.js';\nimport type {IPaster} from '../interfaces/i_paster.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given paster so that it cna be used for pasting.\n *\n * @param type The type of the paster to register, e.g. 'block', 'comment', etc.\n * @param paster The paster to register.\n */\nexport function register<U extends ICopyData, T extends ICopyable<U>>(\n  type: string,\n  paster: IPaster<U, T>,\n) {\n  registry.register(registry.Type.PASTER, type, paster);\n}\n\n/**\n * Unregisters the paster associated with the given type.\n *\n * @param type The type of the paster to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.PASTER, type);\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The set of all blocks in need of rendering which don't have parents. */\nconst rootBlocks = new Set<BlockSvg>();\n\n/** The set of all blocks in need of rendering. */\nconst dirtyBlocks = new WeakSet<BlockSvg>();\n\n/**\n * The promise which resolves after the current set of renders is completed. Or\n * null if there are no queued renders.\n *\n * Stored so that we can return it from afterQueuedRenders.\n */\nlet afterRendersPromise: Promise<void> | null = null;\n\n/** The function to call to resolve the `afterRendersPromise`. */\nlet afterRendersResolver: (() => void) | null = null;\n\n/**\n * The ID of the current animation frame request. Used to cancel the request\n * if necessary.\n */\nlet animationRequestId = 0;\n\n/**\n * Registers that the given block and all of its parents need to be rerendered,\n * and registers a callback to do so after a delay, to allowf or batching.\n *\n * @param block The block to rerender.\n * @returns A promise that resolves after the currently queued renders have been\n *     completed. Used for triggering other behavior that relies on updated\n *     size/position location for the block.\n * @internal\n */\nexport function queueRender(block: BlockSvg): Promise<void> {\n  queueBlock(block);\n\n  if (alwaysImmediatelyRender()) {\n    doRenders();\n    return Promise.resolve();\n  }\n\n  if (!afterRendersPromise) {\n    afterRendersPromise = new Promise((resolve) => {\n      afterRendersResolver = resolve;\n      animationRequestId = window.requestAnimationFrame(() => {\n        doRenders();\n        resolve();\n      });\n    });\n  }\n  return afterRendersPromise;\n}\n\n/**\n * @returns A promise that resolves after the currently queued renders have\n *     been completed.\n */\nexport function finishQueuedRenders(): Promise<void> {\n  // If there are no queued renders, return a resolved promise so `then`\n  // callbacks trigger immediately.\n  return afterRendersPromise ? afterRendersPromise : Promise.resolve();\n}\n\n/**\n * Triggers an immediate render of all queued renders. Should only be used in\n * cases where queueing renders breaks functionality + backwards compatibility\n * (such as rendering icons).\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n *\n * @internal\n */\nexport function triggerQueuedRenders(workspace?: WorkspaceSvg) {\n  if (!workspace) window.cancelAnimationFrame(animationRequestId);\n  doRenders(workspace);\n  if (!workspace && afterRendersResolver) afterRendersResolver();\n}\n\n/**\n * @returns True if we should always trigger an immediate render.\n *     Some platforms don't properly support `requestAnimationFrame`, so to\n *     avoid glitchiness, we give up the performance improvements.\n */\nfunction alwaysImmediatelyRender() {\n  return userAgent.JavaFx;\n}\n\n/**\n * Adds the given block and its parents to the render queue. Adds the root block\n * to the list of root blocks.\n *\n * @param block The block to queue.\n */\nfunction queueBlock(block: BlockSvg) {\n  dirtyBlocks.add(block);\n  const parent = block.getParent();\n  if (parent) {\n    queueBlock(parent);\n  } else {\n    rootBlocks.add(block);\n  }\n}\n\n/**\n * Rerenders all of the blocks in the queue.\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n */\nfunction doRenders(workspace?: WorkspaceSvg) {\n  const workspaces = workspace\n    ? new Set([workspace])\n    : new Set([...rootBlocks].map((block) => block.workspace));\n  const blocks = [...rootBlocks]\n    .filter(shouldRenderRootBlock)\n    .filter((b) => workspaces.has(b.workspace));\n  for (const block of blocks) {\n    renderBlock(block);\n  }\n  for (const workspace of workspaces) {\n    workspace.resizeContents();\n  }\n  for (const block of blocks) {\n    const blockOrigin = block.getRelativeToSurfaceXY();\n    block.updateComponentLocations(blockOrigin);\n  }\n\n  for (const block of blocks) {\n    dequeueBlock(block);\n  }\n  if (!workspace) afterRendersPromise = null;\n}\n\n/** Removes the given block and children from the render queue. */\nfunction dequeueBlock(block: BlockSvg) {\n  rootBlocks.delete(block);\n  dirtyBlocks.delete(block);\n  for (const child of block.getChildren(false)) {\n    dequeueBlock(child);\n  }\n}\n\n/**\n * Returns true if the block should be rendered.\n *\n * No need to render dead blocks.\n *\n * No need to render blocks with parents. A render for the block may have been\n * queued, and the the block was connected to a parent, so it is no longer a\n * root block. Rendering will be triggered through the real root block.\n */\nfunction shouldRenderRootBlock(block: BlockSvg): boolean {\n  return !block.isDisposed() && !block.getParent();\n}\n\n/**\n * Recursively renders all of the dirty children of the given block, and\n * then renders the block.\n *\n * @param block The block to rerender.\n */\nfunction renderBlock(block: BlockSvg) {\n  if (!dirtyBlocks.has(block)) return;\n  for (const child of block.getChildren(false)) {\n    renderBlock(child);\n  }\n  block.renderEfficiently();\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Xml\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {IconType} from './icons/icon_types.js';\nimport {inputTypes} from './inputs/input_types.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as utilsXml from './utils/xml.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\n\n/**\n * Encode a block tree as XML.\n *\n * @param workspace The workspace containing blocks.\n * @param opt_noId True if the encoder should skip the block IDs.\n * @returns XML DOM element.\n */\nexport function workspaceToDom(\n  workspace: Workspace,\n  opt_noId?: boolean,\n): Element {\n  const treeXml = utilsXml.createElement('xml');\n  const variablesElement = variablesToDom(\n    Variables.allUsedVarModels(workspace),\n  );\n  if (variablesElement.hasChildNodes()) {\n    treeXml.appendChild(variablesElement);\n  }\n  const comments = workspace.getTopComments(true);\n  for (let i = 0; i < comments.length; i++) {\n    const comment = comments[i];\n    treeXml.appendChild(comment.toXmlWithXY(opt_noId));\n  }\n  const blocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    treeXml.appendChild(blockToDomWithXY(block, opt_noId));\n  }\n  return treeXml;\n}\n\n/**\n * Encode a list of variables as XML.\n *\n * @param variableList List of all variable models.\n * @returns Tree of XML elements.\n */\nexport function variablesToDom(variableList: VariableModel[]): Element {\n  const variables = utilsXml.createElement('variables');\n  for (let i = 0; i < variableList.length; i++) {\n    const variable = variableList[i];\n    const element = utilsXml.createElement('variable');\n    element.appendChild(utilsXml.createTextNode(variable.name));\n    if (variable.type) {\n      element.setAttribute('type', variable.type);\n    }\n    element.id = variable.getId();\n    variables.appendChild(element);\n  }\n  return variables;\n}\n\n/**\n * Encode a block subtree as XML with XY coordinates.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDomWithXY(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  if (block.isInsertionMarker()) {\n    // Skip over insertion markers.\n    block = block.getChildren(false)[0];\n    if (!block) {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  let width = 0; // Not used in LTR.\n  if (block.workspace.RTL) {\n    width = block.workspace.getWidth();\n  }\n\n  const element = blockToDom(block, opt_noId);\n  if (isElement(element)) {\n    const xy = block.getRelativeToSurfaceXY();\n    element.setAttribute(\n      'x',\n      String(Math.round(block.workspace.RTL ? width - xy.x : xy.x)),\n    );\n    element.setAttribute('y', String(Math.round(xy.y)));\n  }\n  return element;\n}\n\n/**\n * Encode a field as XML.\n *\n * @param field The field to encode.\n * @returns XML element, or null if the field did not need to be serialized.\n */\nfunction fieldToDom(field: Field): Element | null {\n  if (field.isSerializable()) {\n    const container = utilsXml.createElement('field');\n    container.setAttribute('name', field.name || '');\n    return field.toXml(container);\n  }\n  return null;\n}\n\n/**\n * Encode all of a block's fields as XML and attach them to the given tree of\n * XML elements.\n *\n * @param block A block with fields to be encoded.\n * @param element The XML element to which the field DOM should be attached.\n */\nfunction allFieldsToDom(block: Block, element: Element) {\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      const fieldDom = fieldToDom(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n}\n\n/**\n * Encode a block subtree as XML.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDom(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  // Skip over insertion markers.\n  if (block.isInsertionMarker()) {\n    const child = block.getChildren(false)[0];\n    if (child) {\n      return blockToDom(child);\n    } else {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\n  element.setAttribute('type', block.type);\n  if (!opt_noId) {\n    element.id = block.id;\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    const mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom(block, element);\n\n  const commentText = block.getCommentText();\n  if (commentText) {\n    const comment = block.getIcon(IconType.COMMENT)!;\n    const size = comment.getBubbleSize();\n    const pinned = comment.bubbleIsVisible();\n\n    const commentElement = utilsXml.createElement('comment');\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\n    commentElement.setAttribute('pinned', `${pinned}`);\n    commentElement.setAttribute('h', String(size.height));\n    commentElement.setAttribute('w', String(size.width));\n\n    element.appendChild(commentElement);\n  }\n\n  if (block.data) {\n    const dataElement = utilsXml.createElement('data');\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\n    element.appendChild(dataElement);\n  }\n\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    let container: Element;\n    let empty = true;\n    if (input.type === inputTypes.DUMMY || input.type === inputTypes.END_ROW) {\n      continue;\n    } else {\n      const childBlock = input.connection!.targetBlock();\n      if (input.type === inputTypes.VALUE) {\n        container = utilsXml.createElement('value');\n      } else if (input.type === inputTypes.STATEMENT) {\n        container = utilsXml.createElement('statement');\n      }\n      const childShadow = input.connection!.getShadowDom();\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\n      }\n      if (childBlock) {\n        const childElem = blockToDom(childBlock, opt_noId);\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n          container!.appendChild(childElem);\n          empty = false;\n        }\n      }\n    }\n    container!.setAttribute('name', input.name);\n    if (!empty) {\n      element.appendChild(container!);\n    }\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    element.setAttribute('inline', String(block.inputsInline));\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute('collapsed', 'true');\n  }\n  if (!block.isEnabled()) {\n    element.setAttribute('disabled', 'true');\n  }\n  if (!block.isDeletable() && !block.isShadow()) {\n    element.setAttribute('deletable', 'false');\n  }\n  if (!block.isMovable() && !block.isShadow()) {\n    element.setAttribute('movable', 'false');\n  }\n  if (!block.isEditable()) {\n    element.setAttribute('editable', 'false');\n  }\n\n  const nextBlock = block.getNextBlock();\n  let container: Element;\n  if (nextBlock) {\n    const nextElem = blockToDom(nextBlock, opt_noId);\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n      container = utilsXml.createElement('next');\n      container.appendChild(nextElem);\n      element.appendChild(container);\n    }\n  }\n  const nextShadow =\n    block.nextConnection && block.nextConnection.getShadowDom();\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\n  }\n\n  return element;\n}\n\n/**\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\n *\n * @param shadow A tree of XML elements.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns A tree of XML elements.\n */\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\n  shadow = shadow.cloneNode(true) as Element;\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  let node: Node | null = shadow;\n  let textNode;\n  while (node) {\n    if (opt_noId && node.nodeName === 'shadow') {\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\n      // a child of a 'shadow', so no need to check that.\n      (node as Element).removeAttribute('id');\n    }\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === '' &&\n          node?.firstChild !== textNode\n        ) {\n          // Prune whitespace after a tag.\n          dom.removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === ''\n        ) {\n          // Prune whitespace before a tag.\n          dom.removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace,\n * unless the DOM itself has whitespace built-in.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  const text = utilsXml.domToText(dom);\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\n}\n\n/**\n * Converts a DOM structure into properly indented text.\n *\n * @param dom A tree of XML elements.\n * @returns Text representation.\n */\nexport function domToPrettyText(dom: Node): string {\n  // This function is not guaranteed to be correct for all XML.\n  // But it handles the XML that Blockly generates.\n  const blob = domToText(dom);\n  // Place every open and close tag on its own line.\n  const lines = blob.split('<');\n  // Indent every line.\n  let indent = '';\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line[0] === '/') {\n      indent = indent.substring(2);\n    }\n    lines[i] = indent + '<' + line;\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\n      indent += '  ';\n    }\n  }\n  // Pull simple tags back together.\n  // E.g. <foo></foo>\n  let text = lines.join('\\n');\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\n  // Trim leading blank line.\n  return text.replace(/^\\n/, '');\n}\n\n/**\n * Clear the given workspace then decode an XML DOM and\n * create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function clearWorkspaceAndLoadFromXml(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  workspace.setResizesEnabled(false);\n  workspace.clear();\n  const blockIds = domToWorkspace(xml, workspace);\n  workspace.setResizesEnabled(true);\n  return blockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\n  let width = 0; // Not used in LTR.\n  if (workspace.RTL) {\n    width = workspace.getWidth();\n  }\n  const newBlockIds = []; // A list of block IDs added by this call.\n  dom.startTextWidthCache();\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  // Disable workspace resizes as an optimization.\n  // Assume it is rendered so we can check.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\n  }\n  let variablesFirst = true;\n  try {\n    for (let i = 0, xmlChild; (xmlChild = xml.childNodes[i]); i++) {\n      const name = xmlChild.nodeName.toLowerCase();\n      const xmlChildElement = xmlChild as Element;\n      if (\n        name === 'block' ||\n        (name === 'shadow' && !eventUtils.getRecordUndo())\n      ) {\n        // Allow top-level shadow blocks if recordUndo is disabled since\n        // that means an undo is in progress.  Such a block is expected\n        // to be moved to a nested destination in the next operation.\n        const block = domToBlockInternal(xmlChildElement, workspace);\n        newBlockIds.push(block.id);\n        const blockX = parseInt(xmlChildElement.getAttribute('x') ?? '10', 10);\n        const blockY = parseInt(xmlChildElement.getAttribute('y') ?? '10', 10);\n        if (!isNaN(blockX) && !isNaN(blockY)) {\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY, [\n            'create',\n          ]);\n        }\n        variablesFirst = false;\n      } else if (name === 'shadow') {\n        throw TypeError('Shadow block cannot be a top-level block.');\n      } else if (name === 'comment') {\n        if (workspace.rendered) {\n          WorkspaceCommentSvg.fromXmlRendered(\n            xmlChildElement,\n            workspace as WorkspaceSvg,\n            width,\n          );\n        } else {\n          WorkspaceComment.fromXml(xmlChildElement, workspace);\n        }\n      } else if (name === 'variables') {\n        if (variablesFirst) {\n          domToVariables(xmlChildElement, workspace);\n        } else {\n          throw Error(\n            \"'variables' tag must exist once before block and \" +\n              'shadow tag elements in the workspace XML, but it was found in ' +\n              'another location.',\n          );\n        }\n        variablesFirst = false;\n      }\n    }\n  } finally {\n    eventUtils.setGroup(existingGroup);\n    if ((workspace as WorkspaceSvg).setResizesEnabled) {\n      (workspace as WorkspaceSvg).setResizesEnabled(true);\n    }\n    if (workspace.rendered) renderManagement.triggerQueuedRenders();\n    dom.stopTextWidthCache();\n  }\n  // Re-enable workspace resizing.\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n  return newBlockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace. Position the new\n * blocks immediately below prior blocks, aligned by their starting edge.\n *\n * @param xml The XML DOM.\n * @param workspace The workspace to add to.\n * @returns An array containing new block IDs.\n */\nexport function appendDomToWorkspace(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\n  // and the position does not matter.\n  // Assume it is rendered so we can check.\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\n    return domToWorkspace(xml, workspace);\n  }\n\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\n  const newBlockIds = domToWorkspace(xml, workspace);\n  if (bbox && bbox.top !== bbox.bottom) {\n    // Check if any previous block.\n    let offsetY = 0; // Offset to add to y of the new block.\n    let offsetX = 0;\n    const farY = bbox.bottom; // Bottom position.\n    const topX = workspace.RTL ? bbox.right : bbox.left; // X of bounding box.\n    // Check position of the new blocks.\n    let newLeftX = Infinity; // X of top left corner.\n    let newRightX = -Infinity; // X of top right corner.\n    let newY = Infinity; // Y of top corner.\n    const ySeparation = 10;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const blockXY = workspace\n        .getBlockById(newBlockIds[i])!\n        .getRelativeToSurfaceXY();\n      if (blockXY.y < newY) {\n        newY = blockXY.y;\n      }\n      if (blockXY.x < newLeftX) {\n        // if we left align also on x\n        newLeftX = blockXY.x;\n      }\n      if (blockXY.x > newRightX) {\n        // if we right align also on x\n        newRightX = blockXY.x;\n      }\n    }\n    offsetY = farY - newY + ySeparation;\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const block = workspace.getBlockById(newBlockIds[i]);\n      block!.moveBy(offsetX, offsetY, ['create']);\n    }\n  }\n  return newBlockIds;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n */\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\n  const block = domToBlockInternal(xmlBlock, workspace);\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * This is defined internally so that it doesn't trigger an immediate render,\n * which we do want to happen for external calls.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n * @internal\n */\nexport function domToBlockInternal(\n  xmlBlock: Element,\n  workspace: Workspace,\n): Block {\n  // Create top-level block.\n  eventUtils.disable();\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let topBlock;\n  try {\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\n    // Generate list of all blocks.\n    if (workspace.rendered) {\n      const topBlockSvg = topBlock as BlockSvg;\n      const blocks = topBlock.getDescendants(false);\n      topBlockSvg.setConnectionTracking(false);\n      // Render each block.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).initSvg();\n      }\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).queueRender();\n      }\n      // Populating the connection database may be deferred until after the\n      // blocks have rendered.\n      setTimeout(function () {\n        if (!topBlockSvg.disposed) {\n          topBlockSvg.setConnectionTracking(true);\n        }\n      }, 1);\n      // Allow the scrollbars to resize and move based on the new contents.\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\n      (workspace as WorkspaceSvg).resizeContents();\n    } else {\n      const blocks = topBlock.getDescendants(false);\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].initModel();\n      }\n    }\n  } finally {\n    eventUtils.enable();\n  }\n  if (eventUtils.isEnabled()) {\n    const newVariables = Variables.getAddedVariables(\n      workspace,\n      variablesBeforeCreation,\n    );\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\n      );\n    }\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(eventUtils.CREATE))(topBlock));\n  }\n  return topBlock;\n}\n\n/**\n * Decode an XML list of variables and add the variables to the workspace.\n *\n * @param xmlVariables List of XML variable elements.\n * @param workspace The workspace to which the variable should be added.\n */\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\n  for (let i = 0; i < xmlVariables.children.length; i++) {\n    const xmlChild = xmlVariables.children[i];\n    const type = xmlChild.getAttribute('type');\n    const id = xmlChild.getAttribute('id');\n    const name = xmlChild.textContent;\n\n    if (!name) return;\n    workspace.createVariable(name, type, id);\n  }\n}\n\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\ninterface childNodeTagMap {\n  mutation: Element[];\n  comment: Element[];\n  data: Element[];\n  field: Element[];\n  input: Element[];\n  next: Element[];\n}\n\n/**\n * Creates a mapping of childNodes for each supported XML tag for the provided\n * xmlBlock. Logs a warning for any encountered unsupported tags.\n *\n * @param xmlBlock XML block element.\n * @returns The childNode map from nodeName to node.\n */\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\n  const childNodeMap = {\n    mutation: new Array<Element>(),\n    comment: new Array<Element>(),\n    data: new Array<Element>(),\n    field: new Array<Element>(),\n    input: new Array<Element>(),\n    next: new Array<Element>(),\n  };\n  for (let i = 0; i < xmlBlock.children.length; i++) {\n    const xmlChild = xmlBlock.children[i];\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\n      continue;\n    }\n    switch (xmlChild.nodeName.toLowerCase()) {\n      case 'mutation':\n        childNodeMap.mutation.push(xmlChild);\n        break;\n      case 'comment':\n        childNodeMap.comment.push(xmlChild);\n        break;\n      case 'data':\n        childNodeMap.data.push(xmlChild);\n        break;\n      case 'title':\n      // Titles were renamed to field in December 2013.\n      // Fall through.\n      case 'field':\n        childNodeMap.field.push(xmlChild);\n        break;\n      case 'value':\n      case 'statement':\n        childNodeMap.input.push(xmlChild);\n        break;\n      case 'next':\n        childNodeMap.next.push(xmlChild);\n        break;\n      default:\n        // Unknown tag; ignore.  Same principle as HTML parsers.\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\n    }\n  }\n  return childNodeMap;\n}\n\n/**\n * Applies mutation tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n * @returns True if mutation may have added some elements that need\n *     initialization (requiring initSvg call).\n */\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\n  let shouldCallInitSvg = false;\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    // Custom data for an advanced block.\n    if (block.domToMutation) {\n      block.domToMutation(xmlChild);\n      if ((block as BlockSvg).initSvg) {\n        // Mutation may have added some elements that need initializing.\n        shouldCallInitSvg = true;\n      }\n    }\n  }\n  return shouldCallInitSvg;\n}\n\n/**\n * Applies comment tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const text = xmlChild.textContent;\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\n    const width = parseInt(xmlChild.getAttribute('w') ?? '50', 10);\n    const height = parseInt(xmlChild.getAttribute('h') ?? '50', 10);\n\n    block.setCommentText(text);\n    const comment = block.getIcon(IconType.COMMENT)!;\n    if (!isNaN(width) && !isNaN(height)) {\n      comment.setBubbleSize(new Size(width, height));\n    }\n    // Set the pinned state of the bubble.\n    comment.setBubbleVisible(pinned);\n    // Actually show the bubble after the block has been rendered.\n    setTimeout(() => comment.setBubbleVisible(pinned), 1);\n  }\n}\n\n/**\n * Applies data tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    block.data = xmlChild.textContent;\n  }\n}\n\n/**\n * Applies field tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    if (!nodeName) {\n      console.warn(`Ignoring unnamed field in block ${block.type}`);\n      continue;\n    }\n    domToField(block, nodeName, xmlChild);\n  }\n}\n\n/**\n * Finds any enclosed blocks or shadows within this XML node.\n *\n * @param xmlNode The XML node to extract child block info from.\n * @returns Any found child block.\n */\nfunction findChildBlocks(xmlNode: Element): {\n  childBlockElement: Element | null;\n  childShadowElement: Element | null;\n} {\n  let childBlockElement: Element | null = null;\n  let childShadowElement: Element | null = null;\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\n    const xmlChild = xmlNode.childNodes[i];\n    if (isElement(xmlChild)) {\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\n        childBlockElement = xmlChild;\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\n        childShadowElement = xmlChild;\n      }\n    }\n  }\n  return {childBlockElement, childShadowElement};\n}\n/**\n * Applies input child nodes (value or statement) to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n * @param prototypeName The prototype name of the block.\n */\nfunction applyInputTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n  prototypeName: string,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    const input = nodeName ? block.getInput(nodeName) : null;\n    if (!input) {\n      console.warn(\n        'Ignoring non-existent input ' +\n          nodeName +\n          ' in block ' +\n          prototypeName,\n      );\n      break;\n    }\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!input.connection) {\n        throw TypeError('Input connection does not exist.');\n      }\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        input.connection,\n        false,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement) {\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Applies next child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n */\nfunction applyNextTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!block.nextConnection) {\n        throw TypeError('Next statement does not exist.');\n      }\n      // If there is more than one XML 'next' tag.\n      if (block.nextConnection.isConnected()) {\n        throw TypeError('Next statement is already connected.');\n      }\n      // Create child block.\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        block.nextConnection,\n        true,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @param parentConnection The parent connection to to connect this block to\n *     after instantiating.\n * @param connectedToParentNext Whether the provided parent connection is a next\n *     connection, rather than output or statement.\n * @returns The root block created.\n */\nfunction domToBlockHeadless(\n  xmlBlock: Element,\n  workspace: Workspace,\n  parentConnection?: Connection,\n  connectedToParentNext?: boolean,\n): Block {\n  let block = null;\n  const prototypeName = xmlBlock.getAttribute('type');\n  if (!prototypeName) {\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\n  }\n  const id = xmlBlock.getAttribute('id') ?? undefined;\n  block = workspace.newBlock(prototypeName, id);\n\n  // Preprocess childNodes so tags can be processed in a consistent order.\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\n\n  const shouldCallInitSvg = applyMutationTagNodes(\n    xmlChildNameMap.mutation,\n    block,\n  );\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\n  applyDataTagNodes(xmlChildNameMap.data, block);\n\n  // Connect parent after processing mutation and before setting fields.\n  if (parentConnection) {\n    if (connectedToParentNext) {\n      if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError('Next block does not have previous statement.');\n      }\n    } else {\n      if (block.outputConnection) {\n        parentConnection.connect(block.outputConnection);\n      } else if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError(\n          'Child block does not have output or previous statement.',\n        );\n      }\n    }\n  }\n\n  applyFieldTagNodes(xmlChildNameMap.field, block);\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\n\n  if (shouldCallInitSvg) {\n    // This shouldn't even be called here\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\n    // it.\n    (block as BlockSvg).initSvg();\n  }\n\n  const inline = xmlBlock.getAttribute('inline');\n  if (inline) {\n    block.setInputsInline(inline === 'true');\n  }\n  const disabled = xmlBlock.getAttribute('disabled');\n  if (disabled) {\n    block.setEnabled(disabled !== 'true' && disabled !== 'disabled');\n  }\n  const deletable = xmlBlock.getAttribute('deletable');\n  if (deletable) {\n    block.setDeletable(deletable === 'true');\n  }\n  const movable = xmlBlock.getAttribute('movable');\n  if (movable) {\n    block.setMovable(movable === 'true');\n  }\n  const editable = xmlBlock.getAttribute('editable');\n  if (editable) {\n    block.setEditable(editable === 'true');\n  }\n  const collapsed = xmlBlock.getAttribute('collapsed');\n  if (collapsed) {\n    block.setCollapsed(collapsed === 'true');\n  }\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\n    // Ensure all children are also shadows.\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      if (!child.isShadow()) {\n        throw TypeError('Shadow block not allowed non-shadow child.');\n      }\n    }\n    // Ensure this block doesn't have any variable inputs.\n    if (block.getVarModels().length) {\n      throw TypeError('Shadow blocks cannot have variable references.');\n    }\n    block.setShadow(true);\n  }\n  return block;\n}\n\n/**\n * Decode an XML field tag and set the value of that field on the given block.\n *\n * @param block The block that is currently being deserialized.\n * @param fieldName The name of the field on the block.\n * @param xml The field tag to decode.\n */\nfunction domToField(block: Block, fieldName: string, xml: Element) {\n  const field = block.getField(fieldName);\n  if (!field) {\n    console.warn(\n      'Ignoring non-existent field ' + fieldName + ' in block ' + block.type,\n    );\n    return;\n  }\n  field.fromXml(xml);\n}\n\n/**\n * Remove any 'next' block (statements in a stack).\n *\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\n *     was an insertion marker.\n */\nexport function deleteNext(xmlBlock: Element | DocumentFragment) {\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\n    const child = xmlBlock.childNodes[i];\n    if (child.nodeName.toLowerCase() === 'next') {\n      xmlBlock.removeChild(child);\n      break;\n    }\n  }\n}\n\nfunction isElement(node: Node): node is Element {\n  return node.nodeType === dom.NodeType.ELEMENT_NODE;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface ISerializable {\n  /**\n   * @param doFullSerialization If true, this signals that any backing data\n   *     structures used by this ISerializable should also be serialized. This\n   *     is used for copy-paste.\n   * @returns a JSON serializable value that records the ISerializable's state.\n   */\n  saveState(doFullSerialization: boolean): any;\n\n  /**\n   * Takes in a JSON serializable value and sets the ISerializable's state\n   * based on that.\n   *\n   * @param state The state to apply to the ISerializable.\n   */\n  loadState(state: any): void;\n}\n\n/** Type guard that checks whether the given object is a ISerializable. */\nexport function isSerializable(obj: any): obj is ISerializable {\n  return obj.saveState !== undefined && obj.loadState !== undefined;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.registry\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given serializer so that it can be used for serialization and\n * deserialization.\n *\n * @param name The name of the serializer to register.\n * @param serializer The serializer to register.\n */\nexport function register(name: string, serializer: ISerializer) {\n  registry.register(registry.Type.SERIALIZER, name, serializer);\n}\n\n/**\n * Unregisters the serializer associated with the given name.\n *\n * @param name The name of the serializer to unregister.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.SERIALIZER, name);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.blocks\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport * as eventUtils from '../events/utils.js';\nimport {inputTypes} from '../inputs/input_types.js';\nimport {isSerializable} from '../interfaces/i_serializable.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport * as renderManagement from '../render_management.js';\n\nimport {\n  BadConnectionCheck,\n  MissingBlockType,\n  MissingConnection,\n  RealChildOfShadow,\n  UnregisteredIcon,\n} from './exceptions.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n// TODO(#5160): Remove this once lint is fixed.\n/* eslint-disable no-use-before-define */\n\n/**\n * Represents the state of a connection.\n */\nexport interface ConnectionState {\n  shadow?: State;\n  block?: State;\n}\n\n/**\n * Represents the state of a given block.\n */\nexport interface State {\n  type: string;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  deletable?: boolean;\n  movable?: boolean;\n  editable?: boolean;\n  enabled?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * Returns the state of the given block as a plain JavaScript object.\n *\n * @param block The block to serialize.\n * @param param1 addCoordinates: If true, the coordinates of the block are added\n *     to the serialized state. False by default. addinputBlocks: If true,\n *     children of the block which are connected to inputs will be serialized.\n *     True by default. addNextBlocks: If true, children of the block which are\n *     connected to the block's next connection (if it exists) will be\n *     serialized. True by default. doFullSerialization: If true, fields that\n *     normally just save a reference to some external state (eg variables) will\n *     instead serialize all of the info about that state. This supports\n *     deserializing the block into a workspace where that state doesn't yet\n *     exist. True by default.\n * @returns The serialized state of the block, or null if the block could not be\n *     serialied (eg it was an insertion marker).\n */\nexport function save(\n  block: Block,\n  {\n    addCoordinates = false,\n    addInputBlocks = true,\n    addNextBlocks = true,\n    doFullSerialization = true,\n    saveIds = true,\n  }: {\n    addCoordinates?: boolean;\n    addInputBlocks?: boolean;\n    addNextBlocks?: boolean;\n    doFullSerialization?: boolean;\n    saveIds?: boolean;\n  } = {},\n): State | null {\n  if (block.isInsertionMarker()) {\n    return null;\n  }\n  const state = {\n    'type': block.type,\n    'id': saveIds ? block.id : undefined,\n  };\n\n  if (addCoordinates) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveCoords(block, state as AnyDuringMigration);\n  }\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveAttributes(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveExtraState(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveIcons(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\n  if (addInputBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveInputBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n  if (addNextBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveNextBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\n  // assignable to type 'State'.\n  return state as AnyDuringMigration;\n}\n\n/**\n * Adds attributes to the given state object based on the state of the block.\n * Eg collapsed, disabled, inline, etc.\n *\n * @param block The block to base the attributes on.\n * @param state The state object to append to.\n */\nfunction saveAttributes(block: Block, state: State) {\n  if (block.isCollapsed()) {\n    state['collapsed'] = true;\n  }\n  if (!block.isEnabled()) {\n    state['enabled'] = false;\n  }\n  if (!block.isOwnDeletable()) {\n    state['deletable'] = false;\n  }\n  if (!block.isOwnMovable()) {\n    state['movable'] = false;\n  }\n  if (!block.isOwnEditable()) {\n    state['editable'] = false;\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    state['inline'] = block.inputsInline;\n  }\n  // Data is a nullable string, so we don't need to worry about falsy values.\n  if (block.data) {\n    state['data'] = block.data;\n  }\n}\n\n/**\n * Adds the coordinates of the given block to the given state object.\n *\n * @param block The block to base the coordinates on.\n * @param state The state object to append to.\n */\nfunction saveCoords(block: Block, state: State) {\n  const workspace = block.workspace;\n  const xy = block.getRelativeToSurfaceXY();\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\n  state['y'] = Math.round(xy.y);\n}\n\n/**\n * Adds any extra state the block may provide to the given state object.\n *\n * @param block The block to serialize the extra state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     extra state (rather than possibly saving a reference to some state).\n */\nfunction saveExtraState(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n) {\n  if (block.saveExtraState) {\n    const extraState = block.saveExtraState(doFullSerialization);\n    if (extraState !== null) {\n      state['extraState'] = extraState;\n    }\n  } else if (block.mutationToDom) {\n    const extraState = block.mutationToDom();\n    if (extraState !== null) {\n      state['extraState'] = Xml.domToText(extraState).replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n  }\n}\n\n/**\n * Adds the state of all of the icons on the block to the given state object.\n *\n * @param block The block to serialize the icon state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     icon (rather than possibly saving a reference to some state).\n */\nfunction saveIcons(block: Block, state: State, doFullSerialization: boolean) {\n  const icons = Object.create(null);\n  for (const icon of block.getIcons()) {\n    if (isSerializable(icon)) {\n      const state = icon.saveState(doFullSerialization);\n      if (state) icons[icon.getType().toString()] = state;\n    }\n  }\n\n  if (Object.keys(icons).length) {\n    state['icons'] = icons;\n  }\n}\n\n/**\n * Adds the state of all of the fields on the block to the given state object.\n *\n * @param block The block to serialize the field state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     field (rather than possibly saving a reference to some state).\n */\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\n  const fields = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      if (field.isSerializable()) {\n        fields[field.name!] = field.saveState(doFullSerialization);\n      }\n    }\n  }\n  if (Object.keys(fields).length) {\n    state['fields'] = fields;\n  }\n}\n\n/**\n * Adds the state of all of the child blocks of the given block (which are\n * connected to inputs) to the given state object.\n *\n * @param block The block to serialize the input blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveInputBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  const inputs = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    if (!input.connection) continue;\n    const connectionState = saveConnection(\n      input.connection as Connection,\n      doFullSerialization,\n      saveIds,\n    );\n    if (connectionState) {\n      inputs[input.name] = connectionState;\n    }\n  }\n\n  if (Object.keys(inputs).length) {\n    state['inputs'] = inputs;\n  }\n}\n\n/**\n * Adds the state of all of the next blocks of the given block to the given\n * state object.\n *\n * @param block The block to serialize the next blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveNextBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  if (!block.nextConnection) {\n    return;\n  }\n  const connectionState = saveConnection(\n    block.nextConnection,\n    doFullSerialization,\n    saveIds,\n  );\n  if (connectionState) {\n    state['next'] = connectionState;\n  }\n}\n\n/**\n * Returns the state of the given connection (ie the state of any connected\n * shadow or real blocks).\n *\n * @param connection The connection to serialize the connected blocks of.\n * @returns An object containing the state of any connected shadow block, or any\n *     connected real block.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveConnection(\n  connection: Connection,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n): ConnectionState | null {\n  const shadow = connection.getShadowState(true);\n  const child = connection.targetBlock();\n  if (!shadow && !child) {\n    return null;\n  }\n  const state = Object.create(null);\n  if (shadow) {\n    state['shadow'] = shadow;\n  }\n  if (child && !child.isShadow()) {\n    state['block'] = save(child, {doFullSerialization, saveIds});\n  }\n  return state;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @returns The block that was just loaded.\n */\nexport function append(\n  state: State,\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n): Block {\n  const block = appendInternal(state, workspace, {recordUndo});\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined internally so that the extra parameters don't clutter our\n * external API.\n * But it is exported so that other places within Blockly can call it directly\n * with the extra parameters.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: If true, the block will be set to a shadow block after\n *     it is created. False by default. recordUndo: If true, events triggered by\n *     this function will be undo-able by the user. False by default.\n * @returns The block that was just appended.\n * @internal\n */\nexport function appendInternal(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n    recordUndo = false,\n  }: {\n    parentConnection?: Connection;\n    isShadow?: boolean;\n    recordUndo?: boolean;\n  } = {},\n): Block {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n  eventUtils.disable();\n\n  let block;\n  try {\n    block = appendPrivate(state, workspace, {parentConnection, isShadow});\n  } finally {\n    eventUtils.enable();\n  }\n\n  if (eventUtils.isEnabled()) {\n    eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n  }\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  // Adding connections to the connection db is expensive. This defers that\n  // operation to decrease load time.\n  if (workspace.rendered) {\n    const blockSvg = block as BlockSvg;\n    setTimeout(() => {\n      if (!blockSvg.disposed) {\n        blockSvg.setConnectionTracking(true);\n      }\n    }, 1);\n  }\n\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined privately so that it can be called recursively without firing\n * eroneous events. Events (and other things we only want to occur on the top\n * block) are handled by appendInternal.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: The block will be set to a shadow block after it is\n *     created. False by default.\n * @returns The block that was just appended.\n */\nfunction appendPrivate(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n  }: {parentConnection?: Connection; isShadow?: boolean} = {},\n): Block {\n  if (!state['type']) {\n    throw new MissingBlockType(state);\n  }\n\n  const block = workspace.newBlock(state['type'], state['id']);\n  block.setShadow(isShadow);\n  loadCoords(block, state);\n  loadAttributes(block, state);\n  loadExtraState(block, state);\n  tryToConnectParent(parentConnection, block, state);\n  loadIcons(block, state);\n  loadFields(block, state);\n  loadInputBlocks(block, state);\n  loadNextBlocks(block, state);\n  initBlock(block, workspace.rendered);\n\n  return block;\n}\n\n/**\n * Applies any coordinate information available on the state object to the\n * block.\n *\n * @param block The block to set the position of.\n * @param state The state object to reference.\n */\nfunction loadCoords(block: Block, state: State) {\n  let x = state['x'] === undefined ? 0 : state['x'];\n  const y = state['y'] === undefined ? 0 : state['y'];\n\n  const workspace = block.workspace;\n  x = workspace.RTL ? workspace.getWidth() - x : x;\n\n  block.moveBy(x, y);\n}\n\n/**\n * Applies any attribute information available on the state object to the block.\n *\n * @param block The block to set the attributes of.\n * @param state The state object to reference.\n */\nfunction loadAttributes(block: Block, state: State) {\n  if (state['collapsed']) {\n    block.setCollapsed(true);\n  }\n  if (state['deletable'] === false) {\n    block.setDeletable(false);\n  }\n  if (state['movable'] === false) {\n    block.setMovable(false);\n  }\n  if (state['editable'] === false) {\n    block.setEditable(false);\n  }\n  if (state['enabled'] === false) {\n    block.setEnabled(false);\n  }\n  if (state['inline'] !== undefined) {\n    block.setInputsInline(state['inline']);\n  }\n  if (state['data'] !== undefined) {\n    block.data = state['data'];\n  }\n}\n\n/**\n * Applies any extra state information available on the state object to the\n * block.\n *\n * @param block The block to set the extra state of.\n * @param state The state object to reference.\n */\nfunction loadExtraState(block: Block, state: State) {\n  if (!state['extraState']) {\n    return;\n  }\n  if (block.loadExtraState) {\n    block.loadExtraState(state['extraState']);\n  } else if (block.domToMutation) {\n    block.domToMutation(utilsXml.textToDom(state['extraState']));\n  }\n}\n\n/**\n * Attempts to connect the block to the parent connection, if it exists.\n *\n * @param parentConnection The parent connection to try to connect the block to.\n * @param child The block to try to connect to the parent.\n * @param state The state which defines the given block\n */\nfunction tryToConnectParent(\n  parentConnection: Connection | undefined,\n  child: Block,\n  state: State,\n) {\n  if (!parentConnection) {\n    return;\n  }\n\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\n    throw new RealChildOfShadow(state);\n  }\n\n  let connected = false;\n  let childConnection;\n  if (parentConnection.type === inputTypes.VALUE) {\n    childConnection = child.outputConnection;\n    if (!childConnection) {\n      throw new MissingConnection('output', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  } else {\n    // Statement type.\n    childConnection = child.previousConnection;\n    if (!childConnection) {\n      throw new MissingConnection('previous', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  }\n\n  if (!connected) {\n    const checker = child.workspace.connectionChecker;\n    throw new BadConnectionCheck(\n      checker.getErrorMessage(\n        checker.canConnectWithReason(childConnection, parentConnection, false),\n        childConnection,\n        parentConnection,\n      ),\n      parentConnection.type === inputTypes.VALUE\n        ? 'output connection'\n        : 'previous connection',\n      child,\n      state,\n    );\n  }\n}\n\n/**\n * Applies icon state to the icons on the block, based on the given state\n * object.\n *\n * @param block The block to set the icon state of.\n * @param state The state object to reference.\n */\nfunction loadIcons(block: Block, state: State) {\n  if (!state['icons']) return;\n\n  const iconTypes = Object.keys(state['icons']);\n  for (const iconType of iconTypes) {\n    const iconState = state['icons'][iconType];\n    let icon = block.getIcon(iconType);\n    if (!icon) {\n      const constructor = registry.getClass(\n        registry.Type.ICON,\n        iconType,\n        false,\n      );\n      if (!constructor) throw new UnregisteredIcon(iconType, block, state);\n      icon = new constructor(block);\n      block.addIcon(icon);\n    }\n    if (isSerializable(icon)) icon.loadState(iconState);\n  }\n}\n\n/**\n * Applies any field information available on the state object to the block.\n *\n * @param block The block to set the field state of.\n * @param state The state object to reference.\n */\nfunction loadFields(block: Block, state: State) {\n  if (!state['fields']) {\n    return;\n  }\n  const keys = Object.keys(state['fields']);\n  for (let i = 0; i < keys.length; i++) {\n    const fieldName = keys[i];\n    const fieldState = state['fields'][fieldName];\n    const field = block.getField(fieldName);\n    if (!field) {\n      console.warn(\n        `Ignoring non-existant field ${fieldName} in block ${block.type}`,\n      );\n      continue;\n    }\n    field.loadState(fieldState);\n  }\n}\n\n/**\n * Creates any child blocks (attached to inputs) defined by the given state\n * and attaches them to the given block.\n *\n * @param block The block to attach input blocks to.\n * @param state The state object to reference.\n */\nfunction loadInputBlocks(block: Block, state: State) {\n  if (!state['inputs']) {\n    return;\n  }\n  const keys = Object.keys(state['inputs']);\n  for (let i = 0; i < keys.length; i++) {\n    const inputName = keys[i];\n    const input = block.getInput(inputName);\n    if (!input || !input.connection) {\n      throw new MissingConnection(inputName, block, state);\n    }\n    loadConnection(input.connection, state['inputs'][inputName]);\n  }\n}\n\n/**\n * Creates any next blocks defined by the given state and attaches them to the\n * given block.\n *\n * @param block The block to attach next blocks to.\n * @param state The state object to reference.\n */\nfunction loadNextBlocks(block: Block, state: State) {\n  if (!state['next']) {\n    return;\n  }\n  if (!block.nextConnection) {\n    throw new MissingConnection('next', block, state);\n  }\n  loadConnection(block.nextConnection, state['next']);\n}\n/**\n * Applies the state defined by connectionState to the given connection, ie\n * assigns shadows and attaches child blocks.\n *\n * @param connection The connection to deserialize the connected blocks of.\n * @param connectionState The object containing the state of any connected\n *     shadow block, or any connected real block.\n */\nfunction loadConnection(\n  connection: Connection,\n  connectionState: ConnectionState,\n) {\n  if (connectionState['shadow']) {\n    connection.setShadowState(connectionState['shadow']);\n  }\n  if (connectionState['block']) {\n    appendPrivate(\n      connectionState['block'],\n      connection.getSourceBlock().workspace,\n      {parentConnection: connection},\n    );\n  }\n}\n\n// TODO(#5146): Remove this from the serialization system.\n/**\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\n *\n * @param block The block to initialize.\n * @param rendered Whether the block is a rendered or headless block.\n */\nfunction initBlock(block: Block, rendered: boolean) {\n  if (rendered) {\n    const blockSvg = block as BlockSvg;\n    // Adding connections to the connection db is expensive. This defers that\n    // operation to decrease load time.\n    blockSvg.setConnectionTracking(false);\n\n    blockSvg.initSvg();\n    blockSvg.queueRender();\n\n    // fixes #6076 JSO deserialization doesn't\n    // set .iconXY_ property so here it will be set\n    for (const icon of blockSvg.getIcons()) {\n      icon.onLocationChange(blockSvg.getRelativeToSurfaceXY());\n    }\n  } else {\n    block.initModel();\n  }\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveBlock = save;\n\n/**\n * Serializer for saving and loading block state.\n */\nexport class BlockSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing blocks. */\n    this.priority = priorities.BLOCKS;\n  }\n\n  /**\n   * Serializes the blocks of the given workspace.\n   *\n   * @param workspace The workspace to save the blocks of.\n   * @returns The state of the workspace's blocks, or null if there are no\n   *     blocks.\n   */\n  save(\n    workspace: Workspace,\n  ): {languageVersion: number; blocks: State[]} | null {\n    const blockStates = [];\n    for (const block of workspace.getTopBlocks(false)) {\n      const state = saveBlock(block, {\n        addCoordinates: true,\n        doFullSerialization: false,\n      });\n      if (state) {\n        blockStates.push(state);\n      }\n    }\n    if (blockStates.length) {\n      return {\n        'languageVersion': 0, // Currently unused.\n        'blocks': blockStates,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Deserializes the blocks defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the blocks to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(\n    state: {languageVersion: number; blocks: State[]},\n    workspace: Workspace,\n  ) {\n    const blockStates = state['blocks'];\n    for (const state of blockStates) {\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /**\n   * Disposes of any blocks that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the blocks of.\n   */\n  clear(workspace: Workspace) {\n    // Cannot use workspace.clear() because that also removes variables.\n    for (const block of workspace.getTopBlocks(false)) {\n      block.dispose(false);\n    }\n  }\n}\n\nserializationRegistry.register('blocks', new BlockSerializer());\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from '../block_svg.js';\nimport * as registry from './registry.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {IPaster} from '../interfaces/i_paster.js';\nimport {State, append} from '../serialization/blocks.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as eventUtils from '../events/utils.js';\nimport {config} from '../config.js';\n\nexport class BlockPaster implements IPaster<BlockCopyData, BlockSvg> {\n  static TYPE = 'block';\n\n  paste(\n    copyData: BlockCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): BlockSvg | null {\n    if (!workspace.isCapacityAvailable(copyData.typeCounts!)) return null;\n\n    if (coordinate) {\n      copyData.blockState['x'] = coordinate.x;\n      copyData.blockState['y'] = coordinate.y;\n    }\n\n    eventUtils.disable();\n    let block;\n    try {\n      block = append(copyData.blockState, workspace) as BlockSvg;\n      moveBlockToNotConflict(block);\n    } finally {\n      eventUtils.enable();\n    }\n\n    if (!block) return block;\n\n    if (eventUtils.isEnabled() && !block.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n    }\n    block.select();\n    return block;\n  }\n}\n\n/**\n * Moves the given block to a location where it does not: (1) overlap exactly\n * with any other blocks, or (2) look like it is connected to any other blocks.\n *\n * Exported for testing.\n *\n * @param block The block to move to an unambiguous location.\n * @internal\n */\nexport function moveBlockToNotConflict(block: BlockSvg) {\n  const workspace = block.workspace;\n  const snapRadius = config.snapRadius;\n  const coord = block.getRelativeToSurfaceXY();\n  const offset = new Coordinate(0, 0);\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\n  const otherCoords = workspace\n    .getAllBlocks(false)\n    .filter((otherBlock) => otherBlock.id != block.id)\n    .map((b) => b.getRelativeToSurfaceXY());\n\n  while (\n    blockOverlapsOtherExactly(Coordinate.sum(coord, offset), otherCoords) ||\n    blockIsInSnapRadius(block, offset, snapRadius)\n  ) {\n    if (workspace.RTL) {\n      offset.translate(-snapRadius, snapRadius * 2);\n    } else {\n      offset.translate(snapRadius, snapRadius * 2);\n    }\n  }\n\n  block!.moveTo(Coordinate.sum(coord, offset));\n}\n\n/**\n * @returns true if the given block coordinates are less than a delta of 1 from\n *     any of the other coordinates.\n */\nfunction blockOverlapsOtherExactly(\n  coord: Coordinate,\n  otherCoords: Coordinate[],\n): boolean {\n  return otherCoords.some(\n    (otherCoord) =>\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\n      Math.abs(otherCoord.y - coord.y) <= 1,\n  );\n}\n\n/**\n * @returns true if the given block (when offset by the given amount) is close\n *     enough to any other connections (within the snap radius) that it looks\n *     like they could connect.\n */\nfunction blockIsInSnapRadius(\n  block: BlockSvg,\n  offset: Coordinate,\n  snapRadius: number,\n): boolean {\n  return block\n    .getConnections_(false)\n    .some((connection) => !!connection.closest(snapRadius, offset).connection);\n}\n\nexport interface BlockCopyData extends ICopyData {\n  blockState: State;\n  typeCounts: {[key: string]: number};\n}\n\nregistry.register(BlockPaster.TYPE, new BlockPaster());\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.clipboard\n\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport {BlockPaster} from './clipboard/block_paster.js';\nimport * as globalRegistry from './registry.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as registry from './clipboard/registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\n\n/** Metadata about the object that is currently on the clipboard. */\nlet stashedCopyData: ICopyData | null = null;\n\nlet stashedWorkspace: WorkspaceSvg | null = null;\n\n/**\n * Copy a copyable element onto the local clipboard.\n *\n * @param toCopy The copyable element to be copied.\n * @deprecated v11. Use `myCopyable.toCopyData()` instead. To be removed v12.\n * @internal\n */\nexport function copy<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\n  deprecation.warn(\n    'Blockly.clipboard.copy',\n    'v11',\n    'v12',\n    'myCopyable.toCopyData()',\n  );\n  return TEST_ONLY.copyInternal(toCopy);\n}\n\n/**\n * Private version of copy for stubbing in tests.\n */\nfunction copyInternal<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\n  const data = toCopy.toCopyData();\n  stashedCopyData = data;\n  stashedWorkspace = (toCopy as any).workspace ?? null;\n  return data;\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null;\n\n/**\n * Pastes the last copied ICopyable into the workspace.\n *\n * @returns the pasted thing if the paste was successful, null otherwise.\n */\nexport function paste(): ICopyable<ICopyData> | null;\n\n/**\n * Pastes the given data into the workspace, or the last copied ICopyable if\n * no data is passed.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData?: T,\n  workspace?: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<ICopyData> | null {\n  if (!copyData || !workspace) {\n    if (!stashedCopyData || !stashedWorkspace) return null;\n    return pasteFromData(stashedCopyData, stashedWorkspace);\n  }\n  return pasteFromData(copyData, workspace, coordinate);\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nfunction pasteFromData<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null {\n  workspace = workspace.getRootWorkspace() ?? workspace;\n  return (globalRegistry\n    .getObject(globalRegistry.Type.PASTER, copyData.paster, false)\n    ?.paste(copyData, workspace, coordinate) ?? null) as ICopyable<T> | null;\n}\n\n/**\n * Duplicate this copy-paste-able element.\n *\n * @param toDuplicate The element to be duplicated.\n * @returns The element that was duplicated, or null if the duplication failed.\n * @deprecated v11. Use\n *     `Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)` instead.\n *     To be removed v12.\n * @internal\n */\nexport function duplicate<\n  U extends ICopyData,\n  T extends ICopyable<U> & IHasWorkspace,\n>(toDuplicate: T): T | null {\n  deprecation.warn(\n    'Blockly.clipboard.duplicate',\n    'v11',\n    'v12',\n    'Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)',\n  );\n  return TEST_ONLY.duplicateInternal(toDuplicate);\n}\n\n/**\n * Private version of duplicate for stubbing in tests.\n */\nfunction duplicateInternal<\n  U extends ICopyData,\n  T extends ICopyable<U> & IHasWorkspace,\n>(toDuplicate: T): T | null {\n  const data = toDuplicate.toCopyData();\n  if (!data) return null;\n  return paste(data, toDuplicate.workspace) as T;\n}\n\ninterface IHasWorkspace {\n  workspace: WorkspaceSvg;\n}\n\nexport const TEST_ONLY = {\n  duplicateInternal,\n  copyInternal,\n};\n\nexport {BlockPaster, registry};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.aria\n\n/** ARIA states/properties prefix. */\nconst ARIA_PREFIX = 'aria-';\n\n/** ARIA role attribute. */\nconst ROLE_ATTRIBUTE = 'role';\n\n/**\n * ARIA role values.\n * Copied from Closure's goog.a11y.aria.Role\n */\nexport enum Role {\n  // ARIA role for an interactive control of tabular data.\n  GRID = 'grid',\n\n  // ARIA role for a cell in a grid.\n  GRIDCELL = 'gridcell',\n  // ARIA role for a group of related elements like tree item siblings.\n  GROUP = 'group',\n\n  // ARIA role for a listbox.\n  LISTBOX = 'listbox',\n\n  // ARIA role for a popup menu.\n  MENU = 'menu',\n\n  // ARIA role for menu item elements.\n  MENUITEM = 'menuitem',\n  // ARIA role for a checkbox box element inside a menu.\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\n  // ARIA role for option items that are  children of combobox, listbox, menu,\n  // radiogroup, or tree elements.\n  OPTION = 'option',\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\n  PRESENTATION = 'presentation',\n\n  // ARIA role for a row of cells in a grid.\n  ROW = 'row',\n  // ARIA role for a tree.\n  TREE = 'tree',\n\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\n  TREEITEM = 'treeitem',\n}\n\n/**\n * ARIA states and properties.\n * Copied from Closure's goog.a11y.aria.State\n */\nexport enum State {\n  // ARIA property for setting the currently active descendant of an element,\n  // for example the selected item in a list box. Value: ID of an element.\n  ACTIVEDESCENDANT = 'activedescendant',\n  // ARIA property defines the total number of columns in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  COLCOUNT = 'colcount',\n  // ARIA state for a disabled item. Value: one of {true, false}.\n  DISABLED = 'disabled',\n\n  // ARIA state for setting whether the element like a tree node is expanded.\n  // Value: one of {true, false, undefined}.\n  EXPANDED = 'expanded',\n\n  // ARIA state indicating that the entered value does not conform. Value:\n  // one of {false, true, 'grammar', 'spelling'}\n  INVALID = 'invalid',\n\n  // ARIA property that provides a label to override any other text, value, or\n  // contents used to describe this element. Value: string.\n  LABEL = 'label',\n  // ARIA property for setting the element which labels another element.\n  // Value: space-separated IDs of elements.\n  LABELLEDBY = 'labelledby',\n\n  // ARIA property for setting the level of an element in the hierarchy.\n  // Value: integer.\n  LEVEL = 'level',\n  // ARIA property indicating if the element is horizontal or vertical.\n  // Value: one of {'vertical', 'horizontal'}.\n  ORIENTATION = 'orientation',\n\n  // ARIA property that defines an element's number of position in a list.\n  // Value: integer.\n  POSINSET = 'posinset',\n\n  // ARIA property defines the total number of rows in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  ROWCOUNT = 'rowcount',\n\n  // ARIA state for setting the currently selected item in the list.\n  // Value: one of {true, false, undefined}.\n  SELECTED = 'selected',\n  // ARIA property defining the number of items in a list. Value: integer.\n  SETSIZE = 'setsize',\n\n  // ARIA property for slider maximum value. Value: number.\n  VALUEMAX = 'valuemax',\n\n  // ARIA property for slider minimum value. Value: number.\n  VALUEMIN = 'valuemin',\n}\n\n/**\n * Sets the role of an element.\n *\n * Similar to Closure's goog.a11y.aria\n *\n * @param element DOM node to set role of.\n * @param roleName Role name.\n */\nexport function setRole(element: Element, roleName: Role) {\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\n}\n\n/**\n * Sets the state or property of an element.\n * Copied from Closure's goog.a11y.aria\n *\n * @param element DOM node where we set state.\n * @param stateName State attribute being set.\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\n * not an extra attribute.\n * @param value Value for the state attribute.\n */\nexport function setState(\n  element: Element,\n  stateName: State,\n  value: string | boolean | number | string[],\n) {\n  if (Array.isArray(value)) {\n    value = value.join(' ');\n  }\n  const attrStateName = ARIA_PREFIX + stateName;\n  element.setAttribute(attrStateName, `${value}`);\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.WidgetDiv\n\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Field} from './field.js';\nimport type {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The object currently using this container. */\nlet owner: unknown = null;\n\n/** Optional cleanup function set by whichever object uses the widget. */\nlet dispose: (() => void) | null = null;\n\n/** A class name representing the current owner's workspace container. */\nconst containerClassName = 'blocklyWidgetDiv';\n\n/** A class name representing the current owner's workspace renderer. */\nlet rendererClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The HTML container for popup overlays (e.g. editor widgets). */\nlet containerDiv: HTMLDivElement | null;\n\n/**\n * Returns the HTML container for editor widgets.\n *\n * @returns The editor widget container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Allows unit tests to reset the div. Do not use outside of tests.\n *\n * @param newDiv The new value for the DIV field.\n * @internal\n */\nexport function testOnly_setDiv(newDiv: HTMLDivElement | null) {\n  containerDiv = newDiv;\n  if (newDiv === null) {\n    document.querySelector('.' + containerClassName)?.remove();\n  }\n}\n\n/**\n * Create the widget div and inject it onto the page.\n */\nexport function createDom() {\n  if (document.querySelector('.' + containerClassName)) {\n    return; // Already created.\n  }\n\n  containerDiv = document.createElement('div') as HTMLDivElement;\n  containerDiv.className = containerClassName;\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n *\n * @param newOwner The object that will be using this container.\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param newDispose Optional cleanup function to be run when the widget is\n *     closed.\n */\nexport function show(newOwner: unknown, rtl: boolean, newDispose: () => void) {\n  hide();\n  owner = newOwner;\n  dispose = newDispose;\n  const div = containerDiv;\n  if (!div) return;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  rendererClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (rendererClassName) {\n    dom.addClass(div, rendererClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n}\n\n/**\n * Destroy the widget and hide the div.\n */\nexport function hide() {\n  if (!isVisible()) {\n    return;\n  }\n  owner = null;\n\n  const div = containerDiv;\n  if (!div) return;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  dispose && dispose();\n  dispose = null;\n  div.textContent = '';\n\n  if (rendererClassName) {\n    dom.removeClass(div, rendererClassName);\n    rendererClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n *\n * @param oldOwner The object that was using this container.\n */\nexport function hideIfOwner(oldOwner: unknown) {\n  if (owner === oldOwner) {\n    hide();\n  }\n}\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n *\n * @param x Horizontal location (window coordinates, not body).\n * @param y Vertical location (window coordinates, not body).\n * @param height The height of the widget div (pixels).\n */\nfunction positionInternal(x: number, y: number, height: number) {\n  containerDiv!.style.left = x + 'px';\n  containerDiv!.style.top = y + 'px';\n  containerDiv!.style.height = height + 'px';\n}\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The size of the widget that is inside the widget div, in\n *     window coordinates.\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\n *     alignment.\n * @internal\n */\nexport function positionWithAnchor(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n) {\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\n\n  if (y < 0) {\n    positionInternal(x, 0, widgetSize.height + y);\n  } else {\n    positionInternal(x, y, widgetSize.height);\n  }\n}\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @param rtl Whether the Blockly workspace is in RTL mode.\n * @returns A valid x-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateX(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n): number {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    const widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    const x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n}\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @returns A valid y-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateY(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n): number {\n  // Flip the widget vertically if off the bottom.\n  // The widget could go off the top of the window, but it would also go off\n  // the bottom.  The window is just too small.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n}\n\n/**\n * Determine if the owner is a field for purposes of repositioning.\n * We can't simply check `instanceof Field` as that would introduce a circular\n * dependency.\n */\nfunction isRepositionable(item: any): item is Field {\n  return !!item?.repositionForWindowResize;\n}\n\n/**\n * Reposition the widget div if the owner of it says to.\n * If the owner isn't a field, just give up and hide it.\n */\nexport function repositionForWindowResize(): void {\n  if (!isRepositionable(owner) || !owner.repositionForWindowResize()) {\n    // If the owner is not a Field, or if the owner returns false from the\n    // reposition method, we should hide the widget div. Otherwise, we'll assume\n    // the owner handled any needed resize.\n    hide();\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenu\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as clipboard from './clipboard.js';\nimport {config} from './config.js';\nimport * as dom from './utils/dom.js';\nimport type {\n  ContextMenuOption,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport * as eventUtils from './events/utils.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as serializationBlocks from './serialization/blocks.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n/**\n * Which block is the context menu attached to?\n */\nlet currentBlock: Block | null = null;\n\nconst dummyOwner = {};\n\n/**\n * Gets the block the context menu is currently attached to.\n *\n * @returns The block the context menu is attached to.\n */\nexport function getCurrentBlock(): Block | null {\n  return currentBlock;\n}\n\n/**\n * Sets the block the context menu is currently attached to.\n *\n * @param block The block the context menu is attached to.\n */\nexport function setCurrentBlock(block: Block | null) {\n  currentBlock = block;\n}\n\n/**\n * Menu object.\n */\nlet menu_: Menu | null = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n *\n * @param e Mouse event.\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n */\nexport function show(\n  e: Event,\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n) {\n  WidgetDiv.show(dummyOwner, rtl, dispose);\n  if (!options.length) {\n    hide();\n    return;\n  }\n  const menu = populate_(options, rtl);\n  menu_ = menu;\n\n  position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function () {\n    menu.focus();\n  }, 1);\n  currentBlock = null; // May be set by Blockly.Block.\n}\n\n/**\n * Create the context menu object and populate it with the given options.\n *\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @returns The menu that will be shown on right click.\n */\nfunction populate_(\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n): Menu {\n  /* Here's what one option object looks like:\n      {text: 'Make It So',\n       enabled: true,\n       callback: Blockly.MakeItSo}\n    */\n  const menu = new Menu();\n  menu.setRole(aria.Role.MENU);\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i];\n    const menuItem = new MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      const actionHandler = function () {\n        hide();\n        requestAnimationFrame(() => {\n          setTimeout(() => {\n            // If .scope does not exist on the option, then the callback\n            // will not be expecting a scope parameter, so there should be\n            // no problems. Just assume it is a ContextMenuOption and we'll\n            // pass undefined if it's not.\n            option.callback((option as ContextMenuOption).scope);\n          }, 0);\n        });\n      };\n      menuItem.onAction(actionHandler, {});\n    }\n  }\n  return menu;\n}\n\n/**\n * Add the menu to the page and position it correctly.\n *\n * @param menu The menu to add and position.\n * @param e Mouse event for the right click that is making the context\n *     menu appear.\n * @param rtl True if RTL, false if LTR.\n */\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\n  // Record windowSize and scrollOffset before adding menu.\n  const viewportBBox = svgMath.getViewportBBox();\n  const mouseEvent = e as MouseEvent;\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  const anchorBBox = new Rect(\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientX + viewportBBox.left,\n    mouseEvent.clientX + viewportBBox.left,\n  );\n\n  createWidget_(menu);\n  const menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n}\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n *\n * @param menu The menu to add to the widget div.\n */\nfunction createWidget_(menu: Menu) {\n  const div = WidgetDiv.getDiv();\n  if (!div) {\n    throw Error('Attempting to create a context menu when widget div is null');\n  }\n  const menuDom = menu.render(div);\n  dom.addClass(menuDom, 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  browserEvents.conditionalBind(\n    menuDom as EventTarget,\n    'contextmenu',\n    null,\n    haltPropagation,\n  );\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n}\n/**\n * Halts the propagation of the event without doing anything else.\n *\n * @param e An event.\n */\nfunction haltPropagation(e: Event) {\n  // This event has been handled.  No need to bubble up to the document.\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Hide the context menu.\n */\nexport function hide() {\n  WidgetDiv.hideIfOwner(dummyOwner);\n  currentBlock = null;\n}\n\n/**\n * Dispose of the menu.\n */\nexport function dispose() {\n  if (menu_) {\n    menu_.dispose();\n    menu_ = null;\n  }\n}\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original and returns it.\n *\n * @param block Original block.\n * @param state XML or JSON object representation of the new block.\n * @returns Function that creates a block.\n */\nexport function callbackFactory(\n  block: Block,\n  state: Element | serializationBlocks.State,\n): () => BlockSvg {\n  return () => {\n    eventUtils.disable();\n    let newBlock: BlockSvg;\n    try {\n      if (state instanceof Element) {\n        newBlock = Xml.domToBlockInternal(state, block.workspace!) as BlockSvg;\n      } else {\n        newBlock = serializationBlocks.appendInternal(\n          state,\n          block.workspace,\n        ) as BlockSvg;\n      }\n      // Move the new block next to the old block.\n      const xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= config.snapRadius;\n      } else {\n        xy.x += config.snapRadius;\n      }\n      xy.y += config.snapRadius * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    newBlock.select();\n    return newBlock;\n  };\n}\n\n// Helper functions for creating context menu options.\n\n/**\n * Make a context menu option for deleting the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @internal\n */\nexport function commentDeleteOption(\n  comment: WorkspaceCommentSvg,\n): LegacyContextMenuOption {\n  const deleteOption = {\n    text: Msg['REMOVE_COMMENT'],\n    enabled: true,\n    callback: function () {\n      eventUtils.setGroup(true);\n      comment.dispose();\n      eventUtils.setGroup(false);\n    },\n  };\n  return deleteOption;\n}\n\n/**\n * Make a context menu option for duplicating the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @internal\n */\nexport function commentDuplicateOption(\n  comment: WorkspaceCommentSvg,\n): LegacyContextMenuOption {\n  const duplicateOption = {\n    text: Msg['DUPLICATE_COMMENT'],\n    enabled: true,\n    callback: function () {\n      const data = comment.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, comment.workspace);\n    },\n  };\n  return duplicateOption;\n}\n\n/**\n * Make a context menu option for adding a comment on the workspace.\n *\n * @param ws The workspace where the right-click\n *     originated.\n * @param e The right-click mouse event.\n * @returns A menu option, containing text, enabled, and a callback.\n *     comments are not bundled in.\n * @internal\n */\nexport function workspaceCommentOption(\n  ws: WorkspaceSvg,\n  e: Event,\n): ContextMenuOption {\n  /**\n   * Helper function to create and position a comment correctly based on the\n   * location of the mouse event.\n   */\n  function addWsComment() {\n    const comment = new WorkspaceCommentSvg(\n      ws,\n      Msg['WORKSPACE_COMMENT_DEFAULT_TEXT'],\n      WorkspaceCommentSvg.DEFAULT_SIZE,\n      WorkspaceCommentSvg.DEFAULT_SIZE,\n    );\n\n    const injectionDiv = ws.getInjectionDiv();\n    // Bounding rect coordinates are in client coordinates, meaning that they\n    // are in pixels relative to the upper left corner of the visible browser\n    // window.  These coordinates change when you scroll the browser window.\n    const boundingRect = injectionDiv.getBoundingClientRect();\n\n    // The client coordinates offset by the injection div's upper left corner.\n    const mouseEvent = e as MouseEvent;\n    const clientOffsetPixels = new Coordinate(\n      mouseEvent.clientX - boundingRect.left,\n      mouseEvent.clientY - boundingRect.top,\n    );\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n    // The position of the new comment in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset = Coordinate.difference(\n      clientOffsetPixels,\n      mainOffsetPixels,\n    );\n    // The position of the new comment in main workspace coordinates.\n    finalOffset.scale(1 / ws.scale);\n\n    const commentX = finalOffset.x;\n    const commentY = finalOffset.y;\n    comment.moveBy(commentX, commentY);\n    if (ws.rendered) {\n      comment.initSvg();\n      comment.render();\n      comment.select();\n    }\n  }\n\n  const wsCommentOption = {\n    enabled: true,\n  } as ContextMenuOption;\n  wsCommentOption.text = Msg['ADD_COMMENT'];\n  wsCommentOption.callback = function () {\n    addWsComment();\n  };\n  return wsCommentOption;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.math\n\n/**\n * Converts degrees to radians.\n * Copied from Closure's goog.math.toRadians.\n *\n * @param angleDegrees Angle in degrees.\n * @returns Angle in radians.\n */\nexport function toRadians(angleDegrees: number): number {\n  return (angleDegrees * Math.PI) / 180;\n}\n\n/**\n * Converts radians to degrees.\n * Copied from Closure's goog.math.toDegrees.\n *\n * @param angleRadians Angle in radians.\n * @returns Angle in degrees.\n */\nexport function toDegrees(angleRadians: number): number {\n  return (angleRadians * 180) / Math.PI;\n}\n\n/**\n * Clamp the provided number between the lower bound and the upper bound.\n *\n * @param lowerBound The desired lower bound.\n * @param number The number to clamp.\n * @param upperBound The desired upper bound.\n * @returns The clamped number.\n */\nexport function clamp(\n  lowerBound: number,\n  number: number,\n  upperBound: number,\n): number {\n  if (upperBound < lowerBound) {\n    const temp = upperBound;\n    upperBound = lowerBound;\n    lowerBound = temp;\n  }\n  return Math.max(lowerBound, Math.min(number, upperBound));\n}\n", "/**\n * @license\n * Copyright 2016 Massachusetts Institute of Technology\n * All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of the workspace, for drop-down menus.\n *\n * @class\n */\n// Former goog.module ID: Blockly.dropDownDiv\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Field} from './field.js';\nimport * as math from './utils/math.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Arrow size in px. Should match the value in CSS\n * (need to position pre-render).\n */\nexport const ARROW_SIZE = 16;\n\n/**\n * Drop-down border size in px. Should match the value in CSS (need to position\n * the arrow).\n */\nexport const BORDER_SIZE = 1;\n\n/**\n * Amount the arrow must be kept away from the edges of the main drop-down div,\n * in px.\n */\nexport const ARROW_HORIZONTAL_PADDING = 12;\n\n/** Amount drop-downs should be padded away from the source, in px. */\nexport const PADDING_Y = 16;\n\n/** Length of animations in seconds. */\nexport const ANIMATION_TIME = 0.25;\n\n/**\n * Timer for animation out, to be cleared if we need to immediately hide\n * without disrupting new shows.\n */\nlet animateOutTimer: ReturnType<typeof setTimeout> | null = null;\n\n/** Callback for when the drop-down is hidden. */\nlet onHide: Function | null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet renderedClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The content element. */\nlet div: HTMLDivElement;\n\n/** The content element. */\nlet content: HTMLDivElement;\n\n/** The arrow element. */\nlet arrow: HTMLDivElement;\n\n/**\n * Drop-downs will appear within the bounds of this element if possible.\n * Set in setBoundsElement.\n */\nlet boundsElement: Element | null = null;\n\n/** The object currently using the drop-down. */\nlet owner: Field | null = null;\n\n/** Whether the dropdown was positioned to a field or the source block. */\nlet positionToField: boolean | null = null;\n\n/**\n * Dropdown bounds info object used to encapsulate sizing information about a\n * bounding element (bounding box and width/height).\n */\nexport interface BoundsInfo {\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n  width: number;\n  height: number;\n}\n\n/** Dropdown position metrics. */\nexport interface PositionMetrics {\n  initialX: number;\n  initialY: number;\n  finalX: number;\n  finalY: number;\n  arrowX: number | null;\n  arrowY: number | null;\n  arrowAtTop: boolean | null;\n  arrowVisible: boolean;\n}\n\n/**\n * Create and insert the DOM element for this div.\n *\n * @internal\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyDropDownDiv')) {\n    return; // Already created.\n  }\n  div = document.createElement('div');\n  div.className = 'blocklyDropDownDiv';\n  const parentDiv = common.getParentContainer() || document.body;\n  parentDiv.appendChild(div);\n\n  content = document.createElement('div');\n  content.className = 'blocklyDropDownContent';\n  div.appendChild(content);\n\n  arrow = document.createElement('div');\n  arrow.className = 'blocklyDropDownArrow';\n  div.appendChild(arrow);\n\n  div.style.opacity = '0';\n  // Transition animation for transform: translate() and opacity.\n  div.style.transition =\n    'transform ' + ANIMATION_TIME + 's, ' + 'opacity ' + ANIMATION_TIME + 's';\n\n  // Handle focusin/out events to add a visual indicator when\n  // a child is focused or blurred.\n  div.addEventListener('focusin', function () {\n    dom.addClass(div, 'blocklyFocused');\n  });\n  div.addEventListener('focusout', function () {\n    dom.removeClass(div, 'blocklyFocused');\n  });\n}\n\n/**\n * Set an element to maintain bounds within. Drop-downs will appear\n * within the box of this element if possible.\n *\n * @param boundsElem Element to bind drop-down to.\n */\nexport function setBoundsElement(boundsElem: Element | null) {\n  boundsElement = boundsElem;\n}\n\n/**\n * @returns The field that currently owns this, or null.\n */\nexport function getOwner(): Field | null {\n  return owner;\n}\n\n/**\n * Provide the div for inserting content into the drop-down.\n *\n * @returns Div to populate with content.\n */\nexport function getContentDiv(): Element {\n  return content;\n}\n\n/** Clear the content of the drop-down. */\nexport function clearContent() {\n  content.textContent = '';\n  content.style.width = '';\n}\n\n/**\n * Set the colour for the drop-down.\n *\n * @param backgroundColour Any CSS colour for the background.\n * @param borderColour Any CSS colour for the border.\n */\nexport function setColour(backgroundColour: string, borderColour: string) {\n  div.style.backgroundColor = backgroundColour;\n  div.style.borderColor = borderColour;\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular block. The primary position will be below the block,\n * and the secondary position above the block. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field showing the drop-down.\n * @param block Block to position the drop-down around.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByBlock<T>(\n  field: Field<T>,\n  block: BlockSvg,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  return showPositionedByRect(\n    getScaledBboxOfBlock(block),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular field. The primary position will be below the field,\n * and the secondary position above the field. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByField<T>(\n  field: Field<T>,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  positionToField = true;\n  return showPositionedByRect(\n    getScaledBboxOfField(field as Field),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n/**\n * Get the scaled bounding box of a block.\n *\n * @param block The block.\n * @returns The scaled bounding box of the block.\n */\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\n  const blockSvg = block.getSvgRoot();\n  const scale = block.workspace.scale;\n  const scaledHeight = block.height * scale;\n  const scaledWidth = block.width * scale;\n  const xy = style.getPageOffset(blockSvg);\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n}\n\n/**\n * Get the scaled bounding box of a field.\n *\n * @param field The field.\n * @returns The scaled bounding box of the field.\n */\nfunction getScaledBboxOfField(field: Field): Rect {\n  const bBox = field.getScaledBBox();\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\n}\n\n/**\n * Helper method to show and place the drop-down with positioning determined\n * by a scaled bounding box.  The primary position will be below the rect,\n * and the secondary position above the rect. Drop-down will be constrained to\n * the block's workspace.\n *\n * @param bBox The scaled bounding box.\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nfunction showPositionedByRect(\n  bBox: Rect,\n  field: Field,\n  opt_onHide?: Function,\n  opt_secondaryYOffset?: number,\n): boolean {\n  // If we can fit it, render below the block.\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n  const primaryY = bBox.bottom;\n  // If we can't fit it, render above the entire parent block.\n  const secondaryX = primaryX;\n  let secondaryY = bBox.top;\n  if (opt_secondaryYOffset) {\n    secondaryY += opt_secondaryYOffset;\n  }\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\n  // Set bounds to main workspace; show the drop-down.\n  let workspace = sourceBlock.workspace;\n  while (workspace.options.parentWorkspace) {\n    workspace = workspace.options.parentWorkspace;\n  }\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\n  return show(\n    field,\n    sourceBlock.RTL,\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n    opt_onHide,\n  );\n}\n\n/**\n * Show and place the drop-down.\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\n * the arrow will point at this origin and box will positioned below or above\n * it.  If we can maintain the container bounds at the primary point, the arrow\n * will point there, and the container will be positioned below it.\n * If we can't maintain the container bounds at the primary point, fall-back to\n * the secondary point and position above.\n *\n * @param newOwner The object showing the drop-down\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @returns True if the menu rendered at the primary origin point.\n * @internal\n */\nexport function show<T>(\n  newOwner: Field<T>,\n  rtl: boolean,\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n  opt_onHide?: Function,\n): boolean {\n  owner = newOwner as Field;\n  onHide = opt_onHide || null;\n  // Set direction.\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (renderedClassName) {\n    dom.addClass(div, renderedClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n\n  // When we change `translate` multiple times in close succession,\n  // Chrome may choose to wait and apply them all at once.\n  // Since we want the translation to initial X, Y to be immediate,\n  // and the translation to final X, Y to be animated,\n  // we saw problems where both would be applied after animation was turned on,\n  // making the dropdown appear to fly in from (0, 0).\n  // Using both `left`, `top` for the initial translation and then `translate`\n  // for the animated transition to final X, Y is a workaround.\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n}\n\nconst internal = {\n  /**\n   * Get sizing info about the bounding element.\n   *\n   * @returns An object containing size information about the bounding element\n   *     (bounding box and width/height).\n   */\n  getBoundsInfo: function (): BoundsInfo {\n    const boundPosition = style.getPageOffset(boundsElement as Element);\n    const boundSize = style.getSize(boundsElement as Element);\n\n    return {\n      left: boundPosition.x,\n      right: boundPosition.x + boundSize.width,\n      top: boundPosition.y,\n      bottom: boundPosition.y + boundSize.height,\n      width: boundSize.width,\n      height: boundSize.height,\n    };\n  },\n\n  /**\n   * Helper to position the drop-down and the arrow, maintaining bounds.\n   * See explanation of origin points in show.\n   *\n   * @param primaryX Desired origin point x, in absolute px.\n   * @param primaryY Desired origin point y, in absolute px.\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\n   * @returns Various final metrics, including rendered positions for drop-down\n   *     and arrow.\n   */\n  getPositionMetrics: function (\n    primaryX: number,\n    primaryY: number,\n    secondaryX: number,\n    secondaryY: number,\n  ): PositionMetrics {\n    const boundsInfo = internal.getBoundsInfo();\n    const divSize = style.getSize(div as Element);\n\n    // Can we fit in-bounds below the target?\n    if (primaryY + divSize.height < boundsInfo.bottom) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit in-bounds above the target?\n    if (secondaryY - divSize.height > boundsInfo.top) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // below?\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // above?\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n\n    // Last resort, render at top of page.\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\n  },\n};\n\n/**\n * Get the metrics for positioning the div below the source.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionBelowMetrics(\n  primaryX: number,\n  primaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    primaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\n  const finalY = primaryY + PADDING_Y;\n\n  return {\n    initialX: xCoords.divX,\n    initialY: primaryY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: true,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div above the source.\n *\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionAboveMetrics(\n  secondaryX: number,\n  secondaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    secondaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\n  const finalY = secondaryY - divSize.height - PADDING_Y;\n  const initialY = secondaryY - divSize.height; // No padding on Y.\n\n  return {\n    initialX: xCoords.divX,\n    initialY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: false,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div at the top of the page.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionTopOfPageMetrics(\n  sourceX: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    sourceX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  // No need to provide arrow-specific information because it won't be visible.\n  return {\n    initialX: xCoords.divX,\n    initialY: 0,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY: 0, // Y position remains constant during animation.\n    arrowAtTop: null,\n    arrowX: null,\n    arrowY: null,\n    arrowVisible: false,\n  };\n}\n\n/**\n * Get the x positions for the left side of the DropDownDiv and the arrow,\n * accounting for the bounds of the workspace.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsLeft The left edge of the bounding element, in absolute px.\n * @param boundsRight The right edge of the bounding element, in absolute px.\n * @param divWidth The width of the div in px.\n * @returns An object containing metrics for the x positions of the left side of\n *     the DropDownDiv and the arrow.\n * @internal\n */\nexport function getPositionX(\n  sourceX: number,\n  boundsLeft: number,\n  boundsRight: number,\n  divWidth: number,\n): {divX: number; arrowX: number} {\n  let divX = sourceX;\n  // Offset the topLeft coord so that the dropdowndiv is centered.\n  divX -= divWidth / 2;\n  // Fit the dropdowndiv within the bounds of the workspace.\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\n\n  let arrowX = sourceX;\n  // Offset the arrow coord so that the arrow is centered.\n  arrowX -= ARROW_SIZE / 2;\n  // Convert the arrow position to be relative to the top left of the div.\n  let relativeArrowX = arrowX - divX;\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\n  relativeArrowX = math.clamp(\n    horizPadding,\n    relativeArrowX,\n    divWidth - horizPadding - ARROW_SIZE,\n  );\n\n  return {arrowX: relativeArrowX, divX};\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Hide the menu only if it is owned by the provided object.\n *\n * @param divOwner Object which must be owning the drop-down to hide.\n * @param opt_withoutAnimation True if we should hide the dropdown without\n *     animating.\n * @returns True if hidden.\n */\nexport function hideIfOwner<T>(\n  divOwner: Field<T>,\n  opt_withoutAnimation?: boolean,\n): boolean {\n  if (owner === divOwner) {\n    if (opt_withoutAnimation) {\n      hideWithoutAnimation();\n    } else {\n      hide();\n    }\n    return true;\n  }\n  return false;\n}\n\n/** Hide the menu, triggering animation. */\nexport function hide() {\n  // Start the animation by setting the translation and fading out.\n  // Reset to (initialX, initialY) - i.e., no translation.\n  div.style.transform = 'translate(0, 0)';\n  div.style.opacity = '0';\n  // Finish animation - reset all values to default.\n  animateOutTimer = setTimeout(function () {\n    hideWithoutAnimation();\n  }, ANIMATION_TIME * 1000);\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n}\n\n/** Hide the menu, without animation. */\nexport function hideWithoutAnimation() {\n  if (!isVisible()) {\n    return;\n  }\n  if (animateOutTimer) {\n    clearTimeout(animateOutTimer);\n  }\n\n  // Reset style properties in case this gets called directly\n  // instead of hide() - see discussion on #2551.\n  div.style.transform = '';\n  div.style.left = '';\n  div.style.top = '';\n  div.style.opacity = '0';\n  div.style.display = 'none';\n  div.style.backgroundColor = '';\n  div.style.borderColor = '';\n\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n  clearContent();\n  owner = null;\n\n  if (renderedClassName) {\n    dom.removeClass(div, renderedClassName);\n    renderedClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Set the dropdown div's position.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @returns True if the menu rendered at the primary origin point.\n */\nfunction positionInternal(\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n): boolean {\n  const metrics = internal.getPositionMetrics(\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n  );\n\n  // Update arrow CSS.\n  if (metrics.arrowVisible) {\n    arrow.style.display = '';\n    arrow.style.transform =\n      'translate(' +\n      metrics.arrowX +\n      'px,' +\n      metrics.arrowY +\n      'px) rotate(45deg)';\n    arrow.setAttribute(\n      'class',\n      metrics.arrowAtTop\n        ? 'blocklyDropDownArrow blocklyArrowTop'\n        : 'blocklyDropDownArrow blocklyArrowBottom',\n    );\n  } else {\n    arrow.style.display = 'none';\n  }\n\n  const initialX = Math.floor(metrics.initialX);\n  const initialY = Math.floor(metrics.initialY);\n  const finalX = Math.floor(metrics.finalX);\n  const finalY = Math.floor(metrics.finalY);\n\n  // First apply initial translation.\n  div.style.left = initialX + 'px';\n  div.style.top = initialY + 'px';\n\n  // Show the div.\n  div.style.display = 'block';\n  div.style.opacity = '1';\n  // Add final translate, animated through `transition`.\n  // Coordinates are relative to (initialX, initialY),\n  // where the drop-down is absolutely positioned.\n  const dx = finalX - initialX;\n  const dy = finalY - initialY;\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\n\n  return !!metrics.arrowAtTop;\n}\n\n/**\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\n * calculate the new position, it will just hide it instead.\n *\n * @internal\n */\nexport function repositionForWindowResize() {\n  // This condition mainly catches the dropdown div when it is being used as a\n  // dropdown.  It is important not to close it in this case because on Android,\n  // when a field is focused, the soft keyboard opens triggering a window resize\n  // event and we want the dropdown div to stick around so users can type into\n  // it.\n  if (owner) {\n    const block = owner.getSourceBlock() as BlockSvg;\n    const bBox = positionToField\n      ? getScaledBboxOfField(owner)\n      : getScaledBboxOfBlock(block);\n    // If we can fit it, render below the block.\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n    const primaryY = bBox.bottom;\n    // If we can't fit it, render above the entire parent block.\n    const secondaryX = primaryX;\n    const secondaryY = bBox.top;\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n  } else {\n    hide();\n  }\n}\n\nexport const TEST_ONLY = internal;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockAnimations\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n/** A bounding box for a cloned block. */\ninterface CloneRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n/** PID of disconnect UI animation.  There can only be one at a time. */\nlet disconnectPid: ReturnType<typeof setTimeout> | null = null;\n\n/** The wobbling block.  There can only be one at a time. */\nlet wobblingBlock: BlockSvg | null = null;\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n *\n * @param block The block being disposed of.\n * @internal\n */\nexport function disposeUiEffect(block: BlockSvg) {\n  // Disposing is going to take so long the animation won't play anyway.\n  if (block.getDescendants(false).length > 100) return;\n\n  const workspace = block.workspace;\n  const svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  const xy = workspace.getSvgXY(svgGroup);\n  // Deeply clone the current block.\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getParentSvg().appendChild(clone);\n  const cloneRect = {\n    'x': xy.x,\n    'y': xy.y,\n    'width': block.width,\n    'height': block.height,\n  };\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date(), workspace.scale);\n}\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n *\n * @param clone SVG element to animate and dispose of.\n * @param rect Starting rect of the clone.\n * @param rtl True if RTL, false if LTR.\n * @param start Date of animation's start.\n * @param workspaceScale Scale of workspace.\n */\nfunction disposeUiStep(\n  clone: Element,\n  rect: CloneRect,\n  rtl: boolean,\n  start: Date,\n  workspaceScale: number,\n) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(clone);\n  } else {\n    const x =\n      rect.x + (((rtl ? -1 : 1) * rect.width * workspaceScale) / 2) * percent;\n    const y = rect.y + rect.height * workspaceScale * percent;\n    const scale = (1 - percent) * workspaceScale;\n    clone.setAttribute(\n      'transform',\n      'translate(' + x + ',' + y + ')' + ' scale(' + scale + ')',\n    );\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start, workspaceScale);\n  }\n}\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n *\n * @param block The block being connected.\n * @internal\n */\nexport function connectionUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  const xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  const ripple = dom.createSvgElement(\n    Svg.CIRCLE,\n    {\n      'cx': xy.x,\n      'cy': xy.y,\n      'r': 0,\n      'fill': 'none',\n      'stroke': '#888',\n      'stroke-width': 10,\n    },\n    workspace.getParentSvg(),\n  );\n\n  const scaleAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationCircle',\n      'begin': 'indefinite',\n      'attributeName': 'r',\n      'dur': '150ms',\n      'from': 0,\n      'to': 25 * scale,\n    },\n    ripple,\n  );\n  const opacityAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationOpacity',\n      'begin': 'indefinite',\n      'attributeName': 'opacity',\n      'dur': '150ms',\n      'from': 1,\n      'to': 0,\n    },\n    ripple,\n  );\n\n  scaleAnimation.beginElement();\n  opacityAnimation.beginElement();\n\n  setTimeout(() => void dom.removeNode(ripple), 150);\n}\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n *\n * @param block The block being disconnected.\n * @internal\n */\nexport function disconnectUiEffect(block: BlockSvg) {\n  disconnectUiStop();\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  const DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  const height = block.getHeightWidth().height;\n  let magnitude = (Math.atan(DISPLACEMENT / height) / Math.PI) * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  wobblingBlock = block;\n  disconnectUiStep(block, magnitude, new Date());\n}\n\n/**\n * Animate a brief wiggle of a disconnected block.\n *\n * @param block Block to animate.\n * @param magnitude Maximum degrees skew (reversed for RTL).\n * @param start Date of animation's start.\n */\nfunction disconnectUiStep(block: BlockSvg, magnitude: number, start: Date) {\n  const DURATION = 200; // Milliseconds.\n  const WIGGLES = 3; // Half oscillations.\n\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / DURATION;\n\n  let skew = '';\n  if (percent <= 1) {\n    const val = Math.round(\n      Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude,\n    );\n    skew = `skewX(${val})`;\n    disconnectPid = setTimeout(disconnectUiStep, 10, block, magnitude, start);\n  }\n\n  block\n    .getSvgRoot()\n    .setAttribute('transform', `${block.getTranslation()} ${skew}`);\n}\n\n/**\n * Stop the disconnect UI animation immediately.\n *\n * @internal\n */\nexport function disconnectUiStop() {\n  if (!wobblingBlock) return;\n  if (disconnectPid) {\n    clearTimeout(disconnectPid);\n    disconnectPid = null;\n  }\n  wobblingBlock\n    .getSvgRoot()\n    .setAttribute('transform', wobblingBlock.getTranslation());\n  wobblingBlock = null;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.string\n\nimport * as deprecation from './deprecation.js';\n\n/**\n * Fast prefix-checker.\n * Copied from Closure's goog.string.startsWith.\n *\n * @param str The string to check.\n * @param prefix A string to look for at the start of `str`.\n * @returns True if `str` begins with `prefix`.\n * @deprecated Use built-in **string.startsWith** instead.\n */\nexport function startsWith(str: string, prefix: string): boolean {\n  deprecation.warn(\n    'Blockly.utils.string.startsWith()',\n    'April 2022',\n    'April 2023',\n    'Use built-in string.startsWith',\n  );\n  return str.startsWith(prefix);\n}\n\n/**\n * Given an array of strings, return the length of the shortest one.\n *\n * @param array Array of strings.\n * @returns Length of shortest string.\n */\nexport function shortestStringLength(array: string[]): number {\n  if (!array.length) {\n    return 0;\n  }\n  return array.reduce(function (a, b) {\n    return a.length < b.length ? a : b;\n  }).length;\n}\n\n/**\n * Given an array of strings, return the length of the common prefix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common prefix.\n */\nexport function commonWordPrefix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0][len];\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i][len]) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i][len];\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Given an array of strings, return the length of the common suffix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common suffix.\n */\nexport function commonWordSuffix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0].substr(-len - 1, 1);\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i].substr(-len - 1, 1)) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i].charAt(array[i].length - len - 1);\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Wrap text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nexport function wrap(text: string, limit: number): string {\n  const lines = text.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    lines[i] = wrapLine(lines[i], limit);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Wrap single line of text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nfunction wrapLine(text: string, limit: number): string {\n  if (text.length <= limit) {\n    // Short text, no need to wrap.\n    return text;\n  }\n  // Split the text into words.\n  const words = text.trim().split(/\\s+/);\n  // Set limit to be the length of the largest word.\n  for (let i = 0; i < words.length; i++) {\n    if (words[i].length > limit) {\n      limit = words[i].length;\n    }\n  }\n\n  let lastScore;\n  let score = -Infinity;\n  let lastText;\n  let lineCount = 1;\n  do {\n    lastScore = score;\n    lastText = text;\n    // Create a list of booleans representing if a space (false) or\n    // a break (true) appears after each word.\n    let wordBreaks = [];\n    // Seed the list with evenly spaced linebreaks.\n    const steps = words.length / lineCount;\n    let insertedBreaks = 1;\n    for (let i = 0; i < words.length - 1; i++) {\n      if (insertedBreaks < (i + 1.5) / steps) {\n        insertedBreaks++;\n        wordBreaks[i] = true;\n      } else {\n        wordBreaks[i] = false;\n      }\n    }\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\n    score = wrapScore(words, wordBreaks, limit);\n    text = wrapToText(words, wordBreaks);\n    lineCount++;\n  } while (score > lastScore);\n  return lastText;\n}\n\n/**\n * Compute a score for how good the wrapping is.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns Larger the better.\n */\nfunction wrapScore(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): number {\n  // If this function becomes a performance liability, add caching.\n  // Compute the length of each line.\n  const lineLengths = [0];\n  const linePunctuation = [];\n  for (let i = 0; i < words.length; i++) {\n    lineLengths[lineLengths.length - 1] += words[i].length;\n    if (wordBreaks[i] === true) {\n      lineLengths.push(0);\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\n    } else if (wordBreaks[i] === false) {\n      lineLengths[lineLengths.length - 1]++;\n    }\n  }\n  const maxLength = Math.max(...lineLengths);\n\n  let score = 0;\n  for (let i = 0; i < lineLengths.length; i++) {\n    // Optimize for width.\n    // -2 points per char over limit (scaled to the power of 1.5).\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\n    // Optimize for even lines.\n    // -1 point per char smaller than max (scaled to the power of 1.5).\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\n    // Optimize for structure.\n    // Add score to line endings after punctuation.\n    if ('.?!'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 3;\n    } else if (',;)]}'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 4;\n    }\n  }\n  // All else being equal, the last line should not be longer than the\n  // previous line.  For example, this looks wrong:\n  // aaa bbb\n  // ccc ddd eee\n  if (\n    lineLengths.length > 1 &&\n    lineLengths[lineLengths.length - 1] <= lineLengths[lineLengths.length - 2]\n  ) {\n    score += 0.5;\n  }\n  return score;\n}\n/**\n * Mutate the array of line break locations until an optimal solution is found.\n * No line breaks are added or deleted, they are simply moved around.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns New array of optimal line breaks.\n */\nfunction wrapMutate(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): boolean[] {\n  let bestScore = wrapScore(words, wordBreaks, limit);\n  let bestBreaks;\n  // Try shifting every line break forward or backward.\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\n      continue;\n    }\n    const mutatedWordBreaks = new Array<boolean>().concat(wordBreaks);\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\n    if (mutatedScore > bestScore) {\n      bestScore = mutatedScore;\n      bestBreaks = mutatedWordBreaks;\n    }\n  }\n  if (bestBreaks) {\n    // Found an improvement.  See if it may be improved further.\n    return wrapMutate(words, bestBreaks, limit);\n  }\n  // No improvements found.  Done.\n  return wordBreaks;\n}\n\n/**\n * Reassemble the array of words into text, with the specified line breaks.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @returns Plain text.\n */\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\n  const text = [];\n  for (let i = 0; i < words.length; i++) {\n    text.push(words[i]);\n    if (wordBreaks[i] !== undefined) {\n      text.push(wordBreaks[i] ? '\\n' : ' ');\n    }\n  }\n  return text.join('');\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n */\nexport function isNumber(str: string): boolean {\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Tooltip\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as blocklyString from './utils/string.js';\n\n/**\n * A type which can define a tooltip.\n * Either a string, an object containing a tooltip property, or a function which\n * returns either a string, or another arbitrarily nested function which\n * eventually unwinds to a string.\n */\nexport type TipInfo =\n  | string\n  | {tooltip: AnyDuringMigration}\n  | (() => TipInfo | string | Function);\n\n/**\n * A function that renders custom tooltip UI.\n * 1st parameter: the div element to render content into.\n * 2nd parameter: the element being moused over (i.e., the element for which the\n * tooltip should be shown).\n */\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\n\n/**\n * An optional function that renders custom tooltips into the provided DIV. If\n * this is defined, the function will be called instead of rendering the default\n * tooltip UI.\n */\nlet customTooltip: CustomTooltip | undefined = undefined;\n\n/**\n * Sets a custom function that will be called if present instead of the default\n * tooltip UI.\n *\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\n */\nexport function setCustomTooltip(customFn: CustomTooltip) {\n  customTooltip = customFn;\n}\n\n/**\n * Gets the custom tooltip function.\n *\n * @returns The custom tooltip function, if defined.\n */\nexport function getCustomTooltip(): CustomTooltip | undefined {\n  return customTooltip;\n}\n\n/** Is a tooltip currently showing? */\nlet visible = false;\n\n/**\n * Returns whether or not a tooltip is showing\n *\n * @returns True if a tooltip is showing\n */\nexport function isVisible(): boolean {\n  return visible;\n}\n\n/** Is someone else blocking the tooltip from being shown? */\nlet blocked = false;\n\n/**\n * Maximum width (in characters) of a tooltip.\n */\nexport const LIMIT = 50;\n\n/** PID of suspended thread to clear tooltip on mouse out. */\nlet mouseOutPid: AnyDuringMigration = 0;\n\n/** PID of suspended thread to show the tooltip. */\nlet showPid: AnyDuringMigration = 0;\n\n/**\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastX = 0;\n\n/**\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastY = 0;\n\n/** Current element being pointed at. */\nlet element: AnyDuringMigration = null;\n\n/**\n * Once a tooltip has opened for an element, that element is 'poisoned' and\n * cannot respawn a tooltip until the pointer moves over a different element.\n */\nlet poisonedElement: AnyDuringMigration = null;\n\n/**\n * Horizontal offset between mouse cursor and tooltip.\n */\nexport const OFFSET_X = 0;\n\n/**\n * Vertical offset between mouse cursor and tooltip.\n */\nexport const OFFSET_Y = 10;\n\n/**\n * Radius mouse can move before killing tooltip.\n */\nexport const RADIUS_OK = 10;\n\n/**\n * Delay before tooltip appears.\n */\nexport const HOVER_MS = 750;\n\n/**\n * Horizontal padding between tooltip and screen edge.\n */\nexport const MARGINS = 5;\n\n/** The HTML container.  Set once by createDom. */\nlet containerDiv: HTMLDivElement | null = null;\n\n/**\n * Returns the HTML tooltip container.\n *\n * @returns The HTML tooltip container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Returns the tooltip text for the given element.\n *\n * @param object The object to get the tooltip text of.\n * @returns The tooltip text of the element.\n */\nexport function getTooltipOfObject(object: AnyDuringMigration | null): string {\n  const obj = getTargetObject(object);\n  if (obj) {\n    let tooltip = obj.tooltip;\n    while (typeof tooltip === 'function') {\n      tooltip = tooltip();\n    }\n    if (typeof tooltip !== 'string') {\n      throw Error('Tooltip function must return a string.');\n    }\n    return tooltip;\n  }\n  return '';\n}\n\n/**\n * Returns the target object that the given object is targeting for its\n * tooltip. Could be the object itself.\n *\n * @param obj The object are trying to find the target tooltip object of.\n * @returns The target tooltip object.\n */\nfunction getTargetObject(\n  obj: object | null,\n): {tooltip: AnyDuringMigration} | null {\n  while (obj && (obj as any).tooltip) {\n    if (\n      typeof (obj as any).tooltip === 'string' ||\n      typeof (obj as any).tooltip === 'function'\n    ) {\n      return obj as {tooltip: string | (() => string)};\n    }\n    obj = (obj as any).tooltip;\n  }\n  return null;\n}\n\n/**\n * Create the tooltip div and inject it onto the page.\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyTooltipDiv')) {\n    return; // Already created.\n  }\n  // Create an HTML container for popup overlays (e.g. editor widgets).\n  containerDiv = document.createElement('div');\n  containerDiv.className = 'blocklyTooltipDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Binds the required mouse events onto an SVG element.\n *\n * @param element SVG element onto which tooltip is to be bound.\n */\nexport function bindMouseEvents(element: Element) {\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  (element as AnyDuringMigration).mouseOverWrapper_ = browserEvents.bind(\n    element,\n    'pointerover',\n    null,\n    onMouseOver,\n  );\n  (element as AnyDuringMigration).mouseOutWrapper_ = browserEvents.bind(\n    element,\n    'pointerout',\n    null,\n    onMouseOut,\n  );\n\n  // Don't use bindEvent_ for mousemove since that would create a\n  // corresponding touch handler, even though this only makes sense in the\n  // context of a mouseover/mouseout.\n  element.addEventListener('pointermove', onMouseMove, false);\n}\n\n/**\n * Unbinds tooltip mouse events from the SVG element.\n *\n * @param element SVG element onto which tooltip is bound.\n */\nexport function unbindMouseEvents(element: Element | null) {\n  if (!element) {\n    return;\n  }\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\n  element.removeEventListener('pointermove', onMouseMove);\n}\n\n/**\n * Hide the tooltip if the mouse is over a different object.\n * Initialize the tooltip to potentially appear for this object.\n *\n * @param e Mouse event.\n */\nfunction onMouseOver(e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // If the tooltip is an object, treat it as a pointer to the next object in\n  // the chain to look at.  Terminate when a string or function is found.\n  const newElement = getTargetObject(e.currentTarget);\n  if (element !== newElement) {\n    hide();\n    poisonedElement = null;\n    element = newElement;\n  }\n  // Forget about any immediately preceding mouseOut event.\n  clearTimeout(mouseOutPid);\n}\n\n/**\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\n *\n * @param _e Mouse event.\n */\nfunction onMouseOut(_e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // Moving from one element to another (overlapping or with no gap) generates\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\n  // event and kill it if a mouseOver is received immediately.\n  // This way the task only fully executes if mousing into the void.\n  mouseOutPid = setTimeout(function () {\n    element = null;\n    poisonedElement = null;\n    hide();\n  }, 1);\n  clearTimeout(showPid);\n  showPid = 0;\n}\n\n/**\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\n * is already visible, hide it if the mouse strays out of a certain radius.\n *\n * @param e Mouse event.\n */\nfunction onMouseMove(e: Event) {\n  if (!element || !(element as AnyDuringMigration).tooltip) {\n    // No tooltip here to show.\n    return;\n  } else if (blocked) {\n    // Someone doesn't want us to show tooltips.  We are probably handling a\n    // user gesture, such as a click or drag.\n    return;\n  }\n  if (visible) {\n    // Compute the distance between the mouse position when the tooltip was\n    // shown and the current mouse position.  Pythagorean theorem.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    const dx = lastX - (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    const dy = lastY - (e as AnyDuringMigration).pageY;\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\n      hide();\n    }\n  } else if (poisonedElement !== element) {\n    // The mouse moved, clear any previously scheduled tooltip.\n    clearTimeout(showPid);\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    lastX = (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    lastY = (e as AnyDuringMigration).pageY;\n    showPid = setTimeout(show, HOVER_MS);\n  }\n}\n\n/**\n * Dispose of the tooltip.\n *\n * @internal\n */\nexport function dispose() {\n  element = null;\n  poisonedElement = null;\n  hide();\n}\n\n/**\n * Hide the tooltip.\n */\nexport function hide() {\n  if (visible) {\n    visible = false;\n    if (containerDiv) {\n      containerDiv.style.display = 'none';\n    }\n  }\n  if (showPid) {\n    clearTimeout(showPid);\n    showPid = 0;\n  }\n}\n\n/**\n * Hide any in-progress tooltips and block showing new tooltips until the next\n * call to unblock().\n *\n * @internal\n */\nexport function block() {\n  hide();\n  blocked = true;\n}\n\n/**\n * Unblock tooltips: allow them to be scheduled and shown according to their own\n * logic.\n *\n * @internal\n */\nexport function unblock() {\n  blocked = false;\n}\n\n/** Renders the tooltip content into the tooltip div. */\nfunction renderContent() {\n  if (!containerDiv || !element) {\n    // This shouldn't happen, but if it does, we can't render.\n    return;\n  }\n  if (typeof customTooltip === 'function') {\n    customTooltip(containerDiv, element);\n  } else {\n    renderDefaultContent();\n  }\n}\n\n/** Renders the default tooltip UI. */\nfunction renderDefaultContent() {\n  let tip = getTooltipOfObject(element);\n  tip = blocklyString.wrap(tip, LIMIT);\n  // Create new text, line by line.\n  const lines = tip.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    const div = document.createElement('div');\n    div.appendChild(document.createTextNode(lines[i]));\n    containerDiv!.appendChild(div);\n  }\n}\n\n/**\n * Gets the coordinates for the tooltip div, taking into account the edges of\n * the screen to prevent showing the tooltip offscreen.\n *\n * @param rtl True if the tooltip should be in right-to-left layout.\n * @returns Coordinates at which the tooltip div should be placed.\n */\nfunction getPosition(rtl: boolean): {x: number; y: number} {\n  // Position the tooltip just below the cursor.\n  const windowWidth = document.documentElement.clientWidth;\n  const windowHeight = document.documentElement.clientHeight;\n\n  let anchorX = lastX;\n  if (rtl) {\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\n  } else {\n    anchorX += OFFSET_X;\n  }\n\n  let anchorY = lastY + OFFSET_Y;\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\n    // Falling off the bottom of the screen; shift the tooltip up.\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\n  }\n\n  if (rtl) {\n    // Prevent falling off left edge in RTL mode.\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\n  } else {\n    if (\n      anchorX + containerDiv!.offsetWidth >\n      windowWidth + window.scrollX - 2 * MARGINS\n    ) {\n      // Falling off the right edge of the screen;\n      // clamp the tooltip on the edge.\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\n    }\n  }\n\n  return {x: anchorX, y: anchorY};\n}\n\n/** Create the tooltip and show it. */\nfunction show() {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  poisonedElement = element;\n  if (!containerDiv) {\n    return;\n  }\n  // Erase all existing text.\n  containerDiv.textContent = '';\n\n  // Add new content.\n  renderContent();\n\n  // Display the tooltip.\n  const rtl = (element as any).RTL;\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\n  containerDiv.style.display = 'block';\n  visible = true;\n\n  const {x, y} = getPosition(rtl);\n  containerDiv.style.left = x + 'px';\n  containerDiv.style.top = y + 'px';\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.object\n\n/**\n * Complete a deep merge of all members of a source object with a target object.\n *\n * @param target Target.\n * @param source Source.\n * @returns The resulting object.\n */\nexport function deepMerge(\n  target: AnyDuringMigration,\n  source: AnyDuringMigration,\n): AnyDuringMigration {\n  for (const x in source) {\n    if (source[x] !== null && typeof source[x] === 'object') {\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\n    } else {\n      target[x] = source[x];\n    }\n  }\n  return target;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface IHasBubble {\n  /** @returns True if the bubble is currently open, false otherwise. */\n  bubbleIsVisible(): boolean;\n\n  /** Sets whether the bubble is open or not. */\n  setBubbleVisible(visible: boolean): void;\n}\n\n/** Type guard that checks whether the given object is a IHasBubble. */\nexport function hasBubble(obj: any): obj is IHasBubble {\n  return (\n    obj.bubbleIsVisible !== undefined && obj.setBubbleVisible !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.colour\n\n/**\n * The richness of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvSaturation = 0.45;\n\n/**\n * Get the richness of block colours, regardless of the hue.\n *\n * @returns The current richness.\n * @internal\n */\nexport function getHsvSaturation(): number {\n  return hsvSaturation;\n}\n\n/**\n * Set the richness of block colours, regardless of the hue.\n *\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvSaturation(newSaturation: number) {\n  hsvSaturation = newSaturation;\n}\n\n/**\n * The intensity of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvValue = 0.65;\n\n/**\n * Get the intensity of block colours, regardless of the hue.\n *\n * @returns The current intensity.\n * @internal\n */\nexport function getHsvValue(): number {\n  return hsvValue;\n}\n\n/**\n * Set the intensity of block colours, regardless of the hue.\n *\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvValue(newValue: number) {\n  hsvValue = newValue;\n}\n\n/**\n * Parses a colour from a string.\n * .parse('red') = '#ff0000'\n * .parse('#f00') = '#ff0000'\n * .parse('#ff0000') = '#ff0000'\n * .parse('0xff0000') = '#ff0000'\n * .parse('rgb(255, 0, 0)') = '#ff0000'\n *\n * @param str Colour in some CSS format.\n * @returns A string containing a hex representation of the colour, or null if\n *     can't be parsed.\n */\nexport function parse(str: string | number): string | null {\n  str = `${str}`.toLowerCase().trim();\n  let hex = names[str];\n  if (hex) {\n    // e.g. 'red'\n    return hex;\n  }\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\n  hex = hex[0] === '#' ? hex : '#' + hex;\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\n    // e.g. '#00ff88'\n    return hex;\n  }\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\n    // e.g. '#0f8'\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\n  }\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n  if (rgb) {\n    // e.g. 'rgb(0, 128, 255)'\n    const r = Number(rgb[1]);\n    const g = Number(rgb[2]);\n    const b = Number(rgb[3]);\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\n      return rgbToHex(r, g, b);\n    }\n  }\n  return null;\n}\n\n/**\n * Converts a colour from RGB to hex representation.\n *\n * @param r Amount of red, int between 0 and 255.\n * @param g Amount of green, int between 0 and 255.\n * @param b Amount of blue, int between 0 and 255.\n * @returns Hex representation of the colour.\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const rgb = (r << 16) | (g << 8) | b;\n  if (r < 0x10) {\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\n  }\n  return '#' + rgb.toString(16);\n}\n\n/**\n * Converts a colour to RGB.\n *\n * @param colour String representing colour in any colour format ('#ff0000',\n *     'red', '0xff000', etc).\n * @returns RGB representation of the colour.\n */\nexport function hexToRgb(colour: string): number[] {\n  const hex = parse(colour);\n  if (!hex) {\n    return [0, 0, 0];\n  }\n\n  const rgb = parseInt(hex.substr(1), 16);\n  const r = rgb >> 16;\n  const g = (rgb >> 8) & 255;\n  const b = rgb & 255;\n\n  return [r, g, b];\n}\n\n/**\n * Converts an HSV triplet to hex representation.\n *\n * @param h Hue value in [0, 360].\n * @param s Saturation value in [0, 1].\n * @param v Brightness in [0, 255].\n * @returns Hex representation of the colour.\n */\nexport function hsvToHex(h: number, s: number, v: number): string {\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n  if (s === 0) {\n    red = v;\n    green = v;\n    blue = v;\n  } else {\n    const sextant = Math.floor(h / 60);\n    const remainder = h / 60 - sextant;\n    const val1 = v * (1 - s);\n    const val2 = v * (1 - s * remainder);\n    const val3 = v * (1 - s * (1 - remainder));\n    switch (sextant) {\n      case 1:\n        red = val2;\n        green = v;\n        blue = val1;\n        break;\n      case 2:\n        red = val1;\n        green = v;\n        blue = val3;\n        break;\n      case 3:\n        red = val1;\n        green = val2;\n        blue = v;\n        break;\n      case 4:\n        red = val3;\n        green = val1;\n        blue = v;\n        break;\n      case 5:\n        red = v;\n        green = val1;\n        blue = val2;\n        break;\n      case 6:\n      case 0:\n        red = v;\n        green = val3;\n        blue = val1;\n        break;\n    }\n  }\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\n}\n\n/**\n * Blend two colours together, using the specified factor to indicate the\n * weight given to the first colour.\n *\n * @param colour1 First colour.\n * @param colour2 Second colour.\n * @param factor The weight to be given to colour1 over colour2.\n *     Values should be in the range [0, 1].\n * @returns Combined colour represented in hex.\n */\nexport function blend(\n  colour1: string,\n  colour2: string,\n  factor: number,\n): string | null {\n  const hex1 = parse(colour1);\n  if (!hex1) {\n    return null;\n  }\n  const hex2 = parse(colour2);\n  if (!hex2) {\n    return null;\n  }\n  const rgb1 = hexToRgb(hex1);\n  const rgb2 = hexToRgb(hex2);\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\n  return rgbToHex(r, g, b);\n}\n\n/**\n * A map that contains the 16 basic colour keywords as defined by W3C:\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\n * The keys of this map are the lowercase \"readable\" names of the colours,\n * while the values are the \"hex\" values.\n */\nexport const names: {[key: string]: string} = {\n  'aqua': '#00ffff',\n  'black': '#000000',\n  'blue': '#0000ff',\n  'fuchsia': '#ff00ff',\n  'gray': '#808080',\n  'green': '#008000',\n  'lime': '#00ff00',\n  'maroon': '#800000',\n  'navy': '#000080',\n  'olive': '#808000',\n  'purple': '#800080',\n  'red': '#ff0000',\n  'silver': '#c0c0c0',\n  'teal': '#008080',\n  'white': '#ffffff',\n  'yellow': '#ffff00',\n};\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n */\nexport function hueToHex(hue: number): string {\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.parsing\n\nimport {Msg} from '../msg.js';\n\nimport * as colourUtils from './colour.js';\n\n/**\n * Internal implementation of the message reference and interpolation token\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @param parseInterpolationTokens Option to parse numeric interpolation\n *     tokens (%1, %2, ...) when true.\n * @param tokenizeNewlines Split individual newline characters into separate\n *     tokens when true.\n * @returns Array of strings and numbers.\n */\nfunction tokenizeInterpolationInternal(\n  message: string,\n  parseInterpolationTokens: boolean,\n  tokenizeNewlines: boolean,\n): (string | number)[] {\n  const tokens = [];\n  const chars = message.split('');\n  chars.push(''); // End marker.\n  // Parse the message with a finite state machine.\n  // 0 - Base case.\n  // 1 - % found.\n  // 2 - Digit found.\n  // 3 - Message ref found.\n  let state = 0;\n  const buffer = new Array<string>();\n  let number = null;\n  for (let i = 0; i < chars.length; i++) {\n    const c = chars[i];\n    if (state === 0) {\n      // Start escape.\n      if (c === '%') {\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        state = 1;\n      } else if (tokenizeNewlines && c === '\\n') {\n        // Output newline characters as single-character tokens, to be replaced\n        // with endOfRow dummies during interpolation.\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        tokens.push(c);\n      } else {\n        buffer.push(c); // Regular char.\n      }\n    } else if (state === 1) {\n      if (c === '%') {\n        buffer.push(c); // Escaped %: %%\n        state = 0;\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\n        state = 2;\n        number = c;\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n      } else if (c === '{') {\n        state = 3;\n      } else {\n        buffer.push('%', c); // Not recognized. Return as literal.\n        state = 0;\n      }\n    } else if (state === 2) {\n      if ('0' <= c && c <= '9') {\n        number += c; // Multi-digit number.\n      } else {\n        tokens.push(parseInt(number ?? '', 10));\n        i--; // Parse this char again.\n        state = 0;\n      }\n    } else if (state === 3) {\n      // String table reference\n      if (c === '') {\n        // Premature end before closing '}'\n        buffer.splice(0, 0, '%{'); // Re-insert leading delimiter\n        i--; // Parse this char again.\n        state = 0; // and parse as string literal.\n      } else if (c !== '}') {\n        buffer.push(c);\n      } else {\n        const rawKey = buffer.join('');\n        if (/[A-Z]\\w*/i.test(rawKey)) {\n          // Strict matching\n          // Found a valid string key. Attempt case insensitive match.\n          const keyUpper = rawKey.toUpperCase();\n\n          // BKY_ is the prefix used to namespace the strings used in\n          // Blockly core files and the predefined blocks in ../blocks/.\n          // These strings are defined in ../msgs/ files.\n          const bklyKey = keyUpper.startsWith('BKY_')\n            ? keyUpper.substring(4)\n            : null;\n          if (bklyKey && bklyKey in Msg) {\n            const rawValue = Msg[bklyKey];\n            if (typeof rawValue === 'string') {\n              // Attempt to dereference substrings, too, appending to the\n              // end.\n              Array.prototype.push.apply(\n                tokens,\n                tokenizeInterpolationInternal(\n                  rawValue,\n                  parseInterpolationTokens,\n                  tokenizeNewlines,\n                ),\n              );\n            } else if (parseInterpolationTokens) {\n              // When parsing interpolation tokens, numbers are special\n              // placeholders (%1, %2, etc). Make sure all other values are\n              // strings.\n              tokens.push(`${rawValue}`);\n            } else {\n              tokens.push(rawValue);\n            }\n          } else {\n            // No entry found in the string table. Pass reference as string.\n            tokens.push('%{' + rawKey + '}');\n          }\n          buffer.length = 0; // Clear the array\n          state = 0;\n        } else {\n          tokens.push('%{' + rawKey + '}');\n          buffer.length = 0;\n          state = 0; // and parse as string literal.\n        }\n      }\n    }\n  }\n  let text = buffer.join('');\n  if (text) {\n    tokens.push(text);\n  }\n\n  // Merge adjacent text tokens into a single string (but if newlines should be\n  // tokenized, don't merge those with adjacent text).\n  const mergedTokens = [];\n  buffer.length = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (\n      typeof tokens[i] === 'string' &&\n      !(tokenizeNewlines && tokens[i] === '\\n')\n    ) {\n      buffer.push(tokens[i] as string);\n    } else {\n      text = buffer.join('');\n      if (text) {\n        mergedTokens.push(text);\n      }\n      buffer.length = 0;\n      mergedTokens.push(tokens[i]);\n    }\n  }\n  text = buffer.join('');\n  if (text) {\n    mergedTokens.push(text);\n  }\n  buffer.length = 0;\n\n  return mergedTokens;\n}\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%'). Newline characters will also be output as string tokens\n * containing a single newline character.\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n */\nexport function tokenizeInterpolation(message: string): (string | number)[] {\n  return tokenizeInterpolationInternal(message, true, true);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains\n *     string table references.\n * @returns String with message references replaced.\n */\nexport function replaceMessageReferences(message: string | any): string {\n  if (typeof message !== 'string') {\n    return message;\n  }\n  const interpolatedResult = tokenizeInterpolationInternal(\n    message,\n    false,\n    false,\n  );\n  // When parseInterpolationTokens and tokenizeNewlines are false,\n  // interpolatedResult should be at most length 1.\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n */\nexport function checkMessageReferences(message: string): boolean {\n  let validSoFar = true;\n\n  const msgTable = Msg;\n  // TODO (#1169): Implement support for other string tables,\n  // prefixes other than BKY_.\n  const m = message.match(/%{BKY_[A-Z]\\w*}/gi);\n  if (m) {\n    for (let i = 0; i < m.length; i++) {\n      const msgKey = m[i].toUpperCase();\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\n        console.warn('No message string for ' + m[i] + ' in ' + message);\n        validSoFar = false; // Continue to report other errors.\n      }\n    }\n  }\n\n  return validSoFar;\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\n *     or a message reference string pointing to one of those two values.\n * @returns An object containing the colour as\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n */\nexport function parseBlockColour(colour: number | string): {\n  hue: number | null;\n  hex: string;\n} {\n  const dereferenced =\n    typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\n\n  const hue = Number(dereferenced);\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\n    return {\n      hue: hue,\n      hex: colourUtils.hsvToHex(\n        hue,\n        colourUtils.getHsvSaturation(),\n        colourUtils.getHsvValue() * 255,\n      ),\n    };\n  } else {\n    const hex = colourUtils.parse(dereferenced);\n    if (hex) {\n      // Only store hue if colour is set as a hue.\n      return {hue: null, hex: hex};\n    } else {\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\n      if (colour !== dereferenced) {\n        errorMsg += ' (from \"' + colour + '\")';\n      }\n      throw Error(errorMsg);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {IProcedureModel} from './i_procedure_model.js';\n// Former goog.module ID: Blockly.procedures.IProcedureBlock\n\n/** The interface for a block which models a procedure. */\nexport interface IProcedureBlock {\n  getProcedureModel(): IProcedureModel;\n  doProcedureUpdate(): void;\n  isProcedureDef(): boolean;\n}\n\n/** A type guard which checks if the given block is a procedure block. */\nexport function isProcedureBlock(\n  block: Block | IProcedureBlock,\n): block is IProcedureBlock {\n  return (\n    (block as IProcedureBlock).getProcedureModel !== undefined &&\n    (block as IProcedureBlock).doProcedureUpdate !== undefined &&\n    (block as IProcedureBlock).isProcedureDef !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that fires events optionally.\n *\n * @internal\n */\nexport interface IObservable {\n  startPublishing(): void;\n  stopPublishing(): void;\n}\n\n/**\n * Type guard for checking if an object fulfills IObservable.\n *\n * @internal\n */\nexport function isObservable(obj: any): obj is IObservable {\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.fieldRegistry\n\nimport type {Field, FieldProto} from './field.js';\nimport * as registry from './registry.js';\n\ninterface RegistryOptions {\n  type: string;\n  [key: string]: unknown;\n}\n\n/**\n * Registers a field type.\n * fieldRegistry.fromJson uses this registry to\n * find the appropriate field type.\n *\n * @param type The field type name as used in the JSON definition.\n * @param fieldClass The field class containing a fromJson function that can\n *     construct an instance of the field.\n * @throws {Error} if the type name is empty, the field is already registered,\n *     or the fieldClass is not an object containing a fromJson function.\n */\nexport function register(type: string, fieldClass: FieldProto) {\n  registry.register(registry.Type.FIELD, type, fieldClass);\n}\n\n/**\n * Unregisters the field registered with the given type.\n *\n * @param type The field type name as used in the JSON definition.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.FIELD, type);\n}\n\n/**\n * Construct a Field from a JSON arg object.\n * Finds the appropriate registered field by the type name as registered using\n * fieldRegistry.register.\n *\n * @param options A JSON object with a type and options specific to the field\n *     type.\n * @returns The new field instance or null if a field wasn't found with the\n *     given type name\n * @internal\n */\nexport function fromJson<T>(options: RegistryOptions): Field<T> | null {\n  return TEST_ONLY.fromJsonInternal(options);\n}\n\n/**\n * Private version of fromJson for stubbing in tests.\n *\n * @param options\n */\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T> | null {\n  const fieldObject = registry.getObject(registry.Type.FIELD, options.type);\n  if (!fieldObject) {\n    console.warn(\n      'Blockly could not create a field of type ' +\n        options['type'] +\n        '. The field is probably not being registered. This could be because' +\n        ' the file is not loaded, the field does not register itself (Issue' +\n        ' #1584), or the registration is not being reached.',\n    );\n    return null;\n  } else if (typeof (fieldObject as any).fromJson !== 'function') {\n    throw new TypeError('returned Field was not a IRegistrableField');\n  } else {\n    type fromJson = (options: {}) => Field<T>;\n    return (fieldObject as unknown as {fromJson: fromJson}).fromJson(options);\n  }\n}\n\nexport const TEST_ONLY = {\n  fromJsonInternal,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Dropdown input field.  Used for editable titles and variables.\n * In the interests of a consistent UI, the toolbox shares some functions and\n * properties with the context menu.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldDropdown\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as style from './utils/style.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as utilsString from './utils/string.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an editable dropdown field.\n */\nexport class FieldDropdown extends Field<string> {\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\n  static CHECKMARK_OVERHANG = 25;\n\n  /**\n   * Maximum height of the dropdown menu, as a percentage of the viewport\n   * height.\n   */\n  static MAX_MENU_HEIGHT_VH = 0.45;\n\n  static ARROW_CHAR = '▾';\n\n  /** A reference to the currently selected menu item. */\n  private selectedMenuItem: MenuItem | null = null;\n\n  /** The dropdown menu. */\n  protected menu_: Menu | null = null;\n\n  /**\n   * SVG image element if currently selected option is an image, or null.\n   */\n  private imageElement: SVGImageElement | null = null;\n\n  /** Tspan based arrow element. */\n  private arrow: SVGTSpanElement | null = null;\n\n  /** SVG based arrow element. */\n  private svgArrow: SVGElement | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  protected menuGenerator_?: MenuGenerator;\n\n  /** A cache of the most recently generated options. */\n  private generatedOptions: MenuOption[] | null = null;\n\n  /**\n   * The prefix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override prefixField: string | null = null;\n\n  /**\n   * The suffix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override suffixField: string | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  private selectedOption!: MenuOption;\n  override clickTarget_: SVGElement | null = null;\n\n  /**\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\n   *     if you wish to skip setup (only used by subclasses that want to handle\n   *     configuration and setting the field value after their own constructors\n   *     have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a language-neutral dropdown option & returns a\n   *     validated language-neutral dropdown option, or null to abort the\n   *     change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\n   * for a list of properties this parameter supports.\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\n   */\n  constructor(\n    menuGenerator: MenuGenerator,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  );\n  constructor(menuGenerator: typeof Field.SKIP_SETUP);\n  constructor(\n    menuGenerator: MenuGenerator | typeof Field.SKIP_SETUP,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\n    if (menuGenerator === Field.SKIP_SETUP) return;\n\n    if (Array.isArray(menuGenerator)) {\n      validateOptions(menuGenerator);\n      const trimmed = trimOptions(menuGenerator);\n      this.menuGenerator_ = trimmed.options;\n      this.prefixField = trimmed.prefix || null;\n      this.suffixField = trimmed.suffix || null;\n    } else {\n      this.menuGenerator_ = menuGenerator;\n    }\n\n    /**\n     * The currently selected option. The field is initialized with the\n     * first option selected.\n     */\n    this.selectedOption = this.getOptions(false)[0];\n\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(this.selectedOption[1]);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state to apply to the dropdown field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(FieldDropdown, state)) {\n      return;\n    }\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this dropdown.\n   */\n  override initView() {\n    if (this.shouldAddBorderRect_()) {\n      this.createBorderRect_();\n    } else {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n    this.createTextElement_();\n\n    this.imageElement = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\n\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\n      this.createSVGArrow_();\n    } else {\n      this.createTextArrow_();\n    }\n\n    if (this.borderRect_) {\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\n    }\n  }\n\n  /**\n   * Whether or not the dropdown should add a border rect.\n   *\n   * @returns True if the dropdown field should add a border rect.\n   */\n  protected shouldAddBorderRect_(): boolean {\n    return (\n      !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n      (this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\n        !this.getSourceBlock()?.isShadow())\n    );\n  }\n\n  /** Create a tspan based arrow. */\n  protected createTextArrow_() {\n    this.arrow = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\n    this.arrow!.appendChild(\n      document.createTextNode(\n        this.getSourceBlock()?.RTL\n          ? FieldDropdown.ARROW_CHAR + ' '\n          : ' ' + FieldDropdown.ARROW_CHAR,\n      ),\n    );\n    if (this.getSourceBlock()?.RTL) {\n      this.getTextElement().insertBefore(this.arrow, this.textContent_);\n    } else {\n      this.getTextElement().appendChild(this.arrow);\n    }\n  }\n\n  /** Create an SVG based arrow. */\n  protected createSVGArrow_() {\n    this.svgArrow = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n        'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n      },\n      this.fieldGroup_,\n    );\n    this.svgArrow!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI,\n    );\n  }\n\n  /**\n   * Create a dropdown menu under the text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: MouseEvent) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.dropdownCreate();\n    if (e && typeof e.clientX === 'number') {\n      this.menu_!.openingCoords = new Coordinate(e.clientX, e.clientY);\n    } else {\n      this.menu_!.openingCoords = null;\n    }\n\n    // Remove any pre-existing elements in the dropdown.\n    dropDownDiv.clearContent();\n    // Element gets created in render.\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\n\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\n      const primaryColour = block.getColour();\n      const borderColour = (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      dropDownDiv.setColour(primaryColour, borderColour);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focusing needs to be handled after the menu is rendered and positioned.\n    // Otherwise it will cause a page scroll to get the misplaced menu in\n    // view. See issue #1329.\n    this.menu_!.focus();\n\n    if (this.selectedMenuItem) {\n      this.menu_!.setHighlighted(this.selectedMenuItem);\n      style.scrollIntoContainerView(\n        this.selectedMenuItem.getElement()!,\n        dropDownDiv.getContentDiv(),\n        true,\n      );\n    }\n\n    this.applyColour();\n  }\n\n  /** Create the dropdown editor. */\n  private dropdownCreate() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const menu = new Menu();\n    menu.setRole(aria.Role.LISTBOX);\n    this.menu_ = menu;\n\n    const options = this.getOptions(false);\n    this.selectedMenuItem = null;\n    for (let i = 0; i < options.length; i++) {\n      const [label, value] = options[i];\n      const content = (() => {\n        if (typeof label === 'object') {\n          // Convert ImageProperties to an HTMLImageElement.\n          const image = new Image(label['width'], label['height']);\n          image.src = label['src'];\n          image.alt = label['alt'] || '';\n          return image;\n        }\n        return label;\n      })();\n      const menuItem = new MenuItem(content, value);\n      menuItem.setRole(aria.Role.OPTION);\n      menuItem.setRightToLeft(block.RTL);\n      menuItem.setCheckable(true);\n      menu.addChild(menuItem);\n      menuItem.setChecked(value === this.value_);\n      if (value === this.value_) {\n        this.selectedMenuItem = menuItem;\n      }\n      menuItem.onAction(this.handleMenuActionEvent, this);\n    }\n  }\n\n  /**\n   * Disposes of events and DOM-references belonging to the dropdown editor.\n   */\n  protected dropdownDispose_() {\n    if (this.menu_) {\n      this.menu_.dispose();\n    }\n    this.menu_ = null;\n    this.selectedMenuItem = null;\n    this.applyColour();\n  }\n\n  /**\n   * Handle an action in the dropdown menu.\n   *\n   * @param menuItem The MenuItem selected within menu.\n   */\n  private handleMenuActionEvent(menuItem: MenuItem) {\n    dropDownDiv.hideIfOwner(this, true);\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\n  }\n\n  /**\n   * Handle the selection of an item in the dropdown menu.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    this.setValue(menuItem.getValue());\n  }\n\n  /**\n   * @returns True if the option list is generated by a function.\n   *     Otherwise false.\n   */\n  isOptionListDynamic(): boolean {\n    return typeof this.menuGenerator_ === 'function';\n  }\n\n  /**\n   * Return a list of the options for this dropdown.\n   *\n   * @param useCache For dynamic options, whether or not to use the cached\n   *     options or to re-generate them.\n   * @returns A non-empty array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @throws {TypeError} If generated options are incorrectly structured.\n   */\n  getOptions(useCache?: boolean): MenuOption[] {\n    if (!this.menuGenerator_) {\n      // A subclass improperly skipped setup without defining the menu\n      // generator.\n      throw TypeError('A menu generator was never defined.');\n    }\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\n    if (useCache && this.generatedOptions) return this.generatedOptions;\n\n    this.generatedOptions = this.menuGenerator_();\n    validateOptions(this.generatedOptions);\n    return this.generatedOptions;\n  }\n\n  /**\n   * Ensure that the input value is a valid language-neutral option.\n   *\n   * @param newValue The input value.\n   * @returns A valid language-neutral option, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: string): string | null {\n    const options = this.getOptions(true);\n    const isValueValid = options.some((option) => option[1] === newValue);\n\n    if (!isValueValid) {\n      if (this.sourceBlock_) {\n        console.warn(\n          \"Cannot set the dropdown's value to an unavailable option.\" +\n            ' Block type: ' +\n            this.sourceBlock_.type +\n            ', Field name: ' +\n            this.name +\n            ', Value: ' +\n            newValue,\n        );\n      }\n      return null;\n    }\n    return newValue as string;\n  }\n\n  /**\n   * Update the value of this dropdown field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is one of the valid dropdown options.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    const options = this.getOptions(true);\n    for (let i = 0, option; (option = options[i]); i++) {\n      if (option[1] === this.value_) {\n        this.selectedOption = option;\n      }\n    }\n  }\n\n  /**\n   * Updates the dropdown arrow to match the colour/style of the block.\n   */\n  override applyColour() {\n    const style = (this.sourceBlock_ as BlockSvg).style;\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', style.colourTertiary);\n      if (this.menu_) {\n        this.borderRect_.setAttribute('fill', style.colourTertiary);\n      } else {\n        this.borderRect_.setAttribute('fill', 'transparent');\n      }\n    }\n    // Update arrow's colour.\n    if (this.sourceBlock_ && this.arrow) {\n      if (this.sourceBlock_.isShadow()) {\n        this.arrow.style.fill = style.colourSecondary;\n      } else {\n        this.arrow.style.fill = style.colourPrimary;\n      }\n    }\n  }\n\n  /** Draws the border with the correct width. */\n  protected override render_() {\n    // Hide both elements.\n    this.getTextContent().nodeValue = '';\n    this.imageElement!.style.display = 'none';\n\n    // Show correct element.\n    const option = this.selectedOption && this.selectedOption[0];\n    if (option && typeof option === 'object') {\n      this.renderSelectedImage(option);\n    } else {\n      this.renderSelectedText();\n    }\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Renders the selected option, which must be an image.\n   *\n   * @param imageJson Selected option that must be an image.\n   */\n  private renderSelectedImage(imageJson: ImageProperties) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.imageElement!.style.display = '';\n    this.imageElement!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      imageJson.src,\n    );\n    this.imageElement!.setAttribute('height', String(imageJson.height));\n    this.imageElement!.setAttribute('width', String(imageJson.width));\n\n    const imageHeight = Number(imageJson.height);\n    const imageWidth = Number(imageJson.width);\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      imageHeight + IMAGE_Y_PADDING,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        imageWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    } else {\n      arrowWidth = dom.getFastTextWidth(\n        this.arrow as SVGTSpanElement,\n        this.getConstants()!.FIELD_TEXT_FONTSIZE,\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n      );\n    }\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    let arrowX = 0;\n    if (block.RTL) {\n      const imageX = xPadding + arrowWidth;\n      this.imageElement!.setAttribute('x', `${imageX}`);\n    } else {\n      arrowX = imageWidth + arrowWidth;\n      this.getTextElement().setAttribute('text-anchor', 'end');\n      this.imageElement!.setAttribute('x', `${xPadding}`);\n    }\n    this.imageElement!.setAttribute('y', String(height / 2 - imageHeight / 2));\n\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\n  }\n\n  /** Renders the selected option, which must be text. */\n  private renderSelectedText() {\n    // Retrieves the selected option to display through getText_.\n    this.getTextContent().nodeValue = this.getDisplayText_();\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyDropdownText');\n    textElement.setAttribute('text-anchor', 'start');\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      this.getConstants()!.FIELD_TEXT_HEIGHT,\n    );\n    const textWidth = dom.getFastTextWidth(\n      this.getTextElement(),\n      this.getConstants()!.FIELD_TEXT_FONTSIZE,\n      this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n      this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        textWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    }\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    this.positionTextElement_(xPadding, textWidth);\n  }\n\n  /**\n   * Position a drop-down arrow at the appropriate location at render-time.\n   *\n   * @param x X position the arrow is being rendered at, in px.\n   * @param y Y position the arrow is being rendered at, in px.\n   * @returns Amount of space the arrow is taking up, in px.\n   */\n  private positionSVGArrow(x: number, y: number): number {\n    if (!this.svgArrow) {\n      return 0;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const hasBorder = !!this.borderRect_;\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\n    const arrowX = block.RTL ? xPadding : x + textPadding;\n    this.svgArrow.setAttribute(\n      'transform',\n      'translate(' + arrowX + ',' + y + ')',\n    );\n    return svgArrowSize + textPadding;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.  Get the selected option text.  If the selected option is\n   * an image we return the image alt text.\n   *\n   * @returns Selected option text.\n   */\n  protected override getText_(): string | null {\n    if (!this.selectedOption) {\n      return null;\n    }\n    const option = this.selectedOption[0];\n    if (typeof option === 'object') {\n      return option['alt'];\n    }\n    return option;\n  }\n\n  /**\n   * Construct a FieldDropdown from a JSON arg object.\n   *\n   * @param options A JSON object with options (options).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldDropdownFromJsonConfig): FieldDropdown {\n    if (!options.options) {\n      throw new Error(\n        'options are required for the dropdown field. The ' +\n          'options property must be assigned an array of ' +\n          '[humanReadableValue, languageNeutralValue] tuples.',\n      );\n    }\n    // `this` might be a subclass of FieldDropdown if that class doesn't\n    // override the static fromJson method.\n    return new this(options.options, undefined, options);\n  }\n}\n\n/**\n * Definition of a human-readable image dropdown option.\n */\nexport interface ImageProperties {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n}\n\n/**\n * An individual option in the dropdown menu. The first element is the human-\n * readable value (text or image), and the second element is the language-\n * neutral value.\n */\nexport type MenuOption = [string | ImageProperties, string];\n\n/**\n * A function that generates an array of menu options for FieldDropdown\n * or its descendants.\n */\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\n\n/**\n * Either an array of menu options or a function that generates an array of\n * menu options for FieldDropdown or its descendants.\n */\nexport type MenuGenerator = MenuOption[] | MenuGeneratorFunction;\n\n/**\n * Config options for the dropdown field.\n */\nexport type FieldDropdownConfig = FieldConfig;\n\n/**\n * fromJson config for the dropdown field.\n */\nexport interface FieldDropdownFromJsonConfig extends FieldDropdownConfig {\n  options?: MenuOption[];\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldDropdownValidator = FieldValidator<string>;\n\n/**\n * The y offset from the top of the field to the top of the image, if an image\n * is selected.\n */\nconst IMAGE_Y_OFFSET = 5;\n\n/** The total vertical padding above and below an image. */\nconst IMAGE_Y_PADDING: number = IMAGE_Y_OFFSET * 2;\n\n/**\n * Factor out common words in statically defined options.\n * Create prefix and/or suffix labels.\n */\nfunction trimOptions(options: MenuOption[]): {\n  options: MenuOption[];\n  prefix?: string;\n  suffix?: string;\n} {\n  let hasImages = false;\n  const trimmedOptions = options.map(([label, value]): MenuOption => {\n    if (typeof label === 'string') {\n      return [parsing.replaceMessageReferences(label), value];\n    }\n\n    hasImages = true;\n    // Copy the image properties so they're not influenced by the original.\n    // NOTE: No need to deep copy since image properties are only 1 level deep.\n    const imageLabel =\n      label.alt !== null\n        ? {...label, alt: parsing.replaceMessageReferences(label.alt)}\n        : {...label};\n    return [imageLabel, value];\n  });\n\n  if (hasImages || options.length < 2) return {options: trimmedOptions};\n\n  const stringOptions = trimmedOptions as [string, string][];\n  const stringLabels = stringOptions.map(([label]) => label);\n\n  const shortest = utilsString.shortestStringLength(stringLabels);\n  const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\n  const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\n\n  if (\n    (!prefixLength && !suffixLength) ||\n    shortest <= prefixLength + suffixLength\n  ) {\n    // One or more strings will entirely vanish if we proceed.  Abort.\n    return {options: stringOptions};\n  }\n\n  const prefix = prefixLength\n    ? stringLabels[0].substring(0, prefixLength - 1)\n    : undefined;\n  const suffix = suffixLength\n    ? stringLabels[0].substr(1 - suffixLength)\n    : undefined;\n  return {\n    options: applyTrim(stringOptions, prefixLength, suffixLength),\n    prefix,\n    suffix,\n  };\n}\n\n/**\n * Use the calculated prefix and suffix lengths to trim all of the options in\n * the given array.\n *\n * @param options Array of option tuples:\n *     (human-readable text or image, language-neutral name).\n * @param prefixLength The length of the common prefix.\n * @param suffixLength The length of the common suffix\n * @returns A new array with all of the option text trimmed.\n */\nfunction applyTrim(\n  options: [string, string][],\n  prefixLength: number,\n  suffixLength: number,\n): MenuOption[] {\n  return options.map(([text, value]) => [\n    text.substring(prefixLength, text.length - suffixLength),\n    value,\n  ]);\n}\n\n/**\n * Validates the data structure to be processed as an options list.\n *\n * @param options The proposed dropdown options.\n * @throws {TypeError} If proposed options are incorrectly structured.\n */\nfunction validateOptions(options: MenuOption[]) {\n  if (!Array.isArray(options)) {\n    throw TypeError('FieldDropdown options must be an array.');\n  }\n  if (!options.length) {\n    throw TypeError('FieldDropdown options must not be an empty array.');\n  }\n  let foundError = false;\n  for (let i = 0; i < options.length; i++) {\n    const tuple = options[i];\n    if (!Array.isArray(tuple)) {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option must be an ' +\n          'array. Found: ',\n        tuple,\n      );\n    } else if (typeof tuple[1] !== 'string') {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option id must be ' +\n          'a string. Found ' +\n          tuple[1] +\n          ' in: ',\n        tuple,\n      );\n    } else if (\n      tuple[0] &&\n      typeof tuple[0] !== 'string' &&\n      typeof tuple[0].src !== 'string'\n    ) {\n      foundError = true;\n      console.error(\n        'Invalid option[' +\n          i +\n          ']: Each FieldDropdown option must have a ' +\n          'string label or image description. Found' +\n          tuple[0] +\n          ' in: ',\n        tuple,\n      );\n    }\n  }\n  if (foundError) {\n    throw TypeError('Found invalid FieldDropdown options.');\n  }\n}\n\nfieldRegistry.register('field_dropdown', FieldDropdown);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Extensions\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {FieldDropdown} from './field_dropdown.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport * as parsing from './utils/parsing.js';\n\n/** The set of all registered extensions, keyed by extension name/id. */\nconst allExtensions = Object.create(null);\nexport const TEST_ONLY = {allExtensions};\n\n/**\n * Registers a new extension function. Extensions are functions that help\n * initialize blocks, usually adding dynamic behavior such as onchange\n * handlers and mutators. These are applied using Block.applyExtension(), or\n * the JSON \"extensions\" array attribute.\n *\n * @param name The name of this extension.\n * @param initFn The function to initialize an extended block.\n * @throws {Error} if the extension name is empty, the extension is already\n *     registered, or extensionFn is not a function.\n */\nexport function register(name: string, initFn: Function) {\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error('Error: Invalid extension name \"' + name + '\"');\n  }\n  if (allExtensions[name]) {\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\n  }\n  if (typeof initFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" must be a function');\n  }\n  allExtensions[name] = initFn;\n}\n\n/**\n * Registers a new extension function that adds all key/value of mixinObj.\n *\n * @param name The name of this extension.\n * @param mixinObj The values to mix in.\n * @throws {Error} if the extension name is empty or the extension is already\n *     registered.\n */\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\n  if (!mixinObj || typeof mixinObj !== 'object') {\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\n  }\n  register(name, function (this: Block) {\n    this.mixin(mixinObj);\n  });\n}\n\n/**\n * Registers a new extension function that adds a mutator to the block.\n * At register time this performs some basic sanity checks on the mutator.\n * The wrapper may also add a mutator dialog to the block, if both compose and\n * decompose are defined on the mixin.\n *\n * @param name The name of this mutator extension.\n * @param mixinObj The values to mix in.\n * @param opt_helperFn An optional function to apply after mixing in the object.\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\n *     dialog.\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\n */\nexport function registerMutator(\n  name: string,\n  mixinObj: AnyDuringMigration,\n  opt_helperFn?: () => AnyDuringMigration,\n  opt_blockList?: string[],\n) {\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\n\n  checkHasMutatorProperties(errorPrefix, mixinObj);\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\n\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\n  }\n\n  // Sanity checks passed.\n  register(name, function (this: Block) {\n    if (hasMutatorDialog) {\n      this.setMutator(new MutatorIcon(opt_blockList || [], this as BlockSvg));\n    }\n    // Mixin the object.\n    this.mixin(mixinObj);\n\n    if (opt_helperFn) {\n      opt_helperFn.apply(this);\n    }\n  });\n}\n\n/**\n * Unregisters the extension registered with the given name.\n *\n * @param name The name of the extension to unregister.\n */\nexport function unregister(name: string) {\n  if (isRegistered(name)) {\n    delete allExtensions[name];\n  } else {\n    console.warn(\n      'No extension mapping for name \"' + name + '\" found to unregister',\n    );\n  }\n}\n\n/**\n * Returns whether an extension is registered with the given name.\n *\n * @param name The name of the extension to check for.\n * @returns True if the extension is registered.  False if it is not registered.\n */\nexport function isRegistered(name: string): boolean {\n  return !!allExtensions[name];\n}\n\n/**\n * Applies an extension method to a block. This should only be called during\n * block construction.\n *\n * @param name The name of the extension.\n * @param block The block to apply the named extension to.\n * @param isMutator True if this extension defines a mutator.\n * @throws {Error} if the extension is not found.\n */\nexport function apply(name: string, block: Block, isMutator: boolean) {\n  const extensionFn = allExtensions[name];\n  if (typeof extensionFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" not found.');\n  }\n  let mutatorProperties;\n  if (isMutator) {\n    // Fail early if the block already has mutation properties.\n    checkNoMutatorProperties(name, block);\n  } else {\n    // Record the old properties so we can make sure they don't change after\n    // applying the extension.\n    mutatorProperties = getMutatorProperties(block);\n  }\n  extensionFn.apply(block);\n\n  if (isMutator) {\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\n    checkHasMutatorProperties(errorPrefix, block);\n  } else {\n    if (\n      !mutatorPropertiesMatch(mutatorProperties as AnyDuringMigration[], block)\n    ) {\n      throw Error(\n        'Error when applying extension \"' +\n          name +\n          '\": ' +\n          'mutation properties changed when applying a non-mutator extension.',\n      );\n    }\n  }\n}\n\n/**\n * Check that the given block does not have any of the four mutator properties\n * defined on it.  This function should be called before applying a mutator\n * extension to a block, to make sure we are not overwriting properties.\n *\n * @param mutationName The name of the mutation to reference in error messages.\n * @param block The block to check.\n * @throws {Error} if any of the properties already exist on the block.\n */\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\n  const properties = getMutatorProperties(block);\n  if (properties.length) {\n    throw Error(\n      'Error: tried to apply mutation \"' +\n        mutationName +\n        '\" to a block that already has mutator functions.' +\n        '  Block id: ' +\n        block.id,\n    );\n  }\n}\n\n/**\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkXmlHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.mutationToDom,\n    object.domToMutation,\n    errorPrefix + ' mutationToDom/domToMutation',\n  );\n}\n/**\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkJsonHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.saveExtraState,\n    object.loadExtraState,\n    errorPrefix + ' saveExtraState/loadExtraState',\n  );\n}\n\n/**\n * Checks if the given object has both the 'compose' and 'decompose' functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkMutatorDialog(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.compose,\n    object.decompose,\n    errorPrefix + ' compose/decompose',\n  );\n}\n\n/**\n * Checks that both or neither of the given functions exist and that they are\n * indeed functions.\n *\n * @param func1 The first function in the pair.\n * @param func2 The second function in the pair.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} If the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkHasFunctionPair(\n  func1: AnyDuringMigration,\n  func2: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  if (func1 && func2) {\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\n      throw Error(errorPrefix + ' must be a function');\n    }\n    return true;\n  } else if (!func1 && !func2) {\n    return false;\n  }\n  throw Error(errorPrefix + 'Must have both or neither functions');\n}\n\n/**\n * Checks that the given object required mutator properties.\n *\n * @param errorPrefix The string to prepend to any error message.\n * @param object The object to inspect.\n */\nfunction checkHasMutatorProperties(\n  errorPrefix: string,\n  object: AnyDuringMigration,\n) {\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\n  if (!hasXmlHooks && !hasJsonHooks) {\n    throw Error(\n      errorPrefix +\n        'Mutations must contain either XML hooks, or JSON hooks, or both',\n    );\n  }\n  // A block with a mutator isn't required to have a mutation dialog, but\n  // it should still have both or neither of compose and decompose.\n  checkMutatorDialog(object, errorPrefix);\n}\n\n/**\n * Get a list of values of mutator properties on the given block.\n *\n * @param block The block to inspect.\n * @returns A list with all of the defined properties, which should be\n *     functions, but may be anything other than undefined.\n */\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\n  const result = [];\n  // List each function explicitly by reference to allow for renaming\n  // during compilation.\n  if (block.domToMutation !== undefined) {\n    result.push(block.domToMutation);\n  }\n  if (block.mutationToDom !== undefined) {\n    result.push(block.mutationToDom);\n  }\n  if (block.saveExtraState !== undefined) {\n    result.push(block.saveExtraState);\n  }\n  if (block.loadExtraState !== undefined) {\n    result.push(block.loadExtraState);\n  }\n  if (block.compose !== undefined) {\n    result.push(block.compose);\n  }\n  if (block.decompose !== undefined) {\n    result.push(block.decompose);\n  }\n  return result;\n}\n\n/**\n * Check that the current mutator properties match a list of old mutator\n * properties.  This should be called after applying a non-mutator extension,\n * to verify that the extension didn't change properties it shouldn't.\n *\n * @param oldProperties The old values to compare to.\n * @param block The block to inspect for new values.\n * @returns True if the property lists match.\n */\nfunction mutatorPropertiesMatch(\n  oldProperties: AnyDuringMigration[],\n  block: Block,\n): boolean {\n  const newProperties = getMutatorProperties(block);\n  if (newProperties.length !== oldProperties.length) {\n    return false;\n  }\n  for (let i = 0; i < newProperties.length; i++) {\n    if (oldProperties[i] !== newProperties[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @internal\n */\nexport function runAfterPageLoad(fn: () => void) {\n  if (typeof document !== 'object') {\n    throw Error('runAfterPageLoad() requires browser document.');\n  }\n  if (document.readyState === 'complete') {\n    fn(); // Page has already loaded. Call immediately.\n  } else {\n    // Poll readyState.\n    const readyStateCheckInterval = setInterval(function () {\n      if (document.readyState === 'complete') {\n        clearInterval(readyStateCheckInterval);\n        fn();\n      }\n    }, 10);\n  }\n}\n\n/**\n * Builds an extension function that will map a dropdown value to a tooltip\n * string.\n *\n * @param dropdownName The name of the field whose value is the key to the\n *     lookup table.\n * @param lookupTable The table of field values to tooltip text.\n * @returns The extension function.\n */\nexport function buildTooltipForDropdown(\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n): (this: Block) => void {\n  // List of block types already validated, to minimize duplicate warnings.\n  const blockTypesChecked: string[] = [];\n\n  return function (this: Block) {\n    if (blockTypesChecked.indexOf(this.type) === -1) {\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\n      blockTypesChecked.push(this.type);\n    }\n\n    this.setTooltip(\n      function (this: Block) {\n        const value = String(this.getFieldValue(dropdownName));\n        return parsing.replaceMessageReferences(lookupTable[value]);\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Checks all options keys are present in the provided string lookup table.\n * Emits console warnings when they are not.\n *\n * @param block The block containing the dropdown\n * @param dropdownName The name of the dropdown\n * @param lookupTable The string lookup table\n */\nfunction checkDropdownOptionsInTable(\n  block: Block,\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n) {\n  const dropdown = block.getField(dropdownName);\n  if (!(dropdown instanceof FieldDropdown) || dropdown.isOptionListDynamic()) {\n    return;\n  }\n\n  const options = dropdown.getOptions();\n  for (const [, key] of options) {\n    if (lookupTable[key] === undefined) {\n      console.warn(\n        `No tooltip mapping for value ${key} of field ` +\n          `${dropdownName} of block type ${block.type}.`,\n      );\n    }\n  }\n}\n\n/**\n * Builds an extension function that will install a dynamic tooltip. The\n * tooltip message should include the string '%1' and that string will be\n * replaced with the text of the named field.\n *\n * @param msgTemplate The template form to of the message text, with %1\n *     placeholder.\n * @param fieldName The field with the replacement text.\n * @returns The extension function.\n */\nexport function buildTooltipWithFieldText(\n  msgTemplate: string,\n  fieldName: string,\n): (this: Block) => void {\n  return function (this: Block) {\n    this.setTooltip(\n      function (this: Block) {\n        const field = this.getField(fieldName);\n        return parsing\n          .replaceMessageReferences(msgTemplate)\n          .replace('%1', field ? field.getText() : '');\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\n * uses the tooltip text at the time this extension is initialized. This takes\n * advantage of the fact that all other values from JSON are initialized before\n * extensions.\n */\nfunction extensionParentTooltip(this: Block) {\n  const tooltipWhenNotConnected = this.tooltip;\n  this.setTooltip(\n    function (this: Block) {\n      const parent = this.getParent();\n      return (\n        (parent && parent.getInputsInline() && parent.tooltip) ||\n        tooltipWhenNotConnected\n      );\n    }.bind(this),\n  );\n}\nregister('parent_tooltip_when_inline', extensionParentTooltip);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgPaths\n\n/**\n * Create a string representing the given x, y pair.  It does not matter whether\n * the coordinate is relative or absolute.  The result has leading\n * and trailing spaces, and separates the x and y coordinates with a comma but\n * no space.\n *\n * @param x The x coordinate.\n * @param y The y coordinate.\n * @returns A string of the format ' x,y '\n */\nexport function point(x: number, y: number): string {\n  return ' ' + x + ',' + y + ' ';\n}\n\n/**\n * Draw a cubic or quadratic curve.  See\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\n * These coordinates are unitless and hence in the user coordinate system.\n *\n * @param command The command to use.\n *     Should be one of: c, C, s, S, q, Q.\n * @param points  An array containing all of the points to pass to the curve\n *     command, in order.  The points are represented as strings of the format '\n *     x, y '.\n * @returns A string defining one or more Bezier curves.  See the MDN\n *     documentation for exact format.\n */\nexport function curve(command: string, points: string[]): string {\n  return ' ' + command + points.join('');\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * The coordinates are absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param x The absolute x coordinate.\n * @param y The absolute y coordinate.\n * @returns A string of the format ' M x,y '\n */\nexport function moveTo(x: number, y: number): string {\n  return ' M ' + x + ',' + y + ' ';\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * Coordinates are relative.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' m dx,dy '\n */\nexport function moveBy(dx: number, dy: number): string {\n  return ' m ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw a line from the current point to the end point, which is the current\n * point shifted by dx along the x-axis and dy along the y-axis.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' l dx,dy '\n */\nexport function lineTo(dx: number, dy: number): string {\n  return ' l ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw multiple lines connecting all of the given points in order.  This is\n * equivalent to a series of 'l' commands.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param points An array containing all of the points to draw lines to, in\n *     order.  The points are represented as strings of the format ' dx,dy '.\n * @returns A string of the format ' l (dx,dy)+ '\n */\nexport function line(points: string[]): string {\n  return ' l' + points.join('');\n}\n\n/**\n * Draw a horizontal or vertical line.\n * The first argument specifies the direction and whether the given position is\n * relative or absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\n *\n * @param command The command to prepend to the coordinate.  This should be one\n *     of: V, v, H, h.\n * @param val The coordinate to pass to the command.  It may be absolute or\n *     relative.\n * @returns A string of the format ' command val '\n */\nexport function lineOnAxis(command: string, val: number): string {\n  return ' ' + command + ' ' + val + ' ';\n}\n\n/**\n * Draw an elliptical arc curve.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\n *\n * @param command The command string.  Either 'a' or 'A'.\n * @param flags The flag string.  See the MDN documentation for a description\n *     and examples.\n * @param radius The radius of the arc to draw.\n * @param point The point to move the cursor to after drawing the arc, specified\n *     either in absolute or relative coordinates depending on the command.\n * @returns A string of the format 'command radius radius flags point'\n */\nexport function arc(\n  command: string,\n  flags: string,\n  radius: number,\n  point: string,\n): string {\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport * as registry from '../registry.js';\nimport {IconType} from './icon_types.js';\n\n/**\n * Registers the given icon so that it can be deserialized.\n *\n * @param type The type of the icon to register. This should be the same string\n *     that is returned from its `getType` method.\n * @param iconConstructor The icon class/constructor to register.\n */\nexport function register(\n  type: IconType<IIcon>,\n  iconConstructor: new (block: Block) => IIcon,\n) {\n  registry.register(registry.Type.ICON, type.toString(), iconConstructor);\n}\n\n/**\n * Unregisters the icon associated with the given type.\n *\n * @param type The type of the icon to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.ICON, type);\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Procedures\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BubbleOpen} from './events/events_bubble_open.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport {IParameterModel} from './interfaces/i_parameter_model.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {\n  IProcedureBlock,\n  isProcedureBlock,\n} from './interfaces/i_procedure_block.js';\nimport {\n  isLegacyProcedureCallBlock,\n  isLegacyProcedureDefBlock,\n  ProcedureBlock,\n  ProcedureTuple,\n} from './interfaces/i_legacy_procedure_blocks.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {MutatorIcon} from './icons.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'PROCEDURE';\n\n/**\n * The default argument for a procedures_mutatorarg block.\n */\nexport const DEFAULT_ARG = 'x';\n\n/**\n * Find all user-created procedure definitions in a workspace.\n *\n * @param root Root workspace.\n * @returns Pair of arrays, the first contains procedures without return\n *     variables, the second with. Each procedure is defined by a three-element\n *     list of name, parameter list, and return value boolean.\n */\nexport function allProcedures(\n  root: Workspace,\n): [ProcedureTuple[], ProcedureTuple[]] {\n  const proceduresNoReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      false,\n    ]);\n  root.getBlocksByType('procedures_defnoreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresNoReturn.push(b.getProcedureDef());\n    }\n  });\n\n  const proceduresReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !!p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      true,\n    ]);\n  root.getBlocksByType('procedures_defreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresReturn.push(b.getProcedureDef());\n    }\n  });\n  proceduresNoReturn.sort(procTupleComparator);\n  proceduresReturn.sort(procTupleComparator);\n  return [proceduresNoReturn, proceduresReturn];\n}\n\n/**\n * Comparison function for case-insensitive sorting of the first element of\n * a tuple.\n *\n * @param ta First tuple.\n * @param tb Second tuple.\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\n */\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\n}\n\n/**\n * Ensure two identically-named procedures don't exist.\n * Take the proposed procedure name, and return a legal name i.e. one that\n * is not empty and doesn't collide with other procedures.\n *\n * @param name Proposed procedure name.\n * @param block Block to disambiguate.\n * @returns Non-colliding name.\n */\nexport function findLegalName(name: string, block: Block): string {\n  if (block.isInFlyout) {\n    // Flyouts can have multiple procedures called 'do something'.\n    return name;\n  }\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\n  while (!isLegalName(name, block.workspace, block)) {\n    // Collision with another procedure.\n    const r = name.match(/^(.*?)(\\d+)$/);\n    if (!r) {\n      name += '2';\n    } else {\n      name = r[1] + (parseInt(r[2]) + 1);\n    }\n  }\n  return name;\n}\n/**\n * Does this procedure have a legal name?  Illegal names include names of\n * procedures already defined.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is legal.\n */\nfunction isLegalName(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  return !isNameUsed(name, workspace, opt_exclude);\n}\n\n/**\n * Return if the given name is already a procedure name.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is used, otherwise return false.\n */\nexport function isNameUsed(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  for (const block of workspace.getAllBlocks(false)) {\n    if (block === opt_exclude) continue;\n\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return true;\n    }\n  }\n\n  const excludeModel =\n    opt_exclude && isProcedureBlock(opt_exclude)\n      ? opt_exclude?.getProcedureModel()\n      : undefined;\n  for (const model of workspace.getProcedureMap().getProcedures()) {\n    if (model === excludeModel) continue;\n    if (Names.equals(model.getName(), name)) return true;\n  }\n  return false;\n}\n\n/**\n * Rename a procedure.  Called by the editable field.\n *\n * @param name The proposed new name.\n * @returns The accepted name.\n */\nexport function rename(this: Field, name: string): string {\n  const block = this.getSourceBlock();\n  if (!block) {\n    throw new UnattachedFieldError();\n  }\n\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\n  name = name.trim();\n\n  const legalName = findLegalName(name, block);\n  if (isProcedureBlock(block) && !block.isInsertionMarker()) {\n    block.getProcedureModel().setName(legalName);\n  }\n  const oldName = this.getValue();\n  if (oldName !== name && oldName !== legalName) {\n    // Rename any callers.\n    const blocks = block.workspace.getAllBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      // Assume it is a procedure so we can check.\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n      if (procedureBlock.renameProcedure) {\n        procedureBlock.renameProcedure(oldName as string, legalName);\n      }\n    }\n  }\n  return legalName;\n}\n\n/**\n * Construct the blocks required by the flyout for the procedure category.\n *\n * @param workspace The workspace containing procedures.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  const xmlList = [];\n  if (Blocks['procedures_defnoreturn']) {\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defnoreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_defreturn']) {\n    // <block type=\"procedures_defreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_ifreturn']) {\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_ifreturn');\n    block.setAttribute('gap', '16');\n    xmlList.push(block);\n  }\n  if (xmlList.length) {\n    // Add slightly larger gap between system blocks and user calls.\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\n  }\n\n  /**\n   * Add items to xmlList for each listed procedure.\n   *\n   * @param procedureList A list of procedures, each of which is defined by a\n   *     three-element list of name, parameter list, and return value boolean.\n   * @param templateName The type of the block to generate.\n   */\n  function populateProcedures(\n    procedureList: ProcedureTuple[],\n    templateName: string,\n  ) {\n    for (let i = 0; i < procedureList.length; i++) {\n      const name = procedureList[i][0];\n      const args = procedureList[i][1];\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\n      //   <mutation name=\"do something\">\n      //     <arg name=\"x\"></arg>\n      //   </mutation>\n      // </block>\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', templateName);\n      block.setAttribute('gap', '16');\n      const mutation = utilsXml.createElement('mutation');\n      mutation.setAttribute('name', name);\n      block.appendChild(mutation);\n      for (let j = 0; j < args.length; j++) {\n        const arg = utilsXml.createElement('arg');\n        arg.setAttribute('name', args[j]);\n        mutation.appendChild(arg);\n      }\n      xmlList.push(block);\n    }\n  }\n\n  const tuple = allProcedures(workspace);\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\n  populateProcedures(tuple[1], 'procedures_callreturn');\n  return xmlList;\n}\n\n/**\n * Updates the procedure mutator's flyout so that the arg block is not a\n * duplicate of another arg.\n *\n * @param workspace The procedure mutator's workspace. This workspace's flyout\n *     is what is being updated.\n */\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\n  const usedNames = [];\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    usedNames.push(block.getFieldValue('NAME'));\n  }\n\n  const xmlElement = utilsXml.createElement('xml');\n  const argBlock = utilsXml.createElement('block');\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\n  const nameField = utilsXml.createElement('field');\n  nameField.setAttribute('name', 'NAME');\n  const argValue = Variables.generateUniqueNameFromOptions(\n    DEFAULT_ARG,\n    usedNames,\n  );\n  const fieldContent = utilsXml.createTextNode(argValue);\n\n  nameField.appendChild(fieldContent);\n  argBlock.appendChild(nameField);\n  xmlElement.appendChild(argBlock);\n\n  workspace.updateToolbox(xmlElement);\n}\n\n/**\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\n * update and adds a mutator change listener to the mutator workspace.\n *\n * @param e The event that triggered this listener.\n * @internal\n */\nexport function mutatorOpenListener(e: Abstract) {\n  if (e.type !== eventUtils.BUBBLE_OPEN) {\n    return;\n  }\n  const bubbleEvent = e as BubbleOpen;\n  if (\n    !(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\n    !bubbleEvent.blockId\n  ) {\n    return;\n  }\n  const workspaceId = bubbleEvent.workspaceId;\n  const block = common\n    .getWorkspaceById(workspaceId)!\n    .getBlockById(bubbleEvent.blockId) as BlockSvg;\n  const type = block.type;\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\n    return;\n  }\n  const workspace = (\n    block.getIcon(MutatorIcon.TYPE) as MutatorIcon\n  ).getWorkspace()!;\n  updateMutatorFlyout(workspace);\n  workspace.addChangeListener(mutatorChangeListener);\n}\n/**\n * Listens for changes in a procedure mutator and triggers flyout updates when\n * necessary.\n *\n * @param e The event that triggered this listener.\n */\nfunction mutatorChangeListener(e: Abstract) {\n  if (\n    e.type !== eventUtils.BLOCK_CREATE &&\n    e.type !== eventUtils.BLOCK_DELETE &&\n    e.type !== eventUtils.BLOCK_CHANGE &&\n    e.type !== eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE\n  ) {\n    return;\n  }\n  const workspaceId = e.workspaceId as string;\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n}\n\n/**\n * Find all the callers of a named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to find callers in.\n * @returns Array of caller blocks.\n */\nexport function getCallers(name: string, workspace: Workspace): Block[] {\n  return workspace.getAllBlocks(false).filter((block) => {\n    return (\n      blockIsModernCallerFor(block, name) ||\n      (isLegacyProcedureCallBlock(block) &&\n        Names.equals(block.getProcedureCall(), name))\n    );\n  });\n}\n\n/**\n * @returns True if the given block is a modern-style caller block of the given\n *     procedure name.\n */\nfunction blockIsModernCallerFor(block: Block, procName: string): boolean {\n  return (\n    isProcedureBlock(block) &&\n    !block.isProcedureDef() &&\n    block.getProcedureModel() &&\n    Names.equals(block.getProcedureModel().getName(), procName)\n  );\n}\n\n/**\n * When a procedure definition changes its parameters, find and edit all its\n * callers.\n *\n * @param defBlock Procedure definition block.\n */\nexport function mutateCallers(defBlock: Block) {\n  const oldRecordUndo = eventUtils.getRecordUndo();\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\n  const name = procedureBlock.getProcedureDef()[0];\n  const xmlElement = defBlock.mutationToDom!(true);\n  const callers = getCallers(name, defBlock.workspace);\n  for (let i = 0, caller; (caller = callers[i]); i++) {\n    const oldMutationDom = caller.mutationToDom!();\n    const oldMutation = oldMutationDom && utilsXml.domToText(oldMutationDom);\n    if (caller.domToMutation) {\n      caller.domToMutation(xmlElement);\n    }\n    const newMutationDom = caller.mutationToDom!();\n    const newMutation = newMutationDom && utilsXml.domToText(newMutationDom);\n    if (oldMutation !== newMutation) {\n      // Fire a mutation on every caller block.  But don't record this as an\n      // undo action since it is deterministically tied to the procedure's\n      // definition mutation.\n      eventUtils.setRecordUndo(false);\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          caller,\n          'mutation',\n          null,\n          oldMutation,\n          newMutation,\n        ),\n      );\n      eventUtils.setRecordUndo(oldRecordUndo);\n    }\n  }\n}\n\n/**\n * Find the definition block for the named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to search.\n * @returns The procedure definition block, or null not found.\n */\nexport function getDefinition(\n  name: string,\n  workspace: Workspace,\n): Block | null {\n  // Do not assume procedure is a top block. Some languages allow nested\n  // procedures. Also do not assume it is one of the built-in blocks. Only\n  // rely on isProcedureDef and getProcedureDef.\n  for (const block of workspace.getAllBlocks(false)) {\n    if (\n      isProcedureBlock(block) &&\n      block.isProcedureDef() &&\n      Names.equals(block.getProcedureModel().getName(), name)\n    ) {\n      return block;\n    }\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return block;\n    }\n  }\n  return null;\n}\n\nexport {\n  ObservableProcedureMap,\n  IParameterModel,\n  IProcedureBlock,\n  isProcedureBlock,\n  IProcedureMap,\n  IProcedureModel,\n  ProcedureTuple,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport * as parsing from '../../utils/parsing.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\n\n/** An object containing sizing and path information about outside corners. */\nexport interface OutsideCorners {\n  topLeft: string;\n  topRight: string;\n  bottomRight: string;\n  bottomLeft: string;\n  rightHeight: number;\n}\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  height: number;\n  width: number;\n  path: string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  type: number;\n  width: number;\n  height: number;\n  pathLeft: string;\n  pathRight: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  type: number;\n  width: number;\n  height: number;\n  pathDown: string | ((p1: number) => string);\n  pathUp: string | ((p1: number) => string);\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  path: string;\n}\n\nexport type BaseShape = {\n  type: number;\n  width: number;\n  height: number;\n};\n\n/** An object containing sizing and type information about a dynamic shape. */\nexport type DynamicShape = {\n  type: number;\n  width: (p1: number) => number;\n  height: (p1: number) => number;\n  isDynamic: true;\n  connectionOffsetY: (p1: number) => number;\n  connectionOffsetX: (p1: number) => number;\n  pathDown: (p1: number) => string;\n  pathUp: (p1: number) => string;\n  pathRightDown: (p1: number) => string;\n  pathRightUp: (p1: number) => string;\n};\n\n/** An object containing sizing and type information about a shape. */\nexport type Shape = BaseShape | DynamicShape;\n\n/**\n * Returns whether the shape is dynamic or not.\n *\n * @param shape The shape to check for dynamic-ness.\n * @returns Whether the shape is a dynamic shape or not.\n */\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\n  return (shape as DynamicShape).isDynamic;\n}\n\n/**\n * An object that provides constants for rendering blocks.\n */\nexport class ConstantProvider {\n  /** The size of an empty spacer. */\n  NO_PADDING = 0;\n\n  /** The size of small padding. */\n  SMALL_PADDING = 3;\n\n  /** The size of medium padding. */\n  MEDIUM_PADDING = 5;\n\n  /** The size of medium-large padding. */\n  MEDIUM_LARGE_PADDING = 8;\n\n  /** The size of large padding. */\n  LARGE_PADDING = 10;\n  TALL_INPUT_FIELD_OFFSET_Y: number;\n\n  /** The height of the puzzle tab used for input and output connections. */\n  TAB_HEIGHT = 15;\n\n  /**\n   * The offset from the top of the block at which a puzzle tab is positioned.\n   */\n  TAB_OFFSET_FROM_TOP = 5;\n\n  /**\n   * Vertical overlap of the puzzle tab, used to make it look more like a\n   * puzzle piece.\n   */\n  TAB_VERTICAL_OVERLAP = 2.5;\n\n  /** The width of the puzzle tab used for input and output connections. */\n  TAB_WIDTH = 8;\n\n  /** The width of the notch used for previous and next connections. */\n  NOTCH_WIDTH = 15;\n\n  /** The height of the notch used for previous and next connections. */\n  NOTCH_HEIGHT = 4;\n\n  /** The minimum width of the block. */\n  MIN_BLOCK_WIDTH = 12;\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\n  DUMMY_INPUT_MIN_HEIGHT: number;\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\n\n  /** Rounded corner radius. */\n  CORNER_RADIUS = 8;\n\n  /**\n   * Offset from the left side of a block or the inside of a statement input\n   * to the left side of the notch.\n   */\n  NOTCH_OFFSET_LEFT = 15;\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\n\n  STATEMENT_BOTTOM_SPACER = 0;\n  STATEMENT_INPUT_PADDING_LEFT = 20;\n\n  /** Vertical padding between consecutive statement inputs. */\n  BETWEEN_STATEMENT_PADDING_Y = 4;\n  TOP_ROW_MIN_HEIGHT: number;\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\n  BOTTOM_ROW_MIN_HEIGHT: number;\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\n\n  /**\n   * Whether to add a 'hat' on top of all blocks with no previous or output\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\n   */\n  ADD_START_HATS = false;\n\n  /** Height of the top hat. */\n  START_HAT_HEIGHT = 15;\n\n  /** Width of the top hat. */\n  START_HAT_WIDTH = 100;\n\n  SPACER_DEFAULT_HEIGHT = 15;\n\n  MIN_BLOCK_HEIGHT = 24;\n\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\n  EMPTY_INLINE_INPUT_HEIGHT: number;\n\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\n  START_POINT: string;\n\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_HEIGHT = 12;\n\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_WIDTH = 6;\n\n  /** Point size of text. */\n  FIELD_TEXT_FONTSIZE = 11;\n\n  /** Text font weight. */\n  FIELD_TEXT_FONTWEIGHT = 'normal';\n\n  /** Text font family. */\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\n\n  /**\n   * Height of text.  This constant is dynamically set in\n   * `setFontConstants_` to be the height of the text based on the font\n   * used.\n   */\n  FIELD_TEXT_HEIGHT = -1; // Dynamically set.\n\n  /**\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\n   * to be the baseline of the text based on the font used.\n   */\n  FIELD_TEXT_BASELINE = -1; // Dynamically set.\n\n  /** A field's border rect corner radius. */\n  FIELD_BORDER_RECT_RADIUS = 4;\n\n  /** A field's border rect default height. */\n  FIELD_BORDER_RECT_HEIGHT = 16;\n\n  /** A field's border rect X padding. */\n  FIELD_BORDER_RECT_X_PADDING = 5;\n\n  /** A field's border rect Y padding. */\n  FIELD_BORDER_RECT_Y_PADDING = 3;\n\n  /**\n   * The backing colour of a field's border rect.\n   */\n  FIELD_BORDER_RECT_COLOUR = '#fff';\n  FIELD_TEXT_BASELINE_CENTER: boolean;\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\n\n  /**\n   * Whether or not a dropdown field should add a border rect when in a shadow\n   * block.\n   */\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\n\n  /**\n   * Whether or not a dropdown field's div should be coloured to match the\n   * block colours.\n   */\n  FIELD_DROPDOWN_COLOURED_DIV = false;\n\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\n  FIELD_DROPDOWN_SVG_ARROW = false;\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\n\n  /** A dropdown field's SVG arrow size. */\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\n\n  /**\n   * Whether or not to show a box shadow around the widget div. This is only a\n   * feature of full block fields.\n   */\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\n\n  /**\n   * Whether or not the colour field should display its colour value on the\n   * entire block.\n   */\n  FIELD_COLOUR_FULL_BLOCK = false;\n\n  /** A colour field's default width. */\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\n  FIELD_CHECKBOX_X_OFFSET: number;\n  randomIdentifier: string;\n\n  /**\n   * The defs tag that contains all filters and patterns for this Blockly\n   * instance.\n   */\n  private defs: SVGElement | null = null;\n\n  /**\n   * The ID of the emboss filter, or the empty string if no filter is set.\n   */\n  embossFilterId = '';\n\n  /** The <filter> element to use for highlighting, or null if not set. */\n  private embossFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\n   */\n  disabledPatternId = '';\n\n  /**\n   * The <pattern> element to use for disabled blocks, or null if not set.\n   */\n  private disabledPattern: SVGElement | null = null;\n\n  /**\n   * The ID of the debug filter, or the empty string if no pattern is set.\n   */\n  debugFilterId = '';\n\n  /**\n   * The <filter> element to use for a debug highlight, or null if not set.\n   */\n  private debugFilter: SVGElement | null = null;\n\n  /** The <style> element to use for injecting renderer specific CSS. */\n  private cssNode: HTMLStyleElement | null = null;\n\n  /**\n   * Cursor colour.\n   */\n  CURSOR_COLOUR = '#cc0a0a';\n\n  /**\n   * Immovable marker colour.\n   */\n  MARKER_COLOUR = '#4286f4';\n\n  /**\n   * Width of the horizontal cursor.\n   */\n  CURSOR_WS_WIDTH = 100;\n\n  /**\n   * Height of the horizontal cursor.\n   */\n  WS_CURSOR_HEIGHT = 5;\n\n  /**\n   * Padding around a stack.\n   */\n  CURSOR_STACK_PADDING = 10;\n\n  /**\n   * Padding around a block.\n   */\n  CURSOR_BLOCK_PADDING = 2;\n\n  /**\n   * Stroke of the cursor.\n   */\n  CURSOR_STROKE_WIDTH = 4;\n\n  /**\n   * Whether text input and colour fields fill up the entire source block.\n   */\n  FULL_BLOCK_FIELDS = false;\n\n  /**\n   * The main colour of insertion markers, in hex.  The block is rendered a\n   * transparent grey by changing the fill opacity in CSS.\n   */\n  INSERTION_MARKER_COLOUR = '#000000';\n\n  /**\n   * The insertion marker opacity.\n   */\n  INSERTION_MARKER_OPACITY = 0.2;\n\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNERS!: InsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNERS!: OutsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n\n  blockStyles!: {[key: string]: BlockStyle};\n\n  constructor() {\n    /**\n     * Offset from the top of the row for placing fields on inline input rows\n     * and statement input rows.\n     * Matches existing rendering (in 2019).\n     */\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\n\n    /** The minimum height of a dummy input row. */\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /** The minimum height of a dummy input row in a shadow block. */\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /**\n     * Additional offset added to the statement input's width to account for the\n     * notch.\n     */\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    /** The top row's minimum height. */\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The top row's minimum height if it precedes a statement. */\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The bottom row's minimum height. */\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The bottom row's minimum height if it follows a statement input. */\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The height of an empty inline input. */\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\n\n    /**\n     * The height of an empty statement input.  Note that in the old rendering\n     * this varies slightly depending on whether the block has external or\n     * inline inputs. In the new rendering this is consistent.  It seems\n     * unlikely that the old behaviour was intentional.\n     */\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\n\n    this.START_POINT = svgPaths.moveBy(0, 0);\n\n    /**\n     * A field's text element's dominant baseline. Pre-2022 this could be false\n     * for certain browsers.\n     */\n    this.FIELD_TEXT_BASELINE_CENTER = true;\n\n    /** A dropdown field's border rect height. */\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A dropdown field's SVG arrow padding. */\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    /** A dropdown field's SVG arrow datauri. */\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\n      'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\n      'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\n      'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\n      'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\n      'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\n      'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\n      'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\n      'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\n      'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\n      'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\n      'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\n\n    /** A colour field's default height. */\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A checkbox field's X offset. */\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\n\n    /**\n     * A random identifier used to ensure a unique ID is used for each\n     * filter/pattern for the case of multiple Blockly instances on a page.\n     */\n    this.randomIdentifier = String(Math.random()).substring(2);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about collapsed block\n     * indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /** An object containing sizing and path information about notches. */\n    this.NOTCH = this.makeNotch();\n\n    /** An object containing sizing and path information about start hats */\n    this.START_HAT = this.makeStartHat();\n\n    /**\n     * An object containing sizing and path information about puzzle tabs.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about inside corners\n     */\n    this.INSIDE_CORNERS = this.makeInsideCorners();\n\n    /**\n     * An object containing sizing and path information about outside corners.\n     */\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\n  }\n\n  /**\n   * Refresh constants properties that depend on the theme.\n   *\n   * @param theme The current workspace theme.\n   */\n  setTheme(theme: Theme) {\n    /** The block styles map. */\n    this.blockStyles = Object.create(null);\n\n    const blockStyles = theme.blockStyles;\n    for (const key in blockStyles) {\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\n    }\n\n    this.setDynamicProperties_(theme);\n  }\n\n  /**\n   * Sets dynamic properties that depend on other values or theme properties.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setDynamicProperties_(theme: Theme) {\n    this.setFontConstants_(theme);\n    this.setComponentConstants_(theme);\n\n    this.ADD_START_HATS =\n      theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\n  }\n\n  /**\n   * Set constants related to fonts.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setFontConstants_(theme: Theme) {\n    if (theme.fontStyle && theme.fontStyle['family']) {\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['weight']) {\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['size']) {\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\n    }\n\n    const fontMetrics = dom.measureFontMetrics(\n      'Hg',\n      this.FIELD_TEXT_FONTSIZE + 'pt',\n      this.FIELD_TEXT_FONTWEIGHT,\n      this.FIELD_TEXT_FONTFAMILY,\n    );\n\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\n  }\n\n  /**\n   * Set constants from a theme's component styles.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setComponentConstants_(theme: Theme) {\n    this.CURSOR_COLOUR =\n      theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\n    this.MARKER_COLOUR =\n      theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\n    this.INSERTION_MARKER_COLOUR =\n      theme.getComponentStyle('insertionMarkerColour') ||\n      this.INSERTION_MARKER_COLOUR;\n    this.INSERTION_MARKER_OPACITY =\n      Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\n      this.INSERTION_MARKER_OPACITY;\n  }\n\n  /**\n   * Get or create a block style based on a single colour value.  Generate a\n   * name for the style based on the colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns An object containing the style and an autogenerated name for that\n   *     style.\n   */\n  getBlockStyleForColour(colour: string): {style: BlockStyle; name: string} {\n    const name = 'auto_' + colour;\n    if (!this.blockStyles[name]) {\n      this.blockStyles[name] = this.createBlockStyle_(colour);\n    }\n    return {style: this.blockStyles[name], name};\n  }\n\n  /**\n   * Gets the BlockStyle for the given block style name.\n   *\n   * @param blockStyleName The name of the block style.\n   * @returns The named block style, or a default style if no style with the\n   *     given name was found.\n   */\n  getBlockStyle(blockStyleName: string | null): BlockStyle {\n    return (\n      this.blockStyles[blockStyleName || ''] ||\n      (blockStyleName && blockStyleName.indexOf('auto_') === 0\n        ? this.getBlockStyleForColour(blockStyleName.substring(5)).style\n        : this.createBlockStyle_('#000000'))\n    );\n  }\n\n  /**\n   * Create a block style object based on the given colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns A populated block style based on the given colour.\n   */\n  protected createBlockStyle_(colour: string): BlockStyle {\n    return this.validatedBlockStyle_({'colourPrimary': colour});\n  }\n\n  /**\n   * Get a full block style object based on the input style object.  Populate\n   * any missing values.\n   *\n   * @param blockStyle A full or partial block style object.\n   * @returns A full block style object, with all required properties populated.\n   */\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\n    // Make a new object with all of the same properties.\n    const valid = {} as BlockStyle;\n    if (blockStyle) {\n      Object.assign(valid, blockStyle);\n    }\n    // Validate required properties.\n    const parsedColour = parsing.parseBlockColour(\n      valid['colourPrimary'] || '#000',\n    );\n    valid.colourPrimary = parsedColour.hex;\n    valid.colourSecondary = valid['colourSecondary']\n      ? parsing.parseBlockColour(valid['colourSecondary']).hex\n      : this.generateSecondaryColour_(valid.colourPrimary);\n    valid.colourTertiary = valid['colourTertiary']\n      ? parsing.parseBlockColour(valid['colourTertiary']).hex\n      : this.generateTertiaryColour_(valid.colourPrimary);\n\n    valid.hat = valid['hat'] || '';\n    return valid;\n  }\n\n  /**\n   * Generate a secondary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated secondary colour.\n   */\n  protected generateSecondaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\n  }\n\n  /**\n   * Generate a tertiary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated tertiary colour.\n   */\n  protected generateTertiaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\n  }\n\n  /**\n   * Dispose of this constants provider.\n   * Delete all DOM elements that this provider created.\n   */\n  dispose() {\n    if (this.embossFilter) {\n      dom.removeNode(this.embossFilter);\n    }\n    if (this.disabledPattern) {\n      dom.removeNode(this.disabledPattern);\n    }\n    if (this.debugFilter) {\n      dom.removeNode(this.debugFilter);\n    }\n    this.cssNode = null;\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block indicators.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const height = this.JAGGED_TEETH_HEIGHT;\n    const width = this.JAGGED_TEETH_WIDTH;\n\n    const mainPath = svgPaths.line([\n      svgPaths.point(width, height / 4),\n      svgPaths.point(-width * 2, height / 2),\n      svgPaths.point(width, height / 4),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start hats.\n   */\n  protected makeStartHat(): StartHat {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(30, -height),\n      svgPaths.point(70, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle\n   *     tabs.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.TAB_WIDTH;\n    const height = this.TAB_HEIGHT;\n\n    /**\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\n     * Those curves are defined with relative positions.  The 'up' and 'down'\n     * versions of the paths are the same, but the Y sign flips.  Forward and\n     * back are the signs to use to move the cursor in the direction that the\n     * path is being drawn.\n     *\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @returns A path fragment describing a puzzle tab.\n     */\n    function makeMainPath(up: boolean): string {\n      const forward = up ? -1 : 1;\n      const back = -forward;\n\n      const overlap = 2.5;\n      const halfHeight = height / 2;\n      const control1Y = halfHeight + overlap;\n      const control2Y = halfHeight + 0.5;\n      const control3Y = overlap; // 2.5\n\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\n\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point(0, forward * control1Y),\n          svgPaths.point(-width, back * control2Y),\n          endPoint1,\n        ]) +\n        svgPaths.curve('s', [\n          svgPaths.point(width, back * control3Y),\n          endPoint2,\n        ])\n      );\n    }\n\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\n    const pathUp = makeMainPath(true);\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\n    const pathDown = makeMainPath(false);\n\n    return {\n      type: this.SHAPES.PUZZLE,\n      width,\n      height,\n      pathDown,\n      pathUp,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notches.\n   */\n  protected makeNotch(): Notch {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n    const innerWidth = 3;\n    const outerWidth = (width - innerWidth) / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.line([\n        svgPaths.point(dir * outerWidth, height),\n        svgPaths.point(dir * innerWidth, 0),\n        svgPaths.point(dir * outerWidth, -height),\n      ]);\n    }\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corners.\n   */\n  protected makeInsideCorners(): InsideCorners {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corners.\n   */\n  protected makeOutsideCorners(): OutsideCorners {\n    const radius = this.CORNER_RADIUS;\n    /** SVG path for drawing the rounded top-left corner. */\n    const topLeft =\n      svgPaths.moveBy(0, radius) +\n      svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\n\n    /** SVG path for drawing the rounded top-right corner. */\n    const topRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-left corner. */\n    const bottomLeft = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, -radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-right corner. */\n    const bottomRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    return {\n      topLeft,\n      topRight,\n      bottomRight,\n      bottomLeft,\n      rightHeight: radius,\n    };\n  }\n\n  /**\n   * Get an object with connection shape and sizing information based on the\n   * type of the connection.\n   *\n   * @param connection The connection to find a shape object for\n   * @returns The shape object for the connection.\n   */\n  shapeFor(connection: RenderedConnection): Shape {\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        return this.PUZZLE_TAB;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH;\n      default:\n        throw Error('Unknown connection type');\n    }\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param tagName The name to use for the CSS style tag.\n   * @param selector The CSS selector to use.\n   */\n  createDom(svg: SVGElement, tagName: string, selector: string) {\n    this.injectCSS_(tagName, selector);\n\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    this.defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    /*\n          <filter id=\"blocklyEmbossFilter837493\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\n                                result=\"specOut\">\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\n            </feSpecularLighting>\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\n                         result=\"specOut\" />\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\n          </filter>\n        */\n    const embossFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\n      embossFilter,\n    );\n    const feSpecularLighting = dom.createSvgElement(\n      Svg.FESPECULARLIGHTING,\n      {\n        'in': 'blur',\n        'surfaceScale': 1,\n        'specularConstant': 0.5,\n        'specularExponent': 10,\n        'lighting-color': 'white',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEPOINTLIGHT,\n      {'x': -5000, 'y': -10000, 'z': 20000},\n      feSpecularLighting,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'specOut',\n        'in2': 'SourceAlpha',\n        'operator': 'in',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'specOut',\n        'operator': 'arithmetic',\n        'k1': 0,\n        'k2': 1,\n        'k3': 1,\n        'k4': 0,\n      },\n      embossFilter,\n    );\n    this.embossFilterId = embossFilter.id;\n    this.embossFilter = embossFilter;\n\n    /*\n          <pattern id=\"blocklyDisabledPattern837493\"\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\n       stroke=\"#cc0\" />\n          </pattern>\n        */\n    const disabledPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {\n        'id': 'blocklyDisabledPattern' + this.randomIdentifier,\n        'patternUnits': 'userSpaceOnUse',\n        'width': 10,\n        'height': 10,\n      },\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': 10, 'height': 10, 'fill': '#aaa'},\n      disabledPattern,\n    );\n    dom.createSvgElement(\n      Svg.PATH,\n      {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\n      disabledPattern,\n    );\n    this.disabledPatternId = disabledPattern.id;\n    this.disabledPattern = disabledPattern;\n\n    this.createDebugFilter();\n  }\n\n  /**\n   * Create a filter for highlighting the currently rendering block during\n   * render debugging.\n   */\n  private createDebugFilter() {\n    // Only create the debug filter once.\n    if (!this.debugFilter) {\n      const debugFilter = dom.createSvgElement(\n        Svg.FILTER,\n        {\n          'id': 'blocklyDebugFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        this.defs,\n      );\n      // Set all gaussian blur pixels to 1 opacity before applying flood\n      const debugComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER,\n        {'result': 'outBlur'},\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        debugComponentTransfer,\n      );\n      // Color the highlight\n      dom.createSvgElement(\n        Svg.FEFLOOD,\n        {\n          'flood-color': '#ff0000',\n          'flood-opacity': 0.5,\n          'result': 'outColor',\n        },\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FECOMPOSITE,\n        {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        debugFilter,\n      );\n      this.debugFilterId = debugFilter.id;\n      this.debugFilter = debugFilter;\n    }\n  }\n\n  /**\n   * Inject renderer specific CSS into the page.\n   *\n   * @param tagName The name of the style tag to use.\n   * @param selector The CSS selector to use.\n   */\n  protected injectCSS_(tagName: string, selector: string) {\n    const cssArray = this.getCSS_(selector);\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\n    this.cssNode = document.getElementById(cssNodeId) as HTMLStyleElement;\n    const text = cssArray.join('\\n');\n    if (this.cssNode) {\n      // Already injected, update if the theme changed.\n      this.cssNode.firstChild!.textContent = text;\n      return;\n    }\n    // Inject CSS tag at start of head.\n    const cssNode = document.createElement('style');\n    cssNode.id = cssNodeId;\n    const cssTextNode = document.createTextNode(text);\n    cssNode.appendChild(cssTextNode);\n    document.head.insertBefore(cssNode, document.head.firstChild);\n    this.cssNode = cssNode;\n  }\n\n  /**\n   * Get any renderer specific CSS to inject when the renderer is initialized.\n   *\n   * @param selector CSS selector to use.\n   * @returns Array of CSS strings.\n   */\n  protected getCSS_(selector: string): string[] {\n    // prettier-ignore\n    return [\n      // Text.\n      `${selector} .blocklyText, `,\n      `${selector} .blocklyFlyoutLabelText {`,\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n        `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect,`,\n      `${selector} .blocklyEditableText>rect {`,\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n        `fill-opacity: .6;`,\n        `stroke: none;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text {`,\n        `fill: #000;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\n        `stroke: #fff;`,\n        `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `}`,\n\n      // Selection highlight.\n      `${selector} .blocklySelected>.blocklyPath {`,\n        `stroke: #fc3;`,\n        `stroke-width: 3px;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n        `stroke: #fc3;`,\n      `}`,\n\n      // Replaceable highlight.\n      `${selector} .blocklyReplaceable .blocklyPath {`,\n        `fill-opacity: .5;`,\n      `}`,\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\n        `display: none;`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n        `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an AST node.\n * Used to traverse the Blockly AST.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ASTNode\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport type {Input} from '../inputs/input.js';\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Class for an AST node.\n * It is recommended that you use one of the createNode methods instead of\n * creating a node directly.\n */\nexport class ASTNode {\n  /**\n   * True to navigate to all fields. False to only navigate to clickable fields.\n   */\n  static NAVIGATE_ALL_FIELDS = false;\n\n  /**\n   * The default y offset to use when moving the cursor from a stack to the\n   * workspace.\n   */\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\n  private readonly type: string;\n  private readonly isConnectionLocation: boolean;\n  private readonly location: IASTNodeLocation;\n\n  /** The coordinate on the workspace. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Coordinate'.\n  private wsCoordinate: Coordinate = null as AnyDuringMigration;\n\n  /**\n   * @param type The type of the location.\n   *     Must be in ASTNode.types.\n   * @param location The position in the AST.\n   * @param opt_params Optional dictionary of options.\n   */\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\n    if (!location) {\n      throw Error('Cannot create a node without a location.');\n    }\n\n    /**\n     * The type of the location.\n     * One of ASTNode.types\n     */\n    this.type = type;\n\n    /** Whether the location points to a connection. */\n    this.isConnectionLocation = ASTNode.isConnectionType(type);\n\n    /** The location of the AST node. */\n    this.location = location;\n\n    this.processParams(opt_params || null);\n  }\n\n  /**\n   * Parse the optional parameters.\n   *\n   * @param params The user specified parameters.\n   */\n  private processParams(params: Params | null) {\n    if (!params) {\n      return;\n    }\n    if (params.wsCoordinate) {\n      this.wsCoordinate = params.wsCoordinate;\n    }\n  }\n\n  /**\n   * Gets the value pointed to by this node.\n   * It is the callers responsibility to check the node type to figure out what\n   * type of object they get back from this.\n   *\n   * @returns The current field, connection, workspace, or block the cursor is\n   *     on.\n   */\n  getLocation(): IASTNodeLocation {\n    return this.location;\n  }\n\n  /**\n   * The type of the current location.\n   * One of ASTNode.types\n   *\n   * @returns The type of the location.\n   */\n  getType(): string {\n    return this.type;\n  }\n\n  /**\n   * The coordinate on the workspace.\n   *\n   * @returns The workspace coordinate or null if the location is not a\n   *     workspace.\n   */\n  getWsCoordinate(): Coordinate {\n    return this.wsCoordinate;\n  }\n\n  /**\n   * Whether the node points to a connection.\n   *\n   * @returns [description]\n   * @internal\n   */\n  isConnection(): boolean {\n    return this.isConnectionLocation;\n  }\n\n  /**\n   * Given an input find the next editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the next field or connection or null if there\n   *     is no editable field or input connection after the given input.\n   */\n  private findNextForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\n      const input = block!.inputList[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the next editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node pointing to the next field or connection or null if\n   *     there is no editable field or input connection after the given input.\n   */\n  private findNextForField(): ASTNode | null {\n    const location = this.location as Field;\n    const input = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(input);\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\n    for (let i = curIdx; i < block.inputList.length; i++) {\n      const newInput = block.inputList[i];\n      const fieldRow = newInput.fieldRow;\n      while (fieldIdx < fieldRow.length) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx++;\n      }\n      fieldIdx = 0;\n      if (newInput.connection) {\n        return ASTNode.createInputNode(newInput);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given an input find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the previous field or connection.\n   */\n  private findPrevForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block!.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node holding the previous input or field.\n   */\n  private findPrevForField(): ASTNode | null {\n    const location = this.location as Field;\n    const parentInput = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(parentInput);\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      while (fieldIdx > -1) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx--;\n      }\n      // Reset the fieldIdx to the length of the field row of the previous\n      // input.\n      if (i - 1 >= 0) {\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Navigate between stacks of blocks on the workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The first block of the next stack or null if there are no blocks\n   *     on the workspace.\n   */\n  private navigateBetweenStacks(forward: boolean): ASTNode | null {\n    let curLocation = this.getLocation();\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\n      if (block) {\n        curLocation = block;\n      }\n    }\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    const curLocationAsBlock = curLocation as Block;\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\n      return null;\n    }\n    const curRoot = curLocationAsBlock.getRootBlock();\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\n    for (let i = 0; i < topBlocks.length; i++) {\n      const topBlock = topBlocks[i];\n      if (curRoot.id === topBlock.id) {\n        const offset = forward ? 1 : -1;\n        const resultIndex = i + offset;\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\n          return null;\n        }\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\n      }\n    }\n    throw Error(\n      \"Couldn't find \" + (forward ? 'next' : 'previous') + ' stack?!',\n    );\n  }\n\n  /**\n   * Finds the top most AST node for a given block.\n   * This is either the previous connection, output connection or block\n   * depending on what kind of connections the block has.\n   *\n   * @param block The block that we want to find the top connection on.\n   * @returns The AST node containing the top connection.\n   */\n  private findTopASTNodeForBlock(block: Block): ASTNode | null {\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      return ASTNode.createConnectionNode(topConnection);\n    } else {\n      return ASTNode.createBlockNode(block);\n    }\n  }\n\n  /**\n   * Get the AST node pointing to the input that the block is nested under or if\n   * the block is not nested then get the stack AST node.\n   *\n   * @param block The source block of the current location.\n   * @returns The AST node pointing to the input connection or the top block of\n   *     the stack this block is in.\n   */\n  private getOutAstNodeForBlock(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    // If the block doesn't have a previous connection then it is the top of the\n    // substack.\n    const topBlock = block.getTopStackBlock();\n    const topConnection = getParentConnection(topBlock);\n    // If the top connection has a parentInput, create an AST node pointing to\n    // that input.\n    if (\n      topConnection &&\n      topConnection.targetConnection &&\n      topConnection.targetConnection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        topConnection.targetConnection.getParentInput() as AnyDuringMigration,\n      );\n    } else {\n      // Go to stack level if you are not underneath an input.\n      return ASTNode.createStackNode(topBlock);\n    }\n  }\n\n  /**\n   * Find the first editable field or input with a connection on a given block.\n   *\n   * @param block The source block of the current location.\n   * @returns An AST node pointing to the first field or input.\n   * Null if there are no editable fields or inputs with connections on the\n   * block.\n   */\n  private findFirstFieldOrInput(block: Block): ASTNode | null {\n    const inputs = block.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Finds the source block of the location of this node.\n   *\n   * @returns The source block of the location, or null if the node is of type\n   *     workspace.\n   */\n  getSourceBlock(): Block | null {\n    if (this.getType() === ASTNode.types.BLOCK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.STACK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\n      return null;\n    } else {\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\n    }\n  }\n\n  /**\n   * Find the element to the right of the current element in the AST.\n   *\n   * @returns An AST node that wraps the next field, connection, block, or\n   *     workspace. Or null if there is no node to the right.\n   */\n  next(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(true);\n\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD:\n        return this.findNextForField();\n\n      case ASTNode.types.INPUT:\n        return this.findNextForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const nextConnection = block.nextConnection;\n        if (!nextConnection) return null;\n        return ASTNode.createConnectionNode(nextConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element one level below and all the way to the left of the current\n   * location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace, or\n   *     block. Or null if there is nothing below this node.\n   */\n  in(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.WORKSPACE: {\n        const workspace = this.location as Workspace;\n        const topBlocks = workspace.getTopBlocks(true);\n        if (topBlocks.length > 0) {\n          return ASTNode.createStackNode(topBlocks[0]);\n        }\n        break;\n      }\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        return this.findTopASTNodeForBlock(block);\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.findFirstFieldOrInput(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element to the left of the current element in the AST.\n   *\n   * @returns An AST node that wraps the previous field, connection, workspace\n   *     or block. Or null if no node exists to the left. null.\n   */\n  prev(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(false);\n\n      case ASTNode.types.OUTPUT:\n        return null;\n\n      case ASTNode.types.FIELD:\n        return this.findPrevForField();\n\n      case ASTNode.types.INPUT:\n        return this.findPrevForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const topConnection = getParentConnection(block);\n        if (!topConnection) return null;\n        return ASTNode.createConnectionNode(topConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        if (targetConnection && !targetConnection.getParentInput()) {\n          return ASTNode.createConnectionNode(targetConnection);\n        }\n        break;\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the next element that is one position above and all the way to the\n   * left of the current location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace or\n   *     block. Or null if we are at the workspace level.\n   */\n  out(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        const blockPos = block.getRelativeToSurfaceXY();\n        // TODO: Make sure this is in the bounds of the workspace.\n        const wsCoordinate = new Coordinate(\n          blockPos.x,\n          blockPos.y + ASTNode.DEFAULT_OFFSET_Y,\n        );\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\n      }\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        const target = connection.targetConnection;\n        if (target) {\n          return ASTNode.createConnectionNode(target);\n        }\n        return ASTNode.createStackNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD: {\n        const field = this.location as Field;\n        const block = field.getSourceBlock();\n        if (!block) {\n          throw new Error(\n            'The current AST location is not associated with a block',\n          );\n        }\n        return ASTNode.createBlockNode(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.getOutAstNodeForBlock(block);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Whether an AST node of the given type points to a connection.\n   *\n   * @param type The type to check.  One of ASTNode.types.\n   * @returns True if a node of the given type points to a connection.\n   */\n  private static isConnectionType(type: string): boolean {\n    switch (type) {\n      case ASTNode.types.PREVIOUS:\n      case ASTNode.types.NEXT:\n      case ASTNode.types.INPUT:\n      case ASTNode.types.OUTPUT:\n        return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create an AST node pointing to a field.\n   *\n   * @param field The location of the AST node.\n   * @returns An AST node pointing to a field.\n   */\n  static createFieldNode(field: Field): ASTNode | null {\n    if (!field) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.FIELD, field);\n  }\n\n  /**\n   * Creates an AST node pointing to a connection. If the connection has a\n   * parent input then create an AST node of type input that will hold the\n   * connection.\n   *\n   * @param connection This is the connection the node will point to.\n   * @returns An AST node pointing to a connection.\n   */\n  static createConnectionNode(connection: Connection): ASTNode | null {\n    if (!connection) {\n      return null;\n    }\n    const type = connection.type;\n    if (type === ConnectionType.INPUT_VALUE) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (\n      type === ConnectionType.NEXT_STATEMENT &&\n      connection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\n      return new ASTNode(ASTNode.types.NEXT, connection);\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\n    }\n    return null;\n  }\n\n  /**\n   * Creates an AST node pointing to an input. Stores the input connection as\n   * the location.\n   *\n   * @param input The input used to create an AST node.\n   * @returns An AST node pointing to a input.\n   */\n  static createInputNode(input: Input): ASTNode | null {\n    if (!input || !input.connection) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\n  }\n\n  /**\n   * Creates an AST node pointing to a block.\n   *\n   * @param block The block used to create an AST node.\n   * @returns An AST node pointing to a block.\n   */\n  static createBlockNode(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BLOCK, block);\n  }\n\n  /**\n   * Create an AST node of type stack. A stack, represented by its top block, is\n   *     the set of all blocks connected to a top block, including the top\n   * block.\n   *\n   * @param topBlock A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createStackNode(topBlock: Block): ASTNode | null {\n    if (!topBlock) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.STACK, topBlock);\n  }\n\n  /**\n   * Creates an AST node pointing to a workspace.\n   *\n   * @param workspace The workspace that we are on.\n   * @param wsCoordinate The position on the workspace for this node.\n   * @returns An AST node pointing to a workspace and a position on the\n   *     workspace.\n   */\n  static createWorkspaceNode(\n    workspace: Workspace | null,\n    wsCoordinate: Coordinate | null,\n  ): ASTNode | null {\n    if (!wsCoordinate || !workspace) {\n      return null;\n    }\n    const params = {wsCoordinate};\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\n  }\n\n  /**\n   * Creates an AST node for the top position on a block.\n   * This is either an output connection, previous connection, or block.\n   *\n   * @param block The block to find the top most AST node on.\n   * @returns The AST node holding the top most position on the block.\n   */\n  static createTopNode(block: Block): ASTNode | null {\n    let astNode;\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      astNode = ASTNode.createConnectionNode(topConnection);\n    } else {\n      astNode = ASTNode.createBlockNode(block);\n    }\n    return astNode;\n  }\n}\n\nexport namespace ASTNode {\n  export interface Params {\n    wsCoordinate: Coordinate;\n  }\n\n  export enum types {\n    FIELD = 'field',\n    BLOCK = 'block',\n    INPUT = 'input',\n    OUTPUT = 'output',\n    NEXT = 'next',\n    PREVIOUS = 'previous',\n    STACK = 'stack',\n    WORKSPACE = 'workspace',\n  }\n}\n\nexport type Params = ASTNode.Params;\n// No need to export ASTNode.types from the module at this time because (1) it\n// wasn't automatically converted by the automatic migration script, (2) the\n// name doesn't follow the styleguide.\n\n/**\n * Gets the parent connection on a block.\n * This is either an output connection, previous connection or undefined.\n * If both connections exist return the one that is actually connected\n * to another block.\n *\n * @param block The block to find the parent connection on.\n * @returns The connection connecting to the parent of the block.\n */\nfunction getParentConnection(block: Block): Connection | null {\n  let topConnection = block.outputConnection;\n  if (\n    !topConnection ||\n    (block.previousConnection && block.previousConnection.isConnected())\n  ) {\n    topConnection = block.previousConnection;\n  }\n  return topConnection;\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Connection\n\nimport type {Block} from './block.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a connection between blocks.\n */\nexport class Connection implements IASTNodeLocationWithBlock {\n  /** Constants for checking whether two connections are compatible. */\n  static CAN_CONNECT = 0;\n  static REASON_SELF_CONNECTION = 1;\n  static REASON_WRONG_TYPE = 2;\n  static REASON_TARGET_NULL = 3;\n  static REASON_CHECKS_FAILED = 4;\n  static REASON_DIFFERENT_WORKSPACES = 5;\n  static REASON_SHADOW_PARENT = 6;\n  static REASON_DRAG_CHECKS_FAILED = 7;\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\n\n  protected sourceBlock_: Block;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  targetConnection: Connection | null = null;\n\n  /**\n   * Has this connection been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** List of compatible value types.  Null if all types are compatible. */\n  private check: string[] | null = null;\n\n  /** DOM representation of a shadow block, or null if none. */\n  private shadowDom: Element | null = null;\n\n  /**\n   * Horizontal location of this connection.\n   *\n   * @internal\n   */\n  x = 0;\n\n  /**\n   * Vertical location of this connection.\n   *\n   * @internal\n   */\n  y = 0;\n\n  private shadowState: blocks.State | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(\n    source: Block,\n    public type: number,\n  ) {\n    this.sourceBlock_ = source;\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected connect_(childConnection: Connection) {\n    const INPUT = ConnectionType.INPUT_VALUE;\n    const parentBlock = this.getSourceBlock();\n    const childBlock = childConnection.getSourceBlock();\n\n    // Make sure the childConnection is available.\n    if (childConnection.isConnected()) {\n      childConnection.disconnectInternal(false);\n    }\n\n    // Make sure the parentConnection is available.\n    let orphan;\n    if (this.isConnected()) {\n      const shadowState = this.stashShadowState();\n      const target = this.targetBlock();\n      if (target!.isShadow()) {\n        target!.dispose(false);\n      } else {\n        this.disconnectInternal();\n        orphan = target;\n      }\n      this.applyShadowState(shadowState);\n    }\n\n    // Connect the new connection to the parent.\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n        childBlock,\n      ) as BlockMove;\n      event.setReason(['connect']);\n    }\n    connectReciprocally(this, childConnection);\n    childBlock.setParent(parentBlock);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    // Deal with the orphan if it exists.\n    if (orphan) {\n      const orphanConnection =\n        this.type === INPUT\n          ? orphan.outputConnection\n          : orphan.previousConnection;\n      if (!orphanConnection) return;\n      const connection = Connection.getConnectionForOrphanedConnection(\n        childBlock,\n        orphanConnection,\n      );\n      if (connection) {\n        orphanConnection.connect(connection);\n      } else {\n        orphanConnection.onFailedConnect(this);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this connection and deal with connected blocks.\n   *\n   * @internal\n   */\n  dispose() {\n    // isConnected returns true for shadows and non-shadows.\n    if (this.isConnected()) {\n      // Destroy the attached shadow block & its children (if it exists).\n      this.setShadowStateInternal();\n\n      const targetBlock = this.targetBlock();\n      if (targetBlock && !targetBlock.isDeadOrDying()) {\n        // Disconnect the attached normal block.\n        targetBlock.unplug();\n      }\n    }\n\n    this.disposed = true;\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Does the connection belong to a superior block (higher in the source\n   * stack)?\n   *\n   * @returns True if connection faces down or right.\n   */\n  isSuperior(): boolean {\n    return (\n      this.type === ConnectionType.INPUT_VALUE ||\n      this.type === ConnectionType.NEXT_STATEMENT\n    );\n  }\n\n  /**\n   * Is the connection connected?\n   *\n   * @returns True if connection is connected to another connection.\n   */\n  isConnected(): boolean {\n    return !!this.targetConnection;\n  }\n\n  /**\n   * Get the workspace's connection type checker object.\n   *\n   * @returns The connection type checker for the source block's workspace.\n   * @internal\n   */\n  getConnectionChecker(): IConnectionChecker {\n    return this.sourceBlock_.workspace.connectionChecker;\n  }\n\n  /**\n   * Called when an attempted connection fails. NOP by default (i.e. for\n   * headless workspaces).\n   *\n   * @param _otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  onFailedConnect(_otherConnection: Connection) {}\n  // NOP\n\n  /**\n   * Connect this connection to another connection.\n   *\n   * @param otherConnection Connection to connect to.\n   * @returns Whether the the blocks are now connected or not.\n   */\n  connect(otherConnection: Connection): boolean {\n    if (this.targetConnection === otherConnection) {\n      // Already connected together.  NOP.\n      return true;\n    }\n\n    const checker = this.getConnectionChecker();\n    if (checker.canConnect(this, otherConnection, false)) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      // Determine which block is superior (higher in the source stack).\n      if (this.isSuperior()) {\n        // Superior block.\n        this.connect_(otherConnection);\n      } else {\n        // Inferior block.\n        otherConnection.connect_(this);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n\n    return this.isConnected();\n  }\n\n  /**\n   * Disconnect this connection.\n   */\n  disconnect() {\n    this.disconnectInternal();\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  protected disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) {\n      throw Error('Source connection not connected.');\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n        childConnection.getSourceBlock(),\n      ) as BlockMove;\n      event.setReason(['disconnect']);\n    }\n    const otherConnection = this.targetConnection;\n    if (otherConnection) {\n      otherConnection.targetConnection = null;\n    }\n    this.targetConnection = null;\n    if (setParent) childConnection.getSourceBlock().setParent(null);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    if (!childConnection.getSourceBlock().isShadow()) {\n      // If we were disconnecting a shadow, no need to spawn a new one.\n      parentConnection.respawnShadow_();\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Returns the parent connection (superior) and child connection (inferior)\n   * given this connection and the connection it is connected to.\n   *\n   * @returns The parent connection and child connection, given this connection\n   *     and the connection it is connected to.\n   */\n  protected getParentAndChildConnections(): {\n    parentConnection?: Connection;\n    childConnection?: Connection;\n  } {\n    if (!this.targetConnection) return {};\n    if (this.isSuperior()) {\n      return {\n        parentConnection: this,\n        childConnection: this.targetConnection,\n      };\n    }\n    return {\n      parentConnection: this.targetConnection,\n      childConnection: this,\n    };\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   */\n  protected respawnShadow_() {\n    // Have to keep respawnShadow_ for backwards compatibility.\n    this.createShadowBlock(true);\n  }\n\n  /**\n   * Reconnects this connection to the input with the given name on the given\n   * block. If there is already a connection connected to that input, that\n   * connection is disconnected.\n   *\n   * @param block The block to connect this connection to.\n   * @param inputName The name of the input to connect this connection to.\n   * @returns True if this connection was able to connect, false otherwise.\n   */\n  reconnect(block: Block, inputName: string): boolean {\n    // No need to reconnect if this connection's block is deleted.\n    if (this.getSourceBlock().isDeadOrDying()) return false;\n\n    const connectionParent = block.getInput(inputName)?.connection;\n    const currentParent = this.targetBlock();\n    if (\n      (!currentParent || currentParent === block) &&\n      connectionParent &&\n      connectionParent.targetConnection !== this\n    ) {\n      if (connectionParent.isConnected()) {\n        // There's already something connected here.  Get rid of it.\n        connectionParent.disconnect();\n      }\n      connectionParent.connect(this);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  targetBlock(): Block | null {\n    if (this.isConnected()) {\n      return this.targetConnection?.getSourceBlock() ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Connection {\n    if (check) {\n      if (!Array.isArray(check)) {\n        check = [check];\n      }\n      this.check = check;\n      this.onCheckChanged_();\n    } else {\n      this.check = null;\n    }\n    return this;\n  }\n\n  /**\n   * Get a connection's compatibility.\n   *\n   * @returns List of compatible value types.\n   *     Null if all types are compatible.\n   */\n  getCheck(): string[] | null {\n    return this.check;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowDom DOM representation of a block or null.\n   */\n  setShadowDom(shadowDom: Element | null) {\n    this.setShadowStateInternal({shadowDom});\n  }\n\n  /**\n   * Returns the xml representation of the connection's shadow block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved shadowDom is\n   *     just returned.\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(returnCurrent?: boolean): Element | null {\n    return returnCurrent && this.targetBlock()!.isShadow()\n      ? (Xml.blockToDom(this.targetBlock() as Block) as Element)\n      : this.shadowDom;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowState An state represetation of the block or null.\n   */\n  setShadowState(shadowState: blocks.State | null) {\n    this.setShadowStateInternal({shadowState});\n  }\n\n  /**\n   * Returns the serialized object representation of the connection's shadow\n   * block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved state is just\n   *     returned.\n   * @returns Serialized object representation of the block, or null.\n   */\n  getShadowState(returnCurrent?: boolean): blocks.State | null {\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\n      return blocks.save(this.targetBlock() as Block);\n    }\n    return this.shadowState;\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * Headless configurations (the default) do not have neighboring connection,\n   * and always return an empty list (the default).\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\n   * computed from the rendered positioning.\n   *\n   * @param _maxLimit The maximum radius to another connection.\n   * @returns List of connections.\n   * @internal\n   */\n  neighbours(_maxLimit: number): Connection[] {\n    return [];\n  }\n\n  /**\n   * Get the parent input of a connection.\n   *\n   * @returns The input that the connection belongs to or null if no parent\n   *     exists.\n   * @internal\n   */\n  getParentInput(): Input | null {\n    let parentInput = null;\n    const inputs = this.sourceBlock_.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      if (inputs[i].connection === this) {\n        parentInput = inputs[i];\n        break;\n      }\n    }\n    return parentInput;\n  }\n\n  /**\n   * This method returns a string describing this Connection in developer terms\n   * (English only). Intended to on be used in console logs and errors.\n   *\n   * @returns The description.\n   */\n  toString(): string {\n    const block = this.sourceBlock_;\n    if (!block) {\n      return 'Orphan Connection';\n    }\n    let msg;\n    if (block.outputConnection === this) {\n      msg = 'Output Connection of ';\n    } else if (block.previousConnection === this) {\n      msg = 'Previous Connection of ';\n    } else if (block.nextConnection === this) {\n      msg = 'Next Connection of ';\n    } else {\n      let parentInput = null;\n      for (let i = 0, input; (input = block.inputList[i]); i++) {\n        if (input.connection === this) {\n          parentInput = input;\n          break;\n        }\n      }\n      if (parentInput) {\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\n      } else {\n        console.warn('Connection not actually connected to sourceBlock_');\n        return 'Orphan Connection';\n      }\n    }\n    return msg + block.toDevString();\n  }\n\n  /**\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\n   * temporarily sets those properties to null so no shadow respawns.\n   *\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\n   */\n  private stashShadowState(): {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  } {\n    const shadowDom = this.getShadowDom(true);\n    const shadowState = this.getShadowState(true);\n    // Set to null so it doesn't respawn.\n    this.shadowDom = null;\n    this.shadowState = null;\n    return {shadowDom, shadowState};\n  }\n\n  /**\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\n   *\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\n   *     properties.\n   */\n  private applyShadowState({\n    shadowDom,\n    shadowState,\n  }: {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  }) {\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n  }\n\n  /**\n   * Sets the state of the shadow of this connection.\n   *\n   * @param param0 The state to set the shadow of this connection to.\n   */\n  private setShadowStateInternal({\n    shadowDom = null,\n    shadowState = null,\n  }: {\n    shadowDom?: Element | null;\n    shadowState?: blocks.State | null;\n  } = {}) {\n    // One or both of these should always be null.\n    // If neither is null, the shadowState will get priority.\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n\n    const target = this.targetBlock();\n    if (!target) {\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else if (target.isShadow()) {\n      target.dispose(false);\n      if (this.getSourceBlock().isDeadOrDying()) return;\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else {\n      const shadow = this.createShadowBlock(false);\n      this.serializeShadow(shadow);\n      if (shadow) {\n        shadow.dispose(false);\n      }\n    }\n  }\n\n  /**\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\n   * shadowState_ gets priority.\n   *\n   * @param attemptToConnect Whether to try to connect the shadow block to this\n   *     connection or not.\n   * @returns The shadow block that was created, or null if both the\n   *     shadowState_ and shadowDom_ are null.\n   */\n  private createShadowBlock(attemptToConnect: boolean): Block | null {\n    const parentBlock = this.getSourceBlock();\n    const shadowState = this.getShadowState();\n    const shadowDom = this.getShadowDom();\n    if (parentBlock.isDeadOrDying() || (!shadowState && !shadowDom)) {\n      return null;\n    }\n\n    let blockShadow;\n    if (shadowState) {\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\n        parentConnection: attemptToConnect ? this : undefined,\n        isShadow: true,\n        recordUndo: false,\n      });\n      return blockShadow;\n    }\n\n    if (shadowDom) {\n      blockShadow = Xml.domToBlockInternal(shadowDom, parentBlock.workspace);\n      if (attemptToConnect) {\n        if (this.type === ConnectionType.INPUT_VALUE) {\n          if (!blockShadow.outputConnection) {\n            throw new Error('Shadow block is missing an output connection');\n          }\n          if (!this.connect(blockShadow.outputConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\n          if (!blockShadow.previousConnection) {\n            throw new Error('Shadow block is missing previous connection');\n          }\n          if (!this.connect(blockShadow.previousConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else {\n          throw new Error(\n            'Cannot connect a shadow block to a previous/output connection',\n          );\n        }\n      }\n      return blockShadow;\n    }\n    return null;\n  }\n\n  /**\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\n   * properties, in their respective serialized forms.\n   *\n   * @param shadow The shadow to serialize, or null.\n   */\n  private serializeShadow(shadow: Block | null) {\n    if (!shadow) {\n      return;\n    }\n    this.shadowDom = Xml.blockToDom(shadow) as Element;\n    this.shadowState = blocks.save(shadow);\n  }\n\n  /**\n   * Returns the connection (starting at the startBlock) which will accept\n   * the given connection. This includes compatible connection types and\n   * connection checks.\n   *\n   * @param startBlock The block on which to start the search.\n   * @param orphanConnection The connection that is looking for a home.\n   * @returns The suitable connection point on the chain of blocks, or null.\n   */\n  static getConnectionForOrphanedConnection(\n    startBlock: Block,\n    orphanConnection: Connection,\n  ): Connection | null {\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\n      return getConnectionForOrphanedOutput(\n        startBlock,\n        orphanConnection.getSourceBlock(),\n      );\n    }\n    // Otherwise we're dealing with a stack.\n    const connection = startBlock.lastConnectionInStack(true);\n    const checker = orphanConnection.getConnectionChecker();\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\n      return connection;\n    }\n    return null;\n  }\n}\n\n/**\n * Update two connections to target each other.\n *\n * @param first The first connection to update.\n * @param second The second connection to update.\n */\nfunction connectReciprocally(first: Connection, second: Connection) {\n  if (!first || !second) {\n    throw Error('Cannot connect null connections.');\n  }\n  first.targetConnection = second;\n  second.targetConnection = first;\n}\n/**\n * Returns the single connection on the block that will accept the orphaned\n * block, if one can be found. If the block has multiple compatible connections\n * (even if they are filled) this returns null. If the block has no compatible\n * connections, this returns null.\n *\n * @param block The superior block.\n * @param orphanBlock The inferior block.\n * @returns The suitable connection point on 'block', or null.\n */\nfunction getSingleConnection(\n  block: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let foundConnection = null;\n  const output = orphanBlock.outputConnection;\n  const typeChecker = output?.getConnectionChecker();\n\n  for (let i = 0, input; (input = block.inputList[i]); i++) {\n    const connection = input.connection;\n    if (connection && typeChecker?.canConnect(output, connection, false)) {\n      if (foundConnection) {\n        return null; // More than one connection.\n      }\n      foundConnection = connection;\n    }\n  }\n  return foundConnection;\n}\n\n/**\n * Walks down a row a blocks, at each stage checking if there are any\n * connections that will accept the orphaned block.  If at any point there\n * are zero or multiple eligible connections, returns null.  Otherwise\n * returns the only input on the last block in the chain.\n * Terminates early for shadow blocks.\n *\n * @param startBlock The block on which to start the search.\n * @param orphanBlock The block that is looking for a home.\n * @returns The suitable connection point on the chain of blocks, or null.\n */\nfunction getConnectionForOrphanedOutput(\n  startBlock: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let newBlock: Block | null = startBlock;\n  let connection;\n  while ((connection = getSingleConnection(newBlock, orphanBlock))) {\n    newBlock = connection.targetBlock();\n    if (!newBlock || newBlock.isShadow()) {\n      return connection;\n    }\n  }\n  return null;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering\n\nimport * as registry from '../../registry.js';\nimport type {Theme} from '../../theme.js';\nimport {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n/**\n * Registers a new renderer.\n *\n * @param name The name of the renderer.\n * @param rendererClass The new renderer class to register.\n * @throws {Error} if a renderer with the same name has already been registered.\n */\nexport function register(name: string, rendererClass: Function) {\n  registry.register(registry.Type.RENDERER, name, rendererClass);\n}\n\n/**\n * Unregisters the renderer registered with the given name.\n *\n * @param name The name of the renderer.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.RENDERER, name);\n}\n\n/**\n * Initialize anything needed for rendering (constants, etc).\n *\n * @param name Name of the renderer to initialize.\n * @param theme The workspace theme object.\n * @param opt_rendererOverrides Rendering constant overrides.\n * @returns The new instance of a renderer.\n *     Already initialized.\n * @internal\n */\nexport function init(\n  name: string,\n  theme: Theme,\n  opt_rendererOverrides?: {[rendererConstant: string]: any},\n): Renderer {\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\n  const renderer = new rendererClass!(name);\n  renderer.init(theme, opt_rendererOverrides);\n  return renderer;\n}\nexport {BottomRow};\nexport {Connection};\nexport {Drawer};\nexport {ExternalValueInput};\nexport {Field};\nexport {Hat};\nexport {Icon};\nexport {InRowSpacer};\nexport {InlineInput};\nexport {InputConnection};\nexport {InputRow};\nexport {IPathObject};\nexport {JaggedEdge};\nexport {MarkerSvg};\nexport {Measurable};\nexport {NextConnection};\nexport {OutputConnection};\nexport {PathObject};\nexport {PreviousConnection};\nexport {Renderer};\nexport {RenderInfo};\nexport {RoundCorner};\nexport {Row};\nexport {SpacerRow};\nexport {SquareCorner};\nexport {StatementInput};\nexport {TopRow};\nexport {Types};\n\nexport {\n  OutsideCorners,\n  InsideCorners,\n  StartHat,\n  Notch,\n  PuzzleTab,\n  JaggedTeeth,\n  BaseShape,\n  DynamicShape,\n  ConstantProvider,\n} from './constants.js';\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.VariablesDynamic\n\nimport {Blocks} from './blocks.js';\nimport {Msg} from './msg.js';\nimport * as xml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {FlyoutButton} from './flyout_button.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.Procedures.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\n\n/**\n * Click handler for a button that creates String variables.\n *\n * @param button\n */\nfunction stringButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'String',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\n\n/**\n * Click handler for a button that creates Number variables.\n *\n * @param button\n */\nfunction numberButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Number',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\n\n/**\n * Click handler for a button that creates Colour variables.\n *\n * @param button\n */\nfunction colourButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Colour',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  let button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\n  xmlList.push(button);\n\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_STRING',\n    stringButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_NUMBER',\n    numberButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_COLOUR',\n    colourButtonClickHandler,\n  );\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getAllVariables();\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    if (Blocks['variables_set_dynamic']) {\n      const firstVariable = variableModelList[variableModelList.length - 1];\n      const block = xml.createElement('block');\n      block.setAttribute('type', 'variables_set_dynamic');\n      block.setAttribute('gap', '24');\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['variables_get_dynamic']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = xml.createElement('block');\n        block.setAttribute('type', 'variables_get_dynamic');\n        block.setAttribute('gap', '8');\n        block.appendChild(Variables.generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n", "/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace rendered as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_theme_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_viewport.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {ConnectionDB} from './connection_db.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Options} from './options.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport {ThemeManager} from './theme_manager.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Trashcan} from './trashcan.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\nimport {ContextMenuOption} from './contextmenu_registry.js';\nimport * as renderManagement from './render_management.js';\nimport * as deprecation from './utils/deprecation.js';\nimport {LayerManager} from './layer_manager.js';\n\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\nconst ZOOM_TO_FIT_MARGIN = 20;\n\n/**\n * Class for a workspace.  This is an onscreen area with optional trashcan,\n * scrollbars, bubbles, and dragging.\n */\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\n  /**\n   * A wrapper function called when a resize event occurs.\n   * You can pass the result to `eventHandling.unbind`.\n   */\n  private resizeHandlerWrapper: browserEvents.Data | null = null;\n\n  /**\n   * The render status of an SVG workspace.\n   * Returns `false` for headless workspaces and true for instances of\n   * `WorkspaceSvg`.\n   */\n  override rendered = true;\n\n  /**\n   * Whether the workspace is visible.  False if the workspace has been hidden\n   * by calling `setVisible(false)`.\n   */\n  private isVisible_ = true;\n\n  /**\n   * Whether this workspace has resizes enabled.\n   * Disable during batch operations for a performance improvement.\n   */\n  private resizesEnabled = true;\n\n  /**\n   * Current horizontal scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves right, this value becomes more positive, and\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\n   * left, this value becomes more negative, and the view is now \"seeing\" the\n   * right side of the canvas.\n   *\n   * The confusing thing about this value is that it does not, and must not\n   * include the absoluteLeft offset. This is because it is used to calculate\n   * the viewLeft value.\n   *\n   * The viewLeft is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewLeft and workspace origin are at\n   * the same X location. As the canvas slides towards the right beneath the\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\n   * more negative relative to the workspace origin (imagine the workspace\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\n   *\n   * So if the scrollX were to include the absoluteLeft this would in a way\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\n   * representing the left edge of the blocklyDiv, rather than the left edge\n   * of the workspace.\n   */\n  scrollX = 0;\n\n  /**\n   * Current vertical scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves down, this value becomes more positive, and the\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\n   * part of the canvas.\n   *\n   * This confusing thing about this value is that it does not, and must not\n   * include the absoluteTop offset. This is because it is used to calculate\n   * the viewTop value.\n   *\n   * The viewTop is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewTop and workspace origin are at the\n   * same Y location. As the canvas slides towards the bottom this value\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\n   * relative to the workspace origin (image in the workspace origin as a dot\n   * on the canvas sliding downwards as the canvas moves).\n   *\n   * So if the scrollY were to include the absoluteTop this would in a way\n   * \"unshift\" the workspace origin. This means that the viewTop would be\n   * representing the top edge of the blocklyDiv, rather than the top edge of\n   * the workspace.\n   */\n  scrollY = 0;\n\n  /** Horizontal scroll value when scrolling started in pixel units. */\n  startScrollX = 0;\n\n  /** Vertical scroll value when scrolling started in pixel units. */\n  startScrollY = 0;\n\n  /** Distance from mouse to object being dragged. */\n  private dragDeltaXY: Coordinate | null = null;\n\n  /** Current scale. */\n  scale = 1;\n\n  /** Cached scale value. Used to detect changes in viewport. */\n  private oldScale = 1;\n\n  /** Cached viewport top value. Used to detect changes in viewport. */\n  private oldTop = 0;\n\n  /** Cached viewport left value. Used to detect changes in viewport. */\n  private oldLeft = 0;\n\n  /** The workspace's trashcan (if any). */\n  trashcan: Trashcan | null = null;\n\n  /** This workspace's scrollbars, if they exist. */\n  scrollbar: ScrollbarPair | null = null;\n\n  /**\n   * Fixed flyout providing blocks which may be dragged into this workspace.\n   */\n  private flyout: IFlyout | null = null;\n\n  /**\n   * Category-based toolbox providing blocks which may be dragged into this\n   * workspace.\n   */\n  private toolbox_: IToolbox | null = null;\n\n  /**\n   * The current gesture in progress on this workspace, if any.\n   *\n   * @internal\n   */\n  currentGesture_: Gesture | null = null;\n\n  /**\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\n   * Access this with getInjectionDiv.\n   */\n  private injectionDiv: Element | null = null;\n\n  /**\n   * Last known position of the page scroll.\n   * This is used to determine whether we have recalculated screen coordinate\n   * stuff since the page scrolled.\n   */\n  private lastRecordedPageScroll: Coordinate | null = null;\n\n  /**\n   * Developers may define this function to add custom menu options to the\n   * workspace's context menu or edit the workspace-created set of menu\n   * options.\n   *\n   * @param options List of menu options to add to.\n   * @param e The right-click event that triggered the context menu.\n   */\n  configureContextMenu:\n    | ((menuOptions: ContextMenuOption[], e: Event) => void)\n    | null = null;\n\n  /**\n   * A dummy wheel event listener used as a workaround for a Safari scrolling issue.\n   * Set in createDom and used for removal in dispose to ensure proper cleanup.\n   */\n  private dummyWheelListener: (() => void) | null = null;\n\n  /**\n   * In a flyout, the target workspace where blocks should be placed after a\n   * drag. Otherwise null.\n   *\n   * @internal\n   */\n  targetWorkspace: WorkspaceSvg | null = null;\n\n  /** Inverted screen CTM, for use in mouseToSvg. */\n  private inverseScreenCTM: SVGMatrix | null = null;\n\n  /** Inverted screen CTM is dirty, recalculate it. */\n  private inverseScreenCTMDirty = true;\n  private metricsManager: IMetricsManager;\n  /** @internal */\n  getMetrics: () => Metrics;\n  /** @internal */\n  setMetrics: (p1: {x?: number; y?: number}) => void;\n  private readonly componentManager: ComponentManager;\n\n  /**\n   * List of currently highlighted blocks.  Block highlighting is often used\n   * to visually mark blocks currently being executed.\n   */\n  private readonly highlightedBlocks: BlockSvg[] = [];\n  private audioManager: WorkspaceAudio;\n  private grid: Grid | null;\n  private markerManager: MarkerManager;\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * custom toolbox category is opened.\n   */\n  private toolboxCategoryCallbacks = new Map<\n    string,\n    (p1: WorkspaceSvg) => toolbox.FlyoutDefinition\n  >();\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * button is clicked.\n   */\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\n  protected themeManager_: ThemeManager;\n  private readonly renderer: Renderer;\n\n  /** Cached parent SVG. */\n  private cachedParentSvg: SVGElement | null = null;\n\n  /** True if keyboard accessibility mode is on, false otherwise. */\n  keyboardAccessibilityMode = false;\n\n  /** The list of top-level bounded elements on the workspace. */\n  private topBoundedElements: IBoundedElement[] = [];\n\n  /** The recorded drag targets. */\n  private dragTargetAreas: Array<{component: IDragTarget; clientRect: Rect}> =\n    [];\n  private readonly cachedParentSvgSize: Size;\n  private layerManager: LayerManager | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgGroup_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBackground_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBlockCanvas_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBubbleCanvas_!: SVGElement;\n  zoomControls_: ZoomControls | null = null;\n\n  /**\n   * @param options Dictionary of options.\n   */\n  constructor(options: Options) {\n    super(options);\n\n    const MetricsManagerClass = registry.getClassFromOptions(\n      registry.Type.METRICS_MANAGER,\n      options,\n      true,\n    );\n    /** Object in charge of calculating metrics for the workspace. */\n    this.metricsManager = new MetricsManagerClass!(this);\n\n    /** Method to get all the metrics that have to do with a workspace. */\n    this.getMetrics =\n      options.getMetrics ||\n      this.metricsManager.getMetrics.bind(this.metricsManager);\n\n    /** Translates the workspace. */\n    this.setMetrics =\n      options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics_;\n\n    this.componentManager = new ComponentManager();\n\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\n\n    /**\n     * Object in charge of loading, storing, and playing audio for a workspace.\n     */\n    this.audioManager = new WorkspaceAudio(\n      options.parentWorkspace as WorkspaceSvg,\n    );\n\n    /** This workspace's grid object or null. */\n    this.grid = this.options.gridPattern\n      ? new Grid(this.options.gridPattern, options.gridOptions)\n      : null;\n\n    /** Manager in charge of markers and cursors. */\n    this.markerManager = new MarkerManager(this);\n\n    if (Variables && Variables.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Variables.CATEGORY_NAME,\n        Variables.flyoutCategory,\n      );\n    }\n\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        VariablesDynamic.CATEGORY_NAME,\n        VariablesDynamic.flyoutCategory,\n      );\n    }\n\n    if (Procedures && Procedures.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Procedures.CATEGORY_NAME,\n        Procedures.flyoutCategory,\n      );\n      this.addChangeListener(Procedures.mutatorOpenListener);\n    }\n\n    /** Object in charge of storing and updating the workspace theme. */\n    this.themeManager_ = this.options.parentWorkspace\n      ? this.options.parentWorkspace.getThemeManager()\n      : new ThemeManager(this, this.options.theme || Classic);\n    this.themeManager_.subscribeWorkspace(this);\n\n    /** The block renderer used for rendering blocks on this workspace. */\n    this.renderer = blockRendering.init(\n      this.options.renderer || 'geras',\n      this.getTheme(),\n      this.options.rendererOverrides ?? undefined,\n    );\n\n    /**\n     * The cached size of the parent svg element.\n     * Used to compute svg metrics.\n     */\n    this.cachedParentSvgSize = new Size(0, 0);\n  }\n\n  /**\n   * Get the marker manager for this workspace.\n   *\n   * @returns The marker manager.\n   */\n  getMarkerManager(): MarkerManager {\n    return this.markerManager;\n  }\n\n  /**\n   * Gets the metrics manager for this workspace.\n   *\n   * @returns The metrics manager.\n   */\n  getMetricsManager(): IMetricsManager {\n    return this.metricsManager;\n  }\n\n  /**\n   * Sets the metrics manager for the workspace.\n   *\n   * @param metricsManager The metrics manager.\n   * @internal\n   */\n  setMetricsManager(metricsManager: IMetricsManager) {\n    this.metricsManager = metricsManager;\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\n  }\n\n  /**\n   * Gets the component manager for this workspace.\n   *\n   * @returns The component manager.\n   */\n  getComponentManager(): ComponentManager {\n    return this.componentManager;\n  }\n\n  /**\n   * Add the cursor SVG to this workspaces SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.markerManager.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.markerManager.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Get the marker with the given ID.\n   *\n   * @param id The ID of the marker.\n   * @returns The marker with the given ID or null if no marker with the given\n   *     ID exists.\n   * @internal\n   */\n  getMarker(id: string): Marker | null {\n    if (this.markerManager) {\n      return this.markerManager.getMarker(id);\n    }\n    return null;\n  }\n\n  /**\n   * The cursor for this workspace.\n   *\n   * @returns The cursor for the workspace.\n   */\n  getCursor(): Cursor | null {\n    if (this.markerManager) {\n      return this.markerManager.getCursor();\n    }\n    return null;\n  }\n\n  /**\n   * Get the block renderer attached to this workspace.\n   *\n   * @returns The renderer attached to this workspace.\n   */\n  getRenderer(): Renderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get the theme manager for this workspace.\n   *\n   * @returns The theme manager for this workspace.\n   * @internal\n   */\n  getThemeManager(): ThemeManager {\n    return this.themeManager_;\n  }\n\n  /**\n   * Get the workspace theme object.\n   *\n   * @returns The workspace theme object.\n   */\n  getTheme(): Theme {\n    return this.themeManager_.getTheme();\n  }\n\n  /**\n   * Set the workspace theme object.\n   * If no theme is passed, default to the `Classic` theme.\n   *\n   * @param theme The workspace theme object.\n   */\n  setTheme(theme: Theme) {\n    if (!theme) {\n      theme = Classic as Theme;\n    }\n    this.themeManager_.setTheme(theme);\n  }\n\n  /**\n   * Refresh all blocks on the workspace after a theme update.\n   */\n  refreshTheme() {\n    if (this.svgGroup_) {\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\n    }\n\n    // Update all blocks in workspace that have a style name.\n    this.updateBlockStyles_(\n      this.getAllBlocks(false).filter(function (block) {\n        return !!block.getStyleName();\n      }),\n    );\n\n    // Update current toolbox selection.\n    this.refreshToolboxSelection();\n    if (this.toolbox_) {\n      this.toolbox_.refreshTheme();\n    }\n\n    // Re-render if workspace is visible\n    if (this.isVisible()) {\n      this.setVisible(true);\n    }\n\n    const event = new (eventUtils.get(eventUtils.THEME_CHANGE))(\n      this.getTheme().name,\n      this.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Updates all the blocks with new style.\n   *\n   * @param blocks List of blocks to update the style on.\n   */\n  private updateBlockStyles_(blocks: Block[]) {\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      const blockStyleName = block.getStyleName();\n      if (blockStyleName) {\n        const blockSvg = block as BlockSvg;\n        blockSvg.setStyle(blockStyleName);\n      }\n    }\n  }\n\n  /**\n   * Getter for the inverted screen CTM.\n   *\n   * @returns The matrix to use in mouseToSvg\n   */\n  getInverseScreenCTM(): SVGMatrix | null {\n    // Defer getting the screen CTM until we actually need it, this should\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\n    if (this.inverseScreenCTMDirty) {\n      const ctm = this.getParentSvg().getScreenCTM();\n      if (ctm) {\n        this.inverseScreenCTM = ctm.inverse();\n        this.inverseScreenCTMDirty = false;\n      }\n    }\n\n    return this.inverseScreenCTM;\n  }\n\n  /** Mark the inverse screen CTM as dirty. */\n  updateInverseScreenCTM() {\n    this.inverseScreenCTMDirty = true;\n  }\n\n  /**\n   * Getter for isVisible\n   *\n   * @returns Whether the workspace is visible.\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this element,\n   * scales that after canvas SVG element, if it's a descendant.\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\n   *\n   * @param element SVG element to find the coordinates of.\n   * @returns Object with .x and .y properties.\n   * @internal\n   */\n  getSvgXY(element: SVGElement): Coordinate {\n    let x = 0;\n    let y = 0;\n    let scale = 1;\n    if (\n      this.getCanvas().contains(element) ||\n      this.getBubbleCanvas().contains(element)\n    ) {\n      // Before the SVG canvas, scale the coordinates.\n      scale = this.scale;\n    }\n    do {\n      // Loop through this block and every parent.\n      const xy = svgMath.getRelativeXY(element);\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\n        // After the SVG canvas, don't scale the coordinates.\n        scale = 1;\n      }\n      x += xy.x * scale;\n      y += xy.y * scale;\n      element = element.parentNode as SVGElement;\n    } while (\n      element &&\n      element !== this.getParentSvg() &&\n      element !== this.getInjectionDiv()\n    );\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Gets the size of the workspace's parent SVG element.\n   *\n   * @returns The cached width and height of the workspace's parent SVG element.\n   * @internal\n   */\n  getCachedParentSvgSize(): Size {\n    const size = this.cachedParentSvgSize;\n    return new Size(size.width, size.height);\n  }\n\n  /**\n   * Return the position of the workspace origin relative to the injection div\n   * origin in pixels.\n   * The workspace origin is where a block would render at position (0, 0).\n   * It is not the upper left corner of the workspace SVG.\n   *\n   * @returns Offset in pixels.\n   * @internal\n   */\n  getOriginOffsetInPixels(): Coordinate {\n    return svgMath.getInjectionDivXY(this.getCanvas());\n  }\n\n  /**\n   * Return the injection div that is a parent of this workspace.\n   * Walks the DOM the first time it's called, then returns a cached value.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns The first parent div with 'injectionDiv' in the name.\n   * @internal\n   */\n  getInjectionDiv(): Element {\n    // NB: it would be better to pass this in at createDom, but is more likely\n    // to break existing uses of Blockly.\n    if (!this.injectionDiv) {\n      let element: Element = this.svgGroup_;\n      while (element) {\n        const classes = element.getAttribute('class') || '';\n        if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n          this.injectionDiv = element;\n          break;\n        }\n        element = element.parentNode as Element;\n      }\n    }\n    return this.injectionDiv!;\n  }\n\n  /**\n   * Returns the SVG group for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   */\n  getSvgGroup(): Element {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the SVG block canvas for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   * @internal\n   */\n  getBlockCanvas(): SVGElement | null {\n    return this.getCanvas();\n  }\n\n  /**\n   * Save resize handler data so we can delete it later in dispose.\n   *\n   * @param handler Data that can be passed to eventHandling.unbind.\n   */\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\n    this.resizeHandlerWrapper = handler;\n  }\n\n  /**\n   * Create the workspace DOM elements.\n   *\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\n   *     'blocklyMutatorBackground'.\n   * @returns The workspace's SVG group.\n   */\n  createDom(opt_backgroundClass?: string, injectionDiv?: Element): Element {\n    if (!this.injectionDiv) {\n      this.injectionDiv = injectionDiv ?? null;\n    }\n\n    /**\n     * <g class=\"blocklyWorkspace\">\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\n     *   [Trashcan and/or flyout may go here]\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\"></g>\n     * </g>\n     */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\n\n    // Note that a <g> alone does not receive mouse events--it must have a\n    // valid target inside it.  If no background class is specified, as in the\n    // flyout, the workspace will not receive mouse events.\n    if (opt_backgroundClass) {\n      this.svgBackground_ = dom.createSvgElement(\n        Svg.RECT,\n        {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\n        this.svgGroup_,\n      );\n\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\n        this.svgBackground_.style.fill =\n          'url(#' + this.grid.getPatternId() + ')';\n      } else {\n        this.themeManager_.subscribe(\n          this.svgBackground_,\n          'workspaceBackgroundColour',\n          'fill',\n        );\n      }\n    }\n\n    this.layerManager = new LayerManager(this);\n    // Assign the canvases for backwards compatibility.\n    this.svgBlockCanvas_ = this.layerManager.getBlockLayer();\n    this.svgBubbleCanvas_ = this.layerManager.getBubbleLayer();\n\n    if (!this.isFlyout) {\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'pointerdown',\n        this,\n        this.onMouseDown_,\n        false,\n      );\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\n      // which otherwise prevents zoom/scroll events from being observed in\n      // Safari. Once that bug is fixed it should be removed.\n      this.dummyWheelListener = () => {};\n      document.body.addEventListener('wheel', this.dummyWheelListener);\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'wheel',\n        this,\n        this.onMouseWheel_,\n      );\n    }\n\n    // Determine if there needs to be a category tree, or a simple list of\n    // blocks.  This cannot be changed later, since the UI is very different.\n    if (this.options.hasCategories) {\n      const ToolboxClass = registry.getClassFromOptions(\n        registry.Type.TOOLBOX,\n        this.options,\n        true,\n      );\n      this.toolbox_ = new ToolboxClass!(this);\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n    this.recordDragTargets();\n    const CursorClass = registry.getClassFromOptions(\n      registry.Type.CURSOR,\n      this.options,\n    );\n\n    CursorClass && this.markerManager.setCursor(new CursorClass());\n\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  override dispose() {\n    // Stop rerendering.\n    this.rendered = false;\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.toolbox_) {\n      this.toolbox_.dispose();\n      this.toolbox_ = null;\n    }\n    if (this.flyout) {\n      this.flyout.dispose();\n      this.flyout = null;\n    }\n    if (this.trashcan) {\n      this.trashcan.dispose();\n      this.trashcan = null;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.dispose();\n      this.scrollbar = null;\n    }\n    if (this.zoomControls_) {\n      this.zoomControls_.dispose();\n    }\n\n    if (this.audioManager) {\n      this.audioManager.dispose();\n    }\n\n    if (this.grid) {\n      this.grid = null;\n    }\n\n    this.renderer.dispose();\n\n    if (this.markerManager) {\n      this.markerManager.dispose();\n    }\n\n    super.dispose();\n\n    // Dispose of theme manager after all blocks and mutators are disposed of.\n    if (this.themeManager_) {\n      this.themeManager_.unsubscribeWorkspace(this);\n      this.themeManager_.unsubscribe(this.svgBackground_);\n      if (!this.options.parentWorkspace) {\n        this.themeManager_.dispose();\n      }\n    }\n\n    this.connectionDBList.length = 0;\n\n    this.toolboxCategoryCallbacks.clear();\n    this.flyoutButtonCallbacks.clear();\n\n    if (!this.options.parentWorkspace) {\n      // Top-most workspace.  Dispose of the div that the\n      // SVG is injected into (i.e. injectionDiv).\n      const parentSvg = this.getParentSvg();\n      if (parentSvg && parentSvg.parentNode) {\n        dom.removeNode(parentSvg.parentNode);\n      }\n    }\n    if (this.resizeHandlerWrapper) {\n      browserEvents.unbind(this.resizeHandlerWrapper);\n      this.resizeHandlerWrapper = null;\n    }\n\n    // Remove the dummy wheel listener\n    if (this.dummyWheelListener) {\n      document.body.removeEventListener('wheel', this.dummyWheelListener);\n      this.dummyWheelListener = null;\n    }\n  }\n\n  /**\n   * Add a trashcan.\n   *\n   * @internal\n   */\n  addTrashcan() {\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\n    const svgTrashcan = this.trashcan.createDom();\n    this.svgGroup_.insertBefore(svgTrashcan, this.getCanvas());\n  }\n\n  /**\n   * @param _workspace\n   * @internal\n   */\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\n    throw new Error(\n      'The implementation of newTrashcan should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Add zoom controls.\n   *\n   * @internal\n   */\n  addZoomControls() {\n    this.zoomControls_ = new ZoomControls(this);\n    const svgZoomControls = this.zoomControls_.createDom();\n    this.svgGroup_.appendChild(svgZoomControls);\n  }\n\n  /**\n   * Add a flyout element in an element with the given tag name.\n   *\n   * @param tagName What type of tag the flyout belongs in.\n   * @returns The element containing the flyout DOM.\n   * @internal\n   */\n  addFlyout(tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>): Element {\n    const workspaceOptions = new Options({\n      'parentWorkspace': this,\n      'rtl': this.RTL,\n      'oneBasedIndex': this.options.oneBasedIndex,\n      'horizontalLayout': this.horizontalLayout,\n      'renderer': this.options.renderer,\n      'rendererOverrides': this.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\n    if (this.horizontalLayout) {\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\n    } else {\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(workspaceOptions);\n    }\n    this.flyout.autoClose = false;\n    this.flyout.getWorkspace().setVisible(true);\n\n    // Return the element so that callers can place it in their desired\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\n    // place as main workspace flyouts.\n    return this.flyout.createDom(tagName);\n  }\n\n  /**\n   * Getter for the flyout associated with this workspace.  This flyout may be\n   * owned by either the toolbox or the workspace, depending on toolbox\n   * configuration.  It will be null if there is no flyout.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The flyout on this workspace.\n   */\n  getFlyout(opt_own?: boolean): IFlyout | null {\n    if (this.flyout || opt_own) {\n      return this.flyout;\n    }\n    if (this.toolbox_) {\n      return this.toolbox_.getFlyout();\n    }\n    return null;\n  }\n\n  /**\n   * Getter for the toolbox associated with this workspace, if one exists.\n   *\n   * @returns The toolbox on this workspace.\n   */\n  getToolbox(): IToolbox | null {\n    return this.toolbox_;\n  }\n\n  /**\n   * Update items that use screen coordinate calculations\n   * because something has changed (e.g. scroll position, window size).\n   */\n  private updateScreenCalculations_() {\n    this.updateInverseScreenCTM();\n    this.recordDragTargets();\n  }\n\n  /**\n   * If enabled, resize the parts of the workspace that change when the\n   * workspace contents (e.g. block positions) change.  This will also scroll\n   * the workspace contents if needed.\n   *\n   * @internal\n   */\n  resizeContents() {\n    if (!this.resizesEnabled || !this.rendered) {\n      return;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateInverseScreenCTM();\n  }\n\n  /**\n   * Resize and reposition all of the workspace chrome (toolbox,\n   * trash, scrollbars etc.)\n   * This should be called when something changes that\n   * requires recalculating dimensions and positions of the\n   * trash, zoom, toolbox, etc. (e.g. window resize).\n   */\n  resize() {\n    if (this.toolbox_) {\n      this.toolbox_.position();\n    }\n    if (this.flyout) {\n      this.flyout.position();\n    }\n\n    const positionables = this.componentManager.getComponents(\n      ComponentManager.Capability.POSITIONABLE,\n      true,\n    );\n    const metrics = this.getMetricsManager().getUiMetrics();\n    const savedPositions = [];\n    for (let i = 0, positionable; (positionable = positionables[i]); i++) {\n      positionable.position(metrics, savedPositions);\n      const boundingRect = positionable.getBoundingRectangle();\n      if (boundingRect) {\n        savedPositions.push(boundingRect);\n      }\n    }\n\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateScreenCalculations_();\n  }\n\n  /**\n   * Resizes and repositions workspace chrome if the page has a new\n   * scroll position.\n   *\n   * @internal\n   */\n  updateScreenCalculationsIfScrolled() {\n    /* eslint-disable indent */\n    const currScroll = svgMath.getDocumentScroll();\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\n      this.lastRecordedPageScroll = currScroll;\n      this.updateScreenCalculations_();\n    }\n  }\n  /* eslint-enable indent */\n\n  /**\n   * @returns The layer manager for this workspace.\n   *\n   * @internal\n   */\n  getLayerManager(): LayerManager | null {\n    return this.layerManager;\n  }\n\n  /**\n   * Get the SVG element that forms the drawing surface.\n   *\n   * @returns SVG group element.\n   */\n  getCanvas(): SVGGElement {\n    return this.layerManager!.getBlockLayer();\n  }\n\n  /**\n   * Caches the width and height of the workspace's parent SVG element for use\n   * with getSvgMetrics.\n   *\n   * @param width The width of the parent SVG element.\n   * @param height The height of the parent SVG element\n   * @internal\n   */\n  setCachedParentSvgSize(width: number | null, height: number | null) {\n    const svg = this.getParentSvg();\n    if (width != null) {\n      this.cachedParentSvgSize.width = width;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-width', `${width}`);\n    }\n    if (height != null) {\n      this.cachedParentSvgSize.height = height;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-height', `${height}`);\n    }\n  }\n\n  /**\n   * Get the SVG element that forms the bubble surface.\n   *\n   * @returns SVG group element.\n   */\n  getBubbleCanvas(): SVGGElement {\n    return this.layerManager!.getBubbleLayer();\n  }\n\n  /**\n   * Get the SVG element that contains this workspace.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns SVG element.\n   */\n  getParentSvg(): SVGSVGElement {\n    if (!this.cachedParentSvg) {\n      let element = this.svgGroup_;\n      while (element) {\n        if (element.tagName === 'svg') {\n          this.cachedParentSvg = element;\n          break;\n        }\n        element = element.parentNode as SVGSVGElement;\n      }\n    }\n    return this.cachedParentSvg as SVGSVGElement;\n  }\n\n  /**\n   * Fires a viewport event if events are enabled and there is a change in\n   * viewport values.\n   *\n   * @internal\n   */\n  maybeFireViewportChangeEvent() {\n    if (!eventUtils.isEnabled()) {\n      return;\n    }\n    const scale = this.scale;\n    const top = -this.scrollY;\n    const left = -this.scrollX;\n    if (\n      scale === this.oldScale &&\n      Math.abs(top - this.oldTop) < 1 &&\n      Math.abs(left - this.oldLeft) < 1\n    ) {\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\n      // of negligible changes in viewport top/left.\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.VIEWPORT_CHANGE))(\n      top,\n      left,\n      scale,\n      this.id,\n      this.oldScale,\n    );\n    this.oldScale = scale;\n    this.oldTop = top;\n    this.oldLeft = left;\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Translate this workspace to new coordinates.\n   *\n   * @param x Horizontal translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   * @param y Vertical translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   */\n  translate(x: number, y: number) {\n    this.layerManager?.translateLayers(new Coordinate(x, y), this.scale);\n    this.grid?.moveTo(x, y);\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   *\n   * @returns Width.\n   */\n  override getWidth(): number {\n    const metrics = this.getMetrics();\n    return metrics ? metrics.viewWidth / this.scale : 0;\n  }\n\n  /**\n   * Toggles the visibility of the workspace.\n   * Currently only intended for main workspace.\n   *\n   * @param isVisible True if workspace should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    this.isVisible_ = isVisible;\n    if (!this.svgGroup_) {\n      return;\n    }\n\n    // Tell the scrollbar whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.scrollbar) {\n      this.scrollbar.setContainerVisible(isVisible);\n    }\n\n    // Tell the flyout whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.getFlyout()) {\n      this.getFlyout()!.setContainerVisible(isVisible);\n    }\n\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\n    if (this.toolbox_) {\n      // Currently does not support toolboxes in mutators.\n      this.toolbox_.setVisible(isVisible);\n    }\n    if (!isVisible) {\n      this.hideChaff(true);\n    }\n  }\n\n  /**\n   * Render all blocks in workspace.\n   */\n  render() {\n    // Generate list of all blocks.\n    const blocks = this.getAllBlocks(false);\n    // Render each block.\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      blocks[i].queueRender();\n    }\n\n    if (this.currentGesture_) {\n      const imList = this.currentGesture_.getInsertionMarkers();\n      for (let i = 0; i < imList.length; i++) {\n        imList[i].queueRender();\n      }\n    }\n\n    renderManagement\n      .finishQueuedRenders()\n      .then(() => void this.markerManager.updateMarkers());\n  }\n\n  /**\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\n   *     to unhighlight all blocks).\n   * @param opt_state If undefined, highlight specified block and automatically\n   *     unhighlight all others.  If true or false, manually\n   *     highlight/unhighlight the specified block.\n   */\n  highlightBlock(id: string | null, opt_state?: boolean) {\n    if (opt_state === undefined) {\n      // Unhighlight all blocks.\n      for (let i = 0, block; (block = this.highlightedBlocks[i]); i++) {\n        block.setHighlighted(false);\n      }\n      this.highlightedBlocks.length = 0;\n    }\n    // Highlight/unhighlight the specified block.\n    const block = id ? this.getBlockById(id) : null;\n    if (block) {\n      const state = opt_state === undefined || opt_state;\n      // Using Set here would be great, but at the cost of IE10 support.\n      if (!state) {\n        arrayUtils.removeElem(this.highlightedBlocks, block);\n      } else if (this.highlightedBlocks.indexOf(block) === -1) {\n        this.highlightedBlocks.push(block);\n      }\n      block.setHighlighted(state);\n    }\n  }\n\n  /**\n   * Pastes the provided block or workspace comment onto the workspace.\n   * Does not check whether there is remaining capacity for the object, that\n   * should be done before calling this method.\n   *\n   * @param state The representation of the thing to paste.\n   * @returns The pasted thing, or null if the paste was not successful.\n   * @deprecated v10. Use `Blockly.clipboard.paste` instead. To be removed in\n   *     v11.\n   */\n  paste(\n    state: AnyDuringMigration | Element | DocumentFragment,\n  ): ICopyable<ICopyData> | null {\n    deprecation.warn(\n      'Blockly.WorkspaceSvg.prototype.paste',\n      'v10',\n      'v11',\n      'Blockly.clipboard.paste',\n    );\n    if (!this.rendered || (!state['type'] && !state['tagName'])) {\n      return null;\n    }\n    if (this.currentGesture_) {\n      // Dragging while pasting?  No.\n      this.currentGesture_.cancel();\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    let pastedThing;\n    try {\n      // Checks if this is JSON. JSON has a type property, while elements don't.\n      if (state['type']) {\n        pastedThing = this.pasteBlock_(null, state as blocks.State);\n      } else {\n        const xmlBlock = state as Element;\n        if (xmlBlock.tagName.toLowerCase() === 'comment') {\n          pastedThing = this.pasteWorkspaceComment_(xmlBlock);\n        } else {\n          pastedThing = this.pasteBlock_(xmlBlock, null);\n        }\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n    return pastedThing;\n  }\n\n  /**\n   * Paste the provided block onto the workspace.\n   *\n   * @param xmlBlock XML block element.\n   * @param jsonBlock JSON block representation.\n   * @returns The pasted block.\n   */\n  private pasteBlock_(\n    xmlBlock: Element | null,\n    jsonBlock: blocks.State | null,\n  ): BlockSvg {\n    eventUtils.disable();\n    let block: BlockSvg;\n    try {\n      let blockX = 0;\n      let blockY = 0;\n      if (xmlBlock) {\n        block = Xml.domToBlockInternal(xmlBlock, this) as BlockSvg;\n        blockX = parseInt(xmlBlock.getAttribute('x') ?? '0');\n        if (this.RTL) {\n          blockX = -blockX;\n        }\n        blockY = parseInt(xmlBlock.getAttribute('y') ?? '0');\n      } else if (jsonBlock) {\n        block = blocks.append(jsonBlock, this) as BlockSvg;\n        blockX = jsonBlock['x'] || 10;\n        if (this.RTL) {\n          blockX = this.getWidth() - blockX;\n        }\n        blockY = jsonBlock['y'] || 10;\n      }\n\n      // Move the duplicate to original position.\n      if (!isNaN(blockX) && !isNaN(blockY)) {\n        // Offset block until not clobbering another block and not in connection\n        // distance with neighbouring blocks.\n        let collide;\n        do {\n          collide = false;\n          const allBlocks = this.getAllBlocks(false);\n          for (let i = 0, otherBlock; (otherBlock = allBlocks[i]); i++) {\n            const otherXY = otherBlock.getRelativeToSurfaceXY();\n            if (\n              Math.abs(blockX - otherXY.x) <= 1 &&\n              Math.abs(blockY - otherXY.y) <= 1\n            ) {\n              collide = true;\n              break;\n            }\n          }\n          if (!collide) {\n            // Check for blocks in snap range to any of its connections.\n            const connections = block!.getConnections_(false);\n            for (let i = 0, connection; (connection = connections[i]); i++) {\n              const neighbour = connection.closest(\n                config.snapRadius,\n                // This code doesn't work because it's passing absolute coords\n                // instead of relative coords. But we're deprecating the `paste`\n                // function anyway so we're not going to fix it.\n                new Coordinate(blockX, blockY),\n              );\n              if (neighbour.connection) {\n                collide = true;\n                break;\n              }\n            }\n          }\n          if (collide) {\n            if (this.RTL) {\n              blockX -= config.snapRadius;\n            } else {\n              blockX += config.snapRadius;\n            }\n            blockY += config.snapRadius * 2;\n          }\n        } while (collide);\n        // No 'reason' provided since events are disabled.\n        block!.moveTo(new Coordinate(blockX, blockY));\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !block!.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block!));\n    }\n    block!.select();\n    return block!;\n  }\n\n  /**\n   * Paste the provided comment onto the workspace.\n   *\n   * @param xmlComment XML workspace comment element.\n   * @returns The pasted workspace comment.\n   */\n  private pasteWorkspaceComment_(xmlComment: Element): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment: WorkspaceCommentSvg;\n    try {\n      comment = WorkspaceCommentSvg.fromXmlRendered(xmlComment, this);\n      // Move the duplicate to original position.\n      let commentX = parseInt(xmlComment.getAttribute('x') ?? '0');\n      let commentY = parseInt(xmlComment.getAttribute('y') ?? '0');\n      if (!isNaN(commentX) && !isNaN(commentY)) {\n        if (this.RTL) {\n          commentX = -commentX;\n        }\n        // Offset workspace comment.\n        // TODO (#1719): Properly offset comment such that it's not interfering\n        // with any blocks.\n        commentX += 50;\n        commentY += 50;\n        // This code doesn't work because it's passing absolute coords\n        // instead of relative coords. But we're deprecating the `paste`\n        // function anyway so we're not going to fix it.\n        comment.moveBy(commentX, commentY);\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled()) {\n      WorkspaceComment.fireCreateEvent(comment);\n    }\n    comment.select();\n    return comment;\n  }\n\n  /**\n   * Refresh the toolbox unless there's a drag in progress.\n   *\n   * @internal\n   */\n  refreshToolboxSelection() {\n    const ws = this.isFlyout ? this.targetWorkspace : this;\n    if (ws && !ws.currentGesture_ && ws.toolbox_ && ws.toolbox_.getFlyout()) {\n      ws.toolbox_.refreshSelection();\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map.  Update the\n   *     flyout to show the renamed variable immediately.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  override renameVariableById(id: string, newName: string) {\n    super.renameVariableById(id, newName);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Delete a variable by the passed in ID.   Update the flyout to show\n   *     immediately that the variable is deleted.\n   *\n   * @param id ID of variable to delete.\n   */\n  override deleteVariableById(id: string) {\n    super.deleteVariableById(id);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Create a new variable with the given name.  Update the flyout to show the\n   *     new variable immediately.\n   *\n   * @param name The new variable's name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  override createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    const newVar = super.createVariable(name, opt_type, opt_id);\n    this.refreshToolboxSelection();\n    return newVar;\n  }\n\n  /** Make a list of all the delete areas for this workspace. */\n  recordDragTargets() {\n    const dragTargets = this.componentManager.getComponents(\n      ComponentManager.Capability.DRAG_TARGET,\n      true,\n    );\n\n    this.dragTargetAreas = [];\n    for (let i = 0, targetArea; (targetArea = dragTargets[i]); i++) {\n      const rect = targetArea.getClientRect();\n      if (rect) {\n        this.dragTargetAreas.push({\n          component: targetArea,\n          clientRect: rect,\n        });\n      }\n    }\n  }\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * Returns the drag target the pointer event is over.\n   *\n   * @param e Pointer move event.\n   * @returns Null if not over a drag target, or the drag target the event is\n   *     over.\n   */\n  getDragTarget(e: PointerEvent): IDragTarget | null {\n    for (let i = 0, targetArea; (targetArea = this.dragTargetAreas[i]); i++) {\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\n        return targetArea.component;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Handle a pointerdown on SVG drawing surface.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.getGesture(e);\n    if (gesture) {\n      gesture.handleWsStart(e, this);\n    }\n  }\n\n  /**\n   * Start tracking a drag of an object on this workspace.\n   *\n   * @param e Pointer down event.\n   * @param xy Starting location of object.\n   */\n  startDrag(e: PointerEvent, xy: Coordinate) {\n    // Record the starting offset between the bubble's location and the mouse.\n    const point = browserEvents.mouseToSvg(\n      e,\n      this.getParentSvg(),\n      this.getInverseScreenCTM(),\n    );\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    this.dragDeltaXY = Coordinate.difference(xy, point);\n  }\n\n  /**\n   * Track a drag of an object on this workspace.\n   *\n   * @param e Pointer move event.\n   * @returns New location of object.\n   */\n  moveDrag(e: PointerEvent): Coordinate {\n    const point = browserEvents.mouseToSvg(\n      e,\n      this.getParentSvg(),\n      this.getInverseScreenCTM(),\n    );\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    return Coordinate.sum(this.dragDeltaXY!, point);\n  }\n\n  /**\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\n   *\n   * @returns True if currently dragging or scrolling.\n   */\n  isDragging(): boolean {\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\n  }\n\n  /**\n   * Is this workspace draggable?\n   *\n   * @returns True if this workspace may be dragged.\n   */\n  isDraggable(): boolean {\n    return this.options.moveOptions && this.options.moveOptions.drag;\n  }\n\n  /**\n   * Is this workspace movable?\n   *\n   * This means the user can reposition the X Y coordinates of the workspace\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\n   * on the mouse position). This does not include zooming with the zoom\n   * controls since the X Y coordinates are decided programmatically.\n   *\n   * @returns True if the workspace is movable, false otherwise.\n   */\n  isMovable(): boolean {\n    return (\n      (this.options.moveOptions && !!this.options.moveOptions.scrollbars) ||\n      (this.options.moveOptions && this.options.moveOptions.wheel) ||\n      (this.options.moveOptions && this.options.moveOptions.drag) ||\n      (this.options.zoomOptions && this.options.zoomOptions.wheel) ||\n      (this.options.zoomOptions && this.options.zoomOptions.pinch)\n    );\n  }\n\n  /**\n   * Is this workspace movable horizontally?\n   *\n   * @returns True if the workspace is movable horizontally, false otherwise.\n   */\n  isMovableHorizontally(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollHorizontally()))\n    );\n  }\n\n  /**\n   * Is this workspace movable vertically?\n   *\n   * @returns True if the workspace is movable vertically, false otherwise.\n   */\n  isMovableVertically(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollVertically()))\n    );\n  }\n\n  /**\n   * Handle a mouse-wheel on SVG drawing surface.\n   *\n   * @param e Mouse wheel event.\n   */\n  private onMouseWheel_(e: WheelEvent) {\n    // Don't scroll or zoom anything if drag is in progress.\n    if (Gesture.inProgress()) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    const canWheelZoom =\n      this.options.zoomOptions && this.options.zoomOptions.wheel;\n    const canWheelMove =\n      this.options.moveOptions && this.options.moveOptions.wheel;\n    if (!canWheelZoom && !canWheelMove) {\n      return;\n    }\n\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    // Zoom should also be enabled by the command key on Mac devices,\n    // but not super on Unix.\n    let commandKey;\n    if (userAgent.MAC) {\n      commandKey = e.metaKey;\n    }\n\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\n      // Zoom.\n      // The vertical scroll distance that corresponds to a click of a zoom\n      // button.\n      const PIXELS_PER_ZOOM_STEP = 50;\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\n      const position = browserEvents.mouseToSvg(\n        e,\n        this.getParentSvg(),\n        this.getInverseScreenCTM(),\n      );\n      this.zoom(position.x, position.y, delta);\n    } else {\n      // Scroll.\n      let x = this.scrollX - scrollDelta.x;\n      let y = this.scrollY - scrollDelta.y;\n\n      if (e.shiftKey && !scrollDelta.x) {\n        // Scroll horizontally (based on vertical scroll delta).\n        // This is needed as for some browser/system combinations which do not\n        // set deltaX.\n        x = this.scrollX - scrollDelta.y;\n        y = this.scrollY; // Don't scroll vertically.\n      }\n      this.scroll(x, y);\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Calculate the bounding box for the blocks on the workspace.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Contains the position and size of the bounding box containing the\n   *     blocks on the workspace.\n   */\n  getBlocksBoundingBox(): Rect {\n    const topElements = this.getTopBoundedElements();\n    // There are no blocks, return empty rectangle.\n    if (!topElements.length) {\n      return new Rect(0, 0, 0, 0);\n    }\n\n    // Initialize boundary using the first block.\n    const boundary = topElements[0].getBoundingRectangle();\n\n    // Start at 1 since the 0th block was used for initialization.\n    for (let i = 1; i < topElements.length; i++) {\n      const topElement = topElements[i];\n      if (\n        (topElement as any).isInsertionMarker &&\n        (topElement as any).isInsertionMarker()\n      ) {\n        continue;\n      }\n      const blockBoundary = topElement.getBoundingRectangle();\n      if (blockBoundary.top < boundary.top) {\n        boundary.top = blockBoundary.top;\n      }\n      if (blockBoundary.bottom > boundary.bottom) {\n        boundary.bottom = blockBoundary.bottom;\n      }\n      if (blockBoundary.left < boundary.left) {\n        boundary.left = blockBoundary.left;\n      }\n      if (blockBoundary.right > boundary.right) {\n        boundary.right = blockBoundary.right;\n      }\n    }\n    return boundary;\n  }\n\n  /** Clean up the workspace by ordering all the blocks in a column. */\n  cleanUp() {\n    this.setResizesEnabled(false);\n    eventUtils.setGroup(true);\n    const topBlocks = this.getTopBlocks(true);\n    let cursorY = 0;\n    for (let i = 0, block; (block = topBlocks[i]); i++) {\n      if (!block.isMovable()) {\n        continue;\n      }\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(-xy.x, cursorY - xy.y, ['cleanup']);\n      block.snapToGrid();\n      cursorY =\n        block.getRelativeToSurfaceXY().y +\n        block.getHeightWidth().height +\n        this.renderer.getConstants().MIN_BLOCK_HEIGHT;\n    }\n    eventUtils.setGroup(false);\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Show the context menu for the workspace.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    if (this.options.readOnly || this.isFlyout) {\n      return;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.WORKSPACE,\n      {workspace: this},\n    );\n\n    // Allow the developer to add or modify menuOptions.\n    if (this.configureContextMenu) {\n      this.configureContextMenu(menuOptions, e);\n    }\n\n    ContextMenu.show(e, menuOptions, this.RTL);\n  }\n\n  /**\n   * Modify the block tree on the existing toolbox.\n   *\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\n   *     or JSON representing toolbox definition.\n   */\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition | null) {\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\n\n    if (!parsedToolboxDef) {\n      if (this.options.languageTree) {\n        throw Error(\"Can't nullify an existing toolbox.\");\n      }\n      return; // No change (null to null).\n    }\n    if (!this.options.languageTree) {\n      throw Error(\"Existing toolbox is null.  Can't create new toolbox.\");\n    }\n\n    if (toolbox.hasCategories(parsedToolboxDef)) {\n      if (!this.toolbox_) {\n        throw Error(\"Existing toolbox has no categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.toolbox_.render(parsedToolboxDef);\n    } else {\n      if (!this.flyout) {\n        throw Error(\"Existing toolbox has categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.flyout.show(parsedToolboxDef);\n    }\n  }\n\n  /** Mark this workspace as the currently focused main workspace. */\n  markFocused() {\n    if (this.options.parentWorkspace) {\n      this.options.parentWorkspace.markFocused();\n    } else {\n      common.setMainWorkspace(this);\n      // We call e.preventDefault in many event handlers which means we\n      // need to explicitly grab focus (e.g from a textarea) because\n      // the browser will not do it for us.\n      this.getParentSvg().focus({preventScroll: true});\n    }\n  }\n\n  /**\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\n   * coordinate.\n   *\n   * @param x X coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param y Y coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param amount Amount of zooming. The formula for the new scale is newScale\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\n   *     workspace options. Negative amount values zoom out, and positive amount\n   *     values zoom in.\n   */\n  zoom(x: number, y: number, amount: number) {\n    // Scale factor.\n    const speed = this.options.zoomOptions.scaleSpeed;\n    let scaleChange = Math.pow(speed, amount);\n    const newScale = this.scale * scaleChange;\n    if (this.scale === newScale) {\n      return; // No change in zoom.\n    }\n\n    // Clamp scale within valid range.\n    if (newScale > this.options.zoomOptions.maxScale) {\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\n    } else if (newScale < this.options.zoomOptions.minScale) {\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\n    }\n\n    // Transform the x/y coordinates from the parentSVG's space into the\n    // canvas' space, so that they are in workspace units relative to the top\n    // left of the visible portion of the workspace.\n    let matrix = this.getCanvas().getCTM();\n    let center = this.getParentSvg().createSVGPoint();\n    center.x = x;\n    center.y = y;\n    center = center.matrixTransform(matrix!.inverse());\n    x = center.x;\n    y = center.y;\n\n    // Find the new scrollX/scrollY so that the center remains in the same\n    // position (relative to the center) after we zoom.\n    // newScale and matrix.a should be identical (within a rounding error).\n    matrix = matrix!\n      .translate(x * (1 - scaleChange), y * (1 - scaleChange))\n      .scale(scaleChange);\n    // scrollX and scrollY are in pixels.\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\n    // subtracted from them, but we'll leave that for setScale so that they're\n    // correctly updated for the new flyout size if we have a simple toolbox.\n    this.scrollX = matrix.e;\n    this.scrollY = matrix.f;\n    this.setScale(newScale);\n  }\n\n  /**\n   * Zooming the blocks centered in the center of view with zooming in or out.\n   *\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\n   */\n  zoomCenter(type: number) {\n    const metrics = this.getMetrics();\n    let x;\n    let y;\n    if (this.flyout) {\n      // If you want blocks in the center of the view (visible portion of the\n      // workspace) to stay centered when the size of the view decreases (i.e.\n      // when the size of the flyout increases) you need the center of the\n      // *blockly div* to stay in the same pixel-position.\n      // Note: This only works because of how scrollCenter positions blocks.\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\n    } else {\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\n    }\n    this.zoom(x, y, type);\n  }\n\n  /** Zoom the blocks to fit in the workspace if possible. */\n  zoomToFit() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let workspaceWidth = metrics.viewWidth;\n    let workspaceHeight = metrics.viewHeight;\n    const blocksBox = this.getBlocksBoundingBox();\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\n    if (!blocksWidth) {\n      return; // Prevents zooming to infinity.\n    }\n    if (this.flyout) {\n      // We have to add the flyout size to both the workspace size and the\n      // block size because the blocks we want to resize include the blocks in\n      // the flyout, and the area we want to fit them includes the portion of\n      // the workspace that is behind the flyout.\n      if (this.horizontalLayout) {\n        workspaceHeight += this.flyout.getHeight();\n        // Convert from pixels to workspace coordinates.\n        blocksHeight += this.flyout.getHeight() / this.scale;\n      } else {\n        workspaceWidth += this.flyout.getWidth();\n        // Convert from pixels to workspace coordinates.\n        blocksWidth += this.flyout.getWidth() / this.scale;\n      }\n    }\n\n    // Scale Units: (pixels / workspaceUnit)\n    const ratioX = workspaceWidth / blocksWidth;\n    const ratioY = workspaceHeight / blocksHeight;\n    eventUtils.disable();\n    try {\n      this.setScale(Math.min(ratioX, ratioY));\n      this.scrollCenter();\n    } finally {\n      eventUtils.enable();\n    }\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Add a transition class to the block and bubble canvas, to animate any\n   * transform changes.\n   *\n   * @internal\n   */\n  beginCanvasTransition() {\n    dom.addClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.addClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /**\n   * Remove transition class from the block and bubble canvas.\n   *\n   * @internal\n   */\n  endCanvasTransition() {\n    dom.removeClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.removeClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /** Center the workspace. */\n  scrollCenter() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\n\n    // Convert from workspace directions to canvas directions.\n    x = -x - metrics.scrollLeft;\n    y = -y - metrics.scrollTop;\n    this.scroll(x, y);\n  }\n\n  /**\n   * Scroll the workspace to center on the given block. If the block has other\n   * blocks stacked below it, the workspace will be centered on the stack,\n   * unless blockOnly is true.\n   *\n   * @param id ID of block center on.\n   * @param blockOnly True to center only on the block itself, not its stack.\n   */\n  centerOnBlock(id: string | null, blockOnly?: boolean) {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const block = id ? this.getBlockById(id) : null;\n    if (!block) {\n      return;\n    }\n\n    // XY is in workspace coordinates.\n    const xy = block.getRelativeToSurfaceXY();\n    // Height/width is in workspace units.\n    const heightWidth = blockOnly\n      ? {height: block.height, width: block.width}\n      : block.getHeightWidth();\n\n    // Find the enter of the block in workspace units.\n    const blockCenterY = xy.y + heightWidth.height / 2;\n\n    // In RTL the block's position is the top right of the block, not top left.\n    const multiplier = this.RTL ? -1 : 1;\n    const blockCenterX = xy.x + (multiplier * heightWidth.width) / 2;\n\n    // Workspace scale, used to convert from workspace coordinates to pixels.\n    const scale = this.scale;\n\n    // Center of block in pixels, relative to workspace origin (center 0,0).\n    // Scrolling to here would put the block in the top-left corner of the\n    // visible workspace.\n    const pixelX = blockCenterX * scale;\n    const pixelY = blockCenterY * scale;\n\n    const metrics = this.getMetrics();\n\n    // viewHeight and viewWidth are in pixels.\n    const halfViewWidth = metrics.viewWidth / 2;\n    const halfViewHeight = metrics.viewHeight / 2;\n\n    // Put the block in the center of the visible workspace instead.\n    const scrollToCenterX = pixelX - halfViewWidth;\n    const scrollToCenterY = pixelY - halfViewHeight;\n\n    // Convert from workspace directions to canvas directions.\n    const x = -scrollToCenterX;\n    const y = -scrollToCenterY;\n\n    this.scroll(x, y);\n  }\n\n  /**\n   * Set the workspace's zoom factor.\n   *\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\n   */\n  setScale(newScale: number) {\n    if (\n      this.options.zoomOptions.maxScale &&\n      newScale > this.options.zoomOptions.maxScale\n    ) {\n      newScale = this.options.zoomOptions.maxScale;\n    } else if (\n      this.options.zoomOptions.minScale &&\n      newScale < this.options.zoomOptions.minScale\n    ) {\n      newScale = this.options.zoomOptions.minScale;\n    }\n    this.scale = newScale;\n\n    this.hideChaff(false);\n    // Get the flyout, if any, whether our own or owned by the toolbox.\n    const flyout = this.getFlyout(false);\n    if (flyout && flyout.isVisible()) {\n      flyout.reflow();\n      this.recordDragTargets();\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n\n    // We call scroll instead of scrollbar.resize() so that we can center the\n    // zoom correctly without scrollbars, but scroll does not resize the\n    // scrollbars so we have to call resizeView/resizeContent as well.\n    const metrics = this.getMetrics();\n\n    this.scrollX -= metrics.absoluteLeft;\n    this.scrollY -= metrics.absoluteTop;\n    // The scroll values and the view values are additive inverses of\n    // each other, so when we subtract from one we have to add to the other.\n    metrics.viewLeft += metrics.absoluteLeft;\n    metrics.viewTop += metrics.absoluteTop;\n\n    this.scroll(this.scrollX, this.scrollY);\n    if (this.scrollbar) {\n      if (this.flyout) {\n        this.scrollbar.resizeView(metrics);\n      } else {\n        this.scrollbar.resizeContent(metrics);\n      }\n    }\n  }\n\n  /**\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\n   * into the parent to get the workspace scale.\n   *\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\n   */\n  getScale(): number {\n    if (this.options.parentWorkspace) {\n      return this.options.parentWorkspace.getScale();\n    }\n    return this.scale;\n  }\n\n  /**\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\n   * the meaning of these values.\n   *\n   * @param x Target X to scroll to.\n   * @param y Target Y to scroll to.\n   * @internal\n   */\n  scroll(x: number, y: number) {\n    this.hideChaff(/* opt_onlyClosePopups= */ true);\n\n    // Keep scrolling within the bounds of the content.\n    const metrics = this.getMetrics();\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\n    // to workspace coordinates so we have to inverse them.\n    x = Math.min(x, -metrics.scrollLeft);\n    y = Math.min(y, -metrics.scrollTop);\n    const maxXDisplacement = Math.max(\n      0,\n      metrics.scrollWidth - metrics.viewWidth,\n    );\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\n    const maxYDisplacement = Math.max(\n      0,\n      metrics.scrollHeight - metrics.viewHeight,\n    );\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\n    x = Math.max(x, -maxXScroll);\n    y = Math.max(y, -maxYScroll);\n    this.scrollX = x;\n    this.scrollY = y;\n\n    if (this.scrollbar) {\n      // The content position (displacement from the content's top-left to the\n      // origin) plus the scroll position (displacement from the view's top-left\n      // to the origin) gives us the distance from the view's top-left to the\n      // content's top-left. Then we negate this so we get the displacement from\n      // the content's top-left to the view's top-left, matching the\n      // directionality of the scrollbars.\n      this.scrollbar.set(\n        -(x + metrics.scrollLeft),\n        -(y + metrics.scrollTop),\n        false,\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    x += metrics.absoluteLeft;\n    y += metrics.absoluteTop;\n    this.translate(x, y);\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  override getBlockById(id: string): BlockSvg | null {\n    return super.getBlockById(id) as BlockSvg;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getAllBlocks(ordered = false): BlockSvg[] {\n    return super.getAllBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  override getTopBlocks(ordered = false): BlockSvg[] {\n    return super.getTopBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  override addTopBlock(block: Block) {\n    this.addTopBoundedElement(block as BlockSvg);\n    super.addTopBlock(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  override removeTopBlock(block: Block) {\n    this.removeTopBoundedElement(block as BlockSvg);\n    super.removeTopBlock(block);\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   */\n  override addTopComment(comment: WorkspaceComment) {\n    this.addTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.addTopComment(comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   */\n  override removeTopComment(comment: WorkspaceComment) {\n    this.removeTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.removeTopComment(comment);\n  }\n\n  override getRootWorkspace(): WorkspaceSvg | null {\n    return super.getRootWorkspace() as WorkspaceSvg | null;\n  }\n\n  /**\n   * Adds a bounded element to the list of top bounded elements.\n   *\n   * @param element Bounded element to add.\n   */\n  addTopBoundedElement(element: IBoundedElement) {\n    this.topBoundedElements.push(element);\n  }\n\n  /**\n   * Removes a bounded element from the list of top bounded elements.\n   *\n   * @param element Bounded element to remove.\n   */\n  removeTopBoundedElement(element: IBoundedElement) {\n    arrayUtils.removeElem(this.topBoundedElements, element);\n  }\n\n  /**\n   * Finds the top-level bounded elements and returns them.\n   *\n   * @returns The top-level bounded elements.\n   */\n  getTopBoundedElements(): IBoundedElement[] {\n    return new Array<IBoundedElement>().concat(this.topBoundedElements);\n  }\n\n  /**\n   * Update whether this workspace has resizes enabled.\n   * If enabled, workspace will resize when appropriate.\n   * If disabled, workspace will not resize until re-enabled.\n   * Use to avoid resizing during a batch operation, for performance.\n   *\n   * @param enabled Whether resizes should be enabled.\n   */\n  setResizesEnabled(enabled: boolean) {\n    const reenabled = !this.resizesEnabled && enabled;\n    this.resizesEnabled = enabled;\n    if (reenabled) {\n      // Newly enabled.  Trigger a resize.\n      this.resizeContents();\n    }\n  }\n\n  /**\n   * Dispose of all blocks in workspace, with an optimization to prevent\n   * resizes.\n   */\n  override clear() {\n    this.setResizesEnabled(false);\n    super.clear();\n    this.topBoundedElements = [];\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   * For instance, a button specified by the XML\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\n   * should be matched by a call to\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given button is clicked.\n   */\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\n    if (typeof func !== 'function') {\n      throw TypeError('Button callbacks must be functions.');\n    }\n    this.flyoutButtonCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace;\n   *     null if no callback is registered.\n   */\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void) | null {\n    return this.flyoutButtonCallbacks.get(key) ?? null;\n  }\n\n  /**\n   * Remove a callback for a click on a button in the flyout.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeButtonCallback(key: string) {\n    this.flyoutButtonCallbacks.delete(key);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.  See the variable and\n   * procedure categories as an example.\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given toolbox category is opened.\n   */\n  registerToolboxCategoryCallback(\n    key: string,\n    func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition,\n  ) {\n    if (typeof func !== 'function') {\n      throw TypeError('Toolbox category callbacks must be functions.');\n    }\n    this.toolboxCategoryCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace, or\n   *     null if no function is registered.\n   */\n  getToolboxCategoryCallback(\n    key: string,\n  ): ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition) | null {\n    return this.toolboxCategoryCallbacks.get(key) || null;\n  }\n\n  /**\n   * Remove a callback for a click on a custom category's name in the toolbox.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeToolboxCategoryCallback(key: string) {\n    this.toolboxCategoryCallbacks.delete(key);\n  }\n\n  /**\n   * Look up the gesture that is tracking this touch stream on this workspace.\n   * May create a new gesture.\n   *\n   * @param e Pointer event.\n   * @returns The gesture that is tracking this touch stream, or null if no\n   *     valid gesture exists.\n   * @internal\n   */\n  getGesture(e: PointerEvent): Gesture | null {\n    const isStart = e.type === 'pointerdown';\n\n    const gesture = this.currentGesture_;\n    if (gesture) {\n      if (isStart && gesture.hasStarted()) {\n        console.warn('Tried to start the same gesture twice.');\n        // That's funny.  We must have missed a mouse up.\n        // Cancel it, rather than try to retrieve all of the state we need.\n        gesture.cancel();\n        return null;\n      }\n      return gesture;\n    }\n\n    // No gesture existed on this workspace, but this looks like the start of a\n    // new gesture.\n    if (isStart) {\n      this.currentGesture_ = new Gesture(e, this);\n      return this.currentGesture_;\n    }\n    // No gesture existed and this event couldn't be the start of a new gesture.\n    return null;\n  }\n\n  /**\n   * Clear the reference to the current gesture.\n   *\n   * @internal\n   */\n  clearGesture() {\n    this.currentGesture_ = null;\n  }\n\n  /**\n   * Cancel the current gesture, if one exists.\n   *\n   * @internal\n   */\n  cancelCurrentGesture() {\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n  }\n\n  /**\n   * Get the audio manager for this workspace.\n   *\n   * @returns The audio manager for this workspace.\n   */\n  getAudioManager(): WorkspaceAudio {\n    return this.audioManager;\n  }\n\n  /**\n   * Get the grid object for this workspace, or null if there is none.\n   *\n   * @returns The grid object for this workspace.\n   * @internal\n   */\n  getGrid(): Grid | null {\n    return this.grid;\n  }\n\n  /**\n   * Close tooltips, context menus, dropdown selections, etc.\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideChaff(onlyClosePopups = false) {\n    Tooltip.hide();\n    WidgetDiv.hide();\n    dropDownDiv.hideWithoutAnimation();\n\n    this.hideComponents(onlyClosePopups);\n  }\n\n  /**\n   * Hide any autohideable components (like flyout, trashcan, and any\n   * user-registered components).\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideComponents(onlyClosePopups = false) {\n    const autoHideables = this.getComponentManager().getComponents(\n      ComponentManager.Capability.AUTOHIDEABLE,\n      true,\n    );\n    autoHideables.forEach((autoHideable) =>\n      autoHideable.autoHide(onlyClosePopups),\n    );\n  }\n\n  /**\n   * Sets the X/Y translations of a top level workspace.\n   *\n   * @param xyRatio Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  private static setTopLevelWorkspaceMetrics_(\n    this: WorkspaceSvg,\n    xyRatio: {x?: number; y?: number},\n  ) {\n    const metrics = this.getMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.scrollX = -(\n        metrics.scrollLeft +\n        (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x\n      );\n    }\n    if (typeof xyRatio.y === 'number') {\n      this.scrollY = -(\n        metrics.scrollTop +\n        (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    const x = this.scrollX + metrics.absoluteLeft;\n    const y = this.scrollY + metrics.absoluteTop;\n    // We could call scroll here, but that has extra checks we don't need to do.\n    this.translate(x, y);\n  }\n}\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @internal\n */\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\n  workspace.resizeContents();\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICopyable\n\nimport type {ISelectable} from './i_selectable.js';\n\nexport interface ICopyable<T extends ICopyData> extends ISelectable {\n  /**\n   * Encode for copying.\n   *\n   * @returns Copy metadata.\n   */\n  toCopyData(): T | null;\n}\n\nexport namespace ICopyable {\n  export interface ICopyData {\n    paster: string;\n  }\n}\n\nexport type ICopyData = ICopyable.ICopyData;\n\n/** @returns true if the given object is copyable. */\nexport function isCopyable(obj: any): obj is ICopyable<ICopyData> {\n  return obj.toCopyData !== undefined;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ShortcutItems\n\nimport {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {Gesture} from './gesture.js';\nimport {ICopyData, isCopyable} from './interfaces/i_copyable.js';\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Object holding the names of the default shortcut items.\n */\nexport enum names {\n  ESCAPE = 'escape',\n  DELETE = 'delete',\n  COPY = 'copy',\n  CUT = 'cut',\n  PASTE = 'paste',\n  UNDO = 'undo',\n  REDO = 'redo',\n}\n\n/**\n * Keyboard shortcut to hide chaff on escape.\n */\nexport function registerEscape() {\n  const escapeAction: KeyboardShortcut = {\n    name: names.ESCAPE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      return true;\n    },\n    keyCodes: [KeyCodes.ESC],\n  };\n  ShortcutRegistry.registry.register(escapeAction);\n}\n\n/**\n * Keyboard shortcut to delete a block on delete or backspace\n */\nexport function registerDelete() {\n  const deleteShortcut: KeyboardShortcut = {\n    name: names.DELETE,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        selected != null &&\n        selected.isDeletable()\n      );\n    },\n    callback(workspace, e) {\n      // Delete or backspace.\n      // Stop the browser from going back to the previous page.\n      // Do this first to prevent an error in the delete code from resulting in\n      // data loss.\n      e.preventDefault();\n      // Don't delete while dragging.  Jeez.\n      if (Gesture.inProgress()) {\n        return false;\n      }\n      (common.getSelected() as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\n  };\n  ShortcutRegistry.registry.register(deleteShortcut);\n}\n\nlet copyData: ICopyData | null = null;\nlet copyWorkspace: WorkspaceSvg | null = null;\n\n/**\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\n */\nexport function registerCopy() {\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.CTRL,\n  ]);\n  const altC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.ALT,\n  ]);\n  const metaC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.META,\n  ]);\n\n  const copyShortcut: KeyboardShortcut = {\n    name: names.COPY,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        selected.isDeletable() &&\n        selected.isMovable() &&\n        isCopyable(selected)\n      );\n    },\n    callback(workspace, e) {\n      // Prevent the default copy behavior, which may beep or otherwise indicate\n      // an error due to the lack of a selection.\n      e.preventDefault();\n      workspace.hideChaff();\n      const selected = common.getSelected();\n      if (!selected || !isCopyable(selected)) return false;\n      copyData = selected.toCopyData();\n      copyWorkspace = workspace;\n      return !!copyData;\n    },\n    keyCodes: [ctrlC, altC, metaC],\n  };\n  ShortcutRegistry.registry.register(copyShortcut);\n}\n\n/**\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\n */\nexport function registerCut() {\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.CTRL,\n  ]);\n  const altX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.ALT,\n  ]);\n  const metaX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.META,\n  ]);\n\n  const cutShortcut: KeyboardShortcut = {\n    name: names.CUT,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        selected instanceof BlockSvg &&\n        selected.isDeletable() &&\n        selected.isMovable() &&\n        !selected.workspace!.isFlyout\n      );\n    },\n    callback(workspace) {\n      const selected = common.getSelected();\n      if (!selected || !isCopyable(selected)) return false;\n      copyData = selected.toCopyData();\n      copyWorkspace = workspace;\n      (selected as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [ctrlX, altX, metaX],\n  };\n\n  ShortcutRegistry.registry.register(cutShortcut);\n}\n\n/**\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\n */\nexport function registerPaste() {\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.CTRL,\n  ]);\n  const altV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.ALT,\n  ]);\n  const metaV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.META,\n  ]);\n\n  const pasteShortcut: KeyboardShortcut = {\n    name: names.PASTE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback() {\n      if (!copyData || !copyWorkspace) return false;\n      return !!clipboard.paste(copyData, copyWorkspace);\n    },\n    keyCodes: [ctrlV, altV, metaV],\n  };\n\n  ShortcutRegistry.registry.register(pasteShortcut);\n}\n\n/**\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\n */\nexport function registerUndo() {\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.CTRL,\n  ]);\n  const altZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.ALT,\n  ]);\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.META,\n  ]);\n\n  const undoShortcut: KeyboardShortcut = {\n    name: names.UNDO,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(false);\n      return true;\n    },\n    keyCodes: [ctrlZ, altZ, metaZ],\n  };\n  ShortcutRegistry.registry.register(undoShortcut);\n}\n\n/**\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\n * or alt+shift+z.\n */\nexport function registerRedo() {\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.CTRL,\n  ]);\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.ALT,\n  ]);\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.META,\n  ]);\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Y, [\n    KeyCodes.CTRL,\n  ]);\n\n  const redoShortcut: KeyboardShortcut = {\n    name: names.REDO,\n    preconditionFn(workspace) {\n      return !Gesture.inProgress() && !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(true);\n      return true;\n    },\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\n  };\n  ShortcutRegistry.registry.register(redoShortcut);\n}\n\n/**\n * Registers all default keyboard shortcut item. This should be called once per\n * instance of KeyboardShortcutRegistry.\n *\n * @internal\n */\nexport function registerDefaultShortcuts() {\n  registerEscape();\n  registerDelete();\n  registerCopy();\n  registerCut();\n  registerPaste();\n  registerUndo();\n  registerRedo();\n}\n\nregisterDefaultShortcuts();\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as priorities from './priorities.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Representation of a procedure data model.\n */\nexport interface State {\n  // TODO: This should also handle enabled.\n  id: string;\n  name: string;\n  returnTypes: string[] | null;\n  parameters?: ParameterState[];\n}\n\n/**\n * Representation of a parameter data model.\n */\nexport interface ParameterState {\n  id: string;\n  name: string;\n  types?: string[];\n}\n\n/**\n * A newable signature for an IProcedureModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ProcedureModelConstructor<ProcedureModel extends IProcedureModel> = new (\n  workspace: Workspace,\n  name: string,\n  id: string,\n) => ProcedureModel;\n\n/**\n * A newable signature for an IParameterModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ParameterModelConstructor<ParameterModel extends IParameterModel> = new (\n  workspace: Workspace,\n  name: string,\n  id: string,\n) => ParameterModel;\n\n/**\n * Serializes the given IProcedureModel to JSON.\n *\n * @internal\n */\nexport function saveProcedure(proc: IProcedureModel): State {\n  const state: State = {\n    id: proc.getId(),\n    name: proc.getName(),\n    returnTypes: proc.getReturnTypes(),\n  };\n  if (!proc.getParameters().length) return state;\n  state.parameters = proc.getParameters().map((param) => saveParameter(param));\n  return state;\n}\n\n/**\n * Serializes the given IParameterModel to JSON.\n *\n * @internal\n */\nexport function saveParameter(param: IParameterModel): ParameterState {\n  const state: ParameterState = {\n    id: param.getId(),\n    name: param.getName(),\n  };\n  if (!param.getTypes().length) return state;\n  state.types = param.getTypes();\n  return state;\n}\n\n/**\n * Deserializes the given procedure model State from JSON.\n *\n * @internal\n */\nexport function loadProcedure<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n>(\n  procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  state: State,\n  workspace: Workspace,\n): ProcedureModel {\n  const proc = new procedureModelClass(\n    workspace,\n    state.name,\n    state.id,\n  ).setReturnTypes(state.returnTypes);\n  if (!state.parameters) return proc;\n  for (const [index, param] of state.parameters.entries()) {\n    proc.insertParameter(\n      loadParameter(parameterModelClass, param, workspace),\n      index,\n    );\n  }\n  return proc;\n}\n\n/**\n * Deserializes the given ParameterState from JSON.\n *\n * @internal\n */\nexport function loadParameter<ParameterModel extends IParameterModel>(\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  state: ParameterState,\n  workspace: Workspace,\n): ParameterModel {\n  const model = new parameterModelClass(workspace, state.name, state.id);\n  if (state.types) model.setTypes(state.types);\n  return model;\n}\n\n/** Serializer for saving and loading procedure state. */\nexport class ProcedureSerializer<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n> implements ISerializer\n{\n  public priority = priorities.PROCEDURES;\n\n  /**\n   * Constructs the procedure serializer.\n   *\n   * Example usage:\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\n   *\n   * @param procedureModelClass The class (implementing IProcedureModel) that\n   *     you want this serializer to deserialize.\n   * @param parameterModelClass The class (implementing IParameterModel) that\n   *     you want this serializer to deserialize.\n   */\n  constructor(\n    private readonly procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n    private readonly parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  ) {}\n\n  /** Serializes the procedure models of the given workspace. */\n  save(workspace: Workspace): State[] | null {\n    const save = workspace\n      .getProcedureMap()\n      .getProcedures()\n      .map((proc) => saveProcedure(proc));\n    return save.length ? save : null;\n  }\n\n  /**\n   * Deserializes the procedures models defined by the given state into the\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    const map = workspace.getProcedureMap();\n    for (const procState of state) {\n      map.add(\n        loadProcedure(\n          this.procedureModelClass,\n          this.parameterModelClass,\n          procState,\n          workspace,\n        ),\n      );\n    }\n  }\n\n  /** Disposes of any procedure models that exist on the workspace. */\n  clear(workspace: Workspace) {\n    workspace.getProcedureMap().clear();\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.workspaces\n\nimport * as eventUtils from '../events/utils.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\n// eslint-disable-next-line no-unused-vars\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Returns the state of the workspace as a plain JavaScript object.\n *\n * @param workspace The workspace to serialize.\n * @returns The serialized state of the workspace.\n */\nexport function save(workspace: Workspace): {\n  [key: string]: AnyDuringMigration;\n} {\n  const state = Object.create(null);\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  for (const key in serializerMap) {\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\n    if (save) {\n      state[key] = save;\n    }\n  }\n  return state;\n}\n\n/**\n * Loads the variable represented by the given state into the given workspace.\n *\n * @param state The state of the workspace to deserialize into the workspace.\n * @param workspace The workspace to add the new state to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n */\nexport function load(\n  state: {[key: string]: AnyDuringMigration},\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n) {\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  if (!serializerMap) {\n    return;\n  }\n\n  const deserializers = Object.entries(serializerMap).sort(\n    (a, b) => (b[1] as ISerializer)!.priority - (a[1] as ISerializer)!.priority,\n  );\n\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  dom.startTextWidthCache();\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(false);\n  }\n\n  // We want to trigger clearing in reverse priority order so plugins don't end\n  // up missing dependencies.\n  for (const [, deserializer] of deserializers.reverse()) {\n    (deserializer as ISerializer)?.clear(workspace);\n  }\n\n  // reverse() is destructive, so we have to re-reverse to correct the order.\n  for (let [name, deserializer] of deserializers.reverse()) {\n    name = name;\n    const pluginState = state[name];\n    if (pluginState) {\n      (deserializer as ISerializer)?.load(state[name], workspace);\n    }\n  }\n\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(true);\n  }\n  dom.stopTextWidthCache();\n\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.bumpObjects\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockCreate} from './events/events_block_create.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport type {CommentCreate} from './events/events_comment_create.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport type {ViewportChange} from './events/events_viewport.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport * as mathUtils from './utils/math.js';\nimport type {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Bumps the given object that has passed out of bounds.\n *\n * @param workspace The workspace containing the object.\n * @param bounds The region to bump an object into. For example, pass\n *     ScrollMetrics to bump a block into the scrollable region of the\n *     workspace, or pass ViewMetrics to bump a block into the visible region of\n *     the workspace. This should be specified in workspace coordinates.\n * @param object The object to bump.\n * @returns True if object was bumped.\n */\nfunction bumpObjectIntoBounds(\n  workspace: WorkspaceSvg,\n  bounds: ContainerRegion,\n  object: IBoundedElement,\n): boolean {\n  // Compute new top/left position for object.\n  const objectMetrics = object.getBoundingRectangle();\n  const height = objectMetrics.bottom - objectMetrics.top;\n  const width = objectMetrics.right - objectMetrics.left;\n\n  const topClamp = bounds.top;\n  const boundsBottom = bounds.top + bounds.height;\n  const bottomClamp = boundsBottom - height;\n  // If the object is taller than the workspace we want to\n  // top-align the block\n  const newYPosition = mathUtils.clamp(\n    topClamp,\n    objectMetrics.top,\n    bottomClamp,\n  );\n  const deltaY = newYPosition - objectMetrics.top;\n\n  // Note: Even in RTL mode the \"anchor\" of the object is the\n  // top-left corner of the object.\n  let leftClamp = bounds.left;\n  const boundsRight = bounds.left + bounds.width;\n  let rightClamp = boundsRight - width;\n  if (workspace.RTL) {\n    // If the object is wider than the workspace and we're in RTL\n    // mode we want to right-align the block, which means setting\n    // the left clamp to match.\n    leftClamp = Math.min(rightClamp, leftClamp);\n  } else {\n    // If the object is wider than the workspace and we're in LTR\n    // mode we want to left-align the block, which means setting\n    // the right clamp to match.\n    rightClamp = Math.max(leftClamp, rightClamp);\n  }\n  const newXPosition = mathUtils.clamp(\n    leftClamp,\n    objectMetrics.left,\n    rightClamp,\n  );\n  const deltaX = newXPosition - objectMetrics.left;\n\n  if (deltaX || deltaY) {\n    object.moveBy(deltaX, deltaY, ['inbounds']);\n    return true;\n  }\n  return false;\n}\nexport const bumpIntoBounds = bumpObjectIntoBounds;\n\n/**\n * Creates a handler for bumping objects when they cross fixed bounds.\n *\n * @param workspace The workspace to handle.\n * @returns The event handler.\n */\nexport function bumpIntoBoundsHandler(\n  workspace: WorkspaceSvg,\n): (p1: Abstract) => void {\n  return (e) => {\n    const metricsManager = workspace.getMetricsManager();\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n      return;\n    }\n\n    if (eventUtils.BUMP_EVENTS.indexOf(e.type ?? '') !== -1) {\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n\n      // Triggered by move/create event\n      const object = extractObjectFromEvent(\n        workspace,\n        e as eventUtils.BumpEvent,\n      );\n      if (!object) {\n        return;\n      }\n      // Handle undo.\n      const existingGroup = eventUtils.getGroup() || false;\n      eventUtils.setGroup(e.group);\n\n      const wasBumped = bumpObjectIntoBounds(\n        workspace,\n        scrollMetricsInWsCoords,\n        object as IBoundedElement,\n      );\n\n      if (wasBumped && !e.group) {\n        console.warn(\n          'Moved object in bounds but there was no' +\n            ' event group. This may break undo.',\n        );\n      }\n      eventUtils.setGroup(existingGroup);\n    } else if (e.type === eventUtils.VIEWPORT_CHANGE) {\n      const viewportEvent = e as ViewportChange;\n      if (\n        viewportEvent.scale &&\n        viewportEvent.oldScale &&\n        viewportEvent.scale > viewportEvent.oldScale\n      ) {\n        bumpTopObjectsIntoBounds(workspace);\n      }\n    }\n  };\n}\n\n/**\n * Extracts the object from the given event.\n *\n * @param workspace The workspace the event originated\n *    from.\n * @param e An event containing an object.\n * @returns The extracted\n *    object.\n */\nfunction extractObjectFromEvent(\n  workspace: WorkspaceSvg,\n  e: eventUtils.BumpEvent,\n): BlockSvg | null | WorkspaceCommentSvg {\n  let object = null;\n  switch (e.type) {\n    case eventUtils.BLOCK_CREATE:\n    case eventUtils.BLOCK_MOVE:\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\n      if (object) {\n        object = object.getRootBlock();\n      }\n      break;\n    case eventUtils.COMMENT_CREATE:\n    case eventUtils.COMMENT_MOVE:\n      object = workspace.getCommentById(\n        (e as CommentCreate | CommentMove).commentId!,\n      ) as WorkspaceCommentSvg | null;\n      break;\n  }\n  return object;\n}\n\n/**\n * Bumps the top objects in the given workspace into bounds.\n *\n * @param workspace The workspace.\n */\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\n  const metricsManager = workspace.getMetricsManager();\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n    return;\n  }\n\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n  const topBlocks = workspace.getTopBoundedElements();\n  for (let i = 0, block; (block = topBlocks[i]); i++) {\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a block visually.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BlockDragger\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_drag.js';\n\nimport * as blockAnimation from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Icon} from './icons/icon.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport * as registry from './registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {hasBubble} from './interfaces/i_has_bubble.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as layers from './layers.js';\n\n/**\n * Class for a block dragger.  It moves blocks around the workspace when they\n * are being dragged by a mouse or touch.\n */\nexport class BlockDragger implements IBlockDragger {\n  /** The top block in the stack that is being dragged. */\n  protected draggingBlock_: BlockSvg;\n  protected draggedConnectionManager_: InsertionMarkerManager;\n\n  /** The workspace on which the block is being dragged. */\n  protected workspace_: WorkspaceSvg;\n\n  /** Which drag area the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget | null = null;\n\n  /** Whether the block would be deleted if dropped immediately. */\n  protected wouldDeleteBlock_ = false;\n  protected startXY_: Coordinate;\n\n  /**\n   * @deprecated To be removed in v11. Updating icons is now handled by the\n   *     block's `moveDuringDrag` method.\n   */\n  protected dragIconData_: IconPositionData[] = [];\n\n  /**\n   * @param block The block to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(block: BlockSvg, workspace: WorkspaceSvg) {\n    this.draggingBlock_ = block;\n\n    /** Object that keeps track of connections on dragged blocks. */\n    this.draggedConnectionManager_ = new InsertionMarkerManager(\n      this.draggingBlock_,\n    );\n\n    this.workspace_ = workspace;\n\n    /**\n     * The location of the top left corner of the dragging block at the\n     * beginning of the drag in workspace coordinates.\n     */\n    this.startXY_ = this.draggingBlock_.getRelativeToSurfaceXY();\n\n    this.dragIconData_ = initIconData(block, this.startXY_);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.dragIconData_.length = 0;\n    if (this.draggedConnectionManager_) {\n      this.draggedConnectionManager_.dispose();\n    }\n  }\n\n  /**\n   * Start dragging a block.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean) {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent_();\n\n    // The z-order of blocks depends on their order in the SVG, so move the\n    // block being dragged to the front so that it will appear atop other blocks\n    // in the workspace.\n    this.draggingBlock_.bringToFront(true);\n\n    // During a drag there may be a lot of rerenders, but not field changes.\n    // Turn the cache on so we don't do spurious remeasures during the drag.\n    dom.startTextWidthCache();\n    this.workspace_.setResizesEnabled(false);\n    blockAnimation.disconnectUiStop();\n\n    if (this.shouldDisconnect_(healStack)) {\n      this.disconnectBlock_(healStack, currentDragDeltaXY);\n    }\n    this.draggingBlock_.setDragging(true);\n    this.workspace_.getLayerManager()?.moveToDragLayer(this.draggingBlock_);\n  }\n\n  /**\n   * Whether or not we should disconnect the block when a drag is started.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @returns True to disconnect the block, false otherwise.\n   */\n  protected shouldDisconnect_(healStack: boolean): boolean {\n    return !!(\n      this.draggingBlock_.getParent() ||\n      (healStack &&\n        this.draggingBlock_.nextConnection &&\n        this.draggingBlock_.nextConnection.targetBlock())\n    );\n  }\n\n  /**\n   * Disconnects the block and moves it to a new location.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   */\n  protected disconnectBlock_(\n    healStack: boolean,\n    currentDragDeltaXY: Coordinate,\n  ) {\n    this.draggingBlock_.unplug(healStack);\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n\n    this.draggingBlock_.translate(newLoc.x, newLoc.y);\n    blockAnimation.disconnectUiEffect(this.draggingBlock_);\n    this.draggedConnectionManager_.updateAvailableConnections();\n  }\n\n  /** Fire a UI event at the start of a block drag. */\n  protected fireDragStartEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n      this.draggingBlock_,\n      true,\n      this.draggingBlock_.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Execute a step of block dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  drag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.draggingBlock_.moveDuringDrag(newLoc);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace_.getDragTarget(e);\n\n    this.draggedConnectionManager_.update(delta, this.dragTarget_);\n    const oldWouldDeleteBlock = this.wouldDeleteBlock_;\n    this.wouldDeleteBlock_ = this.draggedConnectionManager_.wouldDeleteBlock;\n    if (oldWouldDeleteBlock !== this.wouldDeleteBlock_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBlockDrag_();\n    }\n\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // InsertionMarkerManager.update.\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.draggingBlock_);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.draggingBlock_);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.draggingBlock_);\n  }\n\n  /**\n   * Finish a block drag and put the block back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  endDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.drag(e, currentDragDeltaXY);\n    this.fireDragEndEvent_();\n\n    dom.stopTextWidthCache();\n\n    blockAnimation.disconnectUiStop();\n\n    const preventMove =\n      !!this.dragTarget_ &&\n      this.dragTarget_.shouldPreventMove(this.draggingBlock_);\n    let delta: Coordinate | null = null;\n    if (!preventMove) {\n      const newValues = this.getNewLocationAfterDrag_(currentDragDeltaXY);\n      delta = newValues.delta;\n    }\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.draggingBlock_);\n    }\n\n    const deleted = this.maybeDeleteBlock_();\n    if (!deleted) {\n      // These are expensive and don't need to be done if we're deleting.\n      this.workspace_\n        .getLayerManager()\n        ?.moveOffDragLayer(this.draggingBlock_, layers.BLOCK);\n      this.draggingBlock_.setDragging(false);\n      if (delta) {\n        // !preventMove\n        this.updateBlockAfterMove_();\n      } else {\n        // Blocks dragged directly from a flyout may need to be bumped into\n        // bounds.\n        bumpObjects.bumpIntoBounds(\n          this.draggingBlock_.workspace,\n          this.workspace_.getMetricsManager().getScrollMetrics(true),\n          this.draggingBlock_,\n        );\n      }\n    }\n    this.workspace_.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Calculates the drag delta and new location values after a block is dragged.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the start of\n   *     the drag, in pixel units.\n   * @returns New location after drag. delta is in workspace units. newLocation\n   *     is the new coordinate where the block should end up.\n   */\n  protected getNewLocationAfterDrag_(currentDragDeltaXY: Coordinate): {\n    delta: Coordinate;\n    newLocation: Coordinate;\n  } {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLocation = Coordinate.sum(this.startXY_, delta);\n    return {\n      delta,\n      newLocation,\n    };\n  }\n\n  /**\n   * May delete the dragging block, if allowed. If `this.wouldDeleteBlock_` is\n   * not true, the block will not be deleted. This should be called at the end\n   * of a block drag.\n   *\n   * @returns True if the block was deleted.\n   */\n  protected maybeDeleteBlock_(): boolean {\n    if (this.wouldDeleteBlock_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.draggingBlock_.dispose(false, true);\n      common.draggingConnections.length = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Updates the necessary information to place a block at a certain location.\n   */\n  protected updateBlockAfterMove_() {\n    this.fireMoveEvent_();\n    if (this.draggedConnectionManager_.wouldConnectBlock()) {\n      // Applying connections also rerenders the relevant blocks.\n      this.draggedConnectionManager_.applyConnections();\n    } else {\n      this.draggingBlock_.queueRender();\n    }\n    this.draggingBlock_.scheduleSnapAndBump();\n  }\n\n  /** Fire a UI event at the end of a block drag. */\n  protected fireDragEndEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n      this.draggingBlock_,\n      false,\n      this.draggingBlock_.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Adds or removes the style of the cursor for the toolbox.\n   * This is what changes the cursor to display an x when a deletable block is\n   * held over the toolbox.\n   *\n   * @param isEnd True if we are at the end of a drag, false otherwise.\n   */\n  protected updateToolboxStyle_(isEnd: boolean) {\n    const toolbox = this.workspace_.getToolbox();\n\n    if (toolbox) {\n      const style = this.draggingBlock_.isDeletable()\n        ? 'blocklyToolboxDelete'\n        : 'blocklyToolboxGrab';\n\n      // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n      // type 'IToolbox'.\n      if (\n        isEnd &&\n        typeof (toolbox as AnyDuringMigration).removeStyle === 'function'\n      ) {\n        // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).removeStyle(style);\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n      } else if (\n        !isEnd &&\n        typeof (toolbox as AnyDuringMigration).addStyle === 'function'\n      ) {\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).addStyle(style);\n      }\n    }\n  }\n\n  /** Fire a move event at the end of a block drag. */\n  protected fireMoveEvent_() {\n    if (this.draggingBlock_.isDeadOrDying()) return;\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n      this.draggingBlock_,\n    ) as BlockMove;\n    event.setReason(['drag']);\n    event.oldCoordinate = this.startXY_;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging block would be deleted if released immediately.\n   */\n  protected updateCursorDuringBlockDrag_() {\n    this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_);\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  protected pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n      pixelCoord.x / this.workspace_.scale,\n      pixelCoord.y / this.workspace_.scale,\n    );\n    if (this.workspace_.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace_.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n\n  /**\n   * Move all of the icons connected to this drag.\n   *\n   * @deprecated To be removed in v11. This is now handled by the block's\n   *     `moveDuringDrag` method.\n   */\n  protected dragIcons_() {\n    deprecation.warn('Blockly.BlockDragger.prototype.dragIcons_', 'v10', 'v11');\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    // No insertion markers with the old style of dragged connection managers.\n    if (\n      this.draggedConnectionManager_ &&\n      this.draggedConnectionManager_.getInsertionMarkers\n    ) {\n      return this.draggedConnectionManager_.getInsertionMarkers();\n    }\n    return [];\n  }\n}\n\n/** Data about the position of a given icon. */\nexport interface IconPositionData {\n  location: Coordinate;\n  icon: Icon;\n}\n\n/**\n * Make a list of all of the icons (comment, warning, and mutator) that are\n * on this block and its descendants.  Moving an icon moves the bubble that\n * extends from it if that bubble is open.\n *\n * @param block The root block that is being dragged.\n * @param blockOrigin The top left of the given block in workspace coordinates.\n * @returns The list of all icons and their locations.\n */\nfunction initIconData(\n  block: BlockSvg,\n  blockOrigin: Coordinate,\n): IconPositionData[] {\n  // Build a list of icons that need to be moved and where they started.\n  const dragIconData = [];\n\n  for (const icon of block.getIcons()) {\n    // Only bother to track icons whose bubble is visible.\n    if (hasBubble(icon) && !icon.bubbleIsVisible()) continue;\n\n    dragIconData.push({location: blockOrigin, icon: icon});\n    icon.onLocationChange(blockOrigin);\n  }\n\n  for (const child of block.getChildren(false)) {\n    dragIconData.push(\n      ...initIconData(child, Coordinate.sum(blockOrigin, child.relativeCoords)),\n    );\n  }\n  // AnyDuringMigration because:  Type '{ location: Coordinate | null; icon:\n  // Icon; }[]' is not assignable to type 'IconPositionData[]'.\n  return dragIconData as AnyDuringMigration;\n}\n\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, BlockDragger);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenuItems\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport {\n  ContextMenuRegistry,\n  RegistryItem,\n  Scope,\n} from './contextmenu_registry.js';\nimport * as dialog from './dialog.js';\nimport * as Events from './events/events.js';\nimport * as eventUtils from './events/utils.js';\nimport {CommentIcon} from './icons/comment_icon.js';\nimport {Msg} from './msg.js';\nimport {StatementInput} from './renderers/zelos/zelos.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Option to undo previous action.\n */\nexport function registerUndo() {\n  const undoOption: RegistryItem = {\n    displayText() {\n      return Msg['UNDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getUndoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'undoWorkspace',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(undoOption);\n}\n\n/**\n * Option to redo previous action.\n */\nexport function registerRedo() {\n  const redoOption: RegistryItem = {\n    displayText() {\n      return Msg['REDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getRedoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(true);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'redoWorkspace',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(redoOption);\n}\n\n/**\n * Option to clean up blocks.\n */\nexport function registerCleanup() {\n  const cleanOption: RegistryItem = {\n    displayText() {\n      return Msg['CLEAN_UP'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.isMovable()) {\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.cleanUp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'cleanWorkspace',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(cleanOption);\n}\n/**\n * Creates a callback to collapse or expand top blocks.\n *\n * @param shouldCollapse Whether a block should collapse.\n * @param topBlocks Top blocks in the workspace.\n */\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\n  const DELAY = 10;\n  let ms = 0;\n  let timeoutCounter = 0;\n  function timeoutFn(block: BlockSvg) {\n    timeoutCounter--;\n    block.setCollapsed(shouldCollapse);\n    if (timeoutCounter === 0) {\n      Events.setGroup(false);\n    }\n  }\n  Events.setGroup(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    let block: BlockSvg | null = topBlocks[i];\n    while (block) {\n      timeoutCounter++;\n      setTimeout(timeoutFn.bind(null, block), ms);\n      block = block.getNextBlock();\n      ms += DELAY;\n    }\n  }\n}\n\n/**\n * Option to collapse all blocks.\n */\nexport function registerCollapse() {\n  const collapseOption: RegistryItem = {\n    displayText() {\n      return Msg['COLLAPSE_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (!block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'collapseWorkspace',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseOption);\n}\n\n/**\n * Option to expand all blocks.\n */\nexport function registerExpand() {\n  const expandOption: RegistryItem = {\n    displayText() {\n      return Msg['EXPAND_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'expandWorkspace',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(expandOption);\n}\n/**\n * Adds a block and its children to a list of deletable blocks.\n *\n * @param block to delete.\n * @param deleteList list of blocks that can be deleted.\n *     This will be modified in place with the given block and its descendants.\n */\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\n  if (block.isDeletable()) {\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\n  } else {\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      addDeletableBlocks_(children[i], deleteList);\n    }\n  }\n}\n\n/**\n * Constructs a list of blocks that can be deleted in the given workspace.\n *\n * @param workspace to delete all blocks from.\n * @returns list of blocks to delete.\n */\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\n  const deleteList: BlockSvg[] = [];\n  const topBlocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    addDeletableBlocks_(topBlocks[i], deleteList);\n  }\n  return deleteList;\n}\n\n/**\n * Deletes the given blocks. Used to delete all blocks in the workspace.\n *\n * @param deleteList List of blocks to delete.\n * @param eventGroup Event group ID with which all delete events should be\n *     associated.  If not specified, create a new group.\n */\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup?: string) {\n  const DELAY = 10;\n  if (eventGroup) {\n    eventUtils.setGroup(eventGroup);\n  } else {\n    eventUtils.setGroup(true);\n    eventGroup = eventUtils.getGroup();\n  }\n  const block = deleteList.shift();\n  if (block) {\n    if (!block.isDeadOrDying()) {\n      block.dispose(false, true);\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\n    } else {\n      deleteNext_(deleteList, eventGroup);\n    }\n  }\n  eventUtils.setGroup(false);\n}\n\n/**\n * Option to delete all blocks.\n */\nexport function registerDeleteAll() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      if (deletableBlocksLength === 1) {\n        return Msg['DELETE_BLOCK'];\n      }\n      return Msg['DELETE_X_BLOCKS'].replace('%1', `${deletableBlocksLength}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.workspace) {\n        return 'disabled';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\n    },\n    callback(scope: Scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      scope.workspace.cancelCurrentGesture();\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\n      if (deletableBlocks.length < 2) {\n        deleteNext_(deletableBlocks);\n      } else {\n        dialog.confirm(\n          Msg['DELETE_ALL_BLOCKS'].replace(\n            '%1',\n            String(deletableBlocks.length),\n          ),\n          function (ok) {\n            if (ok) {\n              deleteNext_(deletableBlocks);\n            }\n          },\n        );\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'workspaceDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n/** Registers all workspace-scoped context menu items. */\nfunction registerWorkspaceOptions_() {\n  registerUndo();\n  registerRedo();\n  registerCleanup();\n  registerCollapse();\n  registerExpand();\n  registerDeleteAll();\n}\n\n/**\n * Option to duplicate a block.\n */\nexport function registerDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText() {\n      return Msg['DUPLICATE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\n        if (block!.isDuplicatable()) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (!scope.block) return;\n      const data = scope.block.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, scope.block.workspace);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/**\n * Option to add or remove block-level comment.\n */\nexport function registerComment() {\n  const commentOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (scope.block!.hasIcon(CommentIcon.TYPE)) {\n        // If there's already a comment,  option is to remove.\n        return Msg['REMOVE_COMMENT'];\n      }\n      // If there's no comment yet, option is to add.\n      return Msg['ADD_COMMENT'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.comments &&\n        !block!.isCollapsed() &&\n        block!.isEditable()\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      if (block!.hasIcon(CommentIcon.TYPE)) {\n        block!.setCommentText(null);\n      } else {\n        block!.setCommentText('');\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockComment',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(commentOption);\n}\n\n/**\n * Option to inline variables.\n */\nexport function registerInline() {\n  const inlineOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.getInputsInline()\n        ? Msg['EXTERNAL_INPUTS']\n        : Msg['INLINE_INPUTS'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\n        for (let i = 1; i < block!.inputList.length; i++) {\n          // Only display this option if there are two value or dummy inputs\n          // next to each other.\n          if (\n            !(block!.inputList[i - 1] instanceof StatementInput) &&\n            !(block!.inputList[i] instanceof StatementInput)\n          ) {\n            return 'enabled';\n          }\n        }\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockInline',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(inlineOption);\n}\n\n/**\n * Option to collapse or expand a block.\n */\nexport function registerCollapseExpandBlock() {\n  const collapseExpandOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isCollapsed()\n        ? Msg['EXPAND_BLOCK']\n        : Msg['COLLAPSE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.isMovable() &&\n        block!.workspace.options.collapse\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockCollapseExpand',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseExpandOption);\n}\n\n/**\n * Option to disable or enable a block.\n */\nexport function registerDisable() {\n  const disableOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isEnabled()\n        ? Msg['DISABLE_BLOCK']\n        : Msg['ENABLE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.disable &&\n        block!.isEditable()\n      ) {\n        if (block!.getInheritedDisabled()) {\n          return 'disabled';\n        }\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      block!.setEnabled(!block!.isEnabled());\n      eventUtils.setGroup(existingGroup);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDisable',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(disableOption);\n}\n\n/**\n * Option to delete a block.\n */\nexport function registerDelete() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      const block = scope.block;\n      // Count the number of blocks that are nested in this block.\n      let descendantCount = block!.getDescendants(false).length;\n      const nextBlock = block!.getNextBlock();\n      if (nextBlock) {\n        // Blocks in the current stack would survive this block's deletion.\n        descendantCount -= nextBlock.getDescendants(false).length;\n      }\n      return descendantCount === 1\n        ? Msg['DELETE_BLOCK']\n        : Msg['DELETE_X_BLOCKS'].replace('%1', `${descendantCount}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        scope.block.checkAndDelete();\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/**\n * Option to open help for a block.\n */\nexport function registerHelp() {\n  const helpOption: RegistryItem = {\n    displayText() {\n      return Msg['HELP'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      const url =\n        typeof block!.helpUrl === 'function'\n          ? block!.helpUrl()\n          : block!.helpUrl;\n      if (url) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.showHelp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockHelp',\n    weight: 7,\n  };\n  ContextMenuRegistry.registry.register(helpOption);\n}\n\n/** Registers all block-scoped context menu items. */\nfunction registerBlockOptions_() {\n  registerDuplicate();\n  registerComment();\n  registerInline();\n  registerCollapseExpandBlock();\n  registerDisable();\n  registerDelete();\n  registerHelp();\n}\n\n/**\n * Registers all default context menu items. This should be called once per\n * instance of ContextMenuRegistry.\n *\n * @internal\n */\nexport function registerDefaultOptions() {\n  registerWorkspaceOptions_();\n  registerBlockOptions_();\n}\n\nregisterDefaultOptions();\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inject\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Grid} from './grid.js';\nimport {Msg} from './msg.js';\nimport {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n *\n * @param container Containing element, or its ID, or a CSS selector.\n * @param opt_options Optional dictionary of options.\n * @returns Newly created main workspace.\n */\nexport function inject(\n  container: Element | string,\n  opt_options?: BlocklyOptions,\n): WorkspaceSvg {\n  let containerElement: Element | null = null;\n  if (typeof container === 'string') {\n    containerElement =\n      document.getElementById(container) || document.querySelector(container);\n  } else {\n    containerElement = container;\n  }\n  // Verify that the container is in document.\n  if (\n    !document.contains(containerElement) &&\n    document !== containerElement?.ownerDocument\n  ) {\n    throw Error('Error: container is not in current document');\n  }\n  const options = new Options(opt_options || ({} as BlocklyOptions));\n  const subContainer = document.createElement('div');\n  subContainer.className = 'injectionDiv';\n  subContainer.tabIndex = 0;\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\n\n  containerElement!.appendChild(subContainer);\n  const svg = createDom(subContainer, options);\n\n  const workspace = createMainWorkspace(subContainer, svg, options);\n\n  init(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks\n  // correct.\n  common.setMainWorkspace(workspace);\n\n  common.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function () {\n    common.setMainWorkspace(workspace);\n  });\n\n  return workspace;\n}\n\n/**\n * Create the SVG image.\n *\n * @param container Containing element.\n * @param options Dictionary of options.\n * @returns Newly created SVG image.\n */\nfunction createDom(container: Element, options: Options): SVGElement {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n\n  // Load CSS.\n  Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      version=\"1.1\"\n      class=\"blocklySvg\">\n      ...\n    </svg>\n    */\n  const svg = dom.createSvgElement(\n    Svg.SVG,\n    {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'class': 'blocklySvg',\n      'tabindex': '0',\n    },\n    container,\n  );\n  /*\n    <defs>\n      ... filters go here ...\n    </defs>\n    */\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  const rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n}\n\n/**\n * Create a main workspace and add it to the SVG.\n *\n * @param svg SVG element with pattern defined.\n * @param options Dictionary of options.\n * @returns Newly created main workspace.\n */\nfunction createMainWorkspace(\n  injectionDiv: Element,\n  svg: SVGElement,\n  options: Options,\n): WorkspaceSvg {\n  options.parentWorkspace = null;\n  const mainWorkspace = new WorkspaceSvg(options);\n  const wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(\n    mainWorkspace.createDom('blocklyMainBackground', injectionDiv),\n  );\n\n  // Set the theme name and renderer name onto the injection div.\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\n  if (rendererClassName) {\n    dom.addClass(injectionDiv, rendererClassName);\n  }\n  const themeClassName = mainWorkspace.getTheme().getClassName();\n  if (themeClassName) {\n    dom.addClass(injectionDiv, themeClassName);\n  }\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\n    dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace\n    .getThemeManager()\n    .subscribe(svg, 'workspaceBackgroundColour', 'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  mainWorkspace.addChangeListener(\n    bumpObjects.bumpIntoBoundsHandler(mainWorkspace),\n  );\n\n  // The SVG is now fully assembled.\n  common.svgResize(mainWorkspace);\n  WidgetDiv.createDom();\n  dropDownDiv.createDom();\n  Tooltip.createDom();\n  return mainWorkspace;\n}\n\n/**\n * Initialize Blockly with various handlers.\n *\n * @param mainWorkspace Newly created main workspace.\n */\nfunction init(mainWorkspace: WorkspaceSvg) {\n  const options = mainWorkspace.options;\n  const svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  browserEvents.conditionalBind(\n    svg.parentNode as Element,\n    'contextmenu',\n    null,\n    function (e: Event) {\n      if (!browserEvents.isTargetInput(e)) {\n        e.preventDefault();\n      }\n    },\n  );\n\n  const workspaceResizeHandler = browserEvents.conditionalBind(\n    window,\n    'resize',\n    null,\n    function () {\n      // Don't hide all the chaff. Leave the dropdown and widget divs open if\n      // possible.\n      Tooltip.hide();\n      mainWorkspace.hideComponents(true);\n      dropDownDiv.repositionForWindowResize();\n      WidgetDiv.repositionForWindowResize();\n      common.svgResize(mainWorkspace);\n      bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\n    },\n  );\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  bindDocumentEvents();\n\n  if (options.languageTree) {\n    const toolbox = mainWorkspace.getToolbox();\n    const flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      if (typeof flyout.scrollToStart === 'function') {\n        flyout.scrollToStart();\n      }\n    }\n  }\n\n  if (options.hasTrashcan) {\n    mainWorkspace.trashcan!.init();\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_!.init();\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    const horizontalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.horizontal;\n    const verticalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.vertical;\n    mainWorkspace.scrollbar = new ScrollbarPair(\n      mainWorkspace,\n      horizontalScroll,\n      verticalScroll,\n      'blocklyMainWorkspaceScrollbar',\n    );\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    loadSounds(options.pathToMedia, mainWorkspace);\n  }\n}\n\n/**\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\n * is not visible.\n *\n * @param e Key down event.\n */\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\n// are multiple workspaces and non-main workspaces are able to accept input.\nfunction onKeyDown(e: KeyboardEvent) {\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  if (!mainWorkspace) {\n    return;\n  }\n\n  if (\n    browserEvents.isTargetInput(e) ||\n    (mainWorkspace.rendered && !mainWorkspace.isVisible())\n  ) {\n    // When focused on an HTML text input widget, don't trap any keys.\n    // Ignore keypresses on rendered workspaces that have been explicitly\n    // hidden.\n    return;\n  }\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\n}\n\n/**\n * Whether event handlers have been bound. Document event handlers will only\n * be bound once, even if Blockly is destroyed and reinjected.\n */\nlet documentEventsBound = false;\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n * Also, 'keydown' has to be on the whole document since the browser doesn't\n * understand a concept of focus on the SVG image.\n */\nfunction bindDocumentEvents() {\n  if (!documentEventsBound) {\n    browserEvents.conditionalBind(document, 'scroll', null, function () {\n      const workspaces = common.getAllWorkspaces();\n      for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n        if (workspace instanceof WorkspaceSvg) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    browserEvents.conditionalBind(document, 'keydown', null, onKeyDown);\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\n    // Some iPad versions don't fire resize after portrait to landscape change.\n    if (userAgent.IPAD) {\n      browserEvents.conditionalBind(\n        window,\n        'orientationchange',\n        document,\n        function () {\n          // TODO (#397): Fix for multiple Blockly workspaces.\n          common.svgResize(common.getMainWorkspace() as WorkspaceSvg);\n        },\n      );\n    }\n  }\n  documentEventsBound = true;\n}\n\n/**\n * Load sounds for the given workspace.\n *\n * @param pathToMedia The path to the media directory.\n * @param workspace The workspace to load sounds for.\n */\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\n  const audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n    [\n      pathToMedia + 'click.mp3',\n      pathToMedia + 'click.wav',\n      pathToMedia + 'click.ogg',\n    ],\n    'click',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'disconnect.wav',\n      pathToMedia + 'disconnect.mp3',\n      pathToMedia + 'disconnect.ogg',\n    ],\n    'disconnect',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'delete.mp3',\n      pathToMedia + 'delete.ogg',\n      pathToMedia + 'delete.wav',\n    ],\n    'delete',\n  );\n\n  // Bind temporary hooks that preload the sounds.\n  const soundBinds: browserEvents.Data[] = [];\n  /**\n   *\n   */\n  function unbindSounds() {\n    while (soundBinds.length) {\n      const oldSoundBinding = soundBinds.pop();\n      if (oldSoundBinding) {\n        browserEvents.unbind(oldSoundBinding);\n      }\n    }\n    audioMgr.preload();\n  }\n\n  // These are bound on mouse/touch events with\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\n  // identifier that will be recognized.  But this is really something that\n  // happens on a click, not a drag, so that's not necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'touchstart',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IconType} from '../icons/icon_types.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {Size} from '../utils/size.js';\n\nexport interface IIcon {\n  /**\n   * @returns the IconType representing the type of the icon. This value should\n   *     also be used to register the icon via `Blockly.icons.registry.register`.\n   */\n  getType(): IconType<IIcon>;\n\n  /**\n   * Creates the SVG elements for the icon that will live on the block.\n   *\n   * @param pointerdownListener An event listener that must be attached to the\n   *     root SVG element by the implementation of `initView`. Used by Blockly's\n   *     gesture system to properly handle clicks and drags.\n   */\n  initView(pointerdownListener: (e: PointerEvent) => void): void;\n\n  /**\n   * Disposes of any elements of the icon.\n   *\n   * @remarks\n   *\n   * In particular, if this icon is currently showing a bubble, this should be\n   * used to hide it.\n   */\n  dispose(): void;\n\n  /**\n   * @returns the \"weight\" of the icon, which determines the static order which\n   *     icons should be rendered in. More positive numbers are rendered farther\n   *     toward the end of the block.\n   */\n  getWeight(): number;\n\n  /** @returns The dimensions of the icon for use in rendering. */\n  getSize(): Size;\n\n  /** Updates the icon's color when the block's color changes.. */\n  applyColour(): void;\n\n  /** Hides the icon when it is part of an insertion marker. */\n  hideForInsertionMarker(): void;\n\n  /** Updates the icon's editability when the block's editability changes. */\n  updateEditable(): void;\n\n  /**\n   * Updates the icon's collapsed-ness/view when the block's collapsed-ness\n   * changes.\n   */\n  updateCollapsed(): void;\n\n  /**\n   * @returns Whether this icon is shown when the block is collapsed. Used\n   *     to allow renderers to account for padding.\n   */\n  isShownWhenCollapsed(): boolean;\n\n  /**\n   * Notifies the icon where it is relative to its block's top-start, in\n   * workspace units.\n   */\n  setOffsetInBlock(offset: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has changed locations.\n   *\n   * @param blockOrigin The location of this icon's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(blockOrigin: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has been clicked.\n   */\n  onClick(): void;\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * If this function is not defined, the icon will be clickable in all flyouts.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout?(autoClosingFlyout: boolean): boolean;\n}\n\n/** Type guard that checks whether the given object is an IIcon. */\nexport function isIcon(obj: any): obj is IIcon {\n  return (\n    obj.getType !== undefined &&\n    obj.initView !== undefined &&\n    obj.dispose !== undefined &&\n    obj.getWeight !== undefined &&\n    obj.getSize !== undefined &&\n    obj.applyColour !== undefined &&\n    obj.hideForInsertionMarker !== undefined &&\n    obj.updateEditable !== undefined &&\n    obj.updateCollapsed !== undefined &&\n    obj.isShownWhenCollapsed !== undefined &&\n    obj.setOffsetInBlock !== undefined &&\n    obj.onLocationChange !== undefined &&\n    obj.onClick !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {ICopyable, ICopyData} from './i_copyable.js';\n\n/** An object that can paste data into a workspace. */\nexport interface IPaster<U extends ICopyData, T extends ICopyable<U>> {\n  paste(\n    copyData: U,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): T | null;\n}\n\n/** @returns True if the given object is a paster. */\nexport function isPaster(\n  obj: any,\n): obj is IPaster<ICopyData, ICopyable<ICopyData>> {\n  return obj.paste !== undefined;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {FlyoutItemInfoArray} from '../utils/toolbox';\n// Former goog.module ID: Blockly.ISelectableToolboxItem\n\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be selected.\n */\nexport interface ISelectableToolboxItem extends IToolboxItem {\n  /**\n   * Gets the name of the toolbox item. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string;\n\n  /**\n   * Gets the contents of the toolbox item. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string;\n\n  /**\n   * Sets the current toolbox item as selected.\n   *\n   * @param _isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(_isSelected: boolean): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element;\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event): void;\n}\n\n/**\n * Type guard that checks whether an IToolboxItem is an ISelectableToolboxItem.\n */\nexport function isSelectableToolboxItem(\n  toolboxItem: IToolboxItem,\n): toolboxItem is ISelectableToolboxItem {\n  return toolboxItem.isSelectable();\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/workspace_events.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui_base.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {BlockDragger} from './block_dragger.js';\nimport {BlockSvg} from './block_svg.js';\nimport {BlocklyOptions} from './blockly_options.js';\nimport {Blocks} from './blocks.js';\nimport * as browserEvents from './browser_events.js';\nimport {Bubble} from './bubbles/bubble.js';\nimport * as bubbles from './bubbles.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport {ConnectionChecker} from './connection_checker.js';\nimport {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as ContextMenu from './contextmenu.js';\nimport * as ContextMenuItems from './contextmenu_items.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as Css from './css.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as dialog from './dialog.js';\nimport {DragTarget} from './drag_target.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as Events from './events/events.js';\nimport * as Extensions from './extensions.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {\n  FieldAngle,\n  FieldAngleConfig,\n  FieldAngleFromJsonConfig,\n  FieldAngleValidator,\n} from './field_angle.js';\nimport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n} from './field_checkbox.js';\nimport {\n  FieldColour,\n  FieldColourConfig,\n  FieldColourFromJsonConfig,\n  FieldColourValidator,\n} from './field_colour.js';\nimport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n} from './field_dropdown.js';\nimport {\n  FieldImage,\n  FieldImageConfig,\n  FieldImageFromJsonConfig,\n} from './field_image.js';\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport {FieldLabelSerializable} from './field_label_serializable.js';\nimport {\n  FieldMultilineInput,\n  FieldMultilineInputConfig,\n  FieldMultilineInputFromJsonConfig,\n  FieldMultilineInputValidator,\n} from './field_multilineinput.js';\nimport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n} from './field_number.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n} from './field_textinput.js';\nimport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n} from './field_variable.js';\nimport {Flyout} from './flyout_base.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {HorizontalFlyout} from './flyout_horizontal.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {VerticalFlyout} from './flyout_vertical.js';\nimport {CodeGenerator} from './generator.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport * as icons from './icons.js';\nimport {inject} from './inject.js';\nimport {Align} from './inputs/align.js';\nimport {Input} from './inputs/input.js';\nimport {inputTypes} from './inputs/input_types.js';\nimport * as inputs from './inputs.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport {IBubble} from './interfaces/i_bubble.js';\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\nimport {IComponent} from './interfaces/i_component.js';\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\nimport {ICopyable, isCopyable} from './interfaces/i_copyable.js';\nimport {IDeletable} from './interfaces/i_deletable.js';\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\nimport {IDragTarget} from './interfaces/i_drag_target.js';\nimport {IDraggable} from './interfaces/i_draggable.js';\nimport {IFlyout} from './interfaces/i_flyout.js';\nimport {IHasBubble, hasBubble} from './interfaces/i_has_bubble.js';\nimport {IIcon, isIcon} from './interfaces/i_icon.js';\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport {IMovable} from './interfaces/i_movable.js';\nimport {IObservable, isObservable} from './interfaces/i_observable.js';\nimport {IPaster, isPaster} from './interfaces/i_paster.js';\nimport {IPositionable} from './interfaces/i_positionable.js';\nimport {IRegistrable} from './interfaces/i_registrable.js';\nimport {ISelectable} from './interfaces/i_selectable.js';\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\nimport {ISerializable, isSerializable} from './interfaces/i_serializable.js';\nimport {IStyleable} from './interfaces/i_styleable.js';\nimport {IToolbox} from './interfaces/i_toolbox.js';\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\nimport {\n  IVariableBackedParameterModel,\n  isVariableBackedParameterModel,\n} from './interfaces/i_variable_backed_parameter_model.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\nimport {Cursor} from './keyboard_nav/cursor.js';\nimport {Marker} from './keyboard_nav/marker.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {MetricsManager} from './metrics_manager.js';\nimport {Msg, setLocale} from './msg.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\nimport {Names} from './names.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport * as renderManagement from './render_management.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport * as constants from './constants.js';\nimport * as geras from './renderers/geras/geras.js';\nimport * as minimalist from './renderers/minimalist/minimalist.js';\nimport * as thrasos from './renderers/thrasos/thrasos.js';\nimport * as zelos from './renderers/zelos/zelos.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as serialization from './serialization.js';\nimport * as ShortcutItems from './shortcut_items.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport {Theme} from './theme.js';\nimport * as Themes from './theme/themes.js';\nimport {ThemeManager} from './theme_manager.js';\nimport {ToolboxCategory} from './toolbox/category.js';\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\nimport {ToolboxSeparator} from './toolbox/separator.js';\nimport {Toolbox} from './toolbox/toolbox.js';\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Trashcan} from './trashcan.js';\nimport * as utils from './utils.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n/**\n * Blockly core version.\n * This constant is overridden by the build script (npm run build) to the value\n * of the version in package.json. This is done by the Closure Compiler in the\n * buildCompressed gulp task.\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\n * compiler to override this constant.\n *\n * @define {string}\n */\nexport const VERSION = 'uncompiled';\n\n/*\n * Top-level functions and properties on the Blockly namespace.\n * These are used only in external code. Do not reference these\n * from internal code as importing from this file can cause circular\n * dependencies. Do not add new functions here. There is probably a better\n * namespace to put new functions on.\n */\n\n/*\n * Aliases for input alignments used in block defintions.\n */\n\n/**\n * @see Blockly.Input.Align.LEFT\n * @deprecated Use `Blockly.inputs.Align.LEFT`. To be removed in v11.\n */\nexport const ALIGN_LEFT = Align.LEFT;\n\n/**\n * @see Blockly.Input.Align.CENTRE\n * @deprecated Use `Blockly.inputs.Align.CENTER`. To be removed in v11.\n */\nexport const ALIGN_CENTRE = Align.CENTRE;\n\n/**\n * @see Blockly.Input.Align.RIGHT\n * @deprecated Use `Blockly.inputs.Align.RIGHT`. To be removed in v11.\n */\nexport const ALIGN_RIGHT = Align.RIGHT;\n/*\n * Aliases for constants used for connection and input types.\n */\n\n/**\n * @see ConnectionType.INPUT_VALUE\n */\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\n\n/**\n * @see ConnectionType.OUTPUT_VALUE\n */\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\n\n/**\n * @see ConnectionType.NEXT_STATEMENT\n */\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\n\n/**\n * @see ConnectionType.PREVIOUS_STATEMENT\n */\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\n\n/**\n * @see inputTypes.DUMMY_INPUT\n * @deprecated Use `Blockly.inputs.inputTypes.DUMMY`. To be removed in v11.\n */\nexport const DUMMY_INPUT = inputTypes.DUMMY;\n\n/** Aliases for toolbox positions. */\n\n/**\n * @see toolbox.Position.TOP\n */\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\n\n/**\n * @see toolbox.Position.BOTTOM\n */\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\n\n/**\n * @see toolbox.Position.LEFT\n */\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\n\n/**\n * @see toolbox.Position.RIGHT\n */\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\n\n/*\n * Other aliased functions.\n */\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @see Blockly.common.svgResize\n */\nexport const svgResize = common.svgResize;\n\n/**\n * Close tooltips, context menus, dropdown selections, etc.\n *\n * @param opt_onlyClosePopups Whether only popups should be closed.\n * @see Blockly.WorkspaceSvg.hideChaff\n */\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\n}\n\n/**\n * Returns the main workspace.  Returns the last used main workspace (based on\n * focus).  Try not to use this function, particularly if there are multiple\n * Blockly instances on a page.\n *\n * @see Blockly.common.getMainWorkspace\n */\nexport const getMainWorkspace = common.getMainWorkspace;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport const getSelected = common.getSelected;\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @see Blockly.common.defineBlocksWithJsonArray\n */\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param container The container element.\n * @see Blockly.common.setParentContainer\n */\nexport const setParentContainer = common.setParentContainer;\n\n// Aliases to allow external code to access these values for legacy reasons.\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\nexport const DRAG_STACK = internalConstants.DRAG_STACK;\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\n  VariablesDynamic.CATEGORY_NAME;\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n */\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\n\n// Context for why we need to monkey-patch in these functions (internal):\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\n\n// clang-format off\nWorkspace.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): Block {\n  return new Block(this, prototypeName, opt_id);\n};\n\nWorkspaceSvg.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): BlockSvg {\n  return new BlockSvg(this, prototypeName, opt_id);\n};\n\nWorkspaceSvg.newTrashcan = function (workspace: WorkspaceSvg): Trashcan {\n  return new Trashcan(workspace);\n};\n\nWorkspaceCommentSvg.prototype.showContextMenu = function (\n  this: WorkspaceCommentSvg,\n  e: Event,\n) {\n  if (this.workspace.options.readOnly) {\n    return;\n  }\n  const menuOptions = [];\n\n  if (this.isDeletable() && this.isMovable()) {\n    menuOptions.push(ContextMenu.commentDuplicateOption(this));\n    menuOptions.push(ContextMenu.commentDeleteOption(this));\n  }\n\n  ContextMenu.show(e, menuOptions, this.RTL);\n};\n\nMiniWorkspaceBubble.prototype.newWorkspaceSvg = function (\n  options: Options,\n): WorkspaceSvg {\n  return new WorkspaceSvg(options);\n};\n\nNames.prototype.populateProcedures = function (\n  this: Names,\n  workspace: Workspace,\n) {\n  const procedures = Procedures.allProcedures(workspace);\n  // Flatten the return vs no-return procedure lists.\n  const flattenedProcedures = procedures[0].concat(procedures[1]);\n  for (let i = 0; i < flattenedProcedures.length; i++) {\n    this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\n  }\n};\n// clang-format on\n\n// Re-export submodules that no longer declareLegacyNamespace.\nexport {browserEvents};\nexport {ContextMenu};\nexport {ContextMenuItems};\nexport {Css};\nexport {Events};\nexport {Extensions};\nexport {Procedures};\nexport {Procedures as procedures};\nexport {ShortcutItems};\nexport {Themes};\nexport {Tooltip};\nexport {Touch};\nexport {Variables};\nexport {VariablesDynamic};\nexport {WidgetDiv};\nexport {Xml};\nexport {blockAnimations};\nexport {blockRendering};\nexport {bumpObjects};\nexport {clipboard};\nexport {common};\nexport {constants};\nexport {dialog};\nexport {fieldRegistry};\nexport {geras};\nexport {minimalist};\nexport {registry};\nexport {thrasos};\nexport {uiPosition};\nexport {utils};\nexport {zelos};\nexport {ASTNode};\nexport {BasicCursor};\nexport {Block};\nexport {BlocklyOptions};\nexport {BlockDragger};\nexport {BlockSvg};\nexport {Blocks};\nexport {bubbles};\n/** @deprecated Use Blockly.bubbles.Bubble instead. To be removed in v11. */\nexport {Bubble};\nexport {BubbleDragger};\nexport {CollapsibleToolboxCategory};\nexport {ComponentManager};\nexport {Connection};\nexport {ConnectionType};\nexport {ConnectionChecker};\nexport {ConnectionDB};\nexport {ContextMenuRegistry};\nexport {Cursor};\nexport {DeleteArea};\nexport {DragTarget};\nexport const DropDownDiv = dropDownDiv;\nexport {Field, FieldConfig, FieldValidator, UnattachedFieldError};\nexport {\n  FieldAngle,\n  FieldAngleConfig,\n  FieldAngleFromJsonConfig,\n  FieldAngleValidator,\n};\nexport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n};\nexport {\n  FieldColour,\n  FieldColourConfig,\n  FieldColourFromJsonConfig,\n  FieldColourValidator,\n};\nexport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n};\nexport {FieldImage, FieldImageConfig, FieldImageFromJsonConfig};\nexport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig};\nexport {FieldLabelSerializable};\nexport {\n  FieldMultilineInput,\n  FieldMultilineInputConfig,\n  FieldMultilineInputFromJsonConfig,\n  FieldMultilineInputValidator,\n};\nexport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n};\nexport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n};\nexport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n};\nexport {Flyout};\nexport {FlyoutButton};\nexport {FlyoutMetricsManager};\nexport {CodeGenerator};\nexport {CodeGenerator as Generator}; // Deprecated name, October 2022.\nexport {Gesture};\nexport {Grid};\nexport {HorizontalFlyout};\nexport {IASTNodeLocation};\nexport {IASTNodeLocationSvg};\nexport {IASTNodeLocationWithBlock};\nexport {IAutoHideable};\nexport {IBlockDragger};\nexport {IBoundedElement};\nexport {IBubble};\nexport {ICollapsibleToolboxItem};\nexport {IComponent};\nexport {IConnectionChecker};\nexport {IContextMenu};\nexport {icons};\nexport {ICopyable, isCopyable};\nexport {IDeletable};\nexport {IDeleteArea};\nexport {IDragTarget};\nexport {IDraggable};\nexport {IFlyout};\nexport {IHasBubble, hasBubble};\nexport {IIcon, isIcon};\nexport {IKeyboardAccessible};\nexport {IMetricsManager};\nexport {IMovable};\nexport {Input};\nexport {inputs};\nexport {InsertionMarkerManager};\nexport {IObservable, isObservable};\nexport {IPaster, isPaster};\nexport {IPositionable};\nexport {IRegistrable};\nexport {ISelectable};\nexport {ISelectableToolboxItem};\nexport {ISerializable, isSerializable};\nexport {IStyleable};\nexport {IToolbox};\nexport {IToolboxItem};\nexport {IVariableBackedParameterModel, isVariableBackedParameterModel};\nexport {Marker};\nexport {MarkerManager};\nexport {Menu};\nexport {MenuItem};\nexport {MetricsManager};\nexport {Msg, setLocale};\nexport {Names};\nexport {Options};\nexport {RenderedConnection};\nexport {renderManagement};\nexport {Scrollbar};\nexport {ScrollbarPair};\nexport {ShortcutRegistry};\nexport {TabNavigateCursor};\nexport {Theme};\nexport {ThemeManager};\nexport {Toolbox};\nexport {ToolboxCategory};\nexport {ToolboxItem};\nexport {ToolboxSeparator};\nexport {Trashcan};\nexport {VariableMap};\nexport {VariableModel};\nexport {VerticalFlyout};\nexport {Workspace};\nexport {WorkspaceAudio};\nexport {WorkspaceComment};\nexport {WorkspaceCommentSvg};\nexport {WorkspaceDragger};\nexport {WorkspaceSvg};\nexport {ZoomControls};\nexport {config};\n/** @deprecated Use Blockly.ConnectionType instead. */\nexport const connectionTypes = ConnectionType;\nexport {inject};\n/** @deprecated Use Blockly.inputs.inputTypes instead. To be removed in v11. */\nexport {inputTypes};\nexport {serialization};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/** @internal */\nexport interface IRenderedElement {\n  /**\n   * @returns The root SVG element of htis rendered element.\n   */\n  getSvgRoot(): SVGElement;\n}\n\n/**\n * @returns True if the given object is an IRenderedElement.\n *\n * @internal\n */\nexport function isRenderedElement(obj: any): obj is IRenderedElement {\n  return obj['getSvgRoot'] !== undefined;\n}\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blocks\n\n/**\n * A block definition.  For now this very loose, but it can potentially\n * be refined e.g. by replacing this typedef with a class definition.\n */\nexport type BlockDefinition = AnyDuringMigration;\n\n/**\n * A mapping of block type names to block prototype objects.\n */\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for events fired as a result of actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Abstract\n\nimport * as common from '../common.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as eventUtils from './utils.js';\n\n/**\n * Abstract class for an event.\n */\nexport abstract class Abstract {\n  /**\n   * Whether or not the event was constructed without necessary parameters\n   * (to be populated by fromJson).\n   */\n  abstract isBlank: boolean;\n\n  /** The workspace identifier for this event. */\n  workspaceId?: string = undefined;\n\n  /**\n   * An ID for the group of events this block is associated with.\n   *\n   * Groups define events that should be treated as an single action from the\n   * user's perspective, and should be undone together.\n   */\n  group: string;\n\n  /** Whether this event is undoable or not. */\n  recordUndo: boolean;\n\n  /** Whether or not the event is a UI event. */\n  isUiEvent = false;\n\n  /** Type of this event. */\n  type = '';\n\n  constructor() {\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): AbstractEventJson {\n    return {\n      'type': this.type,\n      'group': this.group,\n    };\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Abstract (like all events), but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be\n   *     supertypes of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: AbstractEventJson,\n    workspace: Workspace,\n    event: any,\n  ): Abstract {\n    event.isBlank = false;\n    event.group = json['group'] || '';\n    event.workspaceId = workspace.id;\n    return event;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns True if null, false if something changed.\n   */\n  isNull(): boolean {\n    return false;\n  }\n\n  /**\n   * Run an event.\n   *\n   * @param _forward True if run forward, false if run backward (undo).\n   */\n  run(_forward: boolean) {\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\n    // this.\n  }\n\n  /**\n   * Get workspace the event belongs to.\n   *\n   * @returns The workspace the event belongs to.\n   * @throws {Error} if workspace is null.\n   * @internal\n   */\n  getEventWorkspace_(): Workspace {\n    let workspace;\n    if (this.workspaceId) {\n      workspace = common.getWorkspaceById(this.workspaceId);\n    }\n    if (!workspace) {\n      throw Error(\n        'Workspace is null. Event must have been generated from real' +\n          ' Blockly events.',\n      );\n    }\n    return workspace;\n  }\n}\n\nexport interface AbstractEventJson {\n  type: string;\n  group: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.UiBase\n\nimport {Abstract as AbstractEvent} from './events_abstract.js';\n\n/**\n * Base class for a UI event.\n * UI events are events that don't need to be sent over the wire for multi-user\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\n * categories).\n * UI events do not undo or redo.\n */\nexport class UiBase extends AbstractEvent {\n  override isBlank = true;\n  override workspaceId: string;\n\n  // UI events do not undo or redo.\n  override recordUndo = false;\n\n  /** Whether or not the event is a UI event. */\n  override isUiEvent = true;\n\n  /**\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_workspaceId?: string) {\n    super();\n\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = typeof opt_workspaceId === 'undefined';\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of UI click in Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Click\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that ome blockly element was clicked.\n */\nexport class Click extends UiBase {\n  /** The ID of the block that was clicked, if a block was clicked. */\n  blockId?: string;\n\n  /**\n   * The type of element that was clicked; one of 'block', 'workspace',\n   * or 'zoom_controls'.\n   */\n  targetType?: ClickTarget;\n  override type = eventUtils.CLICK;\n\n  /**\n   * @param opt_block The affected block. Null for click events that do not have\n   *     an associated block (i.e. workspace click). Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Not used if block is passed. Undefined for a blank event.\n   * @param opt_targetType The type of element targeted by this click event.\n   *     Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    opt_workspaceId?: string | null,\n    opt_targetType?: ClickTarget,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\n    if (workspaceId === null) {\n      workspaceId = undefined;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : undefined;\n    this.targetType = opt_targetType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ClickJson {\n    const json = super.toJson() as ClickJson;\n    if (!this.targetType) {\n      throw new Error(\n        'The click target type is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['targetType'] = this.targetType;\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Click, but we can't specify that due to the fact that parameters to\n   *     static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Click(),\n    ) as Click;\n    newEvent.targetType = json['targetType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum ClickTarget {\n  BLOCK = 'block',\n  WORKSPACE = 'workspace',\n  ZOOM_CONTROLS = 'zoom_controls',\n}\n\nexport interface ClickJson extends AbstractEventJson {\n  targetType: ClickTarget;\n  blockId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CLICK, Click);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.userAgent\n\n/** The raw useragent string. */\nlet rawUserAgent: string;\n\nlet isJavaFx: boolean;\n\nlet isWebKit: boolean;\n\nlet isGecko: boolean;\n\nlet isAndroid: boolean;\n\nlet isIPad: boolean;\n\nlet isIPhone: boolean;\n\nlet isMac: boolean;\n\nlet isTablet: boolean;\n\nlet isMobile: boolean;\n\n(function (raw) {\n  rawUserAgent = raw;\n  const rawUpper = rawUserAgent.toUpperCase();\n  /**\n   * Case-insensitive test of whether name is in the useragent string.\n   *\n   * @param name Name to test.\n   * @returns True if name is present.\n   */\n  function has(name: string): boolean {\n    return rawUpper.indexOf(name.toUpperCase()) !== -1;\n  }\n\n  // Browsers.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\n  // Useragent for JavaFX:\n  // Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\n  //     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\n  isJavaFx = has('JavaFX');\n\n  // Engines.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\n  isWebKit = has('WebKit');\n  isGecko = has('Gecko') && !isWebKit;\n\n  // Platforms.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\n  // and\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\n  isAndroid = has('Android');\n  const maxTouchPoints =\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\n  isIPad = has('iPad') || (has('Macintosh') && maxTouchPoints > 0);\n  isIPhone = has('iPhone') && !isIPad;\n  isMac = has('Macintosh');\n\n  // Devices.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\n  isTablet = isIPad || (isAndroid && !has('Mobile')) || has('Silk');\n  isMobile = !isTablet && (isIPhone || isAndroid);\n})((globalThis['navigator'] && globalThis['navigator']['userAgent']) || '');\n\nexport const raw: string = rawUserAgent;\n\nexport const JavaFx: boolean = isJavaFx;\n\nexport const GECKO: boolean = isGecko;\n\nexport const ANDROID: boolean = isAndroid;\n\nexport const IPAD: boolean = isIPad;\n\nexport const IPHONE: boolean = isIPhone;\n\nexport const MAC: boolean = isMac;\n\nexport const MOBILE: boolean = isMobile;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ComponentManager\n\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IComponent} from './interfaces/i_component.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport * as arrayUtils from './utils/array.js';\n\nclass Capability<_T> {\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\n  private readonly name_: string;\n  /** @param name The name of the component capability. */\n  constructor(name: string) {\n    this.name_ = name;\n  }\n\n  /**\n   * Returns the name of the capability.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name_;\n  }\n}\n\n/**\n * Manager for all items registered with the workspace.\n */\nexport class ComponentManager {\n  static Capability = Capability;\n\n  /**\n   * A map of the components registered with the workspace, mapped to id.\n   */\n  private readonly componentData = new Map<string, ComponentDatum>();\n\n  /** A map of capabilities to component IDs. */\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\n\n  /**\n   * Adds a component.\n   *\n   * @param componentInfo The data for the component to register.\n   * @param opt_allowOverrides True to prevent an error when overriding an\n   *     already registered item.\n   */\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\n    // Don't throw an error if opt_allowOverrides is true.\n    const id = componentInfo.component.id;\n    if (!opt_allowOverrides && this.componentData.has(id)) {\n      throw Error(\n        'Plugin \"' +\n          id +\n          '\" with capabilities \"' +\n          this.componentData.get(id)?.capabilities +\n          '\" already added.',\n      );\n    }\n    this.componentData.set(id, componentInfo);\n    const stringCapabilities = [];\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      stringCapabilities.push(capability);\n      if (!this.capabilityToComponentIds.has(capability)) {\n        this.capabilityToComponentIds.set(capability, [id]);\n      } else {\n        this.capabilityToComponentIds.get(capability)?.push(id);\n      }\n    }\n    this.componentData.get(id)!.capabilities = stringCapabilities;\n  }\n\n  /**\n   * Removes a component.\n   *\n   * @param id The ID of the component to remove.\n   */\n  removeComponent(id: string) {\n    const componentInfo = this.componentData.get(id);\n    if (!componentInfo) {\n      return;\n    }\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n    }\n    this.componentData.delete(id);\n  }\n\n  /**\n   * Adds a capability to a existing registered component.\n   *\n   * @param id The ID of the component to add the capability to.\n   * @param capability The capability to add.\n   */\n  addCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot add capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' + id + 'already has capability \"' + capability + '\"',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    this.componentData.get(id)?.capabilities.push(capability);\n    this.capabilityToComponentIds.get(capability)?.push(id);\n  }\n\n  /**\n   * Removes a capability from an existing registered component.\n   *\n   * @param id The ID of the component to remove the capability from.\n   * @param capability The capability to remove.\n   */\n  removeCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot remove capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (!this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' +\n          id +\n          'doesn\\'t have capability \"' +\n          capability +\n          '\" to remove',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n  }\n\n  /**\n   * Returns whether the component with this id has the specified capability.\n   *\n   * @param id The ID of the component to check.\n   * @param capability The capability to check for.\n   * @returns Whether the component has the capability.\n   */\n  hasCapability<T>(id: string, capability: string | Capability<T>): boolean {\n    capability = `${capability}`.toLowerCase();\n    return (\n      this.componentData.has(id) &&\n      this.componentData.get(id)!.capabilities.indexOf(capability) !== -1\n    );\n  }\n\n  /**\n   * Gets the component with the given ID.\n   *\n   * @param id The ID of the component to get.\n   * @returns The component with the given name or undefined if not found.\n   */\n  getComponent(id: string): IComponent | undefined {\n    return this.componentData.get(id)?.component;\n  }\n\n  /**\n   * Gets all the components with the specified capability.\n   *\n   * @param capability The capability of the component.\n   * @param sorted Whether to return list ordered by weights.\n   * @returns The components that match the specified capability.\n   */\n  getComponents<T extends IComponent>(\n    capability: string | Capability<T>,\n    sorted: boolean,\n  ): T[] {\n    capability = `${capability}`.toLowerCase();\n    const componentIds = this.capabilityToComponentIds.get(capability);\n    if (!componentIds) {\n      return [];\n    }\n    const components: T[] = [];\n    if (sorted) {\n      const componentDataList: ComponentDatum[] = [];\n      componentIds.forEach((id) => {\n        componentDataList.push(this.componentData.get(id)!);\n      });\n      componentDataList.sort(function (a, b) {\n        return a.weight - b.weight;\n      });\n      componentDataList.forEach(function (componentDatum) {\n        components.push(componentDatum.component as T);\n      });\n    } else {\n      componentIds.forEach((id) => {\n        components.push(this.componentData.get(id)!.component as T);\n      });\n    }\n    return components;\n  }\n}\n\nexport namespace ComponentManager {\n  /** An object storing component information. */\n  export interface ComponentDatum {\n    component: IComponent;\n    capabilities: Array<string | Capability<IComponent>>;\n    weight: number;\n  }\n}\n\nexport type ComponentDatum = ComponentManager.ComponentDatum;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for coordinate manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Coordinate\n\n/**\n * Class for representing coordinates and positions.\n */\nexport class Coordinate {\n  /**\n   * @param x Left.\n   * @param y Top.\n   */\n  constructor(\n    public x: number,\n    public y: number,\n  ) {}\n\n  /**\n   * Creates a new copy of this coordinate.\n   *\n   * @returns A copy of this coordinate.\n   */\n  clone(): Coordinate {\n    return new Coordinate(this.x, this.y);\n  }\n\n  /**\n   * Scales this coordinate by the given scale factor.\n   *\n   * @param s The scale factor to use for both x and y dimensions.\n   * @returns This coordinate after scaling.\n   */\n  scale(s: number): Coordinate {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  }\n\n  /**\n   * Translates this coordinate by the given offsets.\n   * respectively.\n   *\n   * @param tx The value to translate x by.\n   * @param ty The value to translate y by.\n   * @returns This coordinate after translating.\n   */\n  translate(tx: number, ty: number): Coordinate {\n    this.x += tx;\n    this.y += ty;\n    return this;\n  }\n\n  /**\n   * Compares coordinates for equality.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns True iff the coordinates are equal, or if both are null.\n   */\n  static equals(a?: Coordinate | null, b?: Coordinate | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.x === b.x && a.y === b.y;\n  }\n\n  /**\n   * Returns the distance between two coordinates.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns The distance between `a` and `b`.\n   */\n  static distance(a: Coordinate, b: Coordinate): number {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Returns the magnitude of a coordinate.\n   *\n   * @param a A Coordinate.\n   * @returns The distance between the origin and `a`.\n   */\n  static magnitude(a: Coordinate): number {\n    return Math.sqrt(a.x * a.x + a.y * a.y);\n  }\n\n  /**\n   * Returns the difference between two coordinates as a new\n   * Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the difference between `a` and `b`.\n   */\n  static difference(\n    a: Coordinate | SVGPoint,\n    b: Coordinate | SVGPoint,\n  ): Coordinate {\n    return new Coordinate(a.x - b.x, a.y - b.y);\n  }\n\n  /**\n   * Returns the sum of two coordinates as a new Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the sum of the two coordinates.\n   */\n  static sum(a: Coordinate | SVGPoint, b: Coordinate | SVGPoint): Coordinate {\n    return new Coordinate(a.x + b.x, a.y + b.y);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Defines the Svg class. Its constants enumerate\n * all SVG tag names used by Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Svg\n\n/**\n * A name with the type of the SVG element stored in the generic.\n */\nexport class Svg<_T> {\n  /** @internal */\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\n  /** @internal */\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\n  /** @internal */\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\n  /** @internal */\n  static DEFS = new Svg<SVGDefsElement>('defs');\n  /** @internal */\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\n  /** @internal */\n  static FECOMPONENTTRANSFER = new Svg<SVGFEComponentTransferElement>(\n    'feComponentTransfer',\n  );\n  /** @internal */\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\n  /** @internal */\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\n  /** @internal */\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\n  /** @internal */\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\n  /** @internal */\n  static FESPECULARLIGHTING = new Svg<SVGFESpecularLightingElement>(\n    'feSpecularLighting',\n  );\n  /** @internal */\n  static FILTER = new Svg<SVGFilterElement>('filter');\n  /** @internal */\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\n  /** @internal */\n  static G = new Svg<SVGGElement>('g');\n  /** @internal */\n  static IMAGE = new Svg<SVGImageElement>('image');\n  /** @internal */\n  static LINE = new Svg<SVGLineElement>('line');\n  /** @internal */\n  static PATH = new Svg<SVGPathElement>('path');\n  /** @internal */\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\n  /** @internal */\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\n  /** @internal */\n  static RECT = new Svg<SVGRectElement>('rect');\n  /** @internal */\n  static SVG = new Svg<SVGSVGElement>('svg');\n  /** @internal */\n  static TEXT = new Svg<SVGTextElement>('text');\n  /** @internal */\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\n\n  /**\n   * @param tagName The SVG element tag name.\n   * @internal\n   */\n  constructor(private readonly tagName: string) {}\n\n  /**\n   * Returns the SVG element tag name.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.tagName;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for rectangle manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Rect\n\n/**\n * Class for representing rectangular regions.\n */\nexport class Rect {\n  /**\n   * @param top Top.\n   * @param bottom Bottom.\n   * @param left Left.\n   * @param right Right.\n   */\n  constructor(\n    public top: number,\n    public bottom: number,\n    public left: number,\n    public right: number,\n  ) {}\n\n  getHeight(): number {\n    return this.bottom - this.top;\n  }\n\n  getWidth(): number {\n    return this.right - this.left;\n  }\n\n  /**\n   * Tests whether this rectangle contains a x/y coordinate.\n   *\n   * @param x The x coordinate to test for containment.\n   * @param y The y coordinate to test for containment.\n   * @returns Whether this rectangle contains given coordinate.\n   */\n  contains(x: number, y: number): boolean {\n    return (\n      x >= this.left && x <= this.right && y >= this.top && y <= this.bottom\n    );\n  }\n\n  /**\n   * Tests whether this rectangle intersects the provided rectangle.\n   * Assumes that the coordinate system increases going down and left.\n   *\n   * @param other The other rectangle to check for intersection with.\n   * @returns Whether this rectangle intersects the provided rectangle.\n   */\n  intersects(other: Rect): boolean {\n    return !(\n      this.left > other.right ||\n      this.right < other.left ||\n      this.top > other.bottom ||\n      this.bottom < other.top\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for size calculation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Size\n\n/**\n * Class for representing sizes consisting of a width and height.\n */\nexport class Size {\n  /**\n   * @param width Width.\n   * @param height Height.\n   */\n  constructor(\n    public width: number,\n    public height: number,\n  ) {}\n\n  /**\n   * Compares sizes for equality.\n   *\n   * @param a A Size.\n   * @param b A Size.\n   * @returns True iff the sizes have equal widths and equal heights, or if both\n   *     are null.\n   */\n  static equals(a: Size | null, b: Size | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.width === b.width && a.height === b.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a scrollbar.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Scrollbar\n\nimport * as browserEvents from './browser_events.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\n * scrollbar is in a mutator.\n */\n\n/**\n * Class for a pure SVG scrollbar.\n * This technique offers a scrollbar that is guaranteed to work, but may not\n * look or behave like the system's scrollbars.\n */\nexport class Scrollbar {\n  /**\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\n   * pixels. Scrollbars should be larger on touch devices.\n   */\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\n\n  /**\n   * Default margin around the scrollbar (between the scrollbar and the edge of\n   * the viewport in pixels).\n   *\n   * @internal\n   */\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\n\n  /** Whether this scrollbar is part of a pair. */\n  private readonly pair: boolean;\n\n  /**\n   * Margin around the scrollbar (between the scrollbar and the edge of the\n   * viewport in pixels).\n   */\n  private readonly margin: number;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics | null = null;\n\n  /**\n   * The ratio of handle position offset to workspace content displacement.\n   *\n   * @internal\n   */\n  ratio = 1;\n\n  /**\n   * The location of the origin of the workspace that the scrollbar is in,\n   * measured in CSS pixels relative to the injection div origin.  This is\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\n   * different origin.\n   */\n  private origin = new Coordinate(0, 0);\n\n  /**\n   * The position of the mouse along this scrollbar's major axis at the start\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\n   * left of the browser window. For a horizontal scrollbar this is the x\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\n   * coordinate of the mouse down event.\n   */\n  private startDragMouse = 0;\n\n  /**\n   * The length of the scrollbars (including the handle and the background),\n   * in CSS pixels. This is equivalent to scrollbar background length and the\n   * area within which the scrollbar handle can move.\n   */\n  private scrollbarLength = 0;\n\n  /** The length of the scrollbar handle in CSS pixels. */\n  private handleLength = 0;\n\n  /**\n   * The offset of the start of the handle from the scrollbar position, in CSS\n   * pixels.\n   */\n  private handlePosition = 0;\n\n  private startDragHandle = 0;\n\n  /** Whether the scrollbar handle is visible. */\n  private isHandleVisible = true;\n\n  /** Whether the workspace containing this scrollbar is visible. */\n  private containerVisible = true;\n\n  /** The transparent background behind the handle. */\n  private svgBackground: SVGRectElement;\n\n  /** The visible handle that can be dragged around. */\n  private svgHandle: SVGRectElement;\n\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\n  private outerSvg: SVGSVGElement;\n\n  /**\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\n   * to the scrollbar's origin.  This is usually relative to the injection div\n   * origin.\n   *\n   * @internal\n   */\n  position = new Coordinate(0, 0);\n\n  /**\n   * The DOM attribute that controls the length of the scrollbar. Different\n   * for horizontal and vertical scrollbars.\n   */\n  lengthAttribute_: string;\n\n  /**\n   * The DOM attribute that controls the position of the scrollbar.\n   * Different for horizontal and vertical scrollbars.\n   */\n  positionAttribute_: string;\n\n  /** Handler for mouse down events on the background of the scrollbar. */\n  onMouseDownBarWrapper_: browserEvents.Data;\n\n  /** Handler for mouse down events on the handle of the scrollbar. */\n  onMouseDownHandleWrapper_: browserEvents.Data;\n\n  /** Handler for mouse move events during scrollbar drags. */\n  onMouseUpWrapper_: browserEvents.Data | null = null;\n\n  /** Handler for mouse up events to end scrollbar drags. */\n  onMouseMoveWrapper_: browserEvents.Data | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbar to.\n   * @param horizontal True if horizontal, false if vertical.\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\n   * @param opt_class A class to be applied to this scrollbar.\n   * @param opt_margin The margin to apply to this scrollbar.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    private readonly horizontal: boolean,\n    opt_pair?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    this.pair = opt_pair || false;\n\n    this.margin =\n      opt_margin !== undefined\n        ? opt_margin\n        : Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\n\n    let className =\n      'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\n    if (opt_class) {\n      className += ' ' + opt_class;\n    }\n\n    /* Create the following DOM:\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\n        <g>\n          <rect class=\"blocklyScrollbarBackground\" />\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\n        </g>\n      </svg>\n    */\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\n    // Child group to hold the handle and background together.\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\n\n    this.svgBackground = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarBackground'},\n      group,\n    );\n\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\n    this.svgHandle = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius},\n      group,\n    );\n\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarColour', 'fill');\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\n\n    // Add everything to the DOM.\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\n\n    this.setInitialThickness();\n\n    if (horizontal) {\n      this.lengthAttribute_ = 'width';\n      this.positionAttribute_ = 'x';\n    } else {\n      this.lengthAttribute_ = 'height';\n      this.positionAttribute_ = 'y';\n    }\n\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\n      this.svgBackground,\n      'pointerdown',\n      this,\n      this.onMouseDownBar,\n    );\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\n      this.svgHandle,\n      'pointerdown',\n      this,\n      this.onMouseDownHandle,\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar DOM elements along the minor axis.\n   */\n  private setInitialThickness() {\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\n    if (this.horizontal) {\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('y', '2.5');\n    } else {\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('x', '2.5');\n    }\n  }\n\n  /**\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\n   * and theme subscriptions.\n   */\n  dispose() {\n    this.cleanUp();\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\n\n    dom.removeNode(this.outerSvg);\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\n  }\n\n  /**\n   * Constrain the handle's length within the minimum (0) and maximum\n   * (scrollbar background) values allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandleLength(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      value = Math.min(value, this.scrollbarLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the length of the scrollbar's handle and change the SVG attribute\n   * accordingly.\n   *\n   * @param newLength The new scrollbar handle length in CSS pixels.\n   */\n  private setHandleLength(newLength: number) {\n    this.handleLength = newLength;\n    this.svgHandle.setAttribute(\n      this.lengthAttribute_,\n      String(this.handleLength),\n    );\n  }\n\n  /**\n   * Constrain the handle's position within the minimum (0) and maximum values\n   * allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandlePosition(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      // Handle length should never be greater than this.scrollbarLength_.\n      // If the viewSize is greater than or equal to the scrollSize, the\n      // handleLength will end up equal to this.scrollbarLength_.\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\n   * change the SVG attribute accordingly.\n   *\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\n   */\n  setHandlePosition(newPosition: number) {\n    this.handlePosition = newPosition;\n    this.svgHandle.setAttribute(\n      this.positionAttribute_,\n      String(this.handlePosition),\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar's background and change the SVG attribute\n   * accordingly.\n   *\n   * @param newSize The new scrollbar background length in CSS pixels.\n   */\n  private setScrollbarLength(newSize: number) {\n    this.scrollbarLength = newSize;\n    this.outerSvg.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n    this.svgBackground.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n  }\n\n  /**\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\n   * scrollbar's origin.  This sets the scrollbar's location within the\n   * workspace.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @internal\n   */\n  setPosition(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n\n    const tempX = this.position.x + this.origin.x;\n    const tempY = this.position.y + this.origin.y;\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\n    dom.setCssTransform(this.outerSvg, transform);\n  }\n\n  /**\n   * Recalculate the scrollbar's location and its length.\n   *\n   * @param opt_metrics A data structure of from the describing all the required\n   *     dimensions.  If not provided, it will be fetched from the host object.\n   */\n  resize(opt_metrics?: Metrics) {\n    // Determine the location, height and width of the host element.\n    let hostMetrics = opt_metrics;\n    if (!hostMetrics) {\n      hostMetrics = this.workspace.getMetrics();\n      if (!hostMetrics) {\n        // Host element is likely not visible.\n        return;\n      }\n    }\n\n    if (\n      this.oldHostMetrics &&\n      Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)\n    ) {\n      return;\n    }\n\n    if (this.horizontal) {\n      this.resizeHorizontal(hostMetrics);\n    } else {\n      this.resizeVertical(hostMetrics);\n    }\n\n    this.oldHostMetrics = hostMetrics;\n\n    // Resizing may have caused some scrolling.\n    this.updateMetrics();\n  }\n\n  /**\n   * Returns whether the a resizeView is necessary by comparing the passed\n   * hostMetrics with cached old host metrics.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   * @returns Whether a resizeView is necessary.\n   */\n  private requiresViewResize(hostMetrics: Metrics): boolean {\n    if (!this.oldHostMetrics) {\n      return true;\n    }\n    return (\n      this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\n      this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop\n    );\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeHorizontal(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewHorizontal(hostMetrics);\n    } else {\n      this.resizeContentHorizontal(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location on the screen and path\n   * length. This should be called when the layout or size of the window has\n   * changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewHorizontal(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\n    if (this.pair && this.workspace.RTL) {\n      xCoordinate += Scrollbar.scrollbarThickness;\n    }\n\n    // Horizontal toolbar should always be just above the bottom of the\n    // workspace.\n    const yCoordinate =\n      hostMetrics.absoluteTop +\n      hostMetrics.viewHeight -\n      Scrollbar.scrollbarThickness -\n      this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentHorizontal(hostMetrics);\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentHorizontal(hostMetrics: Metrics) {\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\n      // viewWidth is often greater than scrollWidth in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewWidth) / hostMetrics.scrollWidth;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewLeft === scrollLeft\n    //     then the offset should be 0\n    // If viewRight === scrollRight\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeVertical(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewVertical(hostMetrics);\n    } else {\n      this.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewVertical(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    const xCoordinate = this.workspace.RTL\n      ? hostMetrics.absoluteLeft + this.margin\n      : hostMetrics.absoluteLeft +\n        hostMetrics.viewWidth -\n        Scrollbar.scrollbarThickness -\n        this.margin;\n\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentVertical(hostMetrics);\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentVertical(hostMetrics: Metrics) {\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\n      // viewHeight is often greater than scrollHeight in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewHeight) /\n      hostMetrics.scrollHeight;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewTop === scrollTop\n    //     then the offset should be 0\n    // If viewBottom === scrollBottom\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\n   * needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isHandleVisible;\n  }\n\n  /**\n   * Set whether the scrollbar's container is visible and update\n   * display accordingly if visibility has changed.\n   *\n   * @param visible Whether the container is visible\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether the scrollbar is visible.\n   * Only applies to non-paired scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\n    // headache (due to interactions with the corner square), and the fact\n    // that telling the pair to resize itself would cause circular dependencies.\n    if (this.pair) {\n      throw Error('Unable to toggle visibility of paired scrollbars.');\n    }\n    this.setVisibleInternal(visible);\n  }\n\n  /**\n   * Set whether the scrollbar is visible. Bypasses checking whether this\n   * scrollbar is part of a pair so that it can be toggled by the scrollbar\n   * pair.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisibleInternal(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n    this.isHandleVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update visibility of scrollbar based on whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   * We cannot rely on the containing workspace being hidden to hide us\n   * because it is not necessarily our parent in the DOM.\n   */\n  updateDisplay_() {\n    let show = true;\n    // Check whether our parent/container is visible.\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (show) {\n      this.outerSvg.setAttribute('display', 'block');\n    } else {\n      this.outerSvg.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Scroll by one pageful.\n   * Called when scrollbar background is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownBar(e: MouseEvent) {\n    this.workspace.markFocused();\n    Touch.clearTouchIdentifier(); // This is really a click.\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    const mouseXY = browserEvents.mouseToSvg(\n      e,\n      this.workspace.getParentSvg(),\n      this.workspace.getInverseScreenCTM(),\n    );\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\n\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\n    let handlePosition = this.handlePosition;\n\n    const pageLength = this.handleLength * 0.95;\n    if (mouseLocation <= handleStart) {\n      // Decrease the scrollbar's value by a page.\n      handlePosition -= pageLength;\n    } else if (mouseLocation >= handleStart + this.handleLength) {\n      // Increase the scrollbar's value by a page.\n      handlePosition += pageLength;\n    }\n\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n\n    this.updateMetrics();\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Start a dragging operation.\n   * Called when scrollbar handle is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownHandle(e: PointerEvent) {\n    this.workspace.markFocused();\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    // Look up the current translation and record it.\n    this.startDragHandle = this.handlePosition;\n\n    // Record the current mouse position.\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onMouseUpHandle,\n    );\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onMouseMoveHandle,\n    );\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Drag the scrollbar's handle.\n   *\n   * @param e Mouse move event.\n   */\n  private onMouseMoveHandle(e: PointerEvent) {\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\n    const mouseDelta = currentMouse - this.startDragMouse;\n    const handlePosition = this.startDragHandle + mouseDelta;\n    // Position the bar.\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n    this.updateMetrics();\n  }\n\n  /** Release the scrollbar handle and reset state accordingly. */\n  private onMouseUpHandle() {\n    Touch.clearTouchIdentifier();\n    this.cleanUp();\n  }\n\n  /**\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\n   * wrap up loose ends associated with the scrollbar.\n   */\n  private cleanUp() {\n    this.workspace.hideChaff(true);\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Helper to calculate the ratio of handle position to scrollbar view size.\n   *\n   * @returns Ratio.\n   * @internal\n   */\n  getRatio_(): number {\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\n    let ratio = this.handlePosition / scrollHandleRange;\n    if (isNaN(ratio)) {\n      ratio = 0;\n    }\n    return ratio;\n  }\n\n  /**\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\n   * is moved.\n   */\n  private updateMetrics() {\n    const ratio = this.getRatio_();\n    if (this.horizontal) {\n      this.workspace.setMetrics({x: ratio});\n    } else {\n      this.workspace.setMetrics({y: ratio});\n    }\n  }\n\n  /**\n   * Set the scrollbar handle's position.\n   *\n   * @param value The content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(value: number, updateMetrics?: boolean) {\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\n    if (updateMetrics || updateMetrics === undefined) {\n      this.updateMetrics();\n    }\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   */\n  setOrigin(x: number, y: number) {\n    this.origin = new Coordinate(x, y);\n  }\n\n  /**\n   * @param first An object containing computed measurements of a workspace.\n   * @param second Another object containing computed measurements of a\n   *     workspace.\n   * @returns Whether the two sets of metrics are equivalent.\n   */\n  private static metricsAreEquivalent(\n    first: Metrics,\n    second: Metrics,\n  ): boolean {\n    return (\n      first.viewWidth === second.viewWidth &&\n      first.viewHeight === second.viewHeight &&\n      first.viewLeft === second.viewLeft &&\n      first.viewTop === second.viewTop &&\n      first.absoluteTop === second.absoluteTop &&\n      first.absoluteLeft === second.absoluteLeft &&\n      first.scrollWidth === second.scrollWidth &&\n      first.scrollHeight === second.scrollHeight &&\n      first.scrollLeft === second.scrollLeft &&\n      first.scrollTop === second.scrollTop\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains the path to a single png tat holds the images for the trashcan\n * as well as the zoom controls.\n */\nexport const SPRITE = {\n  width: 96,\n  height: 124,\n  url: 'sprites.png',\n};\n", "/**\n * @license\n * Copyright 2015 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a zoom icons.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ZoomControls\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport {SPRITE} from './sprites.js';\nimport * as Touch from './touch.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a zoom controls.\n */\nexport class ZoomControls implements IPositionable {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id = 'zoomControls';\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The zoom in svg <g> element. */\n  private zoomInGroup: SVGGElement | null = null;\n\n  /** The zoom out svg <g> element. */\n  private zoomOutGroup: SVGGElement | null = null;\n\n  /** The zoom reset svg <g> element. */\n  private zoomResetGroup: SVGGElement | null = null;\n\n  /** Width of the zoom controls. */\n  private readonly WIDTH = 32;\n\n  /** Height of each zoom control. */\n  private readonly HEIGHT = 32;\n\n  /** Small spacing used between the zoom in and out control, in pixels. */\n  private readonly SMALL_SPACING = 2;\n\n  /**\n   * Large spacing used between the zoom in and reset control, in pixels.\n   */\n  private readonly LARGE_SPACING = 11;\n\n  /** Distance between zoom controls and bottom or top edge of workspace. */\n  private readonly MARGIN_VERTICAL = 20;\n\n  /** Distance between zoom controls and right or left edge of workspace. */\n  private readonly MARGIN_HORIZONTAL = 20;\n\n  /** The SVG group containing the zoom controls. */\n  private svgGroup: SVGElement | null = null;\n\n  /** Left coordinate of the zoom controls. */\n  private left = 0;\n\n  /** Top coordinate of the zoom controls. */\n  private top = 0;\n\n  /** Whether this has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Create the zoom controls.\n   *\n   * @returns The zoom controls SVG group.\n   */\n  createDom(): SVGElement {\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\n    // https://neil.fraser.name/news/2015/11/01/\n    const rnd = String(Math.random()).substring(2);\n    this.createZoomOutSvg(rnd);\n    this.createZoomInSvg(rnd);\n    if (this.workspace.isMovable()) {\n      // If we zoom to the center and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      this.createZoomResetSvg(rnd);\n    }\n    return this.svgGroup;\n  }\n\n  /** Initializes the zoom controls. */\n  init() {\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Disposes of this zoom controls.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('zoomControls');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const bottom = this.top + height;\n    const right = this.left + this.WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Positions the zoom controls.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(this.WIDTH, height),\n      this.MARGIN_HORIZONTAL,\n      this.MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      this.MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      if (this.zoomResetGroup) {\n        const zoomResetTranslateY =\n          zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\n        this.zoomResetGroup.setAttribute(\n          'transform',\n          'translate(0, ' + zoomResetTranslateY + ')',\n        );\n      }\n    } else {\n      const zoomInTranslateY = this.zoomResetGroup\n        ? this.LARGE_SPACING + this.HEIGHT\n        : 0;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      const zoomOutTranslateY =\n        zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\n      this.zoomOutGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomOutTranslateY + ')',\n      );\n    }\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n  }\n\n  /**\n   * Create the zoom in icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomOutSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\n            <rect width=\"32\" height=\"32></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomOutGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomOut'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomoutClipPath' + rnd},\n      this.zoomOutGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoomoutSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -64,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\n      },\n      this.zoomOutGroup,\n    );\n    zoomoutSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomOutGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, -1),\n      ),\n    );\n  }\n\n  /**\n   * Create the zoom out icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomInSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoominClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomInGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomIn'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoominClipPath' + rnd},\n      this.zoomInGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoominSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -32,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\n      },\n      this.zoomInGroup,\n    );\n    zoominSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomInGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, 1),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\n   *    workspace.\n   *\n   * @param amount Amount of zooming. Negative amount values zoom out, and\n   *     positive amount values zoom in.\n   * @param e A mouse down event.\n   */\n  private zoom(amount: number, e: PointerEvent) {\n    this.workspace.markFocused();\n    this.workspace.zoomCenter(amount);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /**\n   * Create the zoom reset icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomResetSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomResetGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomReset'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomresetClipPath' + rnd},\n      this.zoomResetGroup,\n    );\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\n    const zoomresetSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\n      },\n      this.zoomResetGroup,\n    );\n    zoomresetSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach event listeners.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomResetGroup,\n        'pointerdown',\n        null,\n        this.resetZoom.bind(this),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the reset zoom button on the workspace.\n   *\n   * @param e A mouse down event.\n   */\n  private resetZoom(e: PointerEvent) {\n    this.workspace.markFocused();\n\n    // zoom is passed amount and computes the new scale using the formula:\n    // targetScale = currentScale * Math.pow(speed, amount)\n    const targetScale = this.workspace.options.zoomOptions.startScale;\n    const currentScale = this.workspace.scale;\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\n    // To compute amount:\n    // amount = log(speed, (targetScale / currentScale))\n    // Math.log computes natural logarithm (ln), to change the base, use\n    // formula: log(base, value) = ln(value) / ln(base)\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\n    this.workspace.beginCanvasTransition();\n    this.workspace.zoomCenter(amount);\n    this.workspace.scrollCenter();\n\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /** Fires a zoom control UI event. */\n  private fireZoomEvent() {\n    const uiEvent = new (eventUtils.get(eventUtils.CLICK))(\n      null,\n      this.workspace.id,\n      'zoom_controls',\n    );\n    eventUtils.fire(uiEvent);\n  }\n}\n\n/** CSS for zoom controls.  See css.js for use. */\nCss.register(`\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n`);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IIcon} from '../interfaces/i_icon.js';\nimport {CommentIcon} from './comment_icon.js';\nimport {MutatorIcon} from './mutator_icon.js';\nimport {WarningIcon} from './warning_icon.js';\n\n/**\n * Defines the type of an icon, so that it can be retrieved from block.getIcon\n */\nexport class IconType<_T extends IIcon> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /** @returns the name of the type. */\n  toString(): string {\n    return this.name;\n  }\n\n  /** @returns true if this icon type is equivalent to the given icon type. */\n  equals(type: IconType<IIcon>): boolean {\n    return this.name === type.toString();\n  }\n\n  static MUTATOR = new IconType<MutatorIcon>('mutator');\n  static WARNING = new IconType<WarningIcon>('warning');\n  static COMMENT = new IconType<CommentIcon>('comment');\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inputTypes\n\nimport {ConnectionType} from '../connection_type.js';\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum inputTypes {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  VALUE = ConnectionType.INPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\n  // A dummy input.  Used to add field(s) with no input.\n  DUMMY = 5,\n  // An unknown type of input defined by an external developer.\n  CUSTOM = 6,\n  // An input with no connections that is always the last input of a row. Any\n  // subsequent input will be rendered on the next row. Any newline character in\n  // a JSON block definition's message will be parsed as an end-row input.\n  END_ROW = 7,\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Msg\n\n/** A dictionary of localised messages. */\nexport const Msg: {[key: string]: string} = Object.create(null);\n\n/**\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\n * locale.\n *\n * This is not useful/necessary when loading from a script tag, because the\n * messages are automatically cluged into the Blockly.Msg object. But we provide\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\n * can properly create our type definition files.\n *\n * @param locale An object defining the messages for a given language.\n */\nexport const setLocale = function (locale: {[key: string]: string}) {\n  Object.keys(locale).forEach(function (k) {\n    Msg[k] = locale[k];\n  });\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for a variable event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarBase\n\nimport type {VariableModel} from '../variable_model.js';\n\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Abstract class for a variable event.\n */\nexport class VarBase extends AbstractEvent {\n  override isBlank = true;\n  /** The ID of the variable this event references. */\n  varId?: string;\n\n  /**\n   * @param opt_variable The variable this event corresponds to.  Undefined for\n   *     a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super();\n    this.isBlank = typeof opt_variable === 'undefined';\n    if (!opt_variable) return;\n\n    this.varId = opt_variable.getId();\n    this.workspaceId = opt_variable.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarBaseJson {\n    const json = super.toJson() as VarBaseJson;\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varId'] = this.varId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarBase(),\n    ) as VarBase;\n    newEvent.varId = json['varId'];\n    return newEvent;\n  }\n}\n\nexport interface VarBaseJson extends AbstractEventJson {\n  varId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarCreate\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model has been created.\n */\nexport class VarCreate extends VarBase {\n  override type = eventUtils.VAR_CREATE;\n\n  /** The type of the variable that was created. */\n  varType?: string;\n\n  /** The name of the variable that was created. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The created variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarCreateJson {\n    const json = super.toJson() as VarCreateJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarCreate, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarCreate(),\n    ) as VarCreate;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    } else {\n      workspace.deleteVariableById(this.varId);\n    }\n  }\n}\n\nexport interface VarCreateJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_CREATE, VarCreate);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for the variable model.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableModel\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable model.\n * Holds information for the variable including name, ID, and type.\n *\n * @see {Blockly.FieldVariable}\n */\nexport class VariableModel {\n  type: string;\n  private readonly id_: string;\n\n  /**\n   * @param workspace The variable's workspace.\n   * @param name The name of the variable.  This is the user-visible name (e.g.\n   *     'my var' or '私の変数'), not the generated name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   */\n  constructor(\n    public workspace: Workspace,\n    public name: string,\n    opt_type?: string,\n    opt_id?: string,\n  ) {\n    /**\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\n     * used to build a list of variables of a specific type. By default this is\n     * the empty string '', which is a specific type.\n     *\n     * @see {Blockly.FieldVariable}\n     */\n    this.type = opt_type || '';\n\n    /**\n     * A unique ID for the variable. This should be defined at creation and\n     * not change, even if the name changes. In most cases this should be a\n     * UUID.\n     */\n    this.id_ = opt_id || idGenerator.genUid();\n  }\n\n  /** @returns The ID for the variable. */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * A custom compare function for the VariableModel objects.\n   *\n   * @param var1 First variable to compare.\n   * @param var2 Second variable to compare.\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\n   *     greater.\n   * @internal\n   */\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceComment\n\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as xml from './utils/xml.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a workspace comment.\n */\nexport class WorkspaceComment {\n  id: string;\n  protected xy_: Coordinate;\n  protected height_: number;\n  protected width_: number;\n  protected RTL: boolean;\n\n  private deletable = true;\n\n  private movable = true;\n\n  private editable = true;\n  protected content_: string;\n\n  /** Whether this comment has been disposed. */\n  protected disposed_ = false;\n  /** @internal */\n  isComment = true;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n    public workspace: Workspace,\n    content: string,\n    height: number,\n    width: number,\n    opt_id?: string,\n  ) {\n    this.id =\n      opt_id && !workspace.getCommentById(opt_id)\n        ? opt_id\n        : idGenerator.genUid();\n\n    workspace.addTopComment(this);\n\n    /**\n     * The comment's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n\n    /**\n     * The comment's height in workspace units.  Scale does not change this\n     * value.\n     */\n    this.height_ = height;\n\n    /**\n     * The comment's width in workspace units.  Scale does not change this\n     * value.\n     */\n    this.width_ = width;\n\n    this.RTL = workspace.RTL;\n\n    this.content_ = content;\n\n    WorkspaceComment.fireCreateEvent(this);\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  dispose() {\n    if (this.disposed_) {\n      return;\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n    // Remove from the list of top comments and the comment database.\n    this.workspace.removeTopComment(this);\n    this.disposed_ = true;\n  }\n\n  // Height, width, x, and y are all stored on even non-rendered comments, to\n  // preserve state if you pass the contents through a headless workspace.\n\n  /**\n   * Get comment height.\n   *\n   * @returns Comment height.\n   * @internal\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Set comment height.\n   *\n   * @param height Comment height.\n   * @internal\n   */\n  setHeight(height: number) {\n    this.height_ = height;\n  }\n\n  /**\n   * Get comment width.\n   *\n   * @returns Comment width.\n   * @internal\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Set comment width.\n   *\n   * @param width comment width.\n   * @internal\n   */\n  setWidth(width: number) {\n    this.width_ = width;\n  }\n\n  /**\n   * Get stored location.\n   *\n   * @returns The comment's stored location.\n   *   This is not valid if the comment is currently being dragged.\n   * @internal\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(this.xy_.x, this.xy_.y);\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  moveBy(dx: number, dy: number) {\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n      this,\n    ) as CommentMove;\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get whether this comment is deletable or not.\n   *\n   * @returns True if deletable.\n   * @internal\n   */\n  isDeletable(): boolean {\n    return (\n      this.deletable && !(this.workspace && this.workspace.options.readOnly)\n    );\n  }\n\n  /**\n   * Set whether this comment is deletable or not.\n   *\n   * @param deletable True if deletable.\n   * @internal\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable = deletable;\n  }\n\n  /**\n   * Get whether this comment is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return this.movable && !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  setMovable(movable: boolean) {\n    this.movable = movable;\n  }\n\n  /**\n   * Get whether this comment is editable or not.\n   *\n   * @returns True if editable.\n   */\n  isEditable(): boolean {\n    return (\n      this.editable && !(this.workspace && this.workspace.options.readOnly)\n    );\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  getContent(): string {\n    return this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  setContent(content: string) {\n    if (this.content_ !== content) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.COMMENT_CHANGE))(\n          this,\n          this.content_,\n          content,\n        ),\n      );\n      this.content_ = content;\n    }\n  }\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXmlWithXY(opt_noId?: boolean): Element {\n    const element = this.toXml(opt_noId);\n    element.setAttribute('x', String(Math.round(this.xy_.x)));\n    element.setAttribute('y', String(Math.round(this.xy_.y)));\n    element.setAttribute('h', String(this.height_));\n    element.setAttribute('w', String(this.width_));\n    return element;\n  }\n\n  /**\n   * Encode a comment subtree as XML, but don't serialize the XY coordinates.\n   * This method avoids some expensive metrics-related calls that are made in\n   * toXmlWithXY().\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXml(opt_noId?: boolean): Element {\n    const commentElement = xml.createElement('comment');\n    if (!opt_noId) {\n      commentElement.id = this.id;\n    }\n    commentElement.textContent = this.getContent();\n    return commentElement;\n  }\n\n  /**\n   * Fire a create event for the given workspace comment, if comments are\n   * enabled.\n   *\n   * @param comment The comment that was just created.\n   * @internal\n   */\n  static fireCreateEvent(comment: WorkspaceComment) {\n    if (eventUtils.isEnabled()) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      try {\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.COMMENT_CREATE))(comment),\n        );\n      } finally {\n        eventUtils.setGroup(existingGroup);\n      }\n    }\n  }\n\n  /**\n   * Decode an XML comment tag and create a comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXml(xmlComment: Element, workspace: Workspace): WorkspaceComment {\n    const info = WorkspaceComment.parseAttributes(xmlComment);\n\n    const comment = new WorkspaceComment(\n      workspace,\n      info.content,\n      info.h,\n      info.w,\n      info.id,\n    );\n\n    const xmlX = xmlComment.getAttribute('x');\n    const xmlY = xmlComment.getAttribute('y');\n    const commentX = xmlX ? parseInt(xmlX, 10) : NaN;\n    const commentY = xmlY ? parseInt(xmlY, 10) : NaN;\n    if (!isNaN(commentX) && !isNaN(commentY)) {\n      comment.moveBy(commentX, commentY);\n    }\n\n    WorkspaceComment.fireCreateEvent(comment);\n    return comment;\n  }\n\n  /**\n   * Decode an XML comment tag and return the results in an object.\n   *\n   * @param xml XML comment element.\n   * @returns An object containing the id, size, position, and comment string.\n   * @internal\n   */\n  static parseAttributes(xml: Element): {\n    id: string;\n    w: number;\n    h: number;\n    x: number;\n    y: number;\n    content: string;\n  } {\n    const xmlH = xml.getAttribute('h');\n    const xmlW = xml.getAttribute('w');\n    const xmlX = xml.getAttribute('x');\n    const xmlY = xml.getAttribute('y');\n    const xmlId = xml.getAttribute('id');\n\n    if (!xmlId) {\n      throw new Error('No ID present in XML comment definition.');\n    }\n\n    return {\n      id: xmlId,\n      // The height of the comment in workspace units, or 100 if not specified.\n      h: xmlH ? parseInt(xmlH) : 100,\n      // The width of the comment in workspace units, or 100 if not specified.\n      w: xmlW ? parseInt(xmlW) : 100,\n      // The x position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      x: xmlX ? parseInt(xmlX) : NaN,\n      // The y position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      y: xmlY ? parseInt(xmlY) : NaN,\n      content: xml.textContent ?? '',\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of element select action.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Selected\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Class for a selected event.\n * Notifies listeners that a new element has been selected.\n */\nexport class Selected extends UiBase {\n  /** The id of the last selected selectable element. */\n  oldElementId?: string;\n\n  /**\n   * The id of the newly selected selectable element,\n   * or undefined if unselected.\n   */\n  newElementId?: string;\n\n  override type = eventUtils.SELECTED;\n\n  /**\n   * @param opt_oldElementId The ID of the previously selected element. Null if\n   *     no element last selected. Undefined for a blank event.\n   * @param opt_newElementId The ID of the selected element. Null if no element\n   *     currently selected (deselect). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Null if no element previously selected. Undefined for a blank event.\n   */\n  constructor(\n    opt_oldElementId?: string | null,\n    opt_newElementId?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n\n    this.oldElementId = opt_oldElementId ?? undefined;\n    this.newElementId = opt_newElementId ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): SelectedJson {\n    const json = super.toJson() as SelectedJson;\n    json['oldElementId'] = this.oldElementId;\n    json['newElementId'] = this.newElementId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Selected, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: SelectedJson,\n    workspace: Workspace,\n    event?: any,\n  ): Selected {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Selected(),\n    ) as Selected;\n    newEvent.oldElementId = json['oldElementId'];\n    newEvent.newElementId = json['newElementId'];\n    return newEvent;\n  }\n}\n\nexport interface SelectedJson extends AbstractEventJson {\n  oldElementId?: string;\n  newElementId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.SELECTED, Selected);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IPaster} from '../interfaces/i_paster.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {WorkspaceCommentSvg} from '../workspace_comment_svg.js';\nimport * as registry from './registry.js';\n\nexport class WorkspaceCommentPaster\n  implements IPaster<WorkspaceCommentCopyData, WorkspaceCommentSvg>\n{\n  static TYPE = 'workspace-comment';\n\n  paste(\n    copyData: WorkspaceCommentCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): WorkspaceCommentSvg {\n    const state = copyData.commentState;\n    if (coordinate) {\n      state.setAttribute('x', `${coordinate.x}`);\n      state.setAttribute('y', `${coordinate.y}`);\n    } else {\n      const x = parseInt(state.getAttribute('x') ?? '0') + 50;\n      const y = parseInt(state.getAttribute('y') ?? '0') + 50;\n      state.setAttribute('x', `${x}`);\n      state.setAttribute('y', `${y}`);\n    }\n    return WorkspaceCommentSvg.fromXmlRendered(\n      copyData.commentState,\n      workspace,\n    );\n  }\n}\n\nexport interface WorkspaceCommentCopyData extends ICopyData {\n  commentState: Element;\n}\n\nregistry.register(WorkspaceCommentPaster.TYPE, new WorkspaceCommentPaster());\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on a rendered workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceCommentSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\n// import * as ContextMenu from './contextmenu.js';\nimport * as Css from './css.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {\n  WorkspaceCommentCopyData,\n  WorkspaceCommentPaster,\n} from './clipboard/workspace_comment_paster.js';\n\n/** Size of the resize icon. */\nconst RESIZE_SIZE = 8;\n\n/** Radius of the border around the comment. */\nconst BORDER_RADIUS = 3;\n\n/** Offset from the foreignobject edge to the textarea edge. */\nconst TEXTAREA_OFFSET = 2;\n\n/**\n * Class for a workspace comment's SVG representation.\n */\nexport class WorkspaceCommentSvg\n  extends WorkspaceComment\n  implements IBoundedElement, IBubble, ICopyable<WorkspaceCommentCopyData>\n{\n  /**\n   * The width and height to use to size a workspace comment when it is first\n   * added, before it has been edited by the user.\n   *\n   * @internal\n   */\n  static DEFAULT_SIZE = 100;\n\n  /** Offset from the top to make room for a top bar. */\n  private static readonly TOP_OFFSET = 10;\n  override workspace: WorkspaceSvg;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper: browserEvents.Data | null = null;\n\n  /** Mouse move event data. */\n  private onMouseMoveWrapper: browserEvents.Data | null = null;\n\n  /** Whether event handlers have been initialized. */\n  private eventsInit = false;\n  private textarea: HTMLTextAreaElement | null = null;\n\n  private svgRectTarget: SVGRectElement | null = null;\n\n  private svgHandleTarget: SVGRectElement | null = null;\n\n  private foreignObject: SVGForeignObjectElement | null = null;\n\n  private resizeGroup: SVGGElement | null = null;\n\n  private deleteGroup: SVGGElement | null = null;\n\n  private deleteIconBorder: SVGCircleElement | null = null;\n\n  private focused = false;\n  private autoLayout = false;\n\n  // Create core elements for the block.\n  private readonly svgGroup: SVGElement;\n  svgRect_: SVGRectElement;\n\n  /** Whether the comment is rendered onscreen and is a part of the DOM. */\n  private rendered = false;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n    workspace: WorkspaceSvg,\n    content: string,\n    height: number,\n    width: number,\n    opt_id?: string,\n  ) {\n    super(workspace, content, height, width, opt_id);\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyComment'});\n    this.workspace = workspace;\n\n    this.svgRect_ = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentRect',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    this.svgGroup.appendChild(this.svgRect_);\n\n    this.render();\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  override dispose() {\n    if (this.disposed_) {\n      return;\n    }\n    // If this comment is being dragged, unlink the mouse events.\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n\n    dom.removeNode(this.svgGroup);\n\n    eventUtils.disable();\n    super.dispose();\n    eventUtils.enable();\n  }\n\n  /**\n   * Create and initialize the SVG representation of a workspace comment.\n   * May be called more than once.\n   *\n   * @param opt_noSelect Text inside text area will be selected if false\n   * @internal\n   */\n  initSvg(opt_noSelect?: boolean) {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    if (!this.workspace.options.readOnly && !this.eventsInit) {\n      browserEvents.conditionalBind(\n        this.svgRectTarget as SVGRectElement,\n        'pointerdown',\n        this,\n        this.pathMouseDown,\n      );\n      browserEvents.conditionalBind(\n        this.svgHandleTarget as SVGRectElement,\n        'pointerdown',\n        this,\n        this.pathMouseDown,\n      );\n    }\n    this.eventsInit = true;\n\n    this.updateMovable();\n    if (!this.getSvgRoot().parentNode) {\n      this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot());\n    }\n\n    if (!opt_noSelect && this.textarea) {\n      this.textarea.select();\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG comment.\n   *\n   * @param e Pointer down event.\n   */\n  private pathMouseDown(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBubbleStart(e, this);\n    }\n  }\n\n  /**\n   * Show the context menu for this workspace comment.\n   *\n   * @param e Pointer event.\n   * @internal\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  showContextMenu(e: PointerEvent) {\n    throw new Error(\n      'The implementation of showContextMenu should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  select() {\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n      oldId,\n      this.id,\n      this.workspace.id,\n    );\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n      this.id,\n      null,\n      this.workspace.id,\n    );\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n    this.blurFocus();\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addSelect() {\n    dom.addClass(this.svgGroup, 'blocklySelected');\n    this.setFocus();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeSelect() {\n    dom.addClass(this.svgGroup, 'blocklySelected');\n    this.blurFocus();\n  }\n\n  /**\n   * Focus this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addFocus() {\n    dom.addClass(this.svgGroup, 'blocklyFocused');\n  }\n\n  /**\n   * Unfocus this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeFocus() {\n    dom.removeClass(this.svgGroup, 'blocklyFocused');\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this comment relative to\n   * the drawing surface's origin (0,0), in workspace units.\n   * If the comment is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   * @internal\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    const layerManger = this.workspace.getLayerManager();\n    if (!layerManger) {\n      throw new Error(\n        'Cannot calculate position because the workspace has not been appended',\n      );\n    }\n\n    let x = 0;\n    let y = 0;\n\n    let element: SVGElement | null = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this comment and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        element = element.parentNode as SVGElement;\n      } while (element && !layerManger.hasLayer(element) && element !== null);\n    }\n    this.xy_ = new Coordinate(x, y);\n    return this.xy_;\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  override moveBy(dx: number, dy: number) {\n    const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n      this,\n    ) as CommentMove;\n    // TODO: Do I need to look up the relative to surface XY position here?\n    const xy = this.getRelativeToSurfaceXY();\n    this.translate(xy.x + dx, xy.y + dy);\n    this.xy_ = new Coordinate(xy.x + dx, xy.y + dy);\n    event.recordNew();\n    eventUtils.fire(event);\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a comment by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   * @internal\n   */\n  translate(x: number, y: number) {\n    this.xy_ = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute(\n      'transform',\n      'translate(' + x + ',' + y + ')',\n    );\n  }\n\n  /**\n   * Move this comment during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    const translation = `translate(${newLoc.x}, ${newLoc.y})`;\n    this.getSvgRoot().setAttribute('transform', translation);\n  }\n\n  /**\n   * Move the bubble group to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.translate(x, y);\n  }\n\n  /**\n   * Clear the comment of transform=\"...\" attributes.\n   * Used when the comment is switching from 3d to 2d transform or vice versa.\n   */\n  private clearTransformAttributes() {\n    this.getSvgRoot().removeAttribute('transform');\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * comment.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   * @internal\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const commentBounds = this.getHeightWidth();\n    const top = blockXY.y;\n    const bottom = blockXY.y + commentBounds.height;\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - commentBounds.width;\n      // Add the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      right = blockXY.x;\n    } else {\n      // Subtract the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      left = blockXY.x;\n      right = blockXY.x + commentBounds.width;\n    }\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Add or remove the UI indicating if this comment is movable or not.\n   *\n   * @internal\n   */\n  updateMovable() {\n    if (this.isMovable()) {\n      dom.addClass(this.svgGroup, 'blocklyDraggable');\n    } else {\n      dom.removeClass(this.svgGroup, 'blocklyDraggable');\n    }\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.updateMovable();\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    if (this.textarea) {\n      this.textarea.readOnly = !editable;\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (adding) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDragging');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDragging');\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   * @internal\n   */\n  getSvgRoot(): SVGElement {\n    return this.svgGroup;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  override getContent(): string {\n    return this.textarea ? this.textarea.value : this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  override setContent(content: string) {\n    super.setContent(content);\n    if (this.textarea) {\n      this.textarea.value = content;\n    }\n  }\n\n  /**\n   * Update the cursor over this comment by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    if (enable) {\n      dom.addClass(this.svgGroup, 'blocklyDraggingDelete');\n    } else {\n      dom.removeClass(this.svgGroup, 'blocklyDraggingDelete');\n    }\n  }\n\n  /**\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n   * is shown it positions itself to not cover any blocks.  Once a user has\n   * dragged it to reposition, it renders where the user put it.\n   *\n   * @param _enable True if auto-layout should be enabled, false otherwise.\n   * @internal\n   */\n  setAutoLayout(_enable: boolean) {}\n  // NOP for compatibility with the bubble dragger.\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  override toXmlWithXY(opt_noId?: boolean): Element {\n    let width = 0; // Not used in LTR.\n    if (this.workspace.RTL) {\n      // Here be performance dragons: This calls getMetrics().\n      width = this.workspace.getWidth();\n    }\n    const element = this.toXml(opt_noId);\n    const xy = this.getRelativeToSurfaceXY();\n    element.setAttribute(\n      'x',\n      String(Math.round(this.workspace.RTL ? width - xy.x : xy.x)),\n    );\n    element.setAttribute('y', String(Math.round(xy.y)));\n    element.setAttribute('h', String(this.getHeight()));\n    element.setAttribute('w', String(this.getWidth()));\n    return element;\n  }\n\n  /**\n   * Encode a comment for copying.\n   *\n   * @returns Copy metadata.\n   */\n  toCopyData(): WorkspaceCommentCopyData {\n    return {\n      paster: WorkspaceCommentPaster.TYPE,\n      commentState: this.toXmlWithXY(),\n    };\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this comment.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number; width: number} {\n    return {width: this.getWidth(), height: this.getHeight()};\n  }\n\n  /**\n   * Renders the workspace comment.\n   *\n   * @internal\n   */\n  render() {\n    if (this.rendered) {\n      return;\n    }\n\n    const size = this.getHeightWidth();\n\n    // Add text area\n    const foreignObject = this.createEditor();\n    this.svgGroup.appendChild(foreignObject);\n\n    this.svgHandleTarget = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentHandleTarget',\n      'x': 0,\n      'y': 0,\n    });\n    this.svgGroup.appendChild(this.svgHandleTarget);\n    this.svgRectTarget = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentTarget',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    this.svgGroup.appendChild(this.svgRectTarget);\n\n    // Add the resize icon\n    this.addResizeDom();\n    if (this.isDeletable()) {\n      // Add the delete icon\n      this.addDeleteDom();\n    }\n\n    this.setSize(size.width, size.height);\n\n    // Set the content\n    this.textarea!.value = this.content_;\n\n    this.rendered = true;\n\n    if (this.resizeGroup) {\n      browserEvents.conditionalBind(\n        this.resizeGroup,\n        'pointerdown',\n        this,\n        this.resizeMouseDown,\n      );\n    }\n\n    if (this.isDeletable()) {\n      browserEvents.conditionalBind(\n        this.deleteGroup as SVGGElement,\n        'pointerdown',\n        this,\n        this.deleteMouseDown,\n      );\n      browserEvents.conditionalBind(\n        this.deleteGroup as SVGGElement,\n        'pointerout',\n        this,\n        this.deleteMouseOut,\n      );\n      browserEvents.conditionalBind(\n        this.deleteGroup as SVGGElement,\n        'pointerup',\n        this,\n        this.deleteMouseUp,\n      );\n    }\n  }\n\n  /**\n   * Create the text area for the comment.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor(): Element {\n    /* Create the editor.  Here's the markup that will be generated:\n          <foreignObject class=\"blocklyCommentForeignObject\" x=\"0\" y=\"10\"\n          width=\"164\" height=\"164\"> <body xmlns=\"http://www.w3.org/1999/xhtml\"\n          class=\"blocklyMinimalBody\"> <textarea\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\n                  style=\"height: 164px; width: 164px;\"></textarea>\n            </body>\n          </foreignObject>\n        */\n    this.foreignObject = dom.createSvgElement(Svg.FOREIGNOBJECT, {\n      'x': 0,\n      'y': WorkspaceCommentSvg.TOP_OFFSET,\n      'class': 'blocklyCommentForeignObject',\n    });\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n    const textarea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    textarea.className = 'blocklyCommentTextarea';\n    textarea.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    textarea.readOnly = !this.isEditable();\n    body.appendChild(textarea);\n    this.textarea = textarea;\n    this.foreignObject.appendChild(body);\n    // Don't zoom with mousewheel.\n    browserEvents.conditionalBind(\n      textarea,\n      'wheel',\n      this,\n      function (e: WheelEvent) {\n        e.stopPropagation();\n      },\n    );\n    browserEvents.conditionalBind(\n      textarea,\n      'change',\n      this,\n      function (this: WorkspaceCommentSvg, _e: Event) {\n        this.setContent(textarea.value);\n      },\n    );\n    return this.foreignObject;\n  }\n\n  /** Add the resize icon to the DOM */\n  private addResizeDom() {\n    this.resizeGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': this.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE'},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.POLYGON,\n      {\n        'points': `0,${RESIZE_SIZE} ${RESIZE_SIZE},${RESIZE_SIZE} ${RESIZE_SIZE},0`,\n      },\n      this.resizeGroup,\n    );\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'class': 'blocklyResizeLine',\n        'x1': RESIZE_SIZE / 3,\n        'y1': RESIZE_SIZE - 1,\n        'x2': RESIZE_SIZE - 1,\n        'y2': RESIZE_SIZE / 3,\n      },\n      this.resizeGroup,\n    );\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'class': 'blocklyResizeLine',\n        'x1': (RESIZE_SIZE * 2) / 3,\n        'y1': RESIZE_SIZE - 1,\n        'x2': RESIZE_SIZE - 1,\n        'y2': (RESIZE_SIZE * 2) / 3,\n      },\n      this.resizeGroup,\n    );\n  }\n\n  /** Add the delete icon to the DOM */\n  private addDeleteDom() {\n    this.deleteGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyCommentDeleteIcon'},\n      this.svgGroup,\n    );\n    this.deleteIconBorder = dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyDeleteIconShape', 'r': '7', 'cx': '7.5', 'cy': '7.5'},\n      this.deleteGroup,\n    );\n    // x icon.\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'x1': '5',\n        'y1': '10',\n        'x2': '10',\n        'y2': '5',\n        'stroke': '#fff',\n        'stroke-width': '2',\n      },\n      this.deleteGroup,\n    );\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'x1': '5',\n        'y1': '5',\n        'x2': '10',\n        'y2': '10',\n        'stroke': '#fff',\n        'stroke-width': '2',\n      },\n      this.deleteGroup,\n    );\n  }\n\n  /**\n   * Handle a pointerdown on comment's resize corner.\n   *\n   * @param e Pointer down event.\n   */\n  private resizeMouseDown(e: PointerEvent) {\n    this.unbindDragEvents();\n    if (browserEvents.isRightButton(e)) {\n      // No right-click.\n      e.stopPropagation();\n      return;\n    }\n    // Left-click (or middle click)\n    this.workspace.startDrag(\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.width_ : this.width_,\n        this.height_,\n      ),\n    );\n\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.resizeMouseUp,\n    );\n    this.onMouseMoveWrapper = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.resizeMouseMove,\n    );\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown on comment's delete icon.\n   *\n   * @param e Pointer down event.\n   */\n  private deleteMouseDown(e: PointerEvent) {\n    // Highlight the delete icon.\n    if (this.deleteIconBorder) {\n      dom.addClass(this.deleteIconBorder, 'blocklyDeleteIconHighlighted');\n    }\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerout on comment's delete icon.\n   *\n   * @param _e Pointer out event.\n   */\n  private deleteMouseOut(_e: PointerEvent) {\n    // Restore highlight on the delete icon.\n    if (this.deleteIconBorder) {\n      dom.removeClass(this.deleteIconBorder, 'blocklyDeleteIconHighlighted');\n    }\n  }\n\n  /**\n   * Handle a pointerup on comment's delete icon.\n   *\n   * @param e Pointer up event.\n   */\n  private deleteMouseUp(e: PointerEvent) {\n    // Delete this comment.\n    this.dispose();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Stop binding to the global pointerup and pointermove events. */\n  private unbindDragEvents() {\n    if (this.onMouseUpWrapper) {\n      browserEvents.unbind(this.onMouseUpWrapper);\n      this.onMouseUpWrapper = null;\n    }\n    if (this.onMouseMoveWrapper) {\n      browserEvents.unbind(this.onMouseMoveWrapper);\n      this.onMouseMoveWrapper = null;\n    }\n  }\n\n  /**\n   * Handle a pointerup event while dragging a comment's border or resize\n   * handle.\n   *\n   * @param _e Pointer up event.\n   */\n  private resizeMouseUp(_e: PointerEvent) {\n    Touch.clearTouchIdentifier();\n    this.unbindDragEvents();\n  }\n\n  /**\n   * Resize this comment to follow the pointer.\n   *\n   * @param e Pointer move event.\n   */\n  private resizeMouseMove(e: PointerEvent) {\n    this.autoLayout = false;\n    const newXY = this.workspace.moveDrag(e);\n    this.setSize(this.RTL ? -newXY.x : newXY.x, newXY.y);\n  }\n\n  /**\n   * Callback function triggered when the comment has resized.\n   * Resize the text area accordingly.\n   */\n  private resizeComment() {\n    const size = this.getHeightWidth();\n    const topOffset = WorkspaceCommentSvg.TOP_OFFSET;\n    const textOffset = TEXTAREA_OFFSET * 2;\n\n    this.foreignObject?.setAttribute('width', String(size.width));\n    this.foreignObject?.setAttribute('height', String(size.height - topOffset));\n    if (this.RTL) {\n      this.foreignObject?.setAttribute('x', String(-size.width));\n    }\n\n    if (!this.textarea) return;\n    this.textarea.style.width = size.width - textOffset + 'px';\n    this.textarea.style.height = size.height - textOffset - topOffset + 'px';\n  }\n\n  /**\n   * Set size\n   *\n   * @param width width of the container\n   * @param height height of the container\n   */\n  private setSize(width: number, height: number) {\n    // Minimum size of a comment.\n    width = Math.max(width, 45);\n    height = Math.max(height, 20 + WorkspaceCommentSvg.TOP_OFFSET);\n    this.width_ = width;\n    this.height_ = height;\n    this.svgRect_.setAttribute('width', `${width}`);\n    this.svgRect_.setAttribute('height', `${height}`);\n    this.svgRectTarget?.setAttribute('width', `${width}`);\n    this.svgRectTarget?.setAttribute('height', `${height}`);\n    this.svgHandleTarget?.setAttribute('width', `${width}`);\n    this.svgHandleTarget?.setAttribute(\n      'height',\n      String(WorkspaceCommentSvg.TOP_OFFSET),\n    );\n    if (this.RTL) {\n      this.svgRect_.setAttribute('transform', 'scale(-1 1)');\n      this.svgRectTarget?.setAttribute('transform', 'scale(-1 1)');\n    }\n\n    if (this.resizeGroup) {\n      if (this.RTL) {\n        // Mirror the resize group.\n        this.resizeGroup.setAttribute(\n          'transform',\n          'translate(' +\n            (-width + RESIZE_SIZE) +\n            ',' +\n            (height - RESIZE_SIZE) +\n            ') scale(-1 1)',\n        );\n        this.deleteGroup?.setAttribute(\n          'transform',\n          'translate(' +\n            (-width + RESIZE_SIZE) +\n            ',' +\n            -RESIZE_SIZE +\n            ') scale(-1 1)',\n        );\n      } else {\n        this.resizeGroup.setAttribute(\n          'transform',\n          'translate(' +\n            (width - RESIZE_SIZE) +\n            ',' +\n            (height - RESIZE_SIZE) +\n            ')',\n        );\n        this.deleteGroup?.setAttribute(\n          'transform',\n          'translate(' + (width - RESIZE_SIZE) + ',' + -RESIZE_SIZE + ')',\n        );\n      }\n    }\n\n    // Allow the contents to resize.\n    this.resizeComment();\n  }\n\n  /**\n   * Set the focus on the text area.\n   *\n   * @internal\n   */\n  setFocus() {\n    this.focused = true;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n      this.textarea!.focus();\n      this.addFocus();\n      if (this.svgRectTarget) {\n        dom.addClass(this.svgRectTarget, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget) {\n        dom.addClass(this.svgHandleTarget, 'blocklyCommentHandleTargetFocused');\n      }\n    }, 0);\n  }\n\n  /**\n   * Remove focus from the text area.\n   *\n   * @internal\n   */\n  blurFocus() {\n    this.focused = false;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n\n      this.textarea!.blur();\n      this.removeFocus();\n      if (this.svgRectTarget) {\n        dom.removeClass(this.svgRectTarget, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget) {\n        dom.removeClass(\n          this.svgHandleTarget,\n          'blocklyCommentHandleTargetFocused',\n        );\n      }\n    }, 0);\n  }\n\n  /**\n   * Decode an XML comment tag and create a rendered comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @param opt_wsWidth The width of the workspace, which is used to position\n   *     comments correctly in RTL.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXmlRendered(\n    xmlComment: Element,\n    workspace: WorkspaceSvg,\n    opt_wsWidth?: number,\n  ): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment;\n    try {\n      const info = WorkspaceComment.parseAttributes(xmlComment);\n\n      comment = new WorkspaceCommentSvg(\n        workspace,\n        info.content,\n        info.h,\n        info.w,\n        info.id,\n      );\n      if (workspace.rendered) {\n        comment.initSvg(true);\n        comment.render();\n      }\n      // Position the comment correctly, taking into account the width of a\n      // rendered RTL workspace.\n      if (!isNaN(info.x) && !isNaN(info.y)) {\n        if (workspace.RTL) {\n          const wsWidth = opt_wsWidth || workspace.getWidth();\n          comment.moveBy(wsWidth - info.x, info.y);\n        } else {\n          comment.moveBy(info.x, info.y);\n        }\n      }\n    } finally {\n      eventUtils.enable();\n    }\n\n    WorkspaceComment.fireCreateEvent(comment);\n    return comment;\n  }\n}\n\n/** CSS for workspace comment.  See css.js for use. */\nCss.register(`\n.blocklyCommentForeignObject {\n  position: relative;\n  z-index: 0;\n}\n\n.blocklyCommentRect {\n  fill: #E7DE8E;\n  stroke: #bcA903;\n  stroke-width: 1px;\n}\n\n.blocklyCommentTarget {\n  fill: transparent;\n  stroke: #bcA903;\n}\n\n.blocklyCommentTargetFocused {\n  fill: none;\n}\n\n.blocklyCommentHandleTarget {\n  fill: none;\n}\n\n.blocklyCommentHandleTargetFocused {\n  fill: transparent;\n}\n\n.blocklyFocused>.blocklyCommentRect {\n  fill: #B9B272;\n  stroke: #B9B272;\n}\n\n.blocklySelected>.blocklyCommentTarget {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCommentDeleteIcon {\n  cursor: pointer;\n  fill: #000;\n  display: none;\n}\n\n.blocklySelected > .blocklyCommentDeleteIcon {\n  display: block;\n}\n\n.blocklyDeleteIconShape {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1px;\n}\n\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\n  stroke: #fc3;\n}\n`);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.exceptions\n\nimport type {Block} from '../block.js';\nimport type {State} from './blocks.js';\n\nexport class DeserializationError extends Error {}\n\n/**\n * Represents an error where the serialized state is expected to provide a\n * block type, but it is not provided.\n *\n */\nexport class MissingBlockType extends DeserializationError {\n  /**\n   * @param state The state object which is missing the block type.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Expected to find a 'type' property, defining the block type`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a block that did\n * not have a connection that was defined in the serialized state.\n */\nexport class MissingConnection extends DeserializationError {\n  /**\n   * @param connection The name of the connection that is missing. E.g.\n   *     'IF0', or 'next'.\n   * @param block The block missing the connection.\n   * @param state The state object containing the bad connection.\n   * @internal\n   */\n  constructor(\n    connection: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\nconnection`);\n  }\n}\n\n/**\n * Represents an error where deserialization tried to connect two connections\n * that were not compatible.\n */\nexport class BadConnectionCheck extends DeserializationError {\n  /**\n   * @param reason The reason the connections were not compatible.\n   * @param childConnection The name of the incompatible child connection. E.g.\n   *     'output' or 'previous'.\n   * @param childBlock The child block that could not connect to its parent.\n   * @param childState The state object representing the child block.\n   * @internal\n   */\n  constructor(\n    reason: string,\n    childConnection: string,\n    public childBlock: Block,\n    public childState: State,\n  ) {\n    super(`The block ${childBlock.toDevString()} could not connect its\n${childConnection} to its parent, because: ${reason}`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a real block as it\n * was deserializing children of a shadow.\n * This is an error because it is an invariant of Blockly that shadow blocks\n * do not have real children.\n */\nexport class RealChildOfShadow extends DeserializationError {\n  /**\n   * @param state The state object representing the real block.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren`);\n  }\n}\n\nexport class UnregisteredIcon extends DeserializationError {\n  /**\n   * @param iconType The type of the unregistered icon we are attempting to\n   *     deserialize.\n   * @param block The block we are attempting to add the unregistered icon to.\n   * @param state The state object representing the block.\n   */\n  constructor(\n    iconType: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(\n      `Cannot add an icon of type '${iconType}' to the block ` +\n        `${block.toDevString()}, because there is no icon registered with ` +\n        `type '${iconType}'. Make sure that all of your icons have been ` +\n        `registered.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.priorities\n\n/**\n * The priority for deserializing variables.\n */\nexport const VARIABLES = 100;\n\n/**\n * The priority for deserializing variable data.\n */\nexport const PROCEDURES = 75;\n\n/**\n * The priority for deserializing blocks.\n */\nexport const BLOCKS = 50;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for all types of block events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockBase\n\nimport type {Block} from '../block.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\n\n/**\n * Abstract class for any event related to blocks.\n */\nexport class BlockBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the block associated with this event. */\n  blockId?: string;\n\n  /**\n   * @param opt_block The block this event corresponds to.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_block?: Block) {\n    super();\n    this.isBlank = !opt_block;\n\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.workspaceId = opt_block.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockBaseJson {\n    const json = super.toJson() as BlockBaseJson;\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockBase(),\n    ) as BlockBase;\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport interface BlockBaseJson extends AbstractEventJson {\n  blockId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockCreate\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * created.\n */\nexport class BlockCreate extends BlockBase {\n  override type = eventUtils.BLOCK_CREATE;\n\n  /** The XML representation of the created block(s). */\n  xml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the created block(s). */\n  json?: blocks.State;\n\n  /** All of the IDs of created blocks. */\n  ids?: string[];\n\n  /** @param opt_block The created block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.xml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockCreateJson {\n    const json = super.toJson() as BlockCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The block XML is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['ids'] = this.ids;\n    json['json'] = this.json;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockCreate(),\n    ) as BlockCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.ids = json['ids'];\n    newEvent.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (allShadowBlocks(workspace, this.ids)) return;\n    if (forward) {\n      blocks.append(this.json, workspace);\n    } else {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't uncreate non-existent block: \" + id);\n        }\n      }\n    }\n  }\n}\n/**\n * Returns true if all blocks in the list are shadow blocks. If so, that means\n * the top-level block being created is a shadow block. This only happens when a\n * block that was covering up a shadow block is removed. We don't need to create\n * an additional block in that case because the original block still has its\n * shadow block.\n *\n * @param workspace Workspace to check for blocks\n * @param ids A list of block ids that were created in this event\n * @returns True if all block ids in the list are shadow blocks\n */\nconst allShadowBlocks = function (\n  workspace: Workspace,\n  ids: string[],\n): boolean {\n  const shadows = ids\n    .map((id) => workspace.getBlockById(id))\n    .filter((block) => block && block.isShadow());\n  return shadows.length === ids.length;\n};\n\nexport interface BlockCreateJson extends BlockBaseJson {\n  xml: string;\n  ids: string[];\n  json: object;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CREATE, BlockCreate);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a theme update.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ThemeChange\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the workspace theme has changed.\n */\nexport class ThemeChange extends UiBase {\n  /** The name of the new theme that has been set. */\n  themeName?: string;\n\n  override type = eventUtils.THEME_CHANGE;\n\n  /**\n   * @param opt_themeName The theme name. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    event. Undefined for a blank event.\n   */\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.themeName = opt_themeName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ThemeChangeJson {\n    const json = super.toJson() as ThemeChangeJson;\n    if (!this.themeName) {\n      throw new Error(\n        'The theme name is undefined. Either pass a theme name to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['themeName'] = this.themeName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ThemeChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ThemeChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ThemeChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ThemeChange(),\n    ) as ThemeChange;\n    newEvent.themeName = json['themeName'];\n    return newEvent;\n  }\n}\n\nexport interface ThemeChangeJson extends AbstractEventJson {\n  themeName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.THEME_CHANGE, ThemeChange);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a viewport change.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ViewportChange\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the workspace surface's position or scale has\n * changed.\n *\n * Does not notify when the workspace itself resizes.\n */\nexport class ViewportChange extends UiBase {\n  /**\n   * Top edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewTop?: number;\n\n  /**\n   * The left edge of the visible portion of the workspace, relative to\n   * the workspace origin.\n   */\n  viewLeft?: number;\n\n  /** The scale of the workpace. */\n  scale?: number;\n\n  /** The previous scale of the workspace. */\n  oldScale?: number;\n\n  override type = eventUtils.VIEWPORT_CHANGE;\n\n  /**\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_left Left-edge of the visible portion of the workspace relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\n   *     event.\n   */\n  constructor(\n    opt_top?: number,\n    opt_left?: number,\n    opt_scale?: number,\n    opt_workspaceId?: string,\n    opt_oldScale?: number,\n  ) {\n    super(opt_workspaceId);\n\n    this.viewTop = opt_top;\n    this.viewLeft = opt_left;\n    this.scale = opt_scale;\n    this.oldScale = opt_oldScale;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ViewportChangeJson {\n    const json = super.toJson() as ViewportChangeJson;\n    if (this.viewTop === undefined) {\n      throw new Error(\n        'The view top is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.viewLeft === undefined) {\n      throw new Error(\n        'The view left is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.scale === undefined) {\n      throw new Error(\n        'The scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.oldScale === undefined) {\n      throw new Error(\n        'The old scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['viewTop'] = this.viewTop;\n    json['viewLeft'] = this.viewLeft;\n    json['scale'] = this.scale;\n    json['oldScale'] = this.oldScale;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Viewport, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ViewportChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ViewportChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ViewportChange(),\n    ) as ViewportChange;\n    newEvent.viewTop = json['viewTop'];\n    newEvent.viewLeft = json['viewLeft'];\n    newEvent.scale = json['scale'];\n    newEvent.oldScale = json['oldScale'];\n    return newEvent;\n  }\n}\n\nexport interface ViewportChangeJson extends AbstractEventJson {\n  viewTop: number;\n  viewLeft: number;\n  scale: number;\n  oldScale: number;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.VIEWPORT_CHANGE,\n  ViewportChange,\n);\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.config\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly.\n */\ninterface Config {\n  dragRadius: number;\n  flyoutDragRadius: number;\n  snapRadius: number;\n  currentConnectionPreference: number;\n  bumpDelay: number;\n  connectingSnapRadius: number;\n}\n\n/** Default snap radius. */\nconst DEFAULT_SNAP_RADIUS = 28;\n\n/**\n * Object holding all the values on Blockly that we expect developers to be\n * able to change.\n */\nexport const config: Config = {\n  /**\n   * Number of pixels the mouse must move before a drag starts.\n   *\n   */\n  dragRadius: 5,\n  /**\n   * Number of pixels the mouse must move before a drag/scroll starts from the\n   * flyout.  Because the drag-intention is determined when this is reached, it\n   * is larger than dragRadius so that the drag-direction is clearer.\n   *\n   */\n  flyoutDragRadius: 10,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   *\n   */\n  snapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   * This should be the same as the snap radius.\n   *\n   */\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * How much to prefer staying connected to the current connection over moving\n   * to a new connection.  The current previewed connection is considered to be\n   * this much closer to the matching connection on the block than it actually\n   * is.\n   *\n   */\n  currentConnectionPreference: 8,\n  /**\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\n   *\n   */\n  bumpDelay: 250,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ConnectionType\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum ConnectionType {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  INPUT_VALUE = 1,\n  // A left-facing value output.  E.g. 'random fraction'.\n  OUTPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  NEXT_STATEMENT,\n  // An up-facing block stack.  E.g. 'break out of loop'.\n  PREVIOUS_STATEMENT,\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A database of all the rendered connections that could\n *    possibly be connected to (i.e. not collapsed, etc).\n *    Sorted by y coordinate.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionDB\n\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\n\n/**\n * Database of connections.\n * Connections are stored in order of their vertical component.  This way\n * connections in an area may be looked up quickly using a binary search.\n */\nexport class ConnectionDB {\n  /** Array of connections sorted by y position in workspace units. */\n  private readonly connections: RenderedConnection[] = [];\n\n  /**\n   * @param connectionChecker The workspace's connection type checker, used to\n   *     decide if connections are valid during a drag.\n   */\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\n\n  /**\n   * Add a connection to the database. Should not already exist in the database.\n   *\n   * @param connection The connection to be added.\n   * @param yPos The y position used to decide where to insert the connection.\n   * @internal\n   */\n  addConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.calculateIndexForYPos(yPos);\n    this.connections.splice(index, 0, connection);\n  }\n\n  /**\n   * Finds the index of the given connection.\n   *\n   * Starts by doing a binary search to find the approximate location, then\n   * linearly searches nearby for the exact connection.\n   *\n   * @param conn The connection to find.\n   * @param yPos The y position used to find the index of the connection.\n   * @returns The index of the connection, or -1 if the connection was not\n   *     found.\n   */\n  private findIndexOfConnection(\n    conn: RenderedConnection,\n    yPos: number,\n  ): number {\n    if (!this.connections.length) {\n      return -1;\n    }\n\n    const bestGuess = this.calculateIndexForYPos(yPos);\n    if (bestGuess >= this.connections.length) {\n      // Not in list\n      return -1;\n    }\n\n    yPos = conn.y;\n    // Walk forward and back on the y axis looking for the connection.\n    let pointer = bestGuess;\n    while (pointer >= 0 && this.connections[pointer].y === yPos) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer--;\n    }\n\n    pointer = bestGuess;\n    while (\n      pointer < this.connections.length &&\n      this.connections[pointer].y === yPos\n    ) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer++;\n    }\n    return -1;\n  }\n\n  /**\n   * Finds the correct index for the given y position.\n   *\n   * @param yPos The y position used to decide where to insert the connection.\n   * @returns The candidate index.\n   */\n  private calculateIndexForYPos(yPos: number): number {\n    if (!this.connections.length) {\n      return 0;\n    }\n    let pointerMin = 0;\n    let pointerMax = this.connections.length;\n    while (pointerMin < pointerMax) {\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n      if (this.connections[pointerMid].y < yPos) {\n        pointerMin = pointerMid + 1;\n      } else if (this.connections[pointerMid].y > yPos) {\n        pointerMax = pointerMid;\n      } else {\n        pointerMin = pointerMid;\n        break;\n      }\n    }\n    return pointerMin;\n  }\n\n  /**\n   * Remove a connection from the database.  Must already exist in DB.\n   *\n   * @param connection The connection to be removed.\n   * @param yPos The y position used to find the index of the connection.\n   * @throws {Error} If the connection cannot be found in the database.\n   */\n  removeConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.findIndexOfConnection(connection, yPos);\n    if (index === -1) {\n      throw Error('Unable to find connection in connectionDB.');\n    }\n    this.connections.splice(index, 1);\n  }\n\n  /**\n   * Find all nearby connections to the given connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param connection The connection whose neighbours should be returned.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns List of connections.\n   */\n  getNeighbours(\n    connection: RenderedConnection,\n    maxRadius: number,\n  ): RenderedConnection[] {\n    const db = this.connections;\n    const currentX = connection.x;\n    const currentY = connection.y;\n\n    // Binary search to find the closest y location.\n    let pointerMin = 0;\n    let pointerMax = db.length - 2;\n    let pointerMid = pointerMax;\n    while (pointerMin < pointerMid) {\n      if (db[pointerMid].y < currentY) {\n        pointerMin = pointerMid;\n      } else {\n        pointerMax = pointerMid;\n      }\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n    }\n\n    const neighbours: RenderedConnection[] = [];\n    /**\n     * Computes if the current connection is within the allowed radius of\n     * another connection. This function is a closure and has access to outside\n     * variables.\n     *\n     * @param yIndex The other connection's index in the database.\n     * @returns True if the current connection's vertical distance from the\n     *     other connection is less than the allowed radius.\n     */\n    function checkConnection(yIndex: number): boolean {\n      const dx = currentX - db[yIndex].x;\n      const dy = currentY - db[yIndex].y;\n      const r = Math.sqrt(dx * dx + dy * dy);\n      if (r <= maxRadius) {\n        neighbours.push(db[yIndex]);\n      }\n      return dy < maxRadius;\n    }\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    pointerMin = pointerMid;\n    pointerMax = pointerMid;\n    if (db.length) {\n      while (pointerMin >= 0 && checkConnection(pointerMin)) {\n        pointerMin--;\n      }\n      do {\n        pointerMax++;\n      } while (pointerMax < db.length && checkConnection(pointerMax));\n    }\n\n    return neighbours;\n  }\n\n  /**\n   * Is the candidate connection close to the reference connection.\n   * Extremely fast; only looks at Y distance.\n   *\n   * @param index Index in database of candidate connection.\n   * @param baseY Reference connection's Y value.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns True if connection is in range.\n   */\n  private isInYRange(index: number, baseY: number, maxRadius: number): boolean {\n    return Math.abs(this.connections[index].y - baseY) <= maxRadius;\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   *\n   * @param conn The connection searching for a compatible mate.\n   * @param maxRadius The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  searchForClosest(\n    conn: RenderedConnection,\n    maxRadius: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    if (!this.connections.length) {\n      // Don't bother.\n      return {connection: null, radius: maxRadius};\n    }\n\n    // Stash the values of x and y from before the drag.\n    const baseY = conn.y;\n    const baseX = conn.x;\n\n    conn.x = baseX + dxy.x;\n    conn.y = baseY + dxy.y;\n\n    // calculateIndexForYPos_ finds an index for insertion, which is always\n    // after any block with the same y index.  We want to search both forward\n    // and back, so search on both sides of the index.\n    const closestIndex = this.calculateIndexForYPos(conn.y);\n\n    let bestConnection = null;\n    let bestRadius = maxRadius;\n    let temp;\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    let pointerMin = closestIndex - 1;\n    while (pointerMin >= 0 && this.isInYRange(pointerMin, conn.y, maxRadius)) {\n      temp = this.connections[pointerMin];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMin--;\n    }\n\n    let pointerMax = closestIndex;\n    while (\n      pointerMax < this.connections.length &&\n      this.isInYRange(pointerMax, conn.y, maxRadius)\n    ) {\n      temp = this.connections[pointerMax];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMax++;\n    }\n\n    // Reset the values of x and y.\n    conn.x = baseX;\n    conn.y = baseY;\n    // If there were no valid connections, bestConnection will be null.\n    return {connection: bestConnection, radius: bestRadius};\n  }\n\n  /**\n   * Initialize a set of connection DBs for a workspace.\n   *\n   * @param checker The workspace's connection checker, used to decide if\n   *     connections are valid during a drag.\n   * @returns Array of databases.\n   */\n  static init(checker: IConnectionChecker): ConnectionDB[] {\n    // Create four databases, one for each connection type.\n    const dbList = [];\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\n    return dbList;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu similar to Closure's goog.ui.Menu\n *\n * @class\n */\n// Former goog.module ID: Blockly.Menu\n\nimport * as browserEvents from './browser_events.js';\nimport type {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\n\n/**\n * A basic menu class.\n */\nexport class Menu {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   */\n  private readonly menuItems: MenuItem[] = [];\n\n  /**\n   * Coordinates of the mousedown event that caused this menu to open. Used to\n   * prevent the consequent mouseup event due to a simple click from\n   * activating a menu item immediately.\n   */\n  openingCoords: Coordinate | null = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   */\n  private highlightedItem: MenuItem | null = null;\n\n  /** Mouse over event data. */\n  private mouseOverHandler: browserEvents.Data | null = null;\n\n  /** Click event data. */\n  private clickHandler: browserEvents.Data | null = null;\n\n  /** Mouse enter event data. */\n  private mouseEnterHandler: browserEvents.Data | null = null;\n\n  /** Mouse leave event data. */\n  private mouseLeaveHandler: browserEvents.Data | null = null;\n\n  /** Key down event data. */\n  private onKeyDownHandler: browserEvents.Data | null = null;\n\n  /** The menu's root DOM element. */\n  private element: HTMLDivElement | null = null;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Constructs a new Menu instance. */\n  constructor() {}\n\n  /**\n   * Add a new menu item to the bottom of this menu.\n   *\n   * @param menuItem Menu item to append.\n   * @internal\n   */\n  addChild(menuItem: MenuItem) {\n    this.menuItems.push(menuItem);\n  }\n\n  /**\n   * Creates the menu DOM.\n   *\n   * @param container Element upon which to append this menu.\n   * @returns The menu's root DOM element.\n   */\n  render(container: Element): HTMLDivElement {\n    const element = document.createElement('div');\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n    element.tabIndex = 0;\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    this.element = element;\n\n    // Add menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      element.appendChild(menuItem.createDom());\n    }\n\n    // Add event handlers.\n    this.mouseOverHandler = browserEvents.conditionalBind(\n      element,\n      'pointerover',\n      this,\n      this.handleMouseOver,\n      true,\n    );\n    this.clickHandler = browserEvents.conditionalBind(\n      element,\n      'pointerup',\n      this,\n      this.handleClick,\n      true,\n    );\n    this.mouseEnterHandler = browserEvents.conditionalBind(\n      element,\n      'pointerenter',\n      this,\n      this.handleMouseEnter,\n      true,\n    );\n    this.mouseLeaveHandler = browserEvents.conditionalBind(\n      element,\n      'pointerleave',\n      this,\n      this.handleMouseLeave,\n      true,\n    );\n    this.onKeyDownHandler = browserEvents.conditionalBind(\n      element,\n      'keydown',\n      this,\n      this.handleKeyEvent,\n    );\n\n    container.appendChild(element);\n    return element;\n  }\n\n  /**\n   * Gets the menu's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): HTMLDivElement | null {\n    return this.element;\n  }\n\n  /**\n   * Focus the menu element.\n   *\n   * @internal\n   */\n  focus() {\n    const el = this.getElement();\n    if (el) {\n      el.focus({preventScroll: true});\n      dom.addClass(el, 'blocklyFocused');\n    }\n  }\n\n  /** Blur the menu element. */\n  private blur() {\n    const el = this.getElement();\n    if (el) {\n      el.blur();\n      dom.removeClass(el, 'blocklyFocused');\n    }\n  }\n\n  /**\n   * Set the menu accessibility role.\n   *\n   * @param roleName role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /** Dispose of this menu. */\n  dispose() {\n    // Remove event handlers.\n    if (this.mouseOverHandler) {\n      browserEvents.unbind(this.mouseOverHandler);\n      this.mouseOverHandler = null;\n    }\n    if (this.clickHandler) {\n      browserEvents.unbind(this.clickHandler);\n      this.clickHandler = null;\n    }\n    if (this.mouseEnterHandler) {\n      browserEvents.unbind(this.mouseEnterHandler);\n      this.mouseEnterHandler = null;\n    }\n    if (this.mouseLeaveHandler) {\n      browserEvents.unbind(this.mouseLeaveHandler);\n      this.mouseLeaveHandler = null;\n    }\n    if (this.onKeyDownHandler) {\n      browserEvents.unbind(this.onKeyDownHandler);\n      this.onKeyDownHandler = null;\n    }\n\n    // Remove menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      menuItem.dispose();\n    }\n    this.element = null;\n  }\n\n  // Child component management.\n\n  /**\n   * Returns the child menu item that owns the given DOM element,\n   * or null if no such menu item is found.\n   *\n   * @param elem DOM element whose owner is to be returned.\n   * @returns Menu item for which the DOM element belongs to.\n   */\n  private getMenuItem(elem: Element): MenuItem | null {\n    const menuElem = this.getElement();\n    // Node might be the menu border (resulting in no associated menu item), or\n    // a menu item's div, or some element within the menu item.\n    // Walk up parents until one meets either the menu's root element, or\n    // a menu item's div.\n    let currentElement: Element | null = elem;\n    while (currentElement && currentElement !== menuElem) {\n      if (currentElement.classList.contains('blocklyMenuItem')) {\n        // Having found a menu item's div, locate that menu item in this menu.\n        for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n          if (menuItem.getElement() === currentElement) {\n            return menuItem;\n          }\n        }\n      }\n      currentElement = currentElement.parentElement;\n    }\n    return null;\n  }\n\n  // Highlight management.\n\n  /**\n   * Highlights the given menu item, or clears highlighting if null.\n   *\n   * @param item Item to highlight, or null.\n   * @internal\n   */\n  setHighlighted(item: MenuItem | null) {\n    const currentHighlighted = this.highlightedItem;\n    if (currentHighlighted) {\n      currentHighlighted.setHighlighted(false);\n      this.highlightedItem = null;\n    }\n    if (item) {\n      item.setHighlighted(true);\n      this.highlightedItem = item;\n      // Bring the highlighted item into view. This has no effect if the menu is\n      // not scrollable.\n      const el = this.getElement() as Element;\n      style.scrollIntoContainerView(item.getElement() as Element, el);\n\n      aria.setState(el, aria.State.ACTIVEDESCENDANT, item.getId());\n    }\n  }\n\n  /**\n   * Highlights the next highlightable item (or the first if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightNext() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index, 1);\n  }\n\n  /**\n   * Highlights the previous highlightable item (or the last if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightPrevious() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\n  }\n\n  /** Highlights the first highlightable item. */\n  private highlightFirst() {\n    this.highlightHelper(-1, 1);\n  }\n\n  /** Highlights the last highlightable item. */\n  private highlightLast() {\n    this.highlightHelper(this.menuItems.length, -1);\n  }\n\n  /**\n   * Helper function that manages the details of moving the highlight among\n   * child menuitems in response to keyboard events.\n   *\n   * @param startIndex Start index.\n   * @param delta Step direction: 1 to go down, -1 to go up.\n   */\n  private highlightHelper(startIndex: number, delta: number) {\n    let index = startIndex + delta;\n    let menuItem;\n    while ((menuItem = this.menuItems[index])) {\n      if (menuItem.isEnabled()) {\n        this.setHighlighted(menuItem);\n        break;\n      }\n      index += delta;\n    }\n  }\n\n  // Mouse events.\n\n  /**\n   * Handles mouseover events. Highlight menuitems as the user hovers over them.\n   *\n   * @param e Mouse event to handle.\n   */\n  private handleMouseOver(e: PointerEvent) {\n    const menuItem = this.getMenuItem(e.target as Element);\n\n    if (menuItem) {\n      if (menuItem.isEnabled()) {\n        if (this.highlightedItem !== menuItem) {\n          this.setHighlighted(menuItem);\n        }\n      } else {\n        this.setHighlighted(null);\n      }\n    }\n  }\n\n  /**\n   * Handles click events. Pass the event onto the child menuitem to handle.\n   *\n   * @param e Click event to handle.\n   */\n  private handleClick(e: PointerEvent) {\n    const oldCoords = this.openingCoords;\n    // Clear out the saved opening coords immediately so they're not used twice.\n    this.openingCoords = null;\n    if (oldCoords && typeof e.clientX === 'number') {\n      const newCoords = new Coordinate(e.clientX, e.clientY);\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\n        // This menu was opened by a mousedown and we're handling the consequent\n        // click event. The coords haven't changed, meaning this was the same\n        // opening event. Don't do the usual behavior because the menu just\n        // popped up under the mouse and the user didn't mean to activate this\n        // item.\n        return;\n      }\n    }\n\n    const menuItem = this.getMenuItem(e.target as Element);\n    if (menuItem) {\n      menuItem.performAction();\n    }\n  }\n\n  /**\n   * Handles mouse enter events. Focus the element.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseEnter(_e: PointerEvent) {\n    this.focus();\n  }\n\n  /**\n   * Handles mouse leave events. Blur and clear highlight.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseLeave(_e: PointerEvent) {\n    if (this.getElement()) {\n      this.blur();\n      this.setHighlighted(null);\n    }\n  }\n\n  // Keyboard events.\n\n  /**\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\n   * calling\n   * {@link Menu#handleKeyEventInternal_}.\n   *\n   * @param e Key event to handle.\n   */\n  private handleKeyEvent(e: Event) {\n    if (!this.menuItems.length) {\n      // Empty menu.\n      return;\n    }\n    const keyboardEvent = e as KeyboardEvent;\n    if (\n      keyboardEvent.shiftKey ||\n      keyboardEvent.ctrlKey ||\n      keyboardEvent.metaKey ||\n      keyboardEvent.altKey\n    ) {\n      // Do not handle the key event if any modifier key is pressed.\n      return;\n    }\n\n    const highlighted = this.highlightedItem;\n    switch (keyboardEvent.key) {\n      case 'Enter':\n      case ' ':\n        if (highlighted) {\n          highlighted.performAction();\n        }\n        break;\n\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n\n      case 'PageUp':\n      case 'Home':\n        this.highlightFirst();\n        break;\n\n      case 'PageDown':\n      case 'End':\n        this.highlightLast();\n        break;\n\n      default:\n        // Not a key the menu is interested in.\n        return;\n    }\n    // The menu used this key, don't let it have secondary effects.\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Get the size of a rendered menu.\n   *\n   * @returns Object with width and height properties.\n   * @internal\n   */\n  getSize(): Size {\n    const menuDom = this.getElement() as HTMLDivElement;\n    const menuSize = style.getSize(menuDom);\n    // Recalculate height for the total content, not only box height.\n    menuSize.height = menuDom.scrollHeight;\n    return menuSize;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu item similar to Closure's goog.ui.MenuItem\n *\n * @class\n */\n// Former goog.module ID: Blockly.MenuItem\n\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\n\n/**\n * Class representing an item in a menu.\n */\nexport class MenuItem {\n  /** Is the menu item clickable, as opposed to greyed-out. */\n  private enabled = true;\n\n  /** The DOM element for the menu item. */\n  private element: HTMLDivElement | null = null;\n\n  /** Whether the menu item is rendered right-to-left. */\n  private rightToLeft = false;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Is this menu item checkable. */\n  private checkable = false;\n\n  /** Is this menu item currently checked. */\n  private checked = false;\n\n  /** Is this menu item currently highlighted. */\n  private highlight = false;\n\n  /** Bound function to call when this menu item is clicked. */\n  private actionHandler: Function | null = null;\n\n  /**\n   * @param content Text caption to display as the content of the item, or a\n   *     HTML element to display.\n   * @param opt_value Data/model associated with the menu item.\n   */\n  constructor(\n    private readonly content: string | HTMLElement,\n    private readonly opt_value?: string,\n  ) {}\n\n  /**\n   * Creates the menuitem's DOM.\n   *\n   * @returns Completed DOM.\n   */\n  createDom(): Element {\n    const element = document.createElement('div');\n    element.id = idGenerator.getNextUniqueId();\n    this.element = element;\n\n    // Set class and style\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\n    element.className =\n      'blocklyMenuItem goog-menuitem ' +\n      (this.enabled ? '' : 'blocklyMenuItemDisabled goog-menuitem-disabled ') +\n      (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\n      (this.highlight\n        ? 'blocklyMenuItemHighlight goog-menuitem-highlight '\n        : '') +\n      (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\n\n    const content = document.createElement('div');\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\n    // Add a checkbox for checkable menu items.\n    if (this.checkable) {\n      const checkbox = document.createElement('div');\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\n      content.appendChild(checkbox);\n    }\n\n    let contentDom: Node = this.content as HTMLElement;\n    if (typeof this.content === 'string') {\n      contentDom = document.createTextNode(this.content);\n    }\n    content.appendChild(contentDom);\n    element.appendChild(content);\n\n    // Initialize ARIA role and state.\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    aria.setState(\n      element,\n      aria.State.SELECTED,\n      (this.checkable && this.checked) || false,\n    );\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\n\n    return element;\n  }\n\n  /** Dispose of this menu item. */\n  dispose() {\n    this.element = null;\n  }\n\n  /**\n   * Gets the menu item's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): Element | null {\n    return this.element;\n  }\n\n  /**\n   * Gets the unique ID for this menu item.\n   *\n   * @returns Unique component ID.\n   * @internal\n   */\n  getId(): string {\n    return this.element!.id;\n  }\n\n  /**\n   * Gets the value associated with the menu item.\n   *\n   * @returns value Value associated with the menu item.\n   * @internal\n   */\n  getValue(): string | null {\n    return this.opt_value ?? null;\n  }\n\n  /**\n   * Set menu item's rendering direction.\n   *\n   * @param rtl True if RTL, false if LTR.\n   * @internal\n   */\n  setRightToLeft(rtl: boolean) {\n    this.rightToLeft = rtl;\n  }\n\n  /**\n   * Set the menu item's accessibility role.\n   *\n   * @param roleName Role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /**\n   * Sets the menu item to be checkable or not. Set to true for menu items\n   * that represent checkable options.\n   *\n   * @param checkable Whether the menu item is checkable.\n   * @internal\n   */\n  setCheckable(checkable: boolean) {\n    this.checkable = checkable;\n  }\n\n  /**\n   * Checks or unchecks the component.\n   *\n   * @param checked Whether to check or uncheck the component.\n   * @internal\n   */\n  setChecked(checked: boolean) {\n    this.checked = checked;\n  }\n\n  /**\n   * Highlights or unhighlights the component.\n   *\n   * @param highlight Whether to highlight or unhighlight the component.\n   * @internal\n   */\n  setHighlighted(highlight: boolean) {\n    this.highlight = highlight;\n\n    const el = this.getElement();\n    if (el && this.isEnabled()) {\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\n      // May 2020.\n      const name = 'blocklyMenuItemHighlight';\n      const nameDep = 'goog-menuitem-highlight';\n      if (highlight) {\n        dom.addClass(el, name);\n        dom.addClass(el, nameDep);\n      } else {\n        dom.removeClass(el, name);\n        dom.removeClass(el, nameDep);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the menu item is enabled, false otherwise.\n   *\n   * @returns Whether the menu item is enabled.\n   * @internal\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enables or disables the menu item.\n   *\n   * @param enabled Whether to enable or disable the menu item.\n   * @internal\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Performs the appropriate action when the menu item is activated\n   * by the user.\n   *\n   * @internal\n   */\n  performAction() {\n    if (this.isEnabled() && this.actionHandler) {\n      this.actionHandler(this);\n    }\n  }\n\n  /**\n   * Set the handler that's called when the menu item is activated by the user.\n   * `obj` will be used as the 'this' object in the function when called.\n   *\n   * @param fn The handler.\n   * @param obj Used as the 'this' object in fn when called.\n   * @internal\n   */\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\n    this.actionHandler = fn.bind(obj);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registry for context menu option items.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ContextMenuRegistry\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of context menu items. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ContextMenuRegistry.registry.\n */\nexport class ContextMenuRegistry {\n  static registry: ContextMenuRegistry;\n  /** Registry of all registered RegistryItems, keyed by ID. */\n  private registry_ = new Map<string, RegistryItem>();\n\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\n  constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry. */\n  reset() {\n    this.registry_.clear();\n  }\n\n  /**\n   * Registers a RegistryItem.\n   *\n   * @param item Context menu item to register.\n   * @throws {Error} if an item with the given ID already exists.\n   */\n  register(item: RegistryItem) {\n    if (this.registry_.has(item.id)) {\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\n    }\n    this.registry_.set(item.id, item);\n  }\n\n  /**\n   * Unregisters a RegistryItem with the given ID.\n   *\n   * @param id The ID of the RegistryItem to remove.\n   * @throws {Error} if an item with the given ID does not exist.\n   */\n  unregister(id: string) {\n    if (!this.registry_.has(id)) {\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\n    }\n    this.registry_.delete(id);\n  }\n\n  /**\n   * @param id The ID of the RegistryItem to get.\n   * @returns RegistryItem or null if not found\n   */\n  getItem(id: string): RegistryItem | null {\n    return this.registry_.get(id) ?? null;\n  }\n\n  /**\n   * Gets the valid context menu options for the given scope type (e.g. block or\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\n   * they should not be hidden.\n   *\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\n   *     or on a workspace)\n   * @param scope Current scope of context menu (i.e., the exact workspace or\n   *     block being clicked on)\n   * @returns the list of ContextMenuOptions\n   */\n  getContextMenuOptions(\n    scopeType: ScopeType,\n    scope: Scope,\n  ): ContextMenuOption[] {\n    const menuOptions: ContextMenuOption[] = [];\n    for (const item of this.registry_.values()) {\n      if (scopeType === item.scopeType) {\n        const precondition = item.preconditionFn(scope);\n        if (precondition !== 'hidden') {\n          const displayText =\n            typeof item.displayText === 'function'\n              ? item.displayText(scope)\n              : item.displayText;\n          const menuOption: ContextMenuOption = {\n            text: displayText,\n            enabled: precondition === 'enabled',\n            callback: item.callback,\n            scope,\n            weight: item.weight,\n          };\n          menuOptions.push(menuOption);\n        }\n      }\n    }\n    menuOptions.sort(function (a, b) {\n      return a.weight - b.weight;\n    });\n    return menuOptions;\n  }\n}\n\nexport namespace ContextMenuRegistry {\n  /**\n   * Where this menu item should be rendered. If the menu item should be\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\n   * should be registered for each scope.\n   */\n  export enum ScopeType {\n    BLOCK = 'block',\n    WORKSPACE = 'workspace',\n  }\n\n  /**\n   * The actual workspace/block where the menu is being rendered. This is passed\n   * to callback and displayText functions that depend on this information.\n   */\n  export interface Scope {\n    block?: BlockSvg;\n    workspace?: WorkspaceSvg;\n  }\n\n  /**\n   * A menu item as entered in the registry.\n   */\n  export interface RegistryItem {\n    callback: (p1: Scope) => void;\n    scopeType: ScopeType;\n    displayText: ((p1: Scope) => string | HTMLElement) | string | HTMLElement;\n    preconditionFn: (p1: Scope) => string;\n    weight: number;\n    id: string;\n  }\n\n  /**\n   * A menu item as presented to contextmenu.js.\n   */\n  export interface ContextMenuOption {\n    text: string | HTMLElement;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n    scope: Scope;\n    weight: number;\n  }\n\n  /**\n   * A subset of ContextMenuOption corresponding to what was publicly\n   * documented.  ContextMenuOption should be preferred for new code.\n   */\n  export interface LegacyContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n  }\n\n  /**\n   * Singleton instance of this class. All interactions with this class should\n   * be done on this object.\n   */\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\n}\n\nexport type ScopeType = ContextMenuRegistry.ScopeType;\nexport const ScopeType = ContextMenuRegistry.ScopeType;\nexport type Scope = ContextMenuRegistry.Scope;\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\nexport type LegacyContextMenuOption =\n  ContextMenuRegistry.LegacyContextMenuOption;\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The layer to place blocks on.\n *\n * @internal\n */\nexport const BLOCK = 50;\n\n/**\n * The layer to place bubbles on.\n *\n * @internal\n */\nexport const BUBBLE = 100;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a bubble visually.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BubbleDragger\n\nimport {ComponentManager} from './component_manager.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as layers from './layers.js';\n\n/**\n * Class for a bubble dragger.  It moves things on the bubble canvas around the\n * workspace when they are being dragged by a mouse or touch.  These can be\n * block comments, mutators, warnings, or workspace comments.\n */\nexport class BubbleDragger {\n  /** Which drag target the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget | null = null;\n\n  /** Whether the bubble would be deleted if dropped immediately. */\n  private wouldDeleteBubble_ = false;\n  private readonly startXY_: Coordinate;\n\n  /**\n   * @param bubble The item on the bubble canvas to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(\n    private bubble: IBubble,\n    private workspace: WorkspaceSvg,\n  ) {\n    /**\n     * The location of the top left corner of the dragging bubble's body at the\n     * beginning of the drag, in workspace coordinates.\n     */\n    this.startXY_ = this.bubble.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Start dragging a bubble.\n   *\n   * @internal\n   */\n  startBubbleDrag() {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n\n    this.workspace.setResizesEnabled(false);\n    if ((this.bubble as AnyDuringMigration).setAutoLayout) {\n      (this.bubble as AnyDuringMigration).setAutoLayout(false);\n    }\n\n    this.workspace.getLayerManager()?.moveToDragLayer(this.bubble);\n\n    this.bubble.setDragging && this.bubble.setDragging(true);\n  }\n\n  /**\n   * Execute a step of bubble dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  dragBubble(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.bubble.moveDuringDrag(newLoc);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace.getDragTarget(e);\n\n    const oldWouldDeleteBubble = this.wouldDeleteBubble_;\n    this.wouldDeleteBubble_ = this.shouldDelete_(this.dragTarget_);\n    if (oldWouldDeleteBubble !== this.wouldDeleteBubble_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBubbleDrag_();\n    }\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // shouldDelete_\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.bubble);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.bubble);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.bubble);\n  }\n\n  /**\n   * Whether ending the drag would delete the bubble.\n   *\n   * @param dragTarget The drag target that the bubblee is currently over.\n   * @returns Whether dropping the bubble immediately would delete the block.\n   */\n  private shouldDelete_(dragTarget: IDragTarget | null): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n        dragTarget.id,\n        ComponentManager.Capability.DELETE_AREA,\n      );\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(this.bubble, false);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging bubble would be deleted if released immediately.\n   */\n  private updateCursorDuringBubbleDrag_() {\n    this.bubble.setDeleteStyle(this.wouldDeleteBubble_);\n  }\n\n  /**\n   * Finish a bubble drag and put the bubble back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  endBubbleDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.dragBubble(e, currentDragDeltaXY);\n\n    const preventMove =\n      this.dragTarget_ && this.dragTarget_.shouldPreventMove(this.bubble);\n    let newLoc;\n    if (preventMove) {\n      newLoc = this.startXY_;\n    } else {\n      const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n      newLoc = Coordinate.sum(this.startXY_, delta);\n    }\n    // Move the bubble to its final location.\n    this.bubble.moveTo(newLoc.x, newLoc.y);\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.bubble);\n    }\n\n    if (this.wouldDeleteBubble_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.bubble.dispose();\n    } else {\n      // Put everything back onto the bubble canvas.\n      if (this.bubble.setDragging) {\n        this.bubble.setDragging(false);\n        this.workspace\n          .getLayerManager()\n          ?.moveOffDragLayer(this.bubble, layers.BUBBLE);\n      }\n      this.fireMoveEvent_();\n    }\n    this.workspace.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /** Fire a move event at the end of a bubble drag. */\n  private fireMoveEvent_() {\n    if (this.bubble instanceof WorkspaceCommentSvg) {\n      const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n        this.bubble,\n      ) as CommentMove;\n      event.setOldCoordinate(this.startXY_);\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n    // TODO (fenichel): move events for comments.\n    return;\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  private pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n      pixelCoord.x / this.workspace.scale,\n      pixelCoord.y / this.workspace.scale,\n    );\n    if (this.workspace.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.internalConstants\n\nimport {ConnectionType} from './connection_type.js';\n\n/**\n * Number of characters to truncate a collapsed block to.\n *\n * @internal\n */\nexport const COLLAPSE_CHARS = 30;\n\n/**\n * When dragging a block out of a stack, split the stack in two (true), or drag\n * out the block healing the stack (false).\n *\n * @internal\n */\nexport const DRAG_STACK = true;\n\n/**\n * Lookup table for determining the opposite type of a connection.\n *\n * @internal\n */\nexport const OPPOSITE_TYPE: number[] = [];\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\n  ConnectionType.PREVIOUS_STATEMENT;\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\n  ConnectionType.NEXT_STATEMENT;\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Rename\n * variable...' and if selected, should trigger the prompt to rename a variable.\n *\n * @internal\n */\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\n * variable' and if selected, should trigger the prompt to delete a variable.\n *\n * @internal\n */\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a workspace visually.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceDragger\n\nimport * as common from './common.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a workspace dragger.  It moves the workspace around when it is\n * being dragged by a mouse or touch.\n *\n */\nexport class WorkspaceDragger {\n  private readonly horizontalScrollEnabled_: boolean;\n  private readonly verticalScrollEnabled_: boolean;\n  protected startScrollXY_: Coordinate;\n\n  /** @param workspace The workspace to drag. */\n  constructor(private workspace: WorkspaceSvg) {\n    /** Whether horizontal scroll is enabled. */\n    this.horizontalScrollEnabled_ = this.workspace.isMovableHorizontally();\n\n    /** Whether vertical scroll is enabled. */\n    this.verticalScrollEnabled_ = this.workspace.isMovableVertically();\n\n    /**\n     * The scroll position of the workspace at the beginning of the drag.\n     * Coordinate system: pixel coordinates.\n     */\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'WorkspaceSvg'.\n    this.workspace = null as AnyDuringMigration;\n  }\n\n  /**\n   * Start dragging the workspace.\n   *\n   * @internal\n   */\n  startDrag() {\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n  }\n\n  /**\n   * Finish dragging the workspace and put everything back where it belongs.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  endDrag(currentDragDeltaXY: Coordinate) {\n    // Make sure everything is up to date.\n    this.drag(currentDragDeltaXY);\n  }\n\n  /**\n   * Move the workspace based on the most recent mouse movements.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  drag(currentDragDeltaXY: Coordinate) {\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\n\n    if (this.horizontalScrollEnabled_ && this.verticalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, newXY.y);\n    } else if (this.horizontalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\n    } else if (this.verticalScrollEnabled_) {\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\n    } else {\n      throw new TypeError('Invalid state.');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an in-progress gesture, e.g. a drag,\n * tap, or pinch to zoom.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Gesture\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {IIcon} from './interfaces/i_icon.js';\n\n/**\n * Note: In this file \"start\" refers to pointerdown\n * events.  \"End\" refers to pointerup events.\n */\n\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\nconst ZOOM_IN_MULTIPLIER = 5;\n\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\nconst ZOOM_OUT_MULTIPLIER = 6;\n\n/**\n * Class for one gesture.\n */\nexport class Gesture {\n  /**\n   * The position of the pointer when the gesture started.  Units are CSS\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\n   * clientX/Y).\n   */\n  private mouseDownXY = new Coordinate(0, 0);\n  private currentDragDeltaXY: Coordinate;\n\n  /**\n   * The bubble that the gesture started on, or null if it did not start on a\n   * bubble.\n   */\n  private startBubble: IBubble | null = null;\n\n  /**\n   * The field that the gesture started on, or null if it did not start on a\n   * field.\n   */\n  private startField: Field | null = null;\n\n  /**\n   * The icon that the gesture started on, or null if it did not start on an\n   * icon.\n   */\n  private startIcon: IIcon | null = null;\n\n  /**\n   * The block that the gesture started on, or null if it did not start on a\n   * block.\n   */\n  private startBlock: BlockSvg | null = null;\n\n  /**\n   * The block that this gesture targets.  If the gesture started on a\n   * shadow block, this is the first non-shadow parent of the block.  If the\n   * gesture started in the flyout, this is the root block of the block group\n   * that was clicked or dragged.\n   */\n  private targetBlock: BlockSvg | null = null;\n\n  /**\n   * The workspace that the gesture started on.  There may be multiple\n   * workspaces on a page; this is more accurate than using\n   * Blockly.common.getMainWorkspace().\n   */\n  protected startWorkspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Whether the pointer has at any point moved out of the drag radius.\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\n   * at its start point.\n   */\n  private hasExceededDragRadius = false;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The object tracking a bubble drag, or null if none is in progress. */\n  private bubbleDragger: BubbleDragger | null = null;\n\n  /** The object tracking a block drag, or null if none is in progress. */\n  private blockDragger: IBlockDragger | null = null;\n\n  /**\n   * The object tracking a workspace or flyout workspace drag, or null if none\n   * is in progress.\n   */\n  private workspaceDragger: WorkspaceDragger | null = null;\n\n  /** The flyout a gesture started in, if any. */\n  private flyout: IFlyout | null = null;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private calledUpdateIsDragging = false;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private gestureHasStarted = false;\n\n  /** Boolean used internally to break a cycle in disposal. */\n  protected isEnding_ = false;\n  private healStack: boolean;\n\n  /** The event that most recently updated this gesture. */\n  private mostRecentEvent: PointerEvent;\n\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\n  private isMultiTouch_ = false;\n\n  /** A map of cached points used for tracking multi-touch gestures. */\n  private cachedPoints = new Map<string, Coordinate | null>();\n\n  /**\n   * This is the ratio between the starting distance between the touch points\n   * and the most recent distance between the touch points.\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\n   */\n  private previousScale = 0;\n\n  /** The starting distance between two touch points. */\n  private startDistance = 0;\n\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\n  private isPinchZoomEnabled: boolean | null = null;\n\n  /**\n   * The owner of the dropdownDiv when this gesture first starts.\n   * Needed because we'll close the dropdown before fields get to\n   * act on their events, and some fields care about who owns\n   * the dropdown.\n   */\n  currentDropdownOwner: Field | null = null;\n\n  /**\n   * @param e The event that kicked off this gesture.\n   * @param creatorWorkspace The workspace that created this gesture and has a\n   *     reference to it.\n   */\n  constructor(\n    e: PointerEvent,\n    private readonly creatorWorkspace: WorkspaceSvg,\n  ) {\n    this.mostRecentEvent = e;\n\n    /**\n     * How far the pointer has moved during this drag, in pixel units.\n     * (0, 0) is at this.mouseDownXY_.\n     */\n    this.currentDragDeltaXY = new Coordinate(0, 0);\n\n    /**\n     * Boolean used to indicate whether or not to heal the stack after\n     * disconnecting a block.\n     */\n    this.healStack = !internalConstants.DRAG_STACK;\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    Touch.clearTouchIdentifier();\n    Tooltip.unblock();\n    // Clear the owner's reference to this gesture.\n    this.creatorWorkspace.clearGesture();\n\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n\n    if (this.blockDragger) {\n      this.blockDragger.dispose();\n    }\n    if (this.workspaceDragger) {\n      this.workspaceDragger.dispose();\n    }\n  }\n\n  /**\n   * Update internal state based on an event.\n   *\n   * @param e The most recent pointer event.\n   */\n  private updateFromEvent(e: PointerEvent) {\n    const currentXY = new Coordinate(e.clientX, e.clientY);\n    const changed = this.updateDragDelta(currentXY);\n    // Exceeded the drag radius for the first time.\n    if (changed) {\n      this.updateIsDragging();\n      Touch.longStop();\n    }\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\n   * position.\n   *\n   * @param currentXY The most recent pointer position, in pixel units,\n   *     with (0, 0) at the window's top left corner.\n   * @returns True if the drag just exceeded the drag radius for the first time.\n   */\n  private updateDragDelta(currentXY: Coordinate): boolean {\n    this.currentDragDeltaXY = Coordinate.difference(\n      currentXY,\n      this.mouseDownXY,\n    );\n\n    if (!this.hasExceededDragRadius) {\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY);\n\n      // The flyout has a different drag radius from the rest of Blockly.\n      const limitRadius = this.flyout\n        ? config.flyoutDragRadius\n        : config.dragRadius;\n\n      this.hasExceededDragRadius = currentDragDelta > limitRadius;\n      return this.hasExceededDragRadius;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a block is being dragged from the\n   * flyout.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged from the flyout this function creates\n   * the new block on the main workspace and updates targetBlock_ and\n   * startWorkspace_.\n   *\n   * @returns True if a block is being dragged from the flyout.\n   */\n  private updateIsDraggingFromFlyout(): boolean {\n    if (!this.targetBlock || !this.flyout?.isBlockCreatable(this.targetBlock)) {\n      return false;\n    }\n    if (!this.flyout.targetWorkspace) {\n      throw new Error(`Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined`);\n    }\n    if (\n      !this.flyout.isScrollable() ||\n      this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)\n    ) {\n      this.startWorkspace_ = this.flyout.targetWorkspace;\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\n      // Start the event group now, so that the same event group is used for\n      // block creation and block dragging.\n      if (!eventUtils.getGroup()) {\n        eventUtils.setGroup(true);\n      }\n      // The start block is no longer relevant, because this is a drag.\n      this.startBlock = null;\n      this.targetBlock = this.flyout.createBlock(this.targetBlock);\n      this.targetBlock.select();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a bubble is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a bubble should be dragged this function creates the necessary\n   * BubbleDragger and starts the drag.\n   *\n   * @returns True if a bubble is being dragged.\n   */\n  private updateIsDraggingBubble(): boolean {\n    if (!this.startBubble) {\n      return false;\n    }\n\n    this.startDraggingBubble();\n    return true;\n  }\n\n  /**\n   * Check whether to start a block drag. If a block should be dragged, either\n   * from the flyout or in the workspace, create the necessary BlockDragger and\n   * start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged, either from the flyout or in the\n   * workspace, this function creates the necessary BlockDragger and starts the\n   * drag.\n   *\n   * @returns True if a block is being dragged.\n   */\n  private updateIsDraggingBlock(): boolean {\n    if (!this.targetBlock) {\n      return false;\n    }\n    if (this.flyout) {\n      if (this.updateIsDraggingFromFlyout()) {\n        this.startDraggingBlock();\n        return true;\n      }\n    } else if (this.targetBlock.isMovable()) {\n      this.startDraggingBlock();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Check whether to start a workspace drag. If a workspace is being dragged,\n   * create the necessary WorkspaceDragger and start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a workspace is being dragged this function creates the\n   * necessary WorkspaceDragger and starts the drag.\n   */\n  private updateIsDraggingWorkspace() {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging the workspace because the ' +\n          'start workspace is undefined',\n      );\n    }\n\n    const wsMovable = this.flyout\n      ? this.flyout.isScrollable()\n      : this.startWorkspace_ && this.startWorkspace_.isDraggable();\n    if (!wsMovable) return;\n\n    this.workspaceDragger = new WorkspaceDragger(this.startWorkspace_);\n\n    this.workspaceDragger.startDrag();\n  }\n\n  /**\n   * Update this gesture to record whether anything is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture.\n   */\n  private updateIsDragging() {\n    // Sanity check.\n    if (this.calledUpdateIsDragging) {\n      throw Error('updateIsDragging_ should only be called once per gesture.');\n    }\n    this.calledUpdateIsDragging = true;\n\n    // First check if it was a bubble drag.  Bubbles always sit on top of\n    // blocks.\n    if (this.updateIsDraggingBubble()) {\n      return;\n    }\n    // Then check if it was a block drag.\n    if (this.updateIsDraggingBlock()) {\n      return;\n    }\n    // Then check if it's a workspace drag.\n    this.updateIsDraggingWorkspace();\n  }\n\n  /** Create a block dragger and start dragging the selected block. */\n  private startDraggingBlock() {\n    const BlockDraggerClass = registry.getClassFromOptions(\n      registry.Type.BLOCK_DRAGGER,\n      this.creatorWorkspace.options,\n      true,\n    );\n\n    this.blockDragger = new BlockDraggerClass!(\n      this.targetBlock,\n      this.startWorkspace_,\n    );\n    this.blockDragger!.startDrag(this.currentDragDeltaXY, this.healStack);\n    this.blockDragger!.drag(this.mostRecentEvent, this.currentDragDeltaXY);\n  }\n\n  /** Create a bubble dragger and start dragging the selected bubble. */\n  private startDraggingBubble() {\n    if (!this.startBubble) {\n      throw new Error(\n        'Cannot update dragging the bubble because the start ' +\n          'bubble is undefined',\n      );\n    }\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging the bubble because the start ' +\n          'workspace is undefined',\n      );\n    }\n\n    this.bubbleDragger = new BubbleDragger(\n      this.startBubble,\n      this.startWorkspace_,\n    );\n    this.bubbleDragger.startBubbleDrag();\n    this.bubbleDragger.dragBubble(\n      this.mostRecentEvent,\n      this.currentDragDeltaXY,\n    );\n  }\n\n  /**\n   * Start a gesture: update the workspace to indicate that a gesture is in\n   * progress and bind pointermove and pointerup handlers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  doStart(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot start the touch gesture becauase the start ' +\n          'workspace is undefined',\n      );\n    }\n    this.isPinchZoomEnabled =\n      this.startWorkspace_.options.zoomOptions &&\n      this.startWorkspace_.options.zoomOptions.pinch;\n\n    if (browserEvents.isTargetInput(e)) {\n      this.cancel();\n      return;\n    }\n\n    this.gestureHasStarted = true;\n\n    blockAnimations.disconnectUiStop();\n\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\n    if (this.startWorkspace_.isMutator) {\n      // Mutator's coordinate system could be out of date because the bubble was\n      // dragged, the block was moved, the parent workspace zoomed, etc.\n      this.startWorkspace_.resize();\n    }\n\n    // Keep track of which field owns the dropdown before we close it.\n    this.currentDropdownOwner = dropDownDiv.getOwner();\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\n    // flyout.\n    this.startWorkspace_.hideChaff(!!this.flyout);\n\n    this.startWorkspace_.markFocused();\n    this.mostRecentEvent = e;\n\n    Tooltip.block();\n\n    if (this.targetBlock) {\n      this.targetBlock.select();\n    }\n\n    if (browserEvents.isRightButton(e)) {\n      this.handleRightClick(e);\n      return;\n    }\n\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\n      Touch.longStart(e, this);\n    }\n\n    this.mouseDownXY = new Coordinate(e.clientX, e.clientY);\n    this.healStack = e.altKey || e.ctrlKey || e.metaKey;\n\n    this.bindMouseEvents(e);\n\n    if (!this.isEnding_) {\n      this.handleTouchStart(e);\n    }\n  }\n\n  /**\n   * Bind gesture events.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  bindMouseEvents(e: PointerEvent) {\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerdown',\n        null,\n        this.handleStart.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointermove',\n        null,\n        this.handleMove.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerup',\n        null,\n        this.handleUp.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown event.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleStart(e: PointerEvent) {\n    if (this.isDragging()) {\n      // A drag has already started, so this can no longer be a pinch-zoom.\n      return;\n    }\n    this.handleTouchStart(e);\n\n    if (this.isMultiTouch()) {\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointermove event.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleMove(e: PointerEvent) {\n    if (\n      (this.isDragging() && Touch.shouldHandleEvent(e)) ||\n      !this.isMultiTouch()\n    ) {\n      this.updateFromEvent(e);\n      if (this.workspaceDragger) {\n        this.workspaceDragger.drag(this.currentDragDeltaXY);\n      } else if (this.blockDragger) {\n        this.blockDragger.drag(this.mostRecentEvent, this.currentDragDeltaXY);\n      } else if (this.bubbleDragger) {\n        this.bubbleDragger.dragBubble(\n          this.mostRecentEvent,\n          this.currentDragDeltaXY,\n        );\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    } else if (this.isMultiTouch()) {\n      this.handleTouchMove(e);\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointerup event.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleUp(e: PointerEvent) {\n    if (!this.isDragging()) {\n      this.handleTouchEnd(e);\n    }\n    if (!this.isMultiTouch() || this.isDragging()) {\n      if (!Touch.shouldHandleEvent(e)) {\n        return;\n      }\n      this.updateFromEvent(e);\n      Touch.longStop();\n\n      if (this.isEnding_) {\n        console.log('Trying to end a gesture recursively.');\n        return;\n      }\n      this.isEnding_ = true;\n      // The ordering of these checks is important: drags have higher priority\n      // than clicks.  Fields and icons have higher priority than blocks; blocks\n      // have higher priority than workspaces. The ordering within drags does\n      // not matter, because the three types of dragging are exclusive.\n      if (this.bubbleDragger) {\n        this.bubbleDragger.endBubbleDrag(e, this.currentDragDeltaXY);\n      } else if (this.blockDragger) {\n        this.blockDragger.endDrag(e, this.currentDragDeltaXY);\n      } else if (this.workspaceDragger) {\n        this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n      } else if (this.isBubbleClick()) {\n        // Bubbles are in front of all fields and blocks.\n        this.doBubbleClick();\n      } else if (this.isFieldClick()) {\n        this.doFieldClick();\n      } else if (this.isIconClick()) {\n        this.doIconClick();\n      } else if (this.isBlockClick()) {\n        this.doBlockClick();\n      } else if (this.isWorkspaceClick()) {\n        this.doWorkspaceClick(e);\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    } else {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    }\n  }\n\n  /**\n   * Handle a pointerdown event and keep track of current\n   * pointers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleTouchStart(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // store the pointerId in the current list of pointers\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n    const pointers = Array.from(this.cachedPoints.keys());\n    // If two pointers are down, store info\n    if (pointers.length === 2) {\n      const point0 = this.cachedPoints.get(pointers[0])!;\n      const point1 = this.cachedPoints.get(pointers[1])!;\n      this.startDistance = Coordinate.distance(point0, point1);\n      this.isMultiTouch_ = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a pointermove event and zoom in/out if two pointers\n   * are on the screen.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleTouchMove(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // Update the cache\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n\n    if (this.isPinchZoomEnabled && this.cachedPoints.size === 2) {\n      this.handlePinch(e);\n    } else {\n      this.handleMove(e);\n    }\n  }\n\n  /**\n   * Handle pinch zoom gesture.\n   *\n   * @param e A pointermove event.\n   */\n  private handlePinch(e: PointerEvent) {\n    const pointers = Array.from(this.cachedPoints.keys());\n    // Calculate the distance between the two pointers\n    const point0 = this.cachedPoints.get(pointers[0])!;\n    const point1 = this.cachedPoints.get(pointers[1])!;\n    const moveDistance = Coordinate.distance(point0, point1);\n    const scale = moveDistance / this.startDistance;\n\n    if (this.previousScale > 0 && this.previousScale < Infinity) {\n      const gestureScale = scale - this.previousScale;\n      const delta =\n        gestureScale > 0\n          ? gestureScale * ZOOM_IN_MULTIPLIER\n          : gestureScale * ZOOM_OUT_MULTIPLIER;\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot handle a pinch because the start workspace ' + 'is undefined',\n        );\n      }\n      const workspace = this.startWorkspace_;\n      const position = browserEvents.mouseToSvg(\n        e,\n        workspace.getParentSvg(),\n        workspace.getInverseScreenCTM(),\n      );\n      workspace.zoom(position.x, position.y, delta);\n    }\n    this.previousScale = scale;\n    e.preventDefault();\n  }\n\n  /**\n   * Handle a pointerup event and end the gesture.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleTouchEnd(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    if (this.cachedPoints.has(pointerId)) {\n      this.cachedPoints.delete(pointerId);\n    }\n    if (this.cachedPoints.size < 2) {\n      this.cachedPoints.clear();\n      this.previousScale = 0;\n    }\n  }\n\n  /**\n   * Helper function returning the current touch point coordinate.\n   *\n   * @param e A pointer event.\n   * @returns The current touch point coordinate\n   * @internal\n   */\n  getTouchPoint(e: PointerEvent): Coordinate | null {\n    if (!this.startWorkspace_) {\n      return null;\n    }\n    return new Coordinate(e.pageX, e.pageY);\n  }\n\n  /**\n   * Whether this gesture is part of a multi-touch gesture.\n   *\n   * @returns Whether this gesture is part of a multi-touch gesture.\n   * @internal\n   */\n  isMultiTouch(): boolean {\n    return this.isMultiTouch_;\n  }\n\n  /**\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\n   * progress, end the drag at the most recent location.\n   *\n   * @internal\n   */\n  cancel() {\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\n    // area disposes of a block and leads to recursive disposal. Break that\n    // cycle.\n    if (this.isEnding_) {\n      return;\n    }\n    Touch.longStop();\n    if (this.bubbleDragger) {\n      this.bubbleDragger.endBubbleDrag(\n        this.mostRecentEvent,\n        this.currentDragDeltaXY,\n      );\n    } else if (this.blockDragger) {\n      this.blockDragger.endDrag(this.mostRecentEvent, this.currentDragDeltaXY);\n    } else if (this.workspaceDragger) {\n      this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n    }\n    this.dispose();\n  }\n\n  /**\n   * Handle a real or faked right-click event by showing a context menu.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleRightClick(e: PointerEvent) {\n    if (this.targetBlock) {\n      this.bringBlockToFront();\n      this.targetBlock.workspace.hideChaff(!!this.flyout);\n      this.targetBlock.showContextMenu(e);\n    } else if (this.startBubble) {\n      this.startBubble.showContextMenu(e);\n    } else if (this.startWorkspace_ && !this.flyout) {\n      this.startWorkspace_.hideChaff();\n      this.startWorkspace_.showContextMenu(e);\n    }\n\n    // TODO: Handle right-click on a bubble.\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.dispose();\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace.\n   *\n   * @param e A pointerdown event.\n   * @param ws The workspace the event hit.\n   * @internal\n   */\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleWsStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartWorkspace(ws);\n    this.mostRecentEvent = e;\n    this.doStart(e);\n  }\n\n  /**\n   * Fires a workspace click event.\n   *\n   * @param ws The workspace that a user clicks on.\n   */\n  private fireWorkspaceClick(ws: WorkspaceSvg) {\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.CLICK))(null, ws.id, 'workspace'),\n    );\n  }\n\n  /**\n   * Handle a pointerdown event on a flyout.\n   *\n   * @param e A pointerdown event.\n   * @param flyout The flyout the event hit.\n   * @internal\n   */\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleFlyoutStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartFlyout(flyout);\n    this.handleWsStart(e, flyout.getWorkspace());\n  }\n\n  /**\n   * Handle a pointerdown event on a block.\n   *\n   * @param e A pointerdown event.\n   * @param block The block the event hit.\n   * @internal\n   */\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBlockStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBlock(block);\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a bubble.\n   *\n   * @param e A pointerdown event.\n   * @param bubble The bubble the event hit.\n   * @internal\n   */\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBubbleStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBubble(bubble);\n    this.mostRecentEvent = e;\n  }\n\n  /* Begin functions defining what actions to take to execute clicks on each\n   * type of target.  Any developer wanting to add behaviour on clicks should\n   * modify only this code. */\n\n  /** Execute a bubble click. */\n  private doBubbleClick() {\n    // TODO (#1673): Consistent handling of single clicks.\n    if (this.startBubble instanceof WorkspaceCommentSvg) {\n      this.startBubble.setFocus();\n      this.startBubble.select();\n    }\n  }\n\n  /** Execute a field click. */\n  private doFieldClick() {\n    if (!this.startField) {\n      throw new Error(\n        'Cannot do a field click because the start field is undefined',\n      );\n    }\n\n    // Only show the editor if the field's editor wasn't already open\n    // right before this gesture started.\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField;\n    if (!dropdownAlreadyOpen) {\n      this.startField.showEditor(this.mostRecentEvent);\n    }\n    this.bringBlockToFront();\n  }\n\n  /** Execute an icon click. */\n  private doIconClick() {\n    if (!this.startIcon) {\n      throw new Error(\n        'Cannot do an icon click because the start icon is undefined',\n      );\n    }\n    this.bringBlockToFront();\n    this.startIcon.onClick();\n  }\n\n  /** Execute a block click. */\n  private doBlockClick() {\n    // Block click in an autoclosing flyout.\n    if (this.flyout && this.flyout.autoClose) {\n      if (!this.targetBlock) {\n        throw new Error(\n          'Cannot do a block click because the target block is ' + 'undefined',\n        );\n      }\n      if (this.targetBlock.isEnabled()) {\n        if (!eventUtils.getGroup()) {\n          eventUtils.setGroup(true);\n        }\n        const newBlock = this.flyout.createBlock(this.targetBlock);\n        newBlock.scheduleSnapAndBump();\n      }\n    } else {\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot do a block click because the start workspace ' +\n            'is undefined',\n        );\n      }\n      // Clicks events are on the start block, even if it was a shadow.\n      const event = new (eventUtils.get(eventUtils.CLICK))(\n        this.startBlock,\n        this.startWorkspace_.id,\n        'block',\n      );\n      eventUtils.fire(event);\n    }\n    this.bringBlockToFront();\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Execute a workspace click. When in accessibility mode shift clicking will\n   * move the cursor.\n   *\n   * @param _e A pointerup event.\n   */\n  private doWorkspaceClick(_e: PointerEvent) {\n    const ws = this.creatorWorkspace;\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.fireWorkspaceClick(this.startWorkspace_ || ws);\n  }\n\n  /* End functions defining what actions to take to execute clicks on each type\n   * of target. */\n\n  // TODO (fenichel): Move bubbles to the front.\n\n  /**\n   * Move the dragged/clicked block to the front of the workspace so that it is\n   * not occluded by other blocks.\n   */\n  private bringBlockToFront() {\n    // Blocks in the flyout don't overlap, so skip the work.\n    if (this.targetBlock && !this.flyout) {\n      this.targetBlock.bringToFront();\n    }\n  }\n\n  /* Begin functions for populating a gesture at pointerdown. */\n\n  /**\n   * Record the field that a gesture started on.\n   *\n   * @param field The field the gesture started on.\n   * @internal\n   */\n  setStartField<T>(field: Field<T>) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartField, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    if (!this.startField) {\n      this.startField = field as Field;\n    }\n  }\n\n  /**\n   * Record the icon that a gesture started on.\n   *\n   * @param icon The icon the gesture started on.\n   * @internal\n   */\n  setStartIcon(icon: IIcon) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartIcon, ' +\n          'but the gesture had already been started.',\n      );\n    }\n\n    if (!this.startIcon) this.startIcon = icon;\n  }\n\n  /**\n   * Record the bubble that a gesture started on\n   *\n   * @param bubble The bubble the gesture started on.\n   * @internal\n   */\n  setStartBubble(bubble: IBubble) {\n    if (!this.startBubble) {\n      this.startBubble = bubble;\n    }\n  }\n\n  /**\n   * Record the block that a gesture started on, and set the target block\n   * appropriately.\n   *\n   * @param block The block the gesture started on.\n   * @internal\n   */\n  setStartBlock(block: BlockSvg) {\n    // If the gesture already went through a bubble, don't set the start block.\n    if (!this.startBlock && !this.startBubble) {\n      this.startBlock = block;\n      if (block.isInFlyout && block !== block.getRootBlock()) {\n        this.setTargetBlock(block.getRootBlock());\n      } else {\n        this.setTargetBlock(block);\n      }\n    }\n  }\n\n  /**\n   * Record the block that a gesture targets, meaning the block that will be\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\n   * its first non-shadow parent.\n   *\n   * @param block The block the gesture targets.\n   */\n  private setTargetBlock(block: BlockSvg) {\n    if (block.isShadow()) {\n      // Non-null assertion is fine b/c it is an invariant that shadows always\n      // have parents.\n      this.setTargetBlock(block.getParent()!);\n    } else {\n      this.targetBlock = block;\n    }\n  }\n\n  /**\n   * Record the workspace that a gesture started on.\n   *\n   * @param ws The workspace the gesture started on.\n   */\n  private setStartWorkspace(ws: WorkspaceSvg) {\n    if (!this.startWorkspace_) {\n      this.startWorkspace_ = ws;\n    }\n  }\n\n  /**\n   * Record the flyout that a gesture started on.\n   *\n   * @param flyout The flyout the gesture started on.\n   */\n  private setStartFlyout(flyout: IFlyout) {\n    if (!this.flyout) {\n      this.flyout = flyout;\n    }\n  }\n\n  /* End functions for populating a gesture at pointerdown. */\n\n  /* Begin helper functions defining types of clicks.  Any developer wanting\n   * to change the definition of a click should modify only this code. */\n\n  /**\n   * Whether this gesture is a click on a bubble.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a bubble.\n   */\n  private isBubbleClick(): boolean {\n    // A bubble click starts on a bubble and never escapes the drag radius.\n    const hasStartBubble = !!this.startBubble;\n    return hasStartBubble && !this.hasExceededDragRadius;\n  }\n\n  /**\n   * Whether this gesture is a click on a block.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a block.\n   */\n  private isBlockClick(): boolean {\n    // A block click starts on a block, never escapes the drag radius, and is\n    // not a field click.\n    const hasStartBlock = !!this.startBlock;\n    return (\n      hasStartBlock &&\n      !this.hasExceededDragRadius &&\n      !this.isFieldClick() &&\n      !this.isIconClick()\n    );\n  }\n\n  /**\n   * Whether this gesture is a click on a field that should be handled.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a field.\n   */\n  private isFieldClick(): boolean {\n    if (!this.startField) return false;\n    return (\n      this.startField.isClickable() &&\n      !this.hasExceededDragRadius &&\n      (!this.flyout ||\n        this.startField.isClickableInFlyout(this.flyout.autoClose))\n    );\n  }\n\n  /** @returns Whether this gesture is a click on an icon that should be handled. */\n  private isIconClick(): boolean {\n    if (!this.startIcon) return false;\n    const handleInFlyout =\n      !this.flyout ||\n      !this.startIcon.isClickableInFlyout ||\n      this.startIcon.isClickableInFlyout(this.flyout.autoClose);\n    return !this.hasExceededDragRadius && handleInFlyout;\n  }\n\n  /**\n   * Whether this gesture is a click on a workspace.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   */\n  private isWorkspaceClick(): boolean {\n    const onlyTouchedWorkspace =\n      !this.startBlock && !this.startBubble && !this.startField;\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius;\n  }\n\n  /* End helper functions defining types of clicks. */\n\n  /**\n   * Whether this gesture is a drag of either a workspace or block.\n   * This function is called externally to block actions that cannot be taken\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\n   *\n   * @returns True if this gesture is a drag of a workspace or block.\n   * @internal\n   */\n  isDragging(): boolean {\n    return (\n      !!this.workspaceDragger || !!this.blockDragger || !!this.bubbleDragger\n    );\n  }\n\n  /**\n   * Whether this gesture has already been started.  In theory every pointerdown\n   * has a corresponding pointerup, but in reality it is possible to lose a\n   * pointerup, leaving an in-process gesture hanging.\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   * @internal\n   */\n  hasStarted(): boolean {\n    return this.gestureHasStarted;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Block drags have\n   * 0, 1, or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    if (this.blockDragger) {\n      return this.blockDragger.getInsertionMarkers();\n    }\n    return [];\n  }\n\n  /**\n   * Gets the current dragger if an item is being dragged. Null if nothing is\n   * being dragged.\n   *\n   * @returns The dragger that is currently in use or null if no drag is in\n   *     progress.\n   */\n  getCurrentDragger(): WorkspaceDragger | BubbleDragger | IBlockDragger | null {\n    return this.blockDragger ?? this.workspaceDragger ?? this.bubbleDragger;\n  }\n\n  /**\n   * Is a drag or other gesture currently in progress on any workspace?\n   *\n   * @returns True if gesture is occurring.\n   */\n  static inProgress(): boolean {\n    const workspaces = common.getAllWorkspaces();\n    for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\n      // we're just checking if the property exists. Theoretically we would\n      // want to use instanceof, but that causes a circular dependency.\n      if ((workspace as WorkspaceSvg).currentGesture_) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object for configuring and updating a workspace grid in\n * Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Grid\n\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {GridOptions} from './options.js';\n\n/**\n * Class for a workspace's grid.\n */\nexport class Grid {\n  private readonly spacing: number;\n  private readonly length: number;\n  private readonly line1: SVGElement;\n  private readonly line2: SVGElement;\n  private readonly snapToGrid: boolean;\n\n  /**\n   * @param pattern The grid's SVG pattern, created during injection.\n   * @param options A dictionary of normalized options for the grid.\n   *     See grid documentation:\n   *     https://developers.google.com/blockly/guides/configure/web/grid\n   */\n  constructor(\n    private pattern: SVGElement,\n    options: GridOptions,\n  ) {\n    /** The spacing of the grid lines (in px). */\n    this.spacing = options['spacing'] ?? 0;\n\n    /** How long the grid lines should be (in px). */\n    this.length = options['length'] ?? 1;\n\n    /** The horizontal grid line, if it exists. */\n    this.line1 = pattern.firstChild as SVGElement;\n\n    /** The vertical grid line, if it exists. */\n    this.line2 = this.line1 && (this.line1.nextSibling as SVGElement);\n\n    /** Whether blocks should snap to the grid. */\n    this.snapToGrid = options['snap'] ?? false;\n  }\n\n  /**\n   * Whether blocks should snap to the grid, based on the initial configuration.\n   *\n   * @returns True if blocks should snap, false otherwise.\n   * @internal\n   */\n  shouldSnap(): boolean {\n    return this.snapToGrid;\n  }\n\n  /**\n   * Get the spacing of the grid points (in px).\n   *\n   * @returns The spacing of the grid points.\n   * @internal\n   */\n  getSpacing(): number {\n    return this.spacing;\n  }\n\n  /**\n   * Get the ID of the pattern element, which should be randomized to avoid\n   * conflicts with other Blockly instances on the page.\n   *\n   * @returns The pattern ID.\n   * @internal\n   */\n  getPatternId(): string {\n    return this.pattern.id;\n  }\n\n  /**\n   * Update the grid with a new scale.\n   *\n   * @param scale The new workspace scale.\n   * @internal\n   */\n  update(scale: number) {\n    const safeSpacing = this.spacing * scale;\n\n    this.pattern.setAttribute('width', `${safeSpacing}`);\n    this.pattern.setAttribute('height', `${safeSpacing}`);\n\n    let half = Math.floor(this.spacing / 2) + 0.5;\n    let start = half - this.length / 2;\n    let end = half + this.length / 2;\n\n    half *= scale;\n    start *= scale;\n    end *= scale;\n\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\n  }\n\n  /**\n   * Set the attributes on one of the lines in the grid.  Use this to update the\n   * length and stroke width of the grid lines.\n   *\n   * @param line Which line to update.\n   * @param width The new stroke size (in px).\n   * @param x1 The new x start position of the line (in px).\n   * @param x2 The new x end position of the line (in px).\n   * @param y1 The new y start position of the line (in px).\n   * @param y2 The new y end position of the line (in px).\n   */\n  private setLineAttributes(\n    line: SVGElement,\n    width: number,\n    x1: number,\n    x2: number,\n    y1: number,\n    y2: number,\n  ) {\n    if (line) {\n      line.setAttribute('stroke-width', `${width}`);\n      line.setAttribute('x1', `${x1}`);\n      line.setAttribute('y1', `${y1}`);\n      line.setAttribute('x2', `${x2}`);\n      line.setAttribute('y2', `${y2}`);\n    }\n  }\n\n  /**\n   * Move the grid to a new x and y position, and make sure that change is\n   * visible.\n   *\n   * @param x The new x position of the grid (in px).\n   * @param y The new y position of the grid (in px).\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.pattern.setAttribute('x', `${x}`);\n    this.pattern.setAttribute('y', `${y}`);\n  }\n\n  /**\n   * Create the DOM for the grid described by options.\n   *\n   * @param rnd A random ID to append to the pattern's ID.\n   * @param gridOptions The object containing grid configuration.\n   * @param defs The root SVG element for this workspace's defs.\n   * @returns The SVG element for the grid pattern.\n   * @internal\n   */\n  static createDom(\n    rnd: string,\n    gridOptions: GridOptions,\n    defs: SVGElement,\n  ): SVGElement {\n    /*\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\n            <rect stroke=\"#888\" />\n            <rect stroke=\"#888\" />\n          </pattern>\n        */\n    const gridPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\n      defs,\n    );\n    // x1, y1, x1, x2 properties will be set later in update.\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\n      dom.createSvgElement(\n        Svg.LINE,\n        {'stroke': gridOptions['colour']},\n        gridPattern,\n      );\n      if (gridOptions['length'] ?? 1 > 1) {\n        dom.createSvgElement(\n          Svg.LINE,\n          {'stroke': gridOptions['colour']},\n          gridPattern,\n        );\n      }\n    } else {\n      // Edge 16 doesn't handle empty patterns\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\n    }\n    return gridPattern;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of managing markers and the cursor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MarkerManager\n\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class to manage the multiple markers and the cursor on a workspace.\n */\nexport class MarkerManager {\n  /** The name of the local marker. */\n  static readonly LOCAL_MARKER = 'local_marker_1';\n\n  /** The cursor. */\n  private cursor_: Cursor | null = null;\n\n  /** The cursor's SVG element. */\n  private cursorSvg_: SVGElement | null = null;\n\n  /** The map of markers for the workspace. */\n  private markers = new Map<string, Marker>();\n\n  /** The marker's SVG element. */\n  private markerSvg_: SVGElement | null = null;\n\n  /**\n   * @param workspace The workspace for the marker manager.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Register the marker by adding it to the map of markers.\n   *\n   * @param id A unique identifier for the marker.\n   * @param marker The marker to register.\n   */\n  registerMarker(id: string, marker: Marker) {\n    if (this.markers.has(id)) {\n      this.unregisterMarker(id);\n    }\n    marker.setDrawer(\n      this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker),\n    );\n    this.setMarkerSvg(marker.getDrawer().createDom());\n    this.markers.set(id, marker);\n  }\n\n  /**\n   * Unregister the marker by removing it from the map of markers.\n   *\n   * @param id The ID of the marker to unregister.\n   */\n  unregisterMarker(id: string) {\n    const marker = this.markers.get(id);\n    if (marker) {\n      marker.dispose();\n      this.markers.delete(id);\n    } else {\n      throw Error(\n        'Marker with ID ' +\n          id +\n          ' does not exist. ' +\n          'Can only unregister markers that exist.',\n      );\n    }\n  }\n\n  /**\n   * Get the cursor for the workspace.\n   *\n   * @returns The cursor for this workspace.\n   */\n  getCursor(): Cursor | null {\n    return this.cursor_;\n  }\n\n  /**\n   * Get a single marker that corresponds to the given ID.\n   *\n   * @param id A unique identifier for the marker.\n   * @returns The marker that corresponds to the given ID, or null if none\n   *     exists.\n   */\n  getMarker(id: string): Marker | null {\n    return this.markers.get(id) || null;\n  }\n\n  /**\n   * Sets the cursor and initializes the drawer for use with keyboard\n   * navigation.\n   *\n   * @param cursor The cursor used to move around this workspace.\n   */\n  setCursor(cursor: Cursor) {\n    if (this.cursor_ && this.cursor_.getDrawer()) {\n      this.cursor_.getDrawer().dispose();\n    }\n    this.cursor_ = cursor;\n    if (this.cursor_) {\n      const drawer = this.workspace\n        .getRenderer()\n        .makeMarkerDrawer(this.workspace, this.cursor_);\n      this.cursor_.setDrawer(drawer);\n      this.setCursorSvg(this.cursor_.getDrawer().createDom());\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this workspace SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement | null) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement | null) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (this.workspace.getBlockCanvas()) {\n      if (this.cursorSvg_) {\n        this.workspace\n          .getBlockCanvas()!\n          .insertBefore(markerSvg, this.cursorSvg_);\n      } else {\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\n      }\n    }\n  }\n\n  /**\n   * Redraw the attached cursor SVG if needed.\n   *\n   * @internal\n   */\n  updateMarkers() {\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      this.workspace.getCursor()!.draw();\n    }\n  }\n\n  /**\n   * Dispose of the marker manager.\n   * Go through and delete all markers associated with this marker manager.\n   *\n   * @internal\n   */\n  dispose() {\n    const markerIds = Object.keys(this.markers);\n    for (let i = 0, markerId; (markerId = markerIds[i]); i++) {\n      this.unregisterMarker(markerId);\n    }\n    this.markers.clear();\n    if (this.cursor_) {\n      this.cursor_.dispose();\n      this.cursor_ = null;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a theme.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Theme\n\nimport * as registry from './registry.js';\nimport * as object from './utils/object.js';\n\nexport interface ITheme {\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\n  categoryStyles?: {[key: string]: CategoryStyle};\n  componentStyles?: ComponentStyle;\n  fontStyle?: FontStyle;\n  startHats?: boolean;\n  base?: string | Theme;\n  name: string;\n}\n\n/**\n * Class for a theme.\n */\nexport class Theme implements ITheme {\n  /** @internal */\n  blockStyles: {[key: string]: BlockStyle};\n  /** @internal */\n  categoryStyles: {[key: string]: CategoryStyle};\n  /** @internal */\n  componentStyles: ComponentStyle;\n  /** @internal */\n  fontStyle: FontStyle;\n\n  /**\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\n   * output connections.\n   *\n   * @internal\n   */\n  startHats?: boolean = false;\n\n  /**\n   * @param name Theme name.\n   * @param opt_blockStyles A map from style names (strings) to objects with\n   *     style attributes for blocks.\n   * @param opt_categoryStyles A map from style names (strings) to objects with\n   *     style attributes for categories.\n   * @param opt_componentStyles A map of Blockly component names to style value.\n   */\n  constructor(\n    public name: string,\n    opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\n    opt_categoryStyles?: {[key: string]: CategoryStyle},\n    opt_componentStyles?: ComponentStyle,\n  ) {\n    /** The block styles map. */\n    this.blockStyles = opt_blockStyles || Object.create(null);\n\n    /** The category styles map. */\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\n\n    /** The UI components styles map. */\n    this.componentStyles =\n      opt_componentStyles || (Object.create(null) as ComponentStyle);\n\n    /** The font style. */\n    this.fontStyle = Object.create(null) as FontStyle;\n\n    // Register the theme by name.\n    registry.register(registry.Type.THEME, name, this, true);\n  }\n\n  /**\n   * Gets the class name that identifies this theme.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-theme';\n  }\n\n  /**\n   * Overrides or adds a style to the blockStyles map.\n   *\n   * @param blockStyleName The name of the block style.\n   * @param blockStyle The block style.\n   */\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\n    this.blockStyles[blockStyleName] = blockStyle;\n  }\n\n  /**\n   * Overrides or adds a style to the categoryStyles map.\n   *\n   * @param categoryStyleName The name of the category style.\n   * @param categoryStyle The category style.\n   */\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\n    this.categoryStyles[categoryStyleName] = categoryStyle;\n  }\n\n  /**\n   * Gets the style for a given Blockly UI component.  If the style value is a\n   * string, we attempt to find the value of any named references.\n   *\n   * @param componentName The name of the component.\n   * @returns The style value.\n   */\n  getComponentStyle(componentName: string): string | null {\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\n    if (!style) {\n      return null;\n    }\n    if (typeof style === 'string') {\n      const recursiveStyle = this.getComponentStyle(style);\n      if (recursiveStyle) {\n        return recursiveStyle;\n      }\n    }\n    return `${style}`;\n  }\n\n  /**\n   * Configure a specific Blockly UI component with a style value.\n   *\n   * @param componentName The name of the component.\n   * @param styleValue The style value.\n   */\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\n  }\n\n  /**\n   * Configure a theme's font style.\n   *\n   * @param fontStyle The font style.\n   */\n  setFontStyle(fontStyle: FontStyle) {\n    this.fontStyle = fontStyle;\n  }\n\n  /**\n   * Configure a theme's start hats.\n   *\n   * @param startHats True if the theme enables start hats, false otherwise.\n   */\n  setStartHats(startHats: boolean) {\n    this.startHats = startHats;\n  }\n\n  /**\n   * Define a new Blockly theme.\n   *\n   * @param name The name of the theme.\n   * @param themeObj An object containing theme properties.\n   * @returns A new Blockly theme.\n   */\n  static defineTheme(name: string, themeObj: ITheme): Theme {\n    name = name.toLowerCase();\n    const theme = new Theme(name);\n    let base = themeObj['base'];\n    if (base) {\n      if (typeof base === 'string') {\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\n      }\n      if (base instanceof Theme) {\n        object.deepMerge(theme, base);\n        theme.name = name;\n      }\n    }\n\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\n    if (themeObj['startHats'] !== null) {\n      theme.startHats = themeObj['startHats'];\n    }\n\n    return theme;\n  }\n}\n\nexport namespace Theme {\n  export interface BlockStyle {\n    colourPrimary: string;\n    colourSecondary: string;\n    colourTertiary: string;\n    hat: string;\n  }\n\n  export interface CategoryStyle {\n    colour: string;\n  }\n\n  export interface ComponentStyle {\n    workspaceBackgroundColour?: string;\n    toolboxBackgroundColour?: string;\n    toolboxForegroundColour?: string;\n    flyoutBackgroundColour?: string;\n    flyoutForegroundColour?: string;\n    flyoutOpacity?: number;\n    scrollbarColour?: string;\n    scrollbarOpacity?: number;\n    insertionMarkerColour?: string;\n    insertionMarkerOpacity?: number;\n    markerColour?: string;\n    cursorColour?: string;\n    selectedGlowColour?: string;\n    selectedGlowOpacity?: number;\n    replacementGlowColour?: string;\n    replacementGlowOpacity?: number;\n  }\n\n  export interface FontStyle {\n    family?: string;\n    weight?: string;\n    size?: number;\n  }\n}\n\nexport type BlockStyle = Theme.BlockStyle;\nexport type CategoryStyle = Theme.CategoryStyle;\nexport type ComponentStyle = Theme.ComponentStyle;\nexport type FontStyle = Theme.FontStyle;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Classic\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {'colourPrimary': '20'},\n  'list_blocks': {'colourPrimary': '260'},\n  'logic_blocks': {'colourPrimary': '210'},\n  'loop_blocks': {'colourPrimary': '120'},\n  'math_blocks': {'colourPrimary': '230'},\n  'procedure_blocks': {'colourPrimary': '290'},\n  'text_blocks': {'colourPrimary': '160'},\n  'variable_blocks': {'colourPrimary': '330'},\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '20'},\n  'list_category': {'colour': '260'},\n  'logic_category': {'colour': '210'},\n  'loop_category': {'colour': '120'},\n  'math_category': {'colour': '230'},\n  'procedure_category': {'colour': '290'},\n  'text_category': {'colour': '160'},\n  'variable_category': {'colour': '330'},\n  'variable_dynamic_category': {'colour': '310'},\n};\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n */\nexport const Classic = new Theme('classic', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object that controls settings for the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Options\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as registry from './registry.js';\nimport {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Parse the user-specified options, using reasonable defaults where behaviour\n * is unspecified.\n */\nexport class Options {\n  RTL: boolean;\n  oneBasedIndex: boolean;\n  collapse: boolean;\n  comments: boolean;\n  disable: boolean;\n  readOnly: boolean;\n  maxBlocks: number;\n  maxInstances: {[key: string]: number} | null;\n  modalInputs: boolean;\n  pathToMedia: string;\n  hasCategories: boolean;\n  moveOptions: MoveOptions;\n  hasScrollbars: boolean;\n  hasTrashcan: boolean;\n  maxTrashcanContents: number;\n  hasSounds: boolean;\n  hasCss: boolean;\n  horizontalLayout: boolean;\n  languageTree: toolbox.ToolboxInfo | null;\n  gridOptions: GridOptions;\n  zoomOptions: ZoomOptions;\n  toolboxPosition: toolbox.Position;\n  theme: Theme;\n  renderer: string;\n  rendererOverrides: {[rendererConstant: string]: any} | null;\n\n  /**\n   * The SVG element for the grid pattern.\n   * Created during injection.\n   */\n  gridPattern: SVGElement | null = null;\n  parentWorkspace: WorkspaceSvg | null;\n  plugins: {[key: string]: (new (...p1: any[]) => any) | string};\n\n  /**\n   * If set, sets the translation of the workspace to match the scrollbars.\n   * A function that\n   *     sets the translation of the workspace to match the scrollbars. The\n   *     argument Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  setMetrics?: (p1: {x?: number; y?: number}) => void = undefined;\n\n  /**\n   * A function that returns a metrics\n   *     object that describes the current workspace.\n   */\n  getMetrics?: () => Metrics = undefined;\n\n  /**\n   * @param options Dictionary of options.\n   *     Specification:\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\n   */\n  constructor(options: BlocklyOptions) {\n    let toolboxJsonDef = null;\n    let hasCategories = false;\n    let hasTrashcan = false;\n    let hasCollapse = false;\n    let hasComments = false;\n    let hasDisable = false;\n    let hasSounds = false;\n    const readOnly = !!options['readOnly'];\n    if (!readOnly) {\n      toolboxJsonDef = toolbox.convertToolboxDefToJson(\n        options['toolbox'] ?? null,\n      );\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\n      const rawHasTrashcan = options['trashcan'];\n      hasTrashcan =\n        rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\n      const rawHasCollapse = options['collapse'];\n      hasCollapse =\n        rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\n      const rawHasComments = options['comments'];\n      hasComments =\n        rawHasComments === undefined ? hasCategories : rawHasComments;\n      const rawHasDisable = options['disable'];\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\n      const rawHasSounds = options['sounds'];\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\n    }\n\n    let maxTrashcanContents = options['maxTrashcanContents'];\n    if (hasTrashcan) {\n      if (maxTrashcanContents === undefined) {\n        maxTrashcanContents = 32;\n      }\n    } else {\n      maxTrashcanContents = 0;\n    }\n    const rtl = !!options['rtl'];\n    let horizontalLayout = options['horizontalLayout'];\n    if (horizontalLayout === undefined) {\n      horizontalLayout = false;\n    }\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\n\n    let toolboxPosition: toolbox.Position;\n    if (horizontalLayout) {\n      toolboxPosition = toolboxAtStart\n        ? toolbox.Position.TOP\n        : toolbox.Position.BOTTOM;\n    } else {\n      toolboxPosition =\n        toolboxAtStart === rtl ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\n    }\n\n    let hasCss = options['css'];\n    if (hasCss === undefined) {\n      hasCss = true;\n    }\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\n    if (options['media']) {\n      pathToMedia = options['media'].endsWith('/')\n        ? options['media']\n        : options['media'] + '/';\n    } else if ('path' in options) {\n      // 'path' is a deprecated option which has been replaced by 'media'.\n      deprecation.warn('path', 'Nov 2014', 'Jul 2023', 'media');\n      pathToMedia = (options as any)['path'] + 'media/';\n    }\n    const rawOneBasedIndex = options['oneBasedIndex'];\n    const oneBasedIndex =\n      rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\n    const renderer = options['renderer'] || 'geras';\n\n    const plugins = options['plugins'] || {};\n\n    let modalInputs = options['modalInputs'];\n    if (modalInputs === undefined) {\n      modalInputs = true;\n    }\n\n    this.RTL = rtl;\n    this.oneBasedIndex = oneBasedIndex;\n    this.collapse = hasCollapse;\n    this.comments = hasComments;\n    this.disable = hasDisable;\n    this.readOnly = readOnly;\n    this.maxBlocks = options['maxBlocks'] || Infinity;\n    this.maxInstances = options['maxInstances'] ?? null;\n    this.modalInputs = modalInputs;\n    this.pathToMedia = pathToMedia;\n    this.hasCategories = hasCategories;\n    this.moveOptions = Options.parseMoveOptions_(options, hasCategories);\n    /** @deprecated  January 2019 */\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\n    this.hasTrashcan = hasTrashcan;\n    this.maxTrashcanContents = maxTrashcanContents;\n    this.hasSounds = hasSounds;\n    this.hasCss = hasCss;\n    this.horizontalLayout = horizontalLayout;\n    this.languageTree = toolboxJsonDef;\n    this.gridOptions = Options.parseGridOptions_(options);\n    this.zoomOptions = Options.parseZoomOptions_(options);\n    this.toolboxPosition = toolboxPosition;\n    this.theme = Options.parseThemeOptions_(options);\n    this.renderer = renderer;\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\n\n    /**\n     * The parent of the current workspace, or null if there is no parent\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\n     * Workspace as this is only used in a rendered workspace.\n     */\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\n\n    /** Map of plugin type to name of registered plugin or plugin class. */\n    this.plugins = plugins;\n  }\n\n  /**\n   * Parse the user-specified move options, using reasonable defaults where\n   *    behaviour is unspecified.\n   *\n   * @param options Dictionary of options.\n   * @param hasCategories Whether the workspace has categories or not.\n   * @returns Normalized move options.\n   */\n  private static parseMoveOptions_(\n    options: BlocklyOptions,\n    hasCategories: boolean,\n  ): MoveOptions {\n    const move = options['move'] || {};\n    const moveOptions = {} as MoveOptions;\n    if (\n      move['scrollbars'] === undefined &&\n      options['scrollbars'] === undefined\n    ) {\n      moveOptions.scrollbars = hasCategories;\n    } else if (typeof move['scrollbars'] === 'object') {\n      moveOptions.scrollbars = {\n        'horizontal': !!move['scrollbars']['horizontal'],\n        'vertical': !!move['scrollbars']['vertical'],\n      };\n      // Convert scrollbars object to boolean if they have the same value.\n      // This allows us to easily check for whether any scrollbars exist using\n      // !!moveOptions.scrollbars.\n      if (\n        moveOptions.scrollbars.horizontal &&\n        moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = true;\n      } else if (\n        !moveOptions.scrollbars.horizontal &&\n        !moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = false;\n      }\n    } else {\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\n    }\n\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\n      // Defaults to true if single-direction scroll is enabled.\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\n    } else {\n      moveOptions.wheel = !!move['wheel'];\n    }\n    if (!moveOptions.scrollbars) {\n      moveOptions.drag = false;\n    } else if (move['drag'] === undefined) {\n      // Defaults to true if scrollbars is true.\n      moveOptions.drag = true;\n    } else {\n      moveOptions.drag = !!move['drag'];\n    }\n    return moveOptions;\n  }\n\n  /**\n   * Parse the user-specified zoom options, using reasonable defaults where\n   * behaviour is unspecified.  See zoom documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized zoom options.\n   */\n  private static parseZoomOptions_(options: BlocklyOptions): ZoomOptions {\n    const zoom = options['zoom'] || {};\n    const zoomOptions = {} as ZoomOptions;\n    if (zoom['controls'] === undefined) {\n      zoomOptions.controls = false;\n    } else {\n      zoomOptions.controls = !!zoom['controls'];\n    }\n    if (zoom['wheel'] === undefined) {\n      zoomOptions.wheel = false;\n    } else {\n      zoomOptions.wheel = !!zoom['wheel'];\n    }\n    if (zoom['startScale'] === undefined) {\n      zoomOptions.startScale = 1;\n    } else {\n      zoomOptions.startScale = Number(zoom['startScale']);\n    }\n    if (zoom['maxScale'] === undefined) {\n      zoomOptions.maxScale = 3;\n    } else {\n      zoomOptions.maxScale = Number(zoom['maxScale']);\n    }\n    if (zoom['minScale'] === undefined) {\n      zoomOptions.minScale = 0.3;\n    } else {\n      zoomOptions.minScale = Number(zoom['minScale']);\n    }\n    if (zoom['scaleSpeed'] === undefined) {\n      zoomOptions.scaleSpeed = 1.2;\n    } else {\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\n    }\n    if (zoom['pinch'] === undefined) {\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\n    } else {\n      zoomOptions.pinch = !!zoom['pinch'];\n    }\n    return zoomOptions;\n  }\n\n  /**\n   * Parse the user-specified grid options, using reasonable defaults where\n   * behaviour is unspecified. See grid documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/grid\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized grid options.\n   */\n  private static parseGridOptions_(options: BlocklyOptions): GridOptions {\n    const grid = options['grid'] || {};\n    const gridOptions = {} as GridOptions;\n    gridOptions.spacing = Number(grid['spacing']) || 0;\n    gridOptions.colour = grid['colour'] || '#888';\n    gridOptions.length =\n      grid['length'] === undefined ? 1 : Number(grid['length']);\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\n    return gridOptions;\n  }\n\n  /**\n   * Parse the user-specified theme options, using the classic theme as a\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\n   *\n   * @param options Dictionary of options.\n   * @returns A Blockly Theme.\n   */\n  private static parseThemeOptions_(options: BlocklyOptions): Theme {\n    const theme = options['theme'] || Classic;\n    if (typeof theme === 'string') {\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\n    } else if (theme instanceof Theme) {\n      return theme;\n    }\n    return Theme.defineTheme(\n      theme.name || 'builtin' + idGenerator.getNextUniqueId(),\n      theme,\n    );\n  }\n}\n\nexport namespace Options {\n  export interface GridOptions {\n    colour: string;\n    length: number;\n    snap: boolean;\n    spacing: number;\n  }\n\n  export interface MoveOptions {\n    drag: boolean;\n    scrollbars: boolean | ScrollbarOptions;\n    wheel: boolean;\n  }\n\n  export interface ScrollbarOptions {\n    horizontal: boolean;\n    vertical: boolean;\n  }\n\n  export interface ZoomOptions {\n    controls: boolean;\n    maxScale: number;\n    minScale: number;\n    pinch: boolean;\n    scaleSpeed: number;\n    startScale: number;\n    wheel: boolean;\n  }\n}\n\nexport type GridOptions = Options.GridOptions;\nexport type MoveOptions = Options.MoveOptions;\nexport type ScrollbarOptions = Options.ScrollbarOptions;\nexport type ZoomOptions = Options.ZoomOptions;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockChange\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {IconType} from '../icons/icon_types.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when some element of a block has changed (e.g.\n * field values, comments, etc).\n */\nexport class BlockChange extends BlockBase {\n  override type = eventUtils.BLOCK_CHANGE;\n  /**\n   * The element that changed; one of 'field', 'comment', 'collapsed',\n   * 'disabled', 'inline', or 'mutation'\n   */\n  element?: string;\n\n  /** The name of the field that changed, if this is a change to a field. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block.  Undefined for a blank event.\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\n   * @param opt_name Name of input or field affected, or null.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_element?: string,\n    opt_name?: string | null,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.element = opt_element;\n    this.name = opt_name || undefined;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockChangeJson {\n    const json = super.toJson() as BlockChangeJson;\n    if (!this.element) {\n      throw new Error(\n        'The changed element is undefined. Either pass an ' +\n          'element to the constructor, or call fromJson',\n      );\n    }\n    json['element'] = this.element;\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockChange(),\n    ) as BlockChange;\n    newEvent.element = json['element'];\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n    // Assume the block is rendered so that then we can check.\n    const icon = block.getIcon(IconType.MUTATOR);\n    if (icon && hasBubble(icon) && icon.bubbleIsVisible()) {\n      // Close the mutator (if open) since we don't want to update it.\n      icon.setBubbleVisible(false);\n    }\n    const value = forward ? this.newValue : this.oldValue;\n    switch (this.element) {\n      case 'field': {\n        const field = block.getField(this.name!);\n        if (field) {\n          field.setValue(value);\n        } else {\n          console.warn(\"Can't set non-existent field: \" + this.name);\n        }\n        break;\n      }\n      case 'comment':\n        block.setCommentText((value as string) || null);\n        break;\n      case 'collapsed':\n        block.setCollapsed(!!value);\n        break;\n      case 'disabled':\n        block.setEnabled(!value);\n        break;\n      case 'inline':\n        block.setInputsInline(!!value);\n        break;\n      case 'mutation': {\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\n        if (block.loadExtraState) {\n          block.loadExtraState(JSON.parse((value as string) || '{}'));\n        } else if (block.domToMutation) {\n          block.domToMutation(\n            utilsXml.textToDom((value as string) || '<mutation/>'),\n          );\n        }\n        eventUtils.fire(\n          new BlockChange(block, 'mutation', null, oldState, value),\n        );\n        break;\n      }\n      default:\n        console.warn('Unknown change type: ' + this.element);\n    }\n  }\n\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\n  //    refactoring change events.\n  /**\n   * Returns the extra state of the given block (either as XML or a JSO,\n   * depending on the block's definition).\n   *\n   * @param block The block to get the extra state of.\n   * @returns A stringified version of the extra state of the given block.\n   * @internal\n   */\n  static getExtraBlockState_(block: BlockSvg): string {\n    if (block.saveExtraState) {\n      const state = block.saveExtraState(true);\n      return state ? JSON.stringify(state) : '';\n    } else if (block.mutationToDom) {\n      const state = block.mutationToDom();\n      return state ? Xml.domToText(state) : '';\n    }\n    return '';\n  }\n}\n\nexport interface BlockChangeJson extends BlockBaseJson {\n  element: string;\n  name?: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CHANGE, BlockChange);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Field.  Used for editable titles, variables, etc.\n * This is an abstract class that defines the UI on the block.  Actual\n * instances would be FieldTextInput, FieldDropdown, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Field\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport type {IRegistrable} from './interfaces/i_registrable.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {ConstantProvider} from './renderers/common/constants.js';\nimport type {KeyboardShortcut} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {ISerializable} from './interfaces/i_serializable.js';\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldValidator<T = any> = (newValue: T) => T | null | undefined;\n\n/**\n * Abstract class for an editable field.\n *\n * @typeParam T - The value stored on the field.\n */\nexport abstract class Field<T = any>\n  implements\n    IASTNodeLocationSvg,\n    IASTNodeLocationWithBlock,\n    IKeyboardAccessible,\n    IRegistrable,\n    ISerializable\n{\n  /**\n   * To overwrite the default value which is set in **Field**, directly update\n   * the prototype.\n   *\n   * Example:\n   * `FieldImage.prototype.DEFAULT_VALUE = null;`\n   */\n  DEFAULT_VALUE: T | null = null;\n\n  /** Non-breaking space. */\n  static readonly NBSP = '\\u00A0';\n\n  /**\n   * A value used to signal when a field's constructor should *not* set the\n   * field's value or run configure_, and should allow a subclass to do that\n   * instead.\n   */\n  static readonly SKIP_SETUP = Symbol('SKIP_SETUP');\n\n  /**\n   * Name of field.  Unique within each block.\n   * Static labels are usually unnamed.\n   */\n  name?: string = undefined;\n  protected value_: T | null;\n\n  /** Validation function called when user edits an editable field. */\n  protected validator_: FieldValidator<T> | null = null;\n\n  /**\n   * Used to cache the field's tooltip value if setTooltip is called when the\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\n   */\n  private tooltip_: Tooltip.TipInfo | null = null;\n  protected size_: Size;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the field.\n   * This is null if there is no cursor on the field.\n   */\n  private cursorSvg_: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the field.\n   * This is null if there is no marker on the field.\n   */\n  private markerSvg_: SVGElement | null = null;\n\n  /** The rendered field's SVG group element. */\n  protected fieldGroup_: SVGGElement | null = null;\n\n  /** The rendered field's SVG border element. */\n  protected borderRect_: SVGRectElement | null = null;\n\n  /** The rendered field's SVG text element. */\n  protected textElement_: SVGTextElement | null = null;\n\n  /** The rendered field's text content element. */\n  protected textContent_: Text | null = null;\n\n  /** Mouse down event listener data. */\n  private mouseDownWrapper_: browserEvents.Data | null = null;\n\n  /** Constants associated with the source block's renderer. */\n  protected constants_: ConstantProvider | null = null;\n\n  /**\n   * Has this field been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** Maximum characters of text to display before adding an ellipsis. */\n  maxDisplayLength = 50;\n\n  /** Block this field is attached to.  Starts as null, then set in init. */\n  protected sourceBlock_: Block | null = null;\n\n  /** Does this block need to be re-rendered? */\n  protected isDirty_ = true;\n\n  /** Is the field visible, or hidden due to the block being collapsed? */\n  protected visible_ = true;\n\n  /**\n   * Can the field value be changed using the editor on an editable block?\n   */\n  protected enabled_ = true;\n\n  /** The element the click handler is bound to. */\n  protected clickTarget_: Element | null = null;\n\n  /**\n   * The prefix field.\n   *\n   * @internal\n   */\n  prefixField: string | null = null;\n\n  /**\n   * The suffix field.\n   *\n   * @internal\n   */\n  suffixField: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. They will also be saved by the serializer.\n   */\n  EDITABLE = true;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable. This is not the\n   * case by default so that SERIALIZABLE is backwards compatible.\n   */\n  SERIALIZABLE = false;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  CURSOR = '';\n\n  /**\n   * @param value The initial value of the field.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value & returns a validated value, or null to\n   *     abort the change.\n   * @param config A map of options used to configure the field.\n   *    Refer to the individual field's documentation for a list of properties\n   * this parameter supports.\n   */\n  constructor(\n    value: T | typeof Field.SKIP_SETUP,\n    validator?: FieldValidator<T> | null,\n    config?: FieldConfig,\n  ) {\n    /**\n     * A generic value possessed by the field.\n     * Should generally be non-null, only null when the field is created.\n     */\n    this.value_ =\n      'DEFAULT_VALUE' in new.target.prototype\n        ? new.target.prototype.DEFAULT_VALUE\n        : this.DEFAULT_VALUE;\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Process the configuration map passed to the field.\n   *\n   * @param config A map of options used to configure the field. See the\n   *     individual field's documentation for a list of properties this\n   *     parameter supports.\n   */\n  protected configure_(config: FieldConfig) {\n    // TODO (#2884): Possibly add CSS class config option.\n    // TODO (#2885): Possibly add cursor config option.\n    if (config.tooltip) {\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\n    }\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  setSourceBlock(block: Block) {\n    if (this.sourceBlock_) {\n      throw Error('Field already bound to a block');\n    }\n    this.sourceBlock_ = block;\n  }\n\n  /**\n   * Get the renderer constant provider.\n   *\n   * @returns The renderer constant provider.\n   */\n  getConstants(): ConstantProvider | null {\n    if (\n      !this.constants_ &&\n      this.sourceBlock_ &&\n      !this.sourceBlock_.isDeadOrDying() &&\n      this.sourceBlock_.workspace.rendered\n    ) {\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\n        .getRenderer()\n        .getConstants();\n    }\n    return this.constants_;\n  }\n\n  /**\n   * Get the block this field is attached to.\n   *\n   * @returns The block containing this field.\n   * @throws An error if the source block is not defined.\n   */\n  getSourceBlock(): Block | null {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Initialize everything to render this field. Override\n   * methods initModel and initView rather than this method.\n   *\n   * @sealed\n   * @internal\n   */\n  init() {\n    if (this.fieldGroup_) {\n      // Field has already been initialized once.\n      return;\n    }\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\n    if (!this.isVisible()) {\n      this.fieldGroup_.style.display = 'none';\n    }\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\n    this.initView();\n    this.updateEditable();\n    this.setTooltip(this.tooltip_);\n    this.bindEvents_();\n    this.initModel();\n  }\n\n  /**\n   * Create the block UI for this field.\n   */\n  protected initView() {\n    this.createBorderRect_();\n    this.createTextElement_();\n  }\n\n  /**\n   * Initializes the model of the field after it has been installed on a block.\n   * No-op by default.\n   */\n  initModel() {}\n\n  /**\n   * Defines whether this field should take up the full block or not.\n   *\n   * Be cautious when overriding this function. It may not work as you expect /\n   * intend because the behavior was kind of hacked in. If you are thinking\n   * about overriding this function, post on the forum with your intended\n   * behavior to see if there's another approach.\n   */\n  protected isFullBlockField(): boolean {\n    return !this.borderRect_;\n  }\n\n  /**\n   * Create a field border rect element. Not to be overridden by subclasses.\n   * Instead modify the result of the function inside initView, or create a\n   * separate function to call.\n   */\n  protected createBorderRect_() {\n    this.borderRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'x': 0,\n        'y': 0,\n        'height': this.size_.height,\n        'width': this.size_.width,\n        'class': 'blocklyFieldRect',\n      },\n      this.fieldGroup_,\n    );\n  }\n\n  /**\n   * Create a field text element. Not to be overridden by subclasses. Instead\n   * modify the result of the function inside initView, or create a separate\n   * function to call.\n   */\n  protected createTextElement_() {\n    this.textElement_ = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyText',\n      },\n      this.fieldGroup_,\n    );\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.textElement_.setAttribute('dominant-baseline', 'central');\n    }\n    this.textContent_ = document.createTextNode('');\n    this.textElement_.appendChild(this.textContent_);\n  }\n\n  /**\n   * Bind events to the field. Can be overridden by subclasses if they need to\n   * do custom input handling.\n   */\n  protected bindEvents_() {\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    Tooltip.bindMouseEvents(clickTarget);\n    this.mouseDownWrapper_ = browserEvents.conditionalBind(\n      clickTarget,\n      'pointerdown',\n      this,\n      this.onMouseDown_,\n    );\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  fromXml(fieldElement: Element) {\n    // Any because gremlins live here. No touchie!\n    this.setValue(fieldElement.textContent as any);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  toXml(fieldElement: Element): Element {\n    // Any because gremlins live here. No touchie!\n    fieldElement.textContent = this.getValue() as any;\n    return fieldElement;\n  }\n\n  /**\n   * Saves this fields value as something which can be serialized to JSON.\n   * Should only be called by the serialization system.\n   *\n   * @param _doFullSerialization If true, this signals to the field that if it\n   *     normally just saves a reference to some state (eg variable fields) it\n   *     should instead serialize the full state of the thing being referenced.\n   *     See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#full_serialization_and_backing_data | field serialization docs}\n   *     for more information.\n   * @returns JSON serializable state.\n   * @internal\n   */\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(Field);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's state based on the given state value. Should only be\n   * called by the serialization system.\n   *\n   * @param state The state we want to apply to the field.\n   * @internal\n   */\n  loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Returns a stringified version of the XML state, if it should be used.\n   * Otherwise this returns null, to signal the field should use its own\n   * serialization.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @returns The stringified version of the XML state, or null.\n   */\n  protected saveLegacyState(callingClass: FieldProto): string | null {\n    if (\n      callingClass.prototype.saveState === this.saveState &&\n      callingClass.prototype.toXml !== this.toXml\n    ) {\n      const elem = utilsXml.createElement('field');\n      elem.setAttribute('name', this.name || '');\n      const text = utilsXml.domToText(this.toXml(elem));\n      return text.replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n    // Either they called this on purpose from their saveState, or they have\n    // no implementations of either hook. Just do our thing.\n    return null;\n  }\n\n  /**\n   * Loads the given state using either the old XML hooks, if they should be\n   * used. Returns true to indicate loading has been handled, false otherwise.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @param state The state to apply to the field.\n   * @returns Whether the state was applied or not.\n   */\n  loadLegacyState(\n    callingClass: FieldProto,\n    state: AnyDuringMigration,\n  ): boolean {\n    if (\n      callingClass.prototype.loadState === this.loadState &&\n      callingClass.prototype.fromXml !== this.fromXml\n    ) {\n      this.fromXml(utilsXml.textToDom(state as string));\n      return true;\n    }\n    // Either they called this on purpose from their loadState, or they have\n    // no implementations of either hook. Just do our thing.\n    return false;\n  }\n\n  /**\n   * Dispose of all DOM objects and events belonging to this editable field.\n   *\n   * @internal\n   */\n  dispose() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hideIfOwner(this);\n\n    if (!this.getSourceBlock()?.isDeadOrDying()) {\n      dom.removeNode(this.fieldGroup_);\n    }\n\n    this.disposed = true;\n  }\n\n  /** Add or remove the UI indicating if this field is editable or not. */\n  updateEditable() {\n    const group = this.fieldGroup_;\n    const block = this.getSourceBlock();\n    if (!this.EDITABLE || !group || !block) {\n      return;\n    }\n    if (this.enabled_ && block.isEditable()) {\n      dom.addClass(group, 'blocklyEditableText');\n      dom.removeClass(group, 'blocklyNonEditableText');\n      group.style.cursor = this.CURSOR;\n    } else {\n      dom.addClass(group, 'blocklyNonEditableText');\n      dom.removeClass(group, 'blocklyEditableText');\n      group.style.cursor = '';\n    }\n  }\n\n  /**\n   * Set whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled_ = enabled;\n    this.updateEditable();\n  }\n\n  /**\n   * Check whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @returns Whether this field is enabled.\n   */\n  isEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Check whether this field defines the showEditor_ function.\n   *\n   * @returns Whether this field is clickable.\n   */\n  isClickable(): boolean {\n    return (\n      this.enabled_ &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable() &&\n      this.showEditor_ !== Field.prototype.showEditor_\n    );\n  }\n\n  /**\n   * Check whether the field should be clickable while the block is in a flyout.\n   * The default is that fields are clickable in always-open flyouts such as the\n   * simple toolbox, but not in autoclosing flyouts such as the category toolbox.\n   * Subclasses may override this function to change this behavior. Note that\n   * `isClickable` must also return true for this to have any effect.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the field should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return !autoClosingFlyout;\n  }\n\n  /**\n   * Check whether this field is currently editable.  Some fields are never\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\n   * non-editable blocks or be currently disabled.\n   *\n   * @returns Whether this field is currently enabled, editable and on an\n   *     editable block.\n   */\n  isCurrentlyEditable(): boolean {\n    return (\n      this.enabled_ &&\n      this.EDITABLE &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable()\n    );\n  }\n\n  /**\n   * Check whether this field should be serialized by the XML renderer.\n   * Handles the logic for backwards compatibility and incongruous states.\n   *\n   * @returns Whether this field should be serialized or not.\n   */\n  isSerializable(): boolean {\n    let isSerializable = false;\n    if (this.name) {\n      if (this.SERIALIZABLE) {\n        isSerializable = true;\n      } else if (this.EDITABLE) {\n        console.warn(\n          'Detected an editable field that was not serializable.' +\n            ' Please define SERIALIZABLE property as true on all editable custom' +\n            ' fields. Proceeding with serialization.',\n        );\n        isSerializable = true;\n      }\n    }\n    return isSerializable;\n  }\n\n  /**\n   * Gets whether this editable field is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible_;\n  }\n\n  /**\n   * Sets whether this editable field is visible or not. Should only be called\n   * by input.setVisible.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisible(visible: boolean) {\n    if (this.visible_ === visible) {\n      return;\n    }\n    this.visible_ = visible;\n    const root = this.fieldGroup_;\n    if (root) {\n      root.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Sets a new validation function for editable fields, or clears a previously\n   * set validator.\n   *\n   * The validator function takes in the new field value, and returns\n   * validated value. The validated value could be the input value, a modified\n   * version of the input value, or null to abort the change.\n   *\n   * If the function does not return anything (or returns undefined) the new\n   * value is accepted as valid. This is to allow for fields using the\n   * validated function as a field-level change event notification.\n   *\n   * @param handler The validator function or null to clear a previous\n   *     validator.\n   */\n  setValidator(handler: FieldValidator<T>) {\n    this.validator_ = handler;\n  }\n\n  /**\n   * Gets the validation function for editable fields, or null if not set.\n   *\n   * @returns Validation function, or null.\n   */\n  getValidator(): FieldValidator<T> | null {\n    return this.validator_;\n  }\n\n  /**\n   * Gets the group element for this editable field.\n   * Used for measuring the size and for positioning.\n   *\n   * @returns The group element.\n   */\n  getSvgRoot(): SVGGElement | null {\n    return this.fieldGroup_;\n  }\n\n  /**\n   * Gets the border rectangle element.\n   *\n   * @returns The border rectangle element.\n   * @throws An error if the border rectangle element is not defined.\n   */\n  protected getBorderRect(): SVGRectElement {\n    if (!this.borderRect_) {\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\n    }\n    return this.borderRect_;\n  }\n\n  /**\n   * Gets the text element.\n   *\n   * @returns The text element.\n   * @throws An error if the text element is not defined.\n   */\n  protected getTextElement(): SVGTextElement {\n    if (!this.textElement_) {\n      throw new Error(`The text element is ${this.textElement_}.`);\n    }\n    return this.textElement_;\n  }\n\n  /**\n   * Gets the text content.\n   *\n   * @returns The text content.\n   * @throws An error if the text content is not defined.\n   */\n  protected getTextContent(): Text {\n    if (!this.textContent_) {\n      throw new Error(`The text content is ${this.textContent_}.`);\n    }\n    return this.textContent_;\n  }\n\n  /**\n   * Updates the field to match the colour/style of the block.\n   *\n   * Non-abstract sub-classes may wish to implement this if the colour of the\n   * field depends on the colour of the block. It will automatically be called\n   * at relevant times, such as when the parent block or renderer changes.\n   *\n   * See {@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#matching_block_colours\n   * | the field documentation} for more information, or FieldDropdown for an\n   * example.\n   */\n  applyColour() {}\n\n  /**\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\n   *\n   * All rendering that has an effect on the size/shape of the block should be\n   * done here, and should be triggered by getSize().\n   */\n  protected render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_();\n  }\n\n  /**\n   * Calls showEditor_ when the field is clicked if the field is clickable.\n   * Do not override.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @sealed\n   * @internal\n   */\n  showEditor(e?: Event) {\n    if (this.isClickable()) {\n      this.showEditor_(e);\n    }\n  }\n\n  /**\n   * A developer hook to create an editor for the field. This is no-op by\n   * default, and must be overriden to create an editor.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected showEditor_(_e?: Event): void {}\n  // NOP\n\n  /**\n   * A developer hook to reposition the WidgetDiv during a window resize. You\n   * need to define this hook if your field has a WidgetDiv that needs to\n   * reposition itself when the window is resized. For example, text input\n   * fields define this hook so that the input WidgetDiv can reposition itself\n   * on a window resize event. This is especially important when modal inputs\n   * have been disabled, as Android devices will fire a window resize event when\n   * the soft keyboard opens.\n   *\n   * If you want the WidgetDiv to hide itself instead of repositioning, return\n   * false. This is the default behavior.\n   *\n   * DropdownDivs already handle their own positioning logic, so you do not need\n   * to override this function if your field only has a DropdownDiv.\n   *\n   * @returns True if the field should be repositioned,\n   *    false if the WidgetDiv should hide itself instead.\n   */\n  repositionForWindowResize(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the size of the field based on the text.\n   *\n   * @param margin margin to use when positioning the text element.\n   */\n  protected updateSize_(margin?: number) {\n    const constants = this.getConstants();\n    const xOffset =\n      margin !== undefined\n        ? margin\n        : !this.isFullBlockField()\n          ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n          : 0;\n    let totalWidth = xOffset * 2;\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\n\n    let contentWidth = 0;\n    if (this.textElement_) {\n      contentWidth = dom.getFastTextWidth(\n        this.textElement_,\n        constants!.FIELD_TEXT_FONTSIZE,\n        constants!.FIELD_TEXT_FONTWEIGHT,\n        constants!.FIELD_TEXT_FONTFAMILY,\n      );\n      totalWidth += contentWidth;\n    }\n    if (!this.isFullBlockField()) {\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionTextElement_(xOffset, contentWidth);\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Position a field's text element after a size change.  This handles both LTR\n   * and RTL positioning.\n   *\n   * @param xOffset x offset to use when positioning the text element.\n   * @param contentWidth The content width.\n   */\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\n    if (!this.textElement_) {\n      return;\n    }\n    const constants = this.getConstants();\n    const halfHeight = this.size_.height / 2;\n\n    this.textElement_.setAttribute(\n      'x',\n      String(\n        this.getSourceBlock()?.RTL\n          ? this.size_.width - contentWidth - xOffset\n          : xOffset,\n      ),\n    );\n    this.textElement_.setAttribute(\n      'y',\n      String(\n        constants!.FIELD_TEXT_BASELINE_CENTER\n          ? halfHeight\n          : halfHeight -\n              constants!.FIELD_TEXT_HEIGHT / 2 +\n              constants!.FIELD_TEXT_BASELINE,\n      ),\n    );\n  }\n\n  /** Position a field's border rect after a size change. */\n  protected positionBorderRect_() {\n    if (!this.borderRect_) {\n      return;\n    }\n    this.borderRect_.setAttribute('width', String(this.size_.width));\n    this.borderRect_.setAttribute('height', String(this.size_.height));\n    this.borderRect_.setAttribute(\n      'rx',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n    this.borderRect_.setAttribute(\n      'ry',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  getSize(): Size {\n    if (!this.isVisible()) {\n      return new Size(0, 0);\n    }\n\n    if (this.isDirty_) {\n      this.render_();\n      this.isDirty_ = false;\n    } else if (this.visible_ && this.size_.width === 0) {\n      // If the field is not visible the width will be 0 as well, one of the\n      // problems with the old system.\n      this.render_();\n      // Don't issue a warning if the field is actually zero width.\n      if (this.size_.width !== 0) {\n        console.warn(\n          'Deprecated use of setting size_.width to 0 to rerender a' +\n            ' field. Set field.isDirty_ to true instead.',\n        );\n      }\n    }\n    return this.size_;\n  }\n\n  /**\n   * Returns the bounding box of the rendered field, accounting for workspace\n   * scaling.\n   *\n   * @returns An object with top, bottom, left, and right in pixels relative to\n   *     the top left corner of the page (window coordinates).\n   * @internal\n   */\n  getScaledBBox(): Rect {\n    let scaledWidth;\n    let scaledHeight;\n    let xy;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    if (this.isFullBlockField()) {\n      // Browsers are inconsistent in what they return for a bounding box.\n      // - Webkit / Blink: fill-box / object bounding box\n      // - Gecko: stroke-box\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\n      const scale = (block.workspace as WorkspaceSvg).scale;\n      xy = this.getAbsoluteXY_();\n      scaledWidth = (bBox.width + 1) * scale;\n      scaledHeight = (bBox.height + 1) * scale;\n\n      if (userAgent.GECKO) {\n        xy.x += 1.5 * scale;\n        xy.y += 1.5 * scale;\n      } else {\n        xy.x -= 0.5 * scale;\n        xy.y -= 0.5 * scale;\n      }\n    } else {\n      const bBox = this.borderRect_!.getBoundingClientRect();\n      xy = style.getPageOffset(this.borderRect_!);\n      scaledWidth = bBox.width;\n      scaledHeight = bBox.height;\n    }\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n  }\n\n  /**\n   * Notifies the field that it has changed locations.\n   *\n   * @param _ The location of this field's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(_: Coordinate) {}\n\n  /**\n   * Get the text from this field to display on the block. May differ from\n   * `getText` due to ellipsis, and other formatting.\n   *\n   * @returns Text to display.\n   */\n  protected getDisplayText_(): string {\n    let text = this.getText();\n    if (!text) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    if (text.length > this.maxDisplayLength) {\n      // Truncate displayed string and add an ellipsis ('...').\n      text = text.substring(0, this.maxDisplayLength - 2) + '…';\n    }\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\n    text = text.replace(/\\s/g, Field.NBSP);\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\n      // The SVG is LTR, force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    return text;\n  }\n\n  /**\n   * Get the text from this field.\n   * Override getText_ to provide a different behavior than simply casting the\n   * value to a string.\n   *\n   * @returns Current text.\n   * @sealed\n   */\n  getText(): string {\n    // this.getText_ was intended so that devs don't have to remember to call\n    // super when overriding how the text of the field is generated. (#2910)\n    const text = this.getText_();\n    if (text !== null) {\n      return String(text);\n    }\n    return String(this.getValue());\n  }\n\n  /**\n   * A developer hook to override the returned text of this field.\n   * Override if the text representation of the value of this field\n   * is not just a string cast of its value.\n   * Return null to resort to a string cast.\n   *\n   * @returns Current text or null.\n   */\n  protected getText_(): string | null {\n    return null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  markDirty() {\n    this.isDirty_ = true;\n    this.constants_ = null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  forceRerender() {\n    this.isDirty_ = true;\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\n      (this.sourceBlock_ as BlockSvg).queueRender();\n      (this.sourceBlock_ as BlockSvg).bumpNeighbours();\n    }\n  }\n\n  /**\n   * Used to change the value of the field. Handles validation and events.\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\n   * than this method.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   * @sealed\n   */\n  setValue(newValue: AnyDuringMigration, fireChangeEvent = true) {\n    const doLogging = false;\n    if (newValue === null) {\n      doLogging && console.log('null, return');\n      // Not a valid value to check.\n      return;\n    }\n\n    const classValidation = this.doClassValidation_(newValue);\n    const classValue = this.processValidation_(newValue, classValidation);\n    if (classValue instanceof Error) {\n      doLogging && console.log('invalid class validation, return');\n      return;\n    }\n\n    const localValidation = this.getValidator()?.call(this, classValue);\n    const localValue = this.processValidation_(classValue, localValidation);\n    if (localValue instanceof Error) {\n      doLogging && console.log('invalid local validation, return');\n      return;\n    }\n\n    const source = this.sourceBlock_;\n    if (source && source.disposed) {\n      doLogging && console.log('source disposed, return');\n      return;\n    }\n\n    const oldValue = this.getValue();\n    if (oldValue === localValue) {\n      doLogging && console.log('same, doValueUpdate_, return');\n      this.doValueUpdate_(localValue);\n      return;\n    }\n\n    this.doValueUpdate_(localValue);\n    if (fireChangeEvent && source && eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          source,\n          'field',\n          this.name || null,\n          oldValue,\n          localValue,\n        ),\n      );\n    }\n    if (this.isDirty_) {\n      this.forceRerender();\n    }\n    doLogging && console.log(this.value_);\n  }\n\n  /**\n   * Process the result of validation.\n   *\n   * @param newValue New value.\n   * @param validatedValue Validated value.\n   * @returns New value, or an Error object.\n   */\n  private processValidation_(\n    newValue: AnyDuringMigration,\n    validatedValue: T | null | undefined,\n  ): T | Error {\n    if (validatedValue === null) {\n      this.doValueInvalid_(newValue);\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      return Error();\n    }\n    return validatedValue === undefined ? (newValue as T) : validatedValue;\n  }\n\n  /**\n   * Get the current value of the field.\n   *\n   * @returns Current value.\n   */\n  getValue(): T | null {\n    return this.value_;\n  }\n\n  /**\n   * Validate the changes to a field's value before they are set. See\n   * **FieldDropdown** for an example of subclass implementation.\n   *\n   * **NOTE:** Validation returns one option between `T`, `null`, and\n   * `undefined`. **Field**'s implementation will never return `undefined`, but\n   * it is valid for a subclass to return `undefined` if the new value is\n   * compatible with `T`.\n   *\n   * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n   * @param newValue - The value to be validated.\n   * @returns One of three instructions for setting the new value: `T`, `null`,\n   * or `undefined`.\n   *\n   * - `T` to set this function's returned value instead of `newValue`.\n   *\n   * - `null` to invoke `doValueInvalid_` and not set a value.\n   *\n   * - `undefined` to set `newValue` as is.\n   */\n  protected doClassValidation_(newValue: T): T | null | undefined;\n  protected doClassValidation_(newValue?: AnyDuringMigration): T | null;\n  protected doClassValidation_(\n    newValue?: T | AnyDuringMigration,\n  ): T | null | undefined {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n\n    return newValue as T;\n  }\n\n  /**\n   * Used to update the value of a field. Can be overridden by subclasses to do\n   * custom storage of values/updating of external things.\n   *\n   * @param newValue The value to be saved.\n   */\n  protected doValueUpdate_(newValue: T) {\n    this.value_ = newValue;\n    this.isDirty_ = true;\n  }\n\n  /**\n   * Used to notify the field an invalid value was input. Can be overridden by\n   * subclasses, see FieldTextInput.\n   * No-op by default.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   */\n  protected doValueInvalid_(_invalidValue: AnyDuringMigration) {}\n  // NOP\n\n  /**\n   * Handle a pointerdown event on a field.\n   *\n   * @param e Pointer down event.\n   */\n  protected onMouseDown_(e: PointerEvent) {\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\n      return;\n    }\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\n    if (gesture) {\n      gesture.setStartField(this);\n    }\n  }\n\n  /**\n   * Sets the tooltip for this field.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\n   *     display the tooltip of the parent block. To not display a tooltip pass\n   *     the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo | null) {\n    if (!newTip && newTip !== '') {\n      // If null or undefined.\n      newTip = this.sourceBlock_;\n    }\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\n    } else {\n      // Field has not been initialized yet.\n      this.tooltip_ = newTip;\n    }\n  }\n\n  /**\n   * Returns the tooltip text for this field.\n   *\n   * @returns The tooltip text for this field.\n   */\n  getTooltip(): string {\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      return Tooltip.getTooltipOfObject(clickTarget);\n    }\n    // Field has not been initialized yet. Return stashed this.tooltip_ value.\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip_});\n  }\n\n  /**\n   * The element to bind the click handler to. If not set explicitly, defaults\n   * to the SVG root of the field. When this element is\n   * clicked on an editable field, the editor will open.\n   *\n   * @returns Element to bind click handler to.\n   */\n  protected getClickTarget_(): Element | null {\n    return this.clickTarget_ || this.getSvgRoot();\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this field.\n   * The origin (0,0) is the top-left corner of the page body.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  protected getAbsoluteXY_(): Coordinate {\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\n  }\n\n  /**\n   * Whether this field references any Blockly variables.  If true it may need\n   * to be handled differently during serialization and deserialization.\n   * Subclasses may override this.\n   *\n   * @returns True if this field has any variable references.\n   * @internal\n   */\n  referencesVariables(): boolean {\n    return false;\n  }\n\n  /**\n   * Refresh the variable name referenced by this field if this field references\n   * variables.\n   *\n   * @internal\n   */\n  refreshVariableName() {}\n  // NOP\n\n  /**\n   * Search through the list of inputs and their fields in order to find the\n   * parent input of a field.\n   *\n   * @returns The input that the field belongs to.\n   * @internal\n   */\n  getParentInput(): Input {\n    let parentInput = null;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const inputs = block.inputList;\n\n    for (let idx = 0; idx < block.inputList.length; idx++) {\n      const input = inputs[idx];\n      const fieldRows = input.fieldRow;\n      for (let j = 0; j < fieldRows.length; j++) {\n        if (fieldRows[j] === this) {\n          parentInput = input;\n          break;\n        }\n      }\n    }\n    return parentInput!;\n  }\n\n  /**\n   * Returns whether or not we should flip the field in RTL.\n   *\n   * @returns True if we should flip in RTL.\n   */\n  getFlipRtl(): boolean {\n    return false;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  isTabNavigable(): boolean {\n    return false;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /**\n   * Add the cursor SVG to this fields SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this fields SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the field group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(markerSvg);\n    this.markerSvg_ = markerSvg;\n  }\n\n  /**\n   * Redraw any attached marker or cursor svgs if needed.\n   *\n   * @internal\n   */\n  updateMarkers_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const workspace = block.workspace as WorkspaceSvg;\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      workspace.getCursor()!.draw();\n    }\n    if (workspace.keyboardAccessibilityMode && this.markerSvg_) {\n      // TODO(#4592): Update all markers on the field.\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n}\n\n/**\n * Extra configuration options for the base field.\n */\nexport interface FieldConfig {\n  tooltip?: string;\n}\n\n/**\n * For use by Field and descendants of Field. Constructors can change\n * in descendants, though they should contain all of Field's prototype methods.\n *\n * @internal\n */\nexport type FieldProto = Pick<typeof Field, 'prototype'>;\n\n/**\n * Represents an error where the field is trying to access its block or\n * information about its block before it has actually been attached to said\n * block.\n */\nexport class UnattachedFieldError extends Error {\n  /** @internal */\n  constructor() {\n    super(\n      'The field has not yet been attached to its input. ' +\n        'Call appendField to attach it.',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variable and procedure names.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Names\n\nimport {Msg} from './msg.js';\n// import * as Procedures from './procedures.js';\nimport type {VariableMap} from './variable_map.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a database of entity names (variables, procedures, etc).\n */\nexport class Names {\n  static DEVELOPER_VARIABLE_TYPE: NameType;\n  private readonly variablePrefix: string;\n\n  /** A set of reserved words. */\n  private readonly reservedWords: Set<string>;\n\n  /**\n   * A map from type (e.g. name, procedure) to maps from names to generated\n   * names.\n   */\n  private readonly db = new Map<string, Map<string, string>>();\n\n  /** A set of used names to avoid collisions. */\n  private readonly dbReverse = new Set<string>();\n\n  /**\n   * The variable map from the workspace, containing Blockly variable models.\n   */\n  private variableMap: VariableMap | null = null;\n\n  /**\n   * @param reservedWordsList A comma-separated string of words that are illegal\n   *     for use as names in a language (e.g. 'new,if,this,...').\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\n   *     all variable names (but not procedure names).\n   */\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\n    /** The prefix to attach to variable names in generated code. */\n    this.variablePrefix = opt_variablePrefix || '';\n\n    this.reservedWords = new Set<string>(\n      reservedWordsList ? reservedWordsList.split(',') : [],\n    );\n  }\n\n  /**\n   * Empty the database and start from scratch.  The reserved words are kept.\n   */\n  reset() {\n    this.db.clear();\n    this.dbReverse.clear();\n    this.variableMap = null;\n  }\n\n  /**\n   * Set the variable map that maps from variable name to variable object.\n   *\n   * @param map The map to track.\n   */\n  setVariableMap(map: VariableMap) {\n    this.variableMap = map;\n  }\n\n  /**\n   * Get the name for a user-defined variable, based on its ID.\n   * This should only be used for variables of NameType VARIABLE.\n   *\n   * @param id The ID to look up in the variable map.\n   * @returns The name of the referenced variable, or null if there was no\n   *     variable map or the variable was not found in the map.\n   */\n  private getNameForUserVariable(id: string): string | null {\n    if (!this.variableMap) {\n      console.warn(\n        'Deprecated call to Names.prototype.getName without ' +\n          'defining a variable map. To fix, add the following code in your ' +\n          \"generator's init() function:\\n\" +\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\n          'workspace.getVariableMap());',\n      );\n      return null;\n    }\n    const variable = this.variableMap.getVariableById(id);\n    if (variable) {\n      return variable.name;\n    }\n    return null;\n  }\n\n  /**\n   * Generate names for user variables, but only ones that are being used.\n   *\n   * @param workspace Workspace to generate variables from.\n   */\n  populateVariables(workspace: Workspace) {\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      this.getName(variables[i].getId(), NameType.VARIABLE);\n    }\n  }\n\n  /**\n   * Generate names for procedures.\n   *\n   * @param workspace Workspace to generate procedures from.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  populateProcedures(workspace: Workspace) {\n    throw new Error(\n      'The implementation of populateProcedures should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   *\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getName(nameOrId: string, type: NameType | string): string {\n    let name = nameOrId;\n    if (type === NameType.VARIABLE) {\n      const varName = this.getNameForUserVariable(nameOrId);\n      if (varName) {\n        // Successful ID lookup.\n        name = varName;\n      }\n    }\n    const normalizedName = name.toLowerCase();\n\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n\n    const prefix = isVar ? this.variablePrefix : '';\n    if (!this.db.has(type)) {\n      this.db.set(type, new Map<string, string>());\n    }\n    const typeDb = this.db.get(type);\n    if (typeDb!.has(normalizedName)) {\n      return prefix + typeDb!.get(normalizedName);\n    }\n    const safeName = this.getDistinctName(name, type);\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\n    return safeName;\n  }\n\n  /**\n   * Return a list of all known user-created names of a specified name type.\n   *\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns A list of Blockly entity names (no constraints).\n   */\n  getUserNames(type: NameType | string): string[] {\n    const userNames = this.db.get(type)?.keys();\n    return userNames ? Array.from(userNames) : [];\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   * Ensure that this is a new name not overlapping any previously defined name.\n   * Also check against list of reserved words for the current language and\n   * ensure name doesn't collide.\n   *\n   * @param name The Blockly entity name (no constraints).\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getDistinctName(name: string, type: NameType | string): string {\n    let safeName = this.safeName(name);\n    let i: number | null = null;\n    while (\n      this.dbReverse.has(safeName + (i ?? '')) ||\n      this.reservedWords.has(safeName + (i ?? ''))\n    ) {\n      // Collision with existing name.  Create a unique name.\n      i = i ? i + 1 : 2;\n    }\n    safeName += i ?? '';\n    this.dbReverse.add(safeName);\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n    const prefix = isVar ? this.variablePrefix : '';\n    return prefix + safeName;\n  }\n\n  /**\n   * Given a proposed entity name, generate a name that conforms to the\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\n   * variable and function names.\n   *\n   * @param name Potentially illegal entity name.\n   * @returns Safe entity name.\n   */\n  private safeName(name: string): string {\n    if (!name) {\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\n    } else {\n      // Unfortunately names in non-latin characters will look like\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\n      // https://github.com/google/blockly/issues/1654\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\n      // Most languages don't allow names with leading numbers.\n      if ('0123456789'.indexOf(name[0]) !== -1) {\n        name = 'my_' + name;\n      }\n    }\n    return name;\n  }\n\n  /**\n   * Do the given two entity names refer to the same entity?\n   * Blockly names are case-insensitive.\n   *\n   * @param name1 First name.\n   * @param name2 Second name.\n   * @returns True if names are the same.\n   */\n  static equals(name1: string, name2: string): boolean {\n    // name1.localeCompare(name2) is slower.\n    return name1.toLowerCase() === name2.toLowerCase();\n  }\n}\n\nexport namespace Names {\n  /**\n   * Enum for the type of a name. Different name types may have different rules\n   * about collisions.\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\n   * Therefore, Blockly keeps a separate name type to disambiguate.\n   * getName('foo', 'VARIABLE') = 'foo'\n   * getName('foo', 'PROCEDURE') = 'foo2'\n   *\n   */\n  export enum NameType {\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\n    VARIABLE = 'VARIABLE',\n    PROCEDURE = 'PROCEDURE',\n  }\n}\n\nexport type NameType = Names.NameType;\nexport const NameType = Names.NameType;\n\n/**\n * Constant to separate developer variable names from user-defined variable\n * names when running generators.\n * A developer variable will be declared as a global in the generated code, but\n * will never be shown to the user in the workspace or stored in the variable\n * map.\n */\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport type {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {isObservable} from './interfaces/i_observable.js';\n\nexport class ObservableProcedureMap\n  extends Map<string, IProcedureModel>\n  implements IProcedureMap\n{\n  /** @internal */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Adds the given procedure model to the procedure map.\n   */\n  override set(id: string, proc: IProcedureModel): this {\n    if (this.get(id) === proc) return this;\n    super.set(id, proc);\n    if (isObservable(proc)) proc.startPublishing();\n    return this;\n  }\n\n  /**\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\n   * exists).\n   */\n  override delete(id: string): boolean {\n    const proc = this.get(id);\n    const existed = super.delete(id);\n    if (!existed) return existed;\n    if (isObservable(proc)) proc.stopPublishing();\n    return existed;\n  }\n\n  /**\n   * Removes all ProcedureModels from the procedure map.\n   */\n  override clear() {\n    if (!this.size) return;\n    for (const id of this.keys()) {\n      this.delete(id);\n    }\n  }\n\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this {\n    return this.set(proc.getId(), proc);\n  }\n\n  /**\n   * Returns all of the procedures stored in this map.\n   */\n  getProcedures(): IProcedureModel[] {\n    return [...this.values()];\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as browserEvents from '../browser_events.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {IconType} from './icon_types.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as tooltip from '../tooltip.js';\n\n/**\n * The abstract icon class. Icons are visual elements that live in the top-start\n * corner of the block. Usually they provide more \"meta\" information about a\n * block (such as warnings or comments) as opposed to fields, which provide\n * \"actual\" information, related to how a block functions.\n */\nexport abstract class Icon implements IIcon {\n  /**\n   * The position of this icon relative to its blocks top-start,\n   * in workspace units.\n   */\n  protected offsetInBlock: Coordinate = new Coordinate(0, 0);\n\n  /** The position of this icon in workspace coordinates. */\n  protected workspaceLocation: Coordinate = new Coordinate(0, 0);\n\n  /** The root svg element visually representing this icon. */\n  protected svgRoot: SVGGElement | null = null;\n\n  /** The tooltip for this icon. */\n  protected tooltip: tooltip.TipInfo;\n\n  constructor(protected sourceBlock: Block) {\n    this.tooltip = sourceBlock;\n  }\n\n  getType(): IconType<IIcon> {\n    throw new Error('Icons must implement getType');\n  }\n\n  initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // The icon has already been initialized.\n\n    const svgBlock = this.sourceBlock as BlockSvg;\n    this.svgRoot = dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\n    svgBlock.getSvgRoot().appendChild(this.svgRoot);\n    this.updateSvgRootOffset();\n    browserEvents.conditionalBind(\n      this.svgRoot,\n      'pointerdown',\n      this,\n      pointerdownListener,\n    );\n    (this.svgRoot as any).tooltip = this;\n    tooltip.bindMouseEvents(this.svgRoot);\n  }\n\n  dispose(): void {\n    tooltip.unbindMouseEvents(this.svgRoot);\n    dom.removeNode(this.svgRoot);\n  }\n\n  getWeight(): number {\n    return -1;\n  }\n\n  getSize(): Size {\n    return new Size(0, 0);\n  }\n\n  /**\n   * Sets the tooltip for this icon to the given value. Null to show the\n   * tooltip of the block.\n   */\n  setTooltip(tip: tooltip.TipInfo | null) {\n    this.tooltip = tip ?? this.sourceBlock;\n  }\n\n  /** Returns the tooltip for this icon. */\n  getTooltip(): tooltip.TipInfo {\n    return this.tooltip;\n  }\n\n  applyColour(): void {}\n\n  updateEditable(): void {}\n\n  updateCollapsed(): void {\n    if (!this.svgRoot) return;\n    if (this.sourceBlock.isCollapsed()) {\n      this.svgRoot.style.display = 'none';\n    } else {\n      this.svgRoot.style.display = 'block';\n    }\n    if (hasBubble(this)) {\n      this.setBubbleVisible(false);\n    }\n  }\n\n  hideForInsertionMarker(): void {\n    if (!this.svgRoot) return;\n    this.svgRoot.style.display = 'none';\n  }\n\n  isShownWhenCollapsed(): boolean {\n    return false;\n  }\n\n  setOffsetInBlock(offset: Coordinate): void {\n    this.offsetInBlock = offset;\n    this.updateSvgRootOffset();\n  }\n\n  private updateSvgRootOffset(): void {\n    this.svgRoot?.setAttribute(\n      'transform',\n      `translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`,\n    );\n  }\n\n  onLocationChange(blockOrigin: Coordinate): void {\n    this.workspaceLocation = Coordinate.sum(blockOrigin, this.offsetInBlock);\n  }\n\n  onClick(): void {}\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * The default is that icons are clickable in all flyouts (auto-closing or not).\n   * Subclasses may override this function to change this behavior.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return true;\n  }\n\n  /**\n   * Sets the visibility of the icon's bubble if one exists.\n   *\n   * @deprecated Use `setBubbleVisible` instead. To be removed in v11.\n   */\n  setVisible(visibility: boolean): void {\n    deprecation.warn('setVisible', 'v10', 'v11', 'setBubbleVisible');\n    if (hasBubble(this)) this.setBubbleVisible(visibility);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as browserEvents from '../browser_events.js';\nimport {IBubble} from '../interfaces/i_bubble.js';\nimport {ContainerRegion} from '../metrics_manager.js';\nimport {Scrollbar} from '../scrollbar.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as math from '../utils/math.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * The abstract pop-up bubble class. This creates a UI that looks like a speech\n * bubble, where it has a \"tail\" that points to the block, and a \"head\" that\n * displays arbitrary svg elements.\n */\nexport abstract class Bubble implements IBubble {\n  /** The width of the border around the bubble. */\n  static readonly BORDER_WIDTH = 6;\n\n  /** Double the width of the border around the bubble. */\n  static readonly DOUBLE_BORDER = this.BORDER_WIDTH * 2;\n\n  /** The minimum size the bubble can have. */\n  static readonly MIN_SIZE = this.DOUBLE_BORDER;\n\n  /**\n   * The thickness of the base of the tail in relation to the size of the\n   * bubble. Higher numbers result in thinner tails.\n   */\n  static readonly TAIL_THICKNESS = 1;\n\n  /** The number of degrees that the tail bends counter-clockwise. */\n  static readonly TAIL_ANGLE = 20;\n\n  /**\n   * The sharpness of the tail's bend. Higher numbers result in smoother\n   * tails.\n   */\n  static readonly TAIL_BEND = 4;\n\n  /** Distance between arrow point and anchor point. */\n  static readonly ANCHOR_RADIUS = 8;\n\n  /** The SVG group containing all parts of the bubble. */\n  protected svgRoot: SVGGElement;\n\n  /** The SVG path for the arrow from the anchor to the bubble. */\n  private tail: SVGPathElement;\n\n  /** The SVG background rect for the main body of the bubble. */\n  private background: SVGRectElement;\n\n  /** The SVG group containing the contents of the bubble. */\n  protected contentContainer: SVGGElement;\n\n  /**\n   * The size of the bubble (including background and contents but not tail).\n   */\n  private size = new Size(0, 0);\n\n  /** The colour of the background of the bubble. */\n  private colour = '#ffffff';\n\n  /** True if the bubble has been disposed, false otherwise. */\n  public disposed = false;\n\n  /** The position of the top of the bubble relative to its anchor. */\n  private relativeTop = 0;\n\n  /** The position of the left of the bubble realtive to its anchor. */\n  private relativeLeft = 0;\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    protected readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    this.svgRoot = dom.createSvgElement(Svg.G, {}, workspace.getBubbleCanvas());\n    const embossGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'filter': `url(#${\n          this.workspace.getRenderer().getConstants().embossFilterId\n        })`,\n      },\n      this.svgRoot,\n    );\n    this.tail = dom.createSvgElement(Svg.PATH, {}, embossGroup);\n    this.background = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyDraggable',\n        'x': 0,\n        'y': 0,\n        'rx': Bubble.BORDER_WIDTH,\n        'ry': Bubble.BORDER_WIDTH,\n      },\n      embossGroup,\n    );\n    this.contentContainer = dom.createSvgElement(Svg.G, {}, this.svgRoot);\n\n    browserEvents.conditionalBind(\n      this.background,\n      'pointerdown',\n      this,\n      this.onMouseDown,\n    );\n  }\n\n  /** Dispose of this bubble. */\n  dispose() {\n    dom.removeNode(this.svgRoot);\n    this.disposed = true;\n  }\n\n  /**\n   * Set the location the tail of this bubble points to.\n   *\n   * @param anchor The location the tail of this bubble points to.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setAnchorLocation(anchor: Coordinate, relayout = false) {\n    this.anchor = anchor;\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Sets the position of this bubble relative to its anchor. */\n  setPositionRelativeToAnchor(left: number, top: number) {\n    this.relativeLeft = left;\n    this.relativeTop = top;\n    this.positionRelativeToAnchor();\n    this.renderTail();\n  }\n\n  /** @returns the size of this bubble. */\n  protected getSize() {\n    return this.size;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  protected setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, Bubble.MIN_SIZE);\n    size.height = Math.max(size.height, Bubble.MIN_SIZE);\n    this.size = size;\n\n    this.background.setAttribute('width', `${size.width}`);\n    this.background.setAttribute('height', `${size.height}`);\n\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Returns the colour of the background and tail of this bubble. */\n  protected getColour(): string {\n    return this.colour;\n  }\n\n  /** Sets the colour of the background and tail of this bubble. */\n  public setColour(colour: string) {\n    this.colour = colour;\n    this.tail.setAttribute('fill', colour);\n    this.background.setAttribute('fill', colour);\n  }\n\n  /** Passes the pointer event off to the gesture system. */\n  private onMouseDown(e: PointerEvent) {\n    this.workspace.getGesture(e)?.handleBubbleStart(e, this);\n  }\n\n  /** Positions the bubble relative to its anchor. Does not render its tail. */\n  protected positionRelativeToAnchor() {\n    let left = this.anchor.x;\n    if (this.workspace.RTL) {\n      left -= this.relativeLeft + this.size.width;\n    } else {\n      left += this.relativeLeft;\n    }\n    const top = this.relativeTop + this.anchor.y;\n    this.moveTo(left, top);\n  }\n\n  /**\n   * Moves the bubble to the given coordinates.\n   *\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.svgRoot.setAttribute('transform', `translate(${x}, ${y})`);\n  }\n\n  /**\n   * Positions the bubble \"optimally\" so that the most of it is visible and\n   * it does not overlap the rect (if provided).\n   */\n  protected positionByRect(rect = new Rect(0, 0, 0, 0)) {\n    const viewMetrics = this.workspace.getMetricsManager().getViewMetrics(true);\n\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\n\n    const topPosition = {\n      x: optimalLeft,\n      y: (-this.size.height -\n        this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT) as number,\n    };\n    const startPosition = {x: -this.size.width - 30, y: optimalTop};\n    const endPosition = {x: rect.getWidth(), y: optimalTop};\n    const bottomPosition = {x: optimalLeft, y: rect.getHeight()};\n\n    const closerPosition =\n      rect.getWidth() < rect.getHeight() ? endPosition : bottomPosition;\n    const fartherPosition =\n      rect.getWidth() < rect.getHeight() ? bottomPosition : endPosition;\n\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\n    const fartherPositionOverlap = this.getOverlap(\n      fartherPosition,\n      viewMetrics,\n    );\n\n    // Set the position to whichever position shows the most of the bubble,\n    // with tiebreaks going in the order: top > start > close > far.\n    const mostOverlap = Math.max(\n      topPositionOverlap,\n      startPositionOverlap,\n      closerPositionOverlap,\n      fartherPositionOverlap,\n    );\n    if (topPositionOverlap === mostOverlap) {\n      this.relativeLeft = topPosition.x;\n      this.relativeTop = topPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (startPositionOverlap === mostOverlap) {\n      this.relativeLeft = startPosition.x;\n      this.relativeTop = startPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (closerPositionOverlap === mostOverlap) {\n      this.relativeLeft = closerPosition.x;\n      this.relativeTop = closerPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\n    //  and then the math should be fixed to reflect this. (hopefully it'll\n    //  make it look simpler)\n    this.relativeLeft = fartherPosition.x;\n    this.relativeTop = fartherPosition.y;\n    this.positionRelativeToAnchor();\n  }\n\n  /**\n   * Calculate the what percentage of the bubble overlaps with the visible\n   * workspace (what percentage of the bubble is visible).\n   *\n   * @param relativeMin The position of the top-left corner of the bubble\n   *     relative to the anchor point.\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The percentage of the bubble that is visible.\n   */\n  private getOverlap(\n    relativeMin: {x: number; y: number},\n    viewMetrics: ContainerRegion,\n  ): number {\n    // The position of the top-left corner of the bubble in workspace units.\n    const bubbleMin = {\n      x: this.workspace.RTL\n        ? this.anchor.x - relativeMin.x - this.size.width\n        : relativeMin.x + this.anchor.x,\n      y: relativeMin.y + this.anchor.y,\n    };\n    // The position of the bottom-right corner of the bubble in workspace units.\n    const bubbleMax = {\n      x: bubbleMin.x + this.size.width,\n      y: bubbleMin.y + this.size.height,\n    };\n\n    // We could adjust these values to account for the scrollbars, but the\n    // bubbles should have been adjusted to not collide with them anyway, so\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\n    // the calculation.\n\n    // The position of the top-left corner of the workspace.\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\n    // The position of the bottom-right corner of the workspace.\n    const workspaceMax = {\n      x: viewMetrics.left + viewMetrics.width,\n      y: viewMetrics.top + viewMetrics.height,\n    };\n\n    const overlapWidth =\n      Math.min(bubbleMax.x, workspaceMax.x) -\n      Math.max(bubbleMin.x, workspaceMin.x);\n    const overlapHeight =\n      Math.min(bubbleMax.y, workspaceMax.y) -\n      Math.max(bubbleMin.y, workspaceMin.y);\n    return Math.max(\n      0,\n      Math.min(\n        1,\n        (overlapWidth * overlapHeight) / (this.size.width * this.size.height),\n      ),\n    );\n  }\n\n  /**\n   * Calculate what the optimal horizontal position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal horizontal position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit to the left of the anchor.\n    let relativeLeft = -this.size.width / 4;\n\n    // No amount of sliding left or right will give us better overlap.\n    if (this.size.width > viewMetrics.width) return relativeLeft;\n\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (this.workspace.RTL) {\n      // Bubble coordinates are flipped in RTL.\n      const bubbleRight = this.anchor.x - relativeLeft;\n      const bubbleLeft = bubbleRight - this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = -(workspaceRect.left - this.anchor.x + this.size.width);\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = -(workspaceRect.right - this.anchor.x);\n      }\n    } else {\n      const bubbleLeft = relativeLeft + this.anchor.x;\n      const bubbleRight = bubbleLeft + this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = workspaceRect.left - this.anchor.x;\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = workspaceRect.right - this.anchor.x - this.size.width;\n      }\n    }\n\n    return relativeLeft;\n  }\n\n  /**\n   * Calculate what the optimal vertical position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal vertical position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit higher than the anchor.\n    let relativeTop = -this.size.height / 4;\n\n    // No amount of sliding up or down will give us better overlap.\n    if (this.size.height > viewMetrics.height) return relativeTop;\n\n    const top = this.anchor.y + relativeTop;\n    const bottom = top + this.size.height;\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (top < workspaceRect.top) {\n      // Slide the bubble down until it is onscreen.\n      relativeTop = workspaceRect.top - this.anchor.y;\n    } else if (bottom > workspaceRect.bottom) {\n      // Slide the bubble up until it is onscreen.\n      relativeTop = workspaceRect.bottom - this.anchor.y - this.size.height;\n    }\n\n    return relativeTop;\n  }\n\n  /**\n   * @returns a rect defining the bounds of the workspace's view in workspace\n   * coordinates.\n   */\n  private getWorkspaceViewRect(viewMetrics: ContainerRegion): Rect {\n    const top = viewMetrics.top;\n    let bottom = viewMetrics.top + viewMetrics.height;\n    let left = viewMetrics.left;\n    let right = viewMetrics.left + viewMetrics.width;\n\n    bottom -= this.getScrollbarThickness();\n    if (this.workspace.RTL) {\n      left -= this.getScrollbarThickness();\n    } else {\n      right -= this.getScrollbarThickness();\n    }\n\n    return new Rect(top, bottom, left, right);\n  }\n\n  /** @returns the scrollbar thickness in workspace units. */\n  private getScrollbarThickness() {\n    return Scrollbar.scrollbarThickness / this.workspace.scale;\n  }\n\n  /** Draws the tail of the bubble. */\n  private renderTail() {\n    const steps = [];\n    // Find the relative coordinates of the center of the bubble.\n    const relBubbleX = this.size.width / 2;\n    const relBubbleY = this.size.height / 2;\n    // Find the relative coordinates of the center of the anchor.\n    let relAnchorX = -this.relativeLeft;\n    let relAnchorY = -this.relativeTop;\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\n      // Null case.  Bubble is directly on top of the anchor.\n      // Short circuit this rather than wade through divide by zeros.\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\n    } else {\n      // Compute the angle of the tail's line.\n      const rise = relAnchorY - relBubbleY;\n      let run = relAnchorX - relBubbleX;\n      if (this.workspace.RTL) {\n        run *= -1;\n      }\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\n      let angle = Math.acos(run / hypotenuse);\n      if (rise < 0) {\n        angle = 2 * Math.PI - angle;\n      }\n      // Compute a line perpendicular to the tail.\n      let rightAngle = angle + Math.PI / 2;\n      if (rightAngle > Math.PI * 2) {\n        rightAngle -= Math.PI * 2;\n      }\n      const rightRise = Math.sin(rightAngle);\n      const rightRun = Math.cos(rightAngle);\n\n      // Calculate the thickness of the base of the tail.\n      let thickness =\n        (this.size.width + this.size.height) / Bubble.TAIL_THICKNESS;\n      thickness = Math.min(thickness, this.size.width, this.size.height) / 4;\n\n      // Back the tip of the tail off of the anchor.\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\n      relAnchorX = relBubbleX + backoffRatio * run;\n      relAnchorY = relBubbleY + backoffRatio * rise;\n\n      // Coordinates for the base of the tail.\n      const baseX1 = relBubbleX + thickness * rightRun;\n      const baseY1 = relBubbleY + thickness * rightRise;\n      const baseX2 = relBubbleX - thickness * rightRun;\n      const baseY2 = relBubbleY - thickness * rightRise;\n\n      // Distortion to curve the tail.\n      const radians = math.toRadians(\n        this.workspace.RTL ? -Bubble.TAIL_ANGLE : Bubble.TAIL_ANGLE,\n      );\n      let swirlAngle = angle + radians;\n      if (swirlAngle > Math.PI * 2) {\n        swirlAngle -= Math.PI * 2;\n      }\n      const swirlRise = (Math.sin(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n      const swirlRun = (Math.cos(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n\n      steps.push('M' + baseX1 + ',' + baseY1);\n      steps.push(\n        'C' +\n          (baseX1 + swirlRun) +\n          ',' +\n          (baseY1 + swirlRise) +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY,\n      );\n      steps.push(\n        'C' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          (baseX2 + swirlRun) +\n          ',' +\n          (baseY2 + swirlRise) +\n          ' ' +\n          baseX2 +\n          ',' +\n          baseY2,\n      );\n    }\n    steps.push('z');\n    this.tail?.setAttribute('d', steps.join(' '));\n  }\n  /**\n   * Move this bubble to the front of the visible workspace.\n   *\n   * @returns Whether or not the bubble has been moved.\n   * @internal\n   */\n  bringToFront(): boolean {\n    const svgGroup = this.svgRoot?.parentNode;\n    if (this.svgRoot && svgGroup?.lastChild !== this.svgRoot) {\n      svgGroup?.appendChild(this.svgRoot);\n      return true;\n    }\n    return false;\n  }\n\n  /** @internal */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(\n      this.workspace.RTL\n        ? -this.relativeLeft + this.anchor.x - this.size.width\n        : this.anchor.x + this.relativeLeft,\n      this.anchor.y + this.relativeTop,\n    );\n  }\n\n  /** @internal */\n  getSvgRoot(): SVGElement {\n    return this.svgRoot;\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.moveTo(newLoc.x, newLoc.y);\n    if (this.workspace.RTL) {\n      this.relativeLeft = this.anchor.x - newLoc.x - this.size.width;\n    } else {\n      this.relativeLeft = newLoc.x - this.anchor.x;\n    }\n    this.relativeTop = newLoc.y - this.anchor.y;\n    this.renderTail();\n  }\n\n  setDragging(_start: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  setDeleteStyle(_enable: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  isDeletable(): boolean {\n    return false;\n  }\n\n  /** @internal */\n  showContextMenu(_e: Event) {\n    // NOOP in base class.\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Abstract as AbstractEvent} from '../events/events_abstract.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Options} from '../options.js';\nimport {Svg} from '../utils/svg.js';\nimport type {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * A bubble that contains a mini-workspace which can hold arbitrary blocks.\n * Used by the mutator icon.\n */\nexport class MiniWorkspaceBubble extends Bubble {\n  /**\n   * The minimum amount of change to the mini workspace view to trigger\n   * resizing the bubble.\n   */\n  private static readonly MINIMUM_VIEW_CHANGE = 10;\n\n  /**\n   * An arbitrary margin of whitespace to put around the blocks in the\n   * workspace.\n   */\n  private static readonly MARGIN = Bubble.DOUBLE_BORDER * 3;\n\n  /** The root svg element containing the workspace. */\n  private svgDialog: SVGElement;\n\n  /** The workspace that gets shown within this bubble. */\n  private miniWorkspace: WorkspaceSvg;\n\n  /**\n   * Should this bubble automatically reposition itself when it resizes?\n   * Becomes false after this bubble is first dragged.\n   */\n  private autoLayout = true;\n\n  /** @internal */\n  constructor(\n    workspaceOptions: BlocklyOptions,\n    protected readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    const options = new Options(workspaceOptions);\n    this.validateWorkspaceOptions(options);\n\n    this.svgDialog = dom.createSvgElement(\n      Svg.SVG,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      this.contentContainer,\n    );\n    workspaceOptions.parentWorkspace = this.workspace;\n    this.miniWorkspace = this.newWorkspaceSvg(new Options(workspaceOptions));\n    // TODO (#7422): Change this to `internalIsMiniWorkspace` or something. Not\n    //   all mini workspaces are necessarily mutators.\n    this.miniWorkspace.internalIsMutator = true;\n    const background = this.miniWorkspace.createDom('blocklyMutatorBackground');\n    this.svgDialog.appendChild(background);\n    if (options.languageTree) {\n      background.insertBefore(\n        this.miniWorkspace.addFlyout(Svg.G),\n        this.miniWorkspace.getCanvas(),\n      );\n      const flyout = this.miniWorkspace.getFlyout();\n      flyout?.init(this.miniWorkspace);\n      flyout?.show(options.languageTree);\n    }\n\n    this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.miniWorkspace\n      .getFlyout()\n      ?.getWorkspace()\n      ?.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.updateBubbleSize();\n  }\n\n  dispose() {\n    this.miniWorkspace.dispose();\n    super.dispose();\n  }\n\n  /** @internal */\n  getWorkspace(): WorkspaceSvg {\n    return this.miniWorkspace;\n  }\n\n  /** Adds a change listener to the mini workspace. */\n  addWorkspaceChangeListener(listener: (e: AbstractEvent) => void) {\n    this.miniWorkspace.addChangeListener(listener);\n  }\n\n  /**\n   * Validates the workspace options to make sure folks aren't trying to\n   * enable things the miniworkspace doesn't support.\n   */\n  private validateWorkspaceOptions(options: Options) {\n    if (options.hasCategories) {\n      throw new Error(\n        'The miniworkspace bubble does not support toolboxes with categories',\n      );\n    }\n    if (options.hasTrashcan) {\n      throw new Error('The miniworkspace bubble does not support trashcans');\n    }\n    if (\n      options.zoomOptions.controls ||\n      options.zoomOptions.wheel ||\n      options.zoomOptions.pinch\n    ) {\n      throw new Error('The miniworkspace bubble does not support zooming');\n    }\n    if (\n      options.moveOptions.scrollbars ||\n      options.moveOptions.wheel ||\n      options.moveOptions.drag\n    ) {\n      throw new Error(\n        'The miniworkspace bubble does not scrolling/moving the workspace',\n      );\n    }\n    if (options.horizontalLayout) {\n      throw new Error(\n        'The miniworkspace bubble does not support horizontal layouts',\n      );\n    }\n  }\n\n  private onWorkspaceChange() {\n    this.bumpBlocksIntoBounds();\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Bumps blocks that are above the top or outside the start-side of the\n   * workspace back within the workspace.\n   *\n   * Blocks that are below the bottom or outside the end-side of the workspace\n   * are dealt with by resizing the workspace to show them.\n   */\n  private bumpBlocksIntoBounds() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const MARGIN = 20;\n\n    for (const block of this.miniWorkspace.getTopBlocks(false)) {\n      const blockXY = block.getRelativeToSurfaceXY();\n\n      // Bump any block that's above the top back inside.\n      if (blockXY.y < MARGIN) {\n        block.moveBy(0, MARGIN - blockXY.y);\n      }\n      // Bump any block overlapping the flyout back inside.\n      if (block.RTL) {\n        let right = -MARGIN;\n        const flyout = this.miniWorkspace.getFlyout();\n        if (flyout) {\n          right -= flyout.getWidth();\n        }\n        if (blockXY.x > right) {\n          block.moveBy(right - blockXY.x, 0);\n        }\n      } else if (blockXY.x < MARGIN) {\n        block.moveBy(MARGIN - blockXY.x, 0);\n      }\n    }\n  }\n\n  /**\n   * Updates the size of this bubble to account for the size of the\n   * mini workspace.\n   */\n  private updateBubbleSize() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const currSize = this.getSize();\n    const newSize = this.calculateWorkspaceSize();\n    if (\n      Math.abs(currSize.width - newSize.width) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE &&\n      Math.abs(currSize.height - newSize.height) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE\n    ) {\n      // Only resize if the size has noticeably changed.\n      return;\n    }\n    this.svgDialog.setAttribute('width', `${newSize.width}px`);\n    this.svgDialog.setAttribute('height', `${newSize.height}px`);\n    this.miniWorkspace.setCachedParentSvgSize(newSize.width, newSize.height);\n    if (this.miniWorkspace.RTL) {\n      // Scroll the workspace to always left-align.\n      this.miniWorkspace\n        .getCanvas()\n        .setAttribute('transform', `translate(${newSize.width}, 0)`);\n    }\n    this.setSize(\n      new Size(\n        newSize.width + Bubble.DOUBLE_BORDER,\n        newSize.height + Bubble.DOUBLE_BORDER,\n      ),\n      this.autoLayout,\n    );\n    this.miniWorkspace.resize();\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /**\n   * Calculates the size of the mini workspace for use in resizing the bubble.\n   */\n  private calculateWorkspaceSize(): Size {\n    const workspaceSize = this.miniWorkspace.getCanvas().getBBox();\n    let width = workspaceSize.width + MiniWorkspaceBubble.MARGIN;\n    let height = workspaceSize.height + MiniWorkspaceBubble.MARGIN;\n\n    const flyout = this.miniWorkspace.getFlyout();\n    if (flyout) {\n      const flyoutScrollMetrics = flyout\n        .getWorkspace()\n        .getMetricsManager()\n        .getScrollMetrics();\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\n      width += flyout.getWidth();\n    }\n    return new Size(width, height);\n  }\n\n  /** Reapplies styles to all of the blocks in the mini workspace. */\n  updateBlockStyles() {\n    for (const block of this.miniWorkspace.getAllBlocks(false)) {\n      block.setStyle(block.getStyleName());\n    }\n\n    const flyoutWs = this.miniWorkspace.getFlyout()?.getWorkspace();\n    if (flyoutWs) {\n      for (const block of flyoutWs.getAllBlocks(false)) {\n        block.setStyle(block.getStyleName());\n      }\n    }\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate): void {\n    super.moveDuringDrag(newLoc);\n    this.autoLayout = false;\n  }\n\n  /** @internal */\n  moveTo(x: number, y: number): void {\n    super.moveTo(x, y);\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /** @internal */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\n    throw new Error(\n      'The implementation of newWorkspaceSvg should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Mutator\n\nimport type {Abstract} from '../events/events_abstract.js';\nimport type {Block} from '../block.js';\nimport {BlockChange} from '../events/events_block_change.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport {Icon} from './icon.js';\nimport {MiniWorkspaceBubble} from '../bubbles/mini_workspace_bubble.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport {IconType} from './icon_types.js';\n\n/** The size of the mutator icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * The distance between the root block in the mini workspace and that\n * workspace's edges.\n */\nconst WORKSPACE_MARGIN = 16;\n\n/**\n * An icon that allows the user to change the shape of the block.\n *\n * For example, it could be used to add additional fields or inputs to\n * the block.\n */\nexport class MutatorIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.MUTATOR;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 1;\n\n  /** The bubble used to show the mini workspace to the user. */\n  private miniWorkspaceBubble: MiniWorkspaceBubble | null = null;\n\n  /** The root block in the mini workspace. */\n  private rootBlock: BlockSvg | null = null;\n\n  /** The PID tracking updating the workkspace in response to user events. */\n  private updateWorkspacePid: ReturnType<typeof setTimeout> | null = null;\n\n  /**\n   * The change listener in the main workspace that triggers the saveConnections\n   * method when anything in the main workspace changes.\n   *\n   * Only actually registered to listen for events while the mutator bubble is\n   * open.\n   */\n  private saveConnectionsListener: (() => void) | null = null;\n\n  constructor(\n    private readonly flyoutBlockTypes: string[],\n    protected readonly sourceBlock: BlockSvg,\n  ) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<MutatorIcon> {\n    return MutatorIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Square with rounded corners.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconShape',\n        'rx': '4',\n        'ry': '4',\n        'height': '16',\n        'width': '16',\n      },\n      this.svgRoot,\n    );\n    // Gear teeth.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\n          '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\n          '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\n          '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\n          '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\n          '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\n          '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\n      },\n      this.svgRoot,\n    );\n    // Axle hole.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-mutator');\n  }\n\n  override dispose(): void {\n    super.dispose();\n    this.miniWorkspaceBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return MutatorIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.miniWorkspaceBubble?.setColour(this.sourceBlock.style.colourPrimary);\n    this.miniWorkspaceBubble?.updateBlockStyles();\n  }\n\n  override updateCollapsed(): void {\n    super.updateCollapsed();\n    if (this.sourceBlock.isCollapsed()) this.setBubbleVisible(false);\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.miniWorkspaceBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  override onClick(): void {\n    super.onClick();\n    if (this.sourceBlock.isEditable()) {\n      this.setBubbleVisible(!this.bubbleIsVisible());\n    }\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.miniWorkspaceBubble;\n  }\n\n  setBubbleVisible(visible: boolean): void {\n    if (this.bubbleIsVisible() === visible) return;\n\n    if (visible) {\n      this.miniWorkspaceBubble = new MiniWorkspaceBubble(\n        this.getMiniWorkspaceConfig(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n      this.createRootBlock();\n      this.addSaveConnectionsListener();\n      this.miniWorkspaceBubble?.addWorkspaceChangeListener(\n        this.createMiniWorkspaceChangeListener(),\n      );\n    } else {\n      this.miniWorkspaceBubble?.dispose();\n      this.miniWorkspaceBubble = null;\n      if (this.saveConnectionsListener) {\n        this.sourceBlock.workspace.removeChangeListener(\n          this.saveConnectionsListener,\n        );\n      }\n      this.saveConnectionsListener = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'mutator',\n      ),\n    );\n  }\n\n  /** @returns the configuration the mini workspace should have. */\n  private getMiniWorkspaceConfig() {\n    const options: BlocklyOptions = {\n      'disable': false,\n      'media': this.sourceBlock.workspace.options.pathToMedia,\n      'rtl': this.sourceBlock.RTL,\n      'renderer': this.sourceBlock.workspace.options.renderer,\n      'rendererOverrides':\n        this.sourceBlock.workspace.options.rendererOverrides ?? undefined,\n    };\n\n    if (this.flyoutBlockTypes.length) {\n      options.toolbox = {\n        'kind': 'flyoutToolbox',\n        'contents': this.flyoutBlockTypes.map((type) => ({\n          'kind': 'block',\n          'type': type,\n        })),\n      };\n    }\n\n    return options;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n\n  /** Decomposes the source block to create blocks in the mini workspace. */\n  private createRootBlock() {\n    if (!this.sourceBlock.decompose) {\n      throw new Error(\n        'Blocks with mutator icons must include a decompose method',\n      );\n    }\n    this.rootBlock = this.sourceBlock.decompose(\n      this.miniWorkspaceBubble!.getWorkspace(),\n    )!;\n\n    for (const child of this.rootBlock.getDescendants(false)) {\n      child.queueRender();\n    }\n\n    this.rootBlock.setMovable(false);\n    this.rootBlock.setDeletable(false);\n\n    const flyoutWidth =\n      this.miniWorkspaceBubble?.getWorkspace()?.getFlyout()?.getWidth() ?? 0;\n    this.rootBlock.moveBy(\n      this.rootBlock.RTL ? -(flyoutWidth + WORKSPACE_MARGIN) : WORKSPACE_MARGIN,\n      WORKSPACE_MARGIN,\n    );\n  }\n\n  /** Adds a listen to the source block that triggers saving connections. */\n  private addSaveConnectionsListener() {\n    if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n    this.saveConnectionsListener = () => {\n      if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n      this.sourceBlock.saveConnections(this.rootBlock);\n    };\n    this.saveConnectionsListener();\n    this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener);\n  }\n\n  /**\n   * Creates a change listener to add to the mini workspace which recomposes\n   * the block.\n   */\n  private createMiniWorkspaceChangeListener() {\n    return (e: Abstract) => {\n      if (!MutatorIcon.isIgnorableMutatorEvent(e) && !this.updateWorkspacePid) {\n        this.updateWorkspacePid = setTimeout(() => {\n          this.updateWorkspacePid = null;\n          this.recomposeSourceBlock();\n        }, 0);\n      }\n    };\n  }\n\n  /**\n   * Returns true if the given event is not one the mutator needs to\n   * care about.\n   *\n   * @internal\n   */\n  static isIgnorableMutatorEvent(e: Abstract) {\n    return (\n      e.isUiEvent ||\n      e.type === eventUtils.CREATE ||\n      (e.type === eventUtils.CHANGE &&\n        (e as BlockChange).element === 'disabled')\n    );\n  }\n\n  /** Recomposes the source block based on changes to the mini workspace. */\n  private recomposeSourceBlock() {\n    if (!this.rootBlock) return;\n    if (!this.sourceBlock.compose) {\n      throw new Error(\n        'Blocks with mutator icons must include a compose method',\n      );\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) eventUtils.setGroup(true);\n\n    const oldExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n    this.sourceBlock.compose(this.rootBlock);\n    const newExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n\n    if (oldExtraState !== newExtraState) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this.sourceBlock,\n          'mutation',\n          null,\n          oldExtraState,\n          newExtraState,\n        ),\n      );\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * @returns The workspace of the mini workspace bubble, if the bubble is\n   *     currently open.\n   */\n  getWorkspace(): WorkspaceSvg | undefined {\n    return this.miniWorkspaceBubble?.getWorkspace();\n  }\n\n  /**\n   * Reconnects the given connection to the mutated input on the given block.\n   *\n   * @deprecated Use connection.reconnect instead. To be removed in v11.\n   */\n  static reconnect(\n    connectionChild: Connection | null,\n    block: Block,\n    inputName: string,\n  ): boolean {\n    deprecation.warn(\n      'MutatorIcon.reconnect',\n      'v10',\n      'v11',\n      'connection.reconnect',\n    );\n    if (!connectionChild) return false;\n    return connectionChild.reconnect(block, inputName);\n  }\n\n  /**\n   * Returns the parent workspace of a workspace that is inside a mini workspace\n   * bubble, taking into account whether the workspace is a flyout.\n   *\n   * @deprecated Use workspace.getRootWorkspace. To be removed in v11.\n   */\n  static findParentWs(workspace: WorkspaceSvg): WorkspaceSvg | null {\n    deprecation.warn(\n      'MutatorIcon.findParentWs',\n      'v10',\n      'v11',\n      'workspace.getRootWorkspace',\n    );\n    return workspace.getRootWorkspace();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.KeyCodes\n\n/* eslint-disable @typescript-eslint/no-duplicate-enum-values */\n\n/**\n * Key codes for common characters.\n *\n * Copied from Closure's goog.events.KeyCodes\n *\n * This list is not localized and therefore some of the key codes are not\n * correct for non US keyboard layouts. See comments below.\n */\nexport enum KeyCodes {\n  WIN_KEY_FF_LINUX = 0,\n  MAC_ENTER = 3,\n  BACKSPACE = 8,\n  TAB = 9,\n  NUM_CENTER = 12, // NUMLOCK on FF/Safari Mac\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESC = 27,\n  SPACE = 32,\n  PAGE_UP = 33, // also NUM_NORTH_EAST\n  PAGE_DOWN = 34, // also NUM_SOUTH_EAST\n  END = 35, // also NUM_SOUTH_WEST\n  HOME = 36, // also NUM_NORTH_WEST\n  LEFT = 37, // also NUM_WEST\n  UP = 38, // also NUM_NORTH\n  RIGHT = 39, // also NUM_EAST\n  DOWN = 40, // also NUM_SOUTH\n  PLUS_SIGN = 43, // NOT numpad plus\n  PRINT_SCREEN = 44,\n  INSERT = 45, // also NUM_INSERT\n  DELETE = 46, // also NUM_DELETE\n  ZERO = 48,\n  ONE = 49,\n  TWO = 50,\n  THREE = 51,\n  FOUR = 52,\n  FIVE = 53,\n  SIX = 54,\n  SEVEN = 55,\n  EIGHT = 56,\n  NINE = 57,\n  FF_SEMICOLON = 59, // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS = 61, // Firefox (Gecko) fires this for equals instead of 187\n  FF_DASH = 173, // Firefox (Gecko) fires this for dash instead of 189\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\n  // Shift+SINGLE_QUOTE.\n  FF_HASH = 163,\n  QUESTION_MARK = 63, // needs localization\n  AT_SIGN = 64,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  META = 91, // WIN_KEY_LEFT\n  WIN_KEY_RIGHT = 92,\n  CONTEXT_MENU = 93,\n  NUM_ZERO = 96,\n  NUM_ONE = 97,\n  NUM_TWO = 98,\n  NUM_THREE = 99,\n  NUM_FOUR = 100,\n  NUM_FIVE = 101,\n  NUM_SIX = 102,\n  NUM_SEVEN = 103,\n  NUM_EIGHT = 104,\n  NUM_NINE = 105,\n  NUM_MULTIPLY = 106,\n  NUM_PLUS = 107,\n  NUM_MINUS = 109,\n  NUM_PERIOD = 110,\n  NUM_DIVISION = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUMLOCK = 144,\n  SCROLL_LOCK = 145,\n\n  // OS-specific media keys like volume controls and browser controls.\n  FIRST_MEDIA_KEY = 166,\n  LAST_MEDIA_KEY = 183,\n\n  SEMICOLON = 186, // needs localization\n  DASH = 189, // needs localization\n  EQUALS = 187, // needs localization\n  COMMA = 188, // needs localization\n  PERIOD = 190, // needs localization\n  SLASH = 191, // needs localization\n  APOSTROPHE = 192, // needs localization\n  TILDE = 192, // needs localization\n  SINGLE_QUOTE = 222, // needs localization\n  OPEN_SQUARE_BRACKET = 219, // needs localization\n  BACKSLASH = 220, // needs localization\n  CLOSE_SQUARE_BRACKET = 221, // needs localization\n  WIN_KEY = 224,\n  MAC_FF_META = 224, // Firefox (Gecko) fires this for the meta key instead of 91\n  MAC_WK_CMD_LEFT = 91, // WebKit Left Command key fired, same as META\n  MAC_WK_CMD_RIGHT = 93, // WebKit Right Command key fired, different from META\n  WIN_IME = 229,\n\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\n  // control) fire this as a hacky way to disable screensavers.\n  VK_NONAME = 252,\n\n  // We've seen users whose machines fire this keycode at regular one\n  // second intervals. The common thread among these users is that\n  // they're all using Dell Inspiron laptops, so we suspect that this\n  // indicates a hardware/bios problem.\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\n  PHANTOM = 255,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils\n\nimport * as browserEvents from './browser_events.js';\nimport * as extensions from './extensions.js';\nimport * as aria from './utils/aria.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as colour from './utils/colour.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as object from './utils/object.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as stringUtils from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as xml from './utils/xml.js';\n\nexport {\n  aria,\n  arrayUtils as array,\n  browserEvents,\n  colour,\n  Coordinate,\n  deprecation,\n  dom,\n  extensions,\n  idGenerator,\n  KeyCodes,\n  math,\n  Metrics,\n  object,\n  parsing,\n  Rect,\n  Size,\n  stringUtils as string,\n  style,\n  Svg,\n  svgMath,\n  svgPaths,\n  toolbox,\n  userAgent,\n  xml,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * A bubble that displays non-editable text. Used by the warning icon.\n */\nexport class TextBubble extends Bubble {\n  private paragraph: SVGTextElement;\n\n  constructor(\n    private text: string,\n    protected readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /** @returns the current text of this text bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the current text of this text bubble, and updates the display. */\n  setText(text: string) {\n    this.text = text;\n    dom.removeNode(this.paragraph);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Converts the given string into an svg containing that string,\n   * broken up by newlines.\n   */\n  private stringToSvg(text: string, container: SVGGElement) {\n    const paragraph = this.createParagraph(container);\n    const spans = this.createSpans(paragraph, text);\n    if (this.workspace.RTL)\n      this.rightAlignSpans(paragraph.getBBox().width, spans);\n    return paragraph;\n  }\n\n  /** Creates the paragraph container for this bubble's view's spans. */\n  private createParagraph(container: SVGGElement): SVGTextElement {\n    return dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n        'y': Bubble.BORDER_WIDTH,\n      },\n      container,\n    );\n  }\n\n  /** Creates the spans visualizing the text of this bubble. */\n  private createSpans(parent: SVGTextElement, text: string): SVGTSpanElement[] {\n    return text.split('\\n').map((line) => {\n      const tspan = dom.createSvgElement(\n        Svg.TSPAN,\n        {'dy': '1em', 'x': Bubble.BORDER_WIDTH},\n        parent,\n      );\n      const textNode = document.createTextNode(line);\n      tspan.appendChild(textNode);\n      return tspan;\n    });\n  }\n\n  /** Right aligns the given spans. */\n  private rightAlignSpans(maxWidth: number, spans: SVGTSpanElement[]) {\n    for (const span of spans) {\n      span.setAttribute('text-anchor', 'end');\n      span.setAttribute('x', `${maxWidth + Bubble.BORDER_WIDTH}`);\n    }\n  }\n\n  /** Updates the size of this bubble to account for the size of the text. */\n  private updateBubbleSize() {\n    const bbox = this.paragraph.getBBox();\n    this.setSize(\n      new Size(\n        bbox.width + Bubble.BORDER_WIDTH * 2,\n        bbox.height + Bubble.BORDER_WIDTH * 2,\n      ),\n      true,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubble.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as Css from '../css.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport * as touch from '../touch.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {browserEvents} from '../utils.js';\n\n/**\n * A bubble that displays editable text. It can also be resized by the user.\n * Used by the comment icon.\n */\nexport class TextInputBubble extends Bubble {\n  /** The root of the elements specific to the text element. */\n  private inputRoot: SVGForeignObjectElement;\n\n  /** The text input area element. */\n  private textArea: HTMLTextAreaElement;\n\n  /** The group containing the lines indicating the bubble is resizable. */\n  private resizeGroup: SVGGElement;\n\n  /**\n   * Event data associated with the listener for pointer up events on the\n   * resize group.\n   */\n  private resizePointerUpListener: browserEvents.Data | null = null;\n\n  /**\n   * Event data associated with the listener for pointer move events on the\n   * resize group.\n   */\n  private resizePointerMoveListener: browserEvents.Data | null = null;\n\n  /** Functions listening for changes to the text of this bubble. */\n  private textChangeListeners: (() => void)[] = [];\n\n  /** Functions listening for changes to the size of this bubble. */\n  private sizeChangeListeners: (() => void)[] = [];\n\n  /** The text of this bubble. */\n  private text = '';\n\n  /** The default size of this bubble, including borders. */\n  private readonly DEFAULT_SIZE = new Size(\n    160 + Bubble.DOUBLE_BORDER,\n    80 + Bubble.DOUBLE_BORDER,\n  );\n\n  /** The minimum size of this bubble, including borders. */\n  private readonly MIN_SIZE = new Size(\n    45 + Bubble.DOUBLE_BORDER,\n    20 + Bubble.DOUBLE_BORDER,\n  );\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    protected readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    ({inputRoot: this.inputRoot, textArea: this.textArea} = this.createEditor(\n      this.contentContainer,\n    ));\n    this.resizeGroup = this.createResizeHandle(this.svgRoot);\n    this.setSize(this.DEFAULT_SIZE, true);\n  }\n\n  /** @returns the text of this bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the text of this bubble. Calls change listeners. */\n  setText(text: string) {\n    this.text = text;\n    this.textArea.value = text;\n    this.onTextChange();\n  }\n\n  /** Adds a change listener to be notified when this bubble's text changes. */\n  addTextChangeListener(listener: () => void) {\n    this.textChangeListeners.push(listener);\n  }\n\n  /** Adds a change listener to be notified when this bubble's size changes. */\n  addSizeChangeListener(listener: () => void) {\n    this.sizeChangeListeners.push(listener);\n  }\n\n  /** Creates the editor UI for this bubble. */\n  private createEditor(container: SVGGElement): {\n    inputRoot: SVGForeignObjectElement;\n    textArea: HTMLTextAreaElement;\n  } {\n    const inputRoot = dom.createSvgElement(\n      Svg.FOREIGNOBJECT,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      container,\n    );\n\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n\n    const textArea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    textArea.className = 'blocklyCommentTextarea';\n    textArea.setAttribute('dir', this.workspace.RTL ? 'RTL' : 'LTR');\n\n    body.appendChild(textArea);\n    inputRoot.appendChild(body);\n\n    this.bindTextAreaEvents(textArea);\n    setTimeout(() => {\n      textArea.focus();\n    }, 0);\n\n    return {inputRoot, textArea};\n  }\n\n  /** Binds events to the text area element. */\n  private bindTextAreaEvents(textArea: HTMLTextAreaElement) {\n    // Don't zoom with mousewheel.\n    browserEvents.conditionalBind(textArea, 'wheel', this, (e: Event) => {\n      e.stopPropagation();\n    });\n\n    browserEvents.conditionalBind(\n      textArea,\n      'focus',\n      this,\n      this.onStartEdit,\n      true,\n    );\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\n  }\n\n  /** Creates the resize handler elements and binds events to them. */\n  private createResizeHandle(container: SVGGElement): SVGGElement {\n    const resizeGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'class': this.workspace.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE',\n      },\n      container,\n    );\n    const size = 2 * Bubble.BORDER_WIDTH;\n    dom.createSvgElement(\n      Svg.POLYGON,\n      {'points': `0,${size} ${size},${size} ${size},0`},\n      resizeGroup,\n    );\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'class': 'blocklyResizeLine',\n        'x1': size / 3,\n        'y1': size - 1,\n        'x2': size - 1,\n        'y2': size / 3,\n      },\n      resizeGroup,\n    );\n    dom.createSvgElement(\n      Svg.LINE,\n      {\n        'class': 'blocklyResizeLine',\n        'x1': (size * 2) / 3,\n        'y1': size - 1,\n        'x2': size - 1,\n        'y2': (size * 2) / 3,\n      },\n      resizeGroup,\n    );\n\n    browserEvents.conditionalBind(\n      resizeGroup,\n      'pointerdown',\n      this,\n      this.onResizePointerDown,\n    );\n\n    return resizeGroup;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, this.MIN_SIZE.width);\n    size.height = Math.max(size.height, this.MIN_SIZE.height);\n\n    const widthMinusBorder = size.width - Bubble.DOUBLE_BORDER;\n    const heightMinusBorder = size.height - Bubble.DOUBLE_BORDER;\n    this.inputRoot.setAttribute('width', `${widthMinusBorder}`);\n    this.inputRoot.setAttribute('height', `${heightMinusBorder}`);\n    this.textArea.style.width = `${widthMinusBorder - 4}px`;\n    this.textArea.style.height = `${heightMinusBorder - 4}px`;\n\n    if (this.workspace.RTL) {\n      this.resizeGroup.setAttribute(\n        'transform',\n        `translate(${Bubble.DOUBLE_BORDER}, ${heightMinusBorder}) scale(-1 1)`,\n      );\n    } else {\n      this.resizeGroup.setAttribute(\n        'transform',\n        `translate(${widthMinusBorder}, ${heightMinusBorder})`,\n      );\n    }\n\n    super.setSize(size, relayout);\n    this.onSizeChange();\n  }\n\n  /** @returns the size of this bubble. */\n  getSize(): Size {\n    // Overriden to be public.\n    return super.getSize();\n  }\n\n  /** Handles mouse down events on the resize target. */\n  private onResizePointerDown(e: PointerEvent) {\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.workspace.startDrag(\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\n        this.getSize().height,\n      ),\n    );\n\n    this.resizePointerUpListener = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onResizePointerUp,\n    );\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onResizePointerMove,\n    );\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Handles pointer up events on the resize target. */\n  private onResizePointerUp(_e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (this.resizePointerUpListener) {\n      browserEvents.unbind(this.resizePointerUpListener);\n      this.resizePointerUpListener = null;\n    }\n    if (this.resizePointerMoveListener) {\n      browserEvents.unbind(this.resizePointerMoveListener);\n      this.resizePointerMoveListener = null;\n    }\n  }\n\n  /** Handles pointer move events on the resize target. */\n  private onResizePointerMove(e: PointerEvent) {\n    const delta = this.workspace.moveDrag(e);\n    this.setSize(\n      new Size(this.workspace.RTL ? -delta.x : delta.x, delta.y),\n      false,\n    );\n    this.onSizeChange();\n  }\n\n  /**\n   * Handles starting an edit of the text area. Brings the bubble to the front.\n   */\n  private onStartEdit() {\n    if (this.bringToFront()) {\n      // Since the act of moving this node within the DOM causes a loss of\n      // focus, we need to reapply the focus.\n      this.textArea.focus();\n    }\n  }\n\n  /** Handles a text change event for the text area. Calls event listeners. */\n  private onTextChange() {\n    this.text = this.textArea.value;\n    for (const listener of this.textChangeListeners) {\n      listener();\n    }\n  }\n\n  /** Handles a size change event for the text area. Calls event listeners. */\n  private onSizeChange() {\n    for (const listener of this.sizeChangeListeners) {\n      listener();\n    }\n  }\n}\n\nCss.register(`\n.blocklyCommentTextarea {\n  background-color: #fef49c;\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n`);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Comment\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {IconType} from './icon_types.js';\nimport {Coordinate} from '../utils.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Icon} from './icon.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport type {ISerializable} from '../interfaces/i_serializable.js';\nimport {Rect} from '../utils/rect.js';\nimport * as registry from './registry.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {TextBubble} from '../bubbles/text_bubble.js';\nimport {TextInputBubble} from '../bubbles/textinput_bubble.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/** The size of the comment icon in workspace-scale units. */\nconst SIZE = 17;\n\n/** The default width in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_WIDTH = 160;\n\n/** The default height in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_HEIGHT = 80;\n\n/**\n * An icon which allows the user to add comment text to a block.\n */\nexport class CommentIcon extends Icon implements IHasBubble, ISerializable {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.COMMENT;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 3;\n\n  /** The bubble used to show editable text to the user. */\n  private textInputBubble: TextInputBubble | null = null;\n\n  /** The bubble used to show non-editable text to the user. */\n  private textBubble: TextBubble | null = null;\n\n  /** The text of this comment. */\n  private text = '';\n\n  /** The size of this comment (which is applied to the editable bubble). */\n  private bubbleSize = new Size(DEFAULT_BUBBLE_WIDTH, DEFAULT_BUBBLE_HEIGHT);\n\n  /**\n   * The visibility of the bubble for this comment.\n   *\n   * This is used to track what the visibile state /should/ be, not necessarily\n   * what it currently /is/. E.g. sometimes this will be true, but the block\n   * hasn't been rendered yet, so the bubble will not currently be visible.\n   */\n  private bubbleVisiblity = false;\n\n  constructor(protected readonly sourceBlock: Block) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<CommentIcon> {\n    return CommentIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Circle.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    // Can't use a real '?' text character since different browsers and\n    // operating systems render it differently. Body of question mark.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n          '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n          '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\n      },\n      this.svgRoot,\n    );\n    // Dot of question mark.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '6.8',\n        'y': '10.78',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-comment');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textInputBubble?.dispose();\n    this.textBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return CommentIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    const colour = (this.sourceBlock as BlockSvg).style.colourPrimary;\n    this.textInputBubble?.setColour(colour);\n    this.textBubble?.setColour(colour);\n  }\n\n  /**\n   * Updates the state of the bubble (editable / noneditable) to reflect the\n   * state of the bubble if the bubble is currently shown.\n   */\n  override updateEditable(): void {\n    super.updateEditable();\n    if (this.bubbleIsVisible()) {\n      // Close and reopen the bubble to display the correct UI.\n      this.setBubbleVisible(false);\n      this.setBubbleVisible(true);\n    }\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    const anchorLocation = this.getAnchorLocation();\n    this.textInputBubble?.setAnchorLocation(anchorLocation);\n    this.textBubble?.setAnchorLocation(anchorLocation);\n  }\n\n  /** Sets the text of this comment. Updates any bubbles if they are visible. */\n  setText(text: string) {\n    const oldText = this.text;\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n    this.text = text;\n    this.textInputBubble?.setText(this.text);\n    this.textBubble?.setText(this.text);\n  }\n\n  /** Returns the text of this comment. */\n  getText(): string {\n    return this.text;\n  }\n\n  /**\n   * Sets the size of the editable bubble for this comment. Resizes the\n   * bubble if it is visible.\n   */\n  setBubbleSize(size: Size) {\n    this.bubbleSize = size;\n    this.textInputBubble?.setSize(this.bubbleSize, true);\n  }\n\n  /** @returns the size of the editable bubble for this comment. */\n  getBubbleSize(): Size {\n    return this.bubbleSize;\n  }\n\n  /**\n   * @returns the state of the comment as a JSON serializable value if the\n   * comment has text. Otherwise returns null.\n   */\n  saveState(): CommentState | null {\n    if (this.text) {\n      return {\n        'text': this.text,\n        'pinned': this.bubbleIsVisible(),\n        'height': this.bubbleSize.height,\n        'width': this.bubbleSize.width,\n      };\n    }\n    return null;\n  }\n\n  /** Applies the given state to this comment. */\n  loadState(state: CommentState) {\n    this.text = state['text'] ?? '';\n    this.bubbleSize = new Size(\n      state['width'] ?? DEFAULT_BUBBLE_WIDTH,\n      state['height'] ?? DEFAULT_BUBBLE_HEIGHT,\n    );\n    this.bubbleVisiblity = state['pinned'] ?? false;\n    // Give the block a chance to be positioned and rendered before showing.\n    setTimeout(() => this.setBubbleVisible(this.bubbleVisiblity), 1);\n  }\n\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the text of this comment in response to changes in the text of\n   * the input bubble.\n   */\n  onTextChange(): void {\n    if (!this.textInputBubble) return;\n\n    const newText = this.textInputBubble.getText();\n    if (this.text === newText) return;\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        this.text,\n        newText,\n      ),\n    );\n    this.text = newText;\n  }\n\n  /**\n   * Updates the size of this icon in response to changes in the size of the\n   * input bubble.\n   */\n  onSizeChange(): void {\n    if (this.textInputBubble) {\n      this.bubbleSize = this.textInputBubble.getSize();\n    }\n  }\n\n  bubbleIsVisible(): boolean {\n    return this.bubbleVisiblity;\n  }\n\n  setBubbleVisible(visible: boolean): void {\n    if (visible && (this.textBubble || this.textInputBubble)) return;\n    if (!visible && !(this.textBubble || this.textInputBubble)) return;\n\n    this.bubbleVisiblity = visible;\n\n    if (!this.sourceBlock.rendered || this.sourceBlock.isInFlyout) return;\n\n    if (visible) {\n      if (this.sourceBlock.isEditable()) {\n        this.showEditableBubble();\n      } else {\n        this.showNonEditableBubble();\n      }\n      this.applyColour();\n    } else {\n      this.hideBubble();\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'comment',\n      ),\n    );\n  }\n\n  /**\n   * Shows the editable text bubble for this comment, and adds change listeners\n   * to update the state of this icon in response to changes in the bubble.\n   */\n  private showEditableBubble() {\n    this.textInputBubble = new TextInputBubble(\n      this.sourceBlock.workspace as WorkspaceSvg,\n      this.getAnchorLocation(),\n      this.getBubbleOwnerRect(),\n    );\n    this.textInputBubble.setText(this.getText());\n    this.textInputBubble.setSize(this.bubbleSize, true);\n    this.textInputBubble.addTextChangeListener(() => this.onTextChange());\n    this.textInputBubble.addSizeChangeListener(() => this.onSizeChange());\n  }\n\n  /** Shows the non editable text bubble for this comment. */\n  private showNonEditableBubble() {\n    this.textBubble = new TextBubble(\n      this.getText(),\n      this.sourceBlock.workspace as WorkspaceSvg,\n      this.getAnchorLocation(),\n      this.getBubbleOwnerRect(),\n    );\n  }\n\n  /** Hides any open bubbles owned by this comment. */\n  private hideBubble() {\n    this.textInputBubble?.dispose();\n    this.textInputBubble = null;\n    this.textBubble?.dispose();\n    this.textBubble = null;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = (this.sourceBlock as BlockSvg).getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n}\n\nexport interface CommentState {\n  text?: string;\n  pinned?: boolean;\n  height?: number;\n  width?: number;\n}\n\nregistry.register(CommentIcon.TYPE, CommentIcon);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Warning\n\nimport type {BlockSvg} from '../block_svg.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Icon} from './icon.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils.js';\nimport {Svg} from '../utils/svg.js';\nimport {TextBubble} from '../bubbles/text_bubble.js';\nimport {IconType} from './icon_types.js';\n\n/** The size of the warning icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * An icon that warns the user that something is wrong with their block.\n *\n * For example, this could be used to warn them about incorrect field values,\n * or incorrect placement of the block (putting it somewhere it doesn't belong).\n */\nexport class WarningIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.WARNING;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 2;\n\n  /** A map of warning IDs to warning text. */\n  private textMap: Map<string, string> = new Map();\n\n  /** The bubble used to display the warnings to the user. */\n  private textBubble: TextBubble | null = null;\n\n  /** @internal */\n  constructor(protected readonly sourceBlock: BlockSvg) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<WarningIcon> {\n    return WarningIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Triangle with rounded corners.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconShape',\n        'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\n      },\n      this.svgRoot,\n    );\n    // Can't use a real '!' text character since different browsers and\n    // operating systems render it differently. Body of exclamation point.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\n      },\n      this.svgRoot,\n    );\n    // Dot of exclamation point.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '7',\n        'y': '11',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-warning');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return WarningIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.textBubble?.setColour(this.sourceBlock.style.colourPrimary);\n  }\n\n  override updateCollapsed(): void {\n    // We are shown when collapsed, so do nothing! I.e. skip the default\n    // behavior of hiding.\n  }\n\n  /** Tells blockly that this icon is shown when the block is collapsed. */\n  override isShownWhenCollapsed(): boolean {\n    return true;\n  }\n\n  /** Updates the location of the icon's bubble if it is open. */\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.textBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  /**\n   * Adds a warning message to this warning icon.\n   *\n   * @param text The text of the message to add.\n   * @param id The id of the message to add.\n   * @internal\n   */\n  addMessage(text: string, id: string): this {\n    if (this.textMap.get(id) === text) return this;\n\n    if (text) {\n      this.textMap.set(id, text);\n    } else {\n      this.textMap.delete(id);\n    }\n\n    this.textBubble?.setText(this.getText());\n    return this;\n  }\n\n  /**\n   * @returns the display text for this icon. Includes all warning messages\n   *     concatenated together with newlines.\n   * @internal\n   */\n  getText(): string {\n    return [...this.textMap.values()].join('\\n');\n  }\n\n  /** Toggles the visibility of the bubble. */\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.textBubble;\n  }\n\n  setBubbleVisible(visible: boolean): void {\n    if (this.bubbleIsVisible() === visible) return;\n\n    if (visible) {\n      this.textBubble = new TextBubble(\n        this.getText(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n    } else {\n      this.textBubble?.dispose();\n      this.textBubble = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'warning',\n      ),\n    );\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IIcon} from '../interfaces/i_icon.js';\n\n/**\n * Thrown when you add more than one icon of the same type to a block.\n */\nexport class DuplicateIconType extends Error {\n  /**\n   * @internal\n   */\n  constructor(public icon: IIcon) {\n    super(\n      `Tried to append an icon of type ${icon.getType()} when an icon of ` +\n        `that type already exists on the block. ` +\n        `Use getIcon to access the existing icon.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Icon} from './icons/icon.js';\nimport {CommentIcon, CommentState} from './icons/comment_icon.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport {WarningIcon} from './icons/warning_icon.js';\nimport {IconType} from './icons/icon_types.js';\nimport * as exceptions from './icons/exceptions.js';\nimport * as registry from './icons/registry.js';\n\nexport {\n  Icon,\n  CommentIcon,\n  CommentState,\n  MutatorIcon,\n  WarningIcon,\n  IconType,\n  exceptions,\n  registry,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Types\n\nimport type {Measurable} from './base.js';\nimport type {Row} from './row.js';\n\n/**\n * Types of rendering elements.\n */\nclass TypesContainer {\n  [index: string]: number | Function;\n\n  NONE = 0; // None\n  FIELD = 1 << 0; // Field.\n  HAT = 1 << 1; // Hat.\n  ICON = 1 << 2; // Icon.\n  SPACER = 1 << 3; // Spacer.\n  BETWEEN_ROW_SPACER = 1 << 4; // Between Row Spacer.\n  IN_ROW_SPACER = 1 << 5; // In Row Spacer.\n  EXTERNAL_VALUE_INPUT = 1 << 6; // External Value Input.\n  INPUT = 1 << 7; // Input.\n  INLINE_INPUT = 1 << 8; // Inline Input.\n  STATEMENT_INPUT = 1 << 9; // Statement Input.\n  CONNECTION = 1 << 10; // Connection.\n  PREVIOUS_CONNECTION = 1 << 11; // Previous Connection.\n  NEXT_CONNECTION = 1 << 12; // Next Connection.\n  OUTPUT_CONNECTION = 1 << 13; // Output Connection.\n  CORNER = 1 << 14; // Corner.\n  LEFT_SQUARE_CORNER = 1 << 15; // Square Corner.\n  LEFT_ROUND_CORNER = 1 << 16; // Round Corner.\n  RIGHT_SQUARE_CORNER = 1 << 17; // Right Square Corner.\n  RIGHT_ROUND_CORNER = 1 << 18; // Right Round Corner.\n  JAGGED_EDGE = 1 << 19; // Jagged Edge.\n  ROW = 1 << 20; // Row.\n  TOP_ROW = 1 << 21; // Top Row.\n  BOTTOM_ROW = 1 << 22; // Bottom Row.\n  INPUT_ROW = 1 << 23; // Input Row.\n\n  /**\n   * A Left Corner Union Type.\n   */\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\n\n  /**\n   * A Right Corner Union Type.\n   */\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\n\n  /**\n   * Next flag value to use for custom rendering element types.\n   * This must be updated to reflect the next enum flag value\n   * to use if additional elements are added to\n   * `Types`.\n   */\n  nextTypeValue_ = 1 << 24;\n\n  /**\n   * Get the enum flag value of an existing type or register a new type.\n   *\n   * @param type The name of the type.\n   * @returns The enum flag value associated with that type.\n   */\n  getType(type: string): number {\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\n      this[type] = this.nextTypeValue_;\n      this.nextTypeValue_ <<= 1;\n    }\n    return this[type] as number;\n  }\n\n  /**\n   * Whether a measurable stores information about a field.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a field.\n   */\n  isField(elem: Measurable): number {\n    return elem.type & this.FIELD;\n  }\n\n  /**\n   * Whether a measurable stores information about a hat.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a hat.\n   */\n  isHat(elem: Measurable): number {\n    return elem.type & this.HAT;\n  }\n\n  /**\n   * Whether a measurable stores information about an icon.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an icon.\n   */\n  isIcon(elem: Measurable): number {\n    return elem.type & this.ICON;\n  }\n\n  /**\n   * Whether a measurable stores information about a spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a spacer.\n   */\n  isSpacer(elem: Measurable | Row): number {\n    return elem.type & this.SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an in-row spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an in-row spacer.\n   */\n  isInRowSpacer(elem: Measurable): number {\n    return elem.type & this.IN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an input.\n   */\n  isInput(elem: Measurable): number {\n    return elem.type & this.INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an external input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an external input.\n   */\n  isExternalInput(elem: Measurable): number {\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an inline input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an inline input.\n   */\n  isInlineInput(elem: Measurable): number {\n    return elem.type & this.INLINE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a statement input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a statement input.\n   */\n  isStatementInput(elem: Measurable): number {\n    return elem.type & this.STATEMENT_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous connection.\n   */\n  isPreviousConnection(elem: Measurable): number {\n    return elem.type & this.PREVIOUS_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a next connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a next connection.\n   */\n  isNextConnection(elem: Measurable): number {\n    return elem.type & this.NEXT_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous or next\n   * connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous or next\n   *     connection.\n   */\n  isPreviousOrNextConnection(elem: Measurable): number {\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\n  }\n\n  /**\n   * Whether a measurable stores information about a left round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left round corner.\n   */\n  isLeftRoundedCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right round corner.\n   */\n  isRightRoundedCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a left square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left square corner.\n   */\n  isLeftSquareCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right square corner.\n   */\n  isRightSquareCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a corner.\n   */\n  isCorner(elem: Measurable): number {\n    return elem.type & this.CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a jagged edge.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a jagged edge.\n   */\n  isJaggedEdge(elem: Measurable): number {\n    return elem.type & this.JAGGED_EDGE;\n  }\n\n  /**\n   * Whether a measurable stores information about a row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a row.\n   */\n  isRow(row: Row): number {\n    return row.type & this.ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a between-row spacer.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a between-row spacer.\n   */\n  isBetweenRowSpacer(row: Row): number {\n    return row.type & this.BETWEEN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about a top row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top row.\n   */\n  isTopRow(row: Row): number {\n    return row.type & this.TOP_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a bottom row.\n   */\n  isBottomRow(row: Row): number {\n    return row.type & this.BOTTOM_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a top or bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top or bottom row.\n   */\n  isTopOrBottomRow(row: Row): number {\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\n  }\n\n  /**\n   * Whether a measurable stores information about an input row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about an input row.\n   */\n  isInputRow(row: Row): number {\n    return row.type & this.INPUT_ROW;\n  }\n}\n\nexport const Types = new TypesContainer();\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Measurable\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a part of a block that takes up space during\n * rendering.  The constructor for each non-spacer Measurable records the size\n * of the block element (e.g. field, statement input).\n */\nexport class Measurable {\n  width = 0;\n\n  height = 0;\n  type: number;\n  xPos = 0;\n\n  centerline = 0;\n  notchOffset: number;\n\n  /** The renderer's constant provider. */\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    this.constants_ = constants;\n\n    this.type = Types.NONE;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Row\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {Measurable} from './base.js';\nimport type {InRowSpacer} from './in_row_spacer.js';\nimport type {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object representing a single row on a rendered block and all of its\n * subcomponents.\n */\nexport class Row {\n  type: number;\n\n  /**\n   * An array of elements contained in this row.\n   */\n  elements: Measurable[] = [];\n\n  /**\n   * The height of the row.\n   */\n  height = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the right.\n   * Does not include child blocks unless they are inline.\n   */\n  width = 0;\n\n  /**\n   * The minimum height of the row.\n   */\n  minHeight = 0;\n\n  /**\n   * The minimum width of the row, from the left edge of the block to the\n   * right. Does not include child blocks unless they are inline.\n   */\n  minWidth = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the edge of the\n   * block or any connected child blocks.\n   */\n  widthWithConnectedBlocks = 0;\n\n  /**\n   * The Y position of the row relative to the origin of the block's svg\n   * group.\n   */\n  yPos = 0;\n\n  /**\n   * The X position of the row relative to the origin of the block's svg\n   * group.\n   */\n  xPos = 0;\n\n  /**\n   * Whether the row has any external inputs.\n   */\n  hasExternalInput = false;\n\n  /**\n   * Whether the row has any statement inputs.\n   */\n  hasStatement = false;\n\n  /**\n   * Where the left edge of all of the statement inputs on the block should\n   * be. This makes sure that statement inputs which are proceded by fields\n   * of varius widths are all aligned.\n   */\n  statementEdge = 0;\n\n  /**\n   * Whether the row has any inline inputs.\n   */\n  hasInlineInput = false;\n\n  /**\n   * Whether the row has any dummy inputs or end-row inputs.\n   */\n  hasDummyInput = false;\n\n  /**\n   * Whether the row has a jagged edge.\n   */\n  hasJaggedEdge = false;\n  notchOffset: number;\n\n  /**\n   * Alignment of the row.\n   */\n  align: number | null = null;\n\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constants_ = constants;\n\n    /** The type of this rendering object. */\n    this.type = Types.ROW;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n\n  /**\n   * Get the last input on this row, if it has one.\n   *\n   * @returns The last input on the row, or null.\n   */\n  getLastInput(): InputConnection | null {\n    // TODO: Consider moving this to InputRow, if possible.\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isInput(elem)) {\n        return elem as InputConnection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  measure() {\n    throw Error('Unexpected attempt to measure a base Row.');\n  }\n\n  /**\n   * Determines whether this row should start with an element spacer.\n   *\n   * @returns Whether the row should start with a spacer.\n   */\n  startsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Determines whether this row should end with an element spacer.\n   *\n   * @returns Whether the row should end with a spacer.\n   */\n  endsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Convenience method to get the first spacer element on this row.\n   *\n   * @returns The first spacer element on this row.\n   */\n  getFirstSpacer(): InRowSpacer | null {\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Convenience method to get the last spacer element on this row.\n   *\n   * @returns The last spacer element on this row.\n   */\n  getLastSpacer(): InRowSpacer | null {\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.BottomRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {NextConnection} from './next_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the bottom row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends Row {\n  /**\n   * Whether this row has a next connection.\n   */\n  hasNextConnection = false;\n\n  /**\n   * The next connection on the row, if any.\n   */\n  connection: NextConnection | null = null;\n\n  /**\n   * The amount that the bottom of the block extends below the horizontal\n   * edge, e.g. because of a next connection.  Must be non-negative (see\n   * #2820).\n   */\n  descenderHeight = 0;\n\n  /**\n   * The Y position of the bottom edge of the block, relative to the origin\n   * of the block rendering.\n   */\n  baseline = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.BOTTOM_ROW;\n  }\n\n  /**\n   * Returns whether or not the bottom row has a left square corner.\n   *\n   * @param block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    return !!block.outputConnection || !!block.getNextBlock();\n  }\n\n  /**\n   * Returns whether or not the bottom row has a right square corner.\n   *\n   * @param _block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let descenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        // Note: this assumes that next connections have *only* descenderHeight,\n        // with no height above the baseline.\n        if (Types.isNextConnection(elem)) {\n          descenderHeight = Math.max(descenderHeight, elem.height);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\n    this.descenderHeight = descenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Connection\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider, Shape} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a connection and the space that it takes up on\n * the block.\n */\nexport class Connection extends Measurable {\n  shape: Shape;\n  isDynamicShape: boolean;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public connectionModel: RenderedConnection,\n  ) {\n    super(constants);\n\n    this.shape = this.constants_.shapeFor(connectionModel);\n\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\n    this.type |= Types.CONNECTION;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputConnection\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent an input that takes up space on a block\n * during rendering.\n */\nexport class InputConnection extends Connection {\n  align: number;\n  connectedBlock: BlockSvg | null;\n  connectedBlockWidth: number;\n  connectedBlockHeight: number;\n  connectionOffsetX = 0;\n  connectionOffsetY = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The input to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public input: Input,\n  ) {\n    super(constants, input.connection as RenderedConnection);\n\n    this.type |= Types.INPUT;\n\n    this.align = input.align;\n\n    this.connectedBlock =\n      input.connection && input.connection.targetBlock()\n        ? (input.connection.targetBlock() as BlockSvg)\n        : null;\n\n    if (this.connectedBlock) {\n      const bBox = this.connectedBlock.getHeightWidth();\n      this.connectedBlockWidth = bBox.width;\n      this.connectedBlockHeight = bBox.height;\n    } else {\n      this.connectedBlockWidth = 0;\n      this.connectedBlockHeight = 0;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ExternalValueInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an external value input\n * takes up during rendering\n */\nexport class ExternalValueInput extends InputConnection {\n  override height = 0;\n  override width: number;\n  override connectionOffsetY: number;\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The external value input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\n    if (!this.connectedBlock) {\n      this.height = this.shape.height as number;\n    } else {\n      this.height =\n        this.connectedBlockHeight -\n        this.constants_.TAB_OFFSET_FROM_TOP -\n        this.constants_.MEDIUM_PADDING;\n    }\n\n    this.width =\n      (this.shape.width as number) +\n      this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionHeight = this.shape.height as number;\n\n    this.connectionWidth = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Field\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Field as BlocklyField} from '../../field.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a field takes up during\n * rendering\n */\nexport class Field extends Measurable {\n  isEditable: boolean;\n  flipRtl: boolean;\n  override height: number;\n  override width: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param field The field to measure and store information for.\n   * @param parentInput The parent input for the field.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public field: BlocklyField,\n    public parentInput: Input,\n  ) {\n    super(constants);\n\n    this.isEditable = field.EDITABLE;\n\n    this.flipRtl = field.getFlipRtl();\n    this.type |= Types.FIELD;\n\n    const size = this.field.getSize();\n\n    this.height = size.height;\n\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Hat\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a hat takes up during\n * rendering.\n */\nexport class Hat extends Measurable {\n  ascenderHeight: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.HAT;\n\n    this.height = this.constants_.START_HAT.height;\n    this.width = this.constants_.START_HAT.width;\n\n    this.ascenderHeight = this.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Icon\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {IIcon as BlocklyIcon} from '../../interfaces/i_icon.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\nimport {hasBubble} from '../../interfaces/i_has_bubble.js';\n\n/**\n * An object containing information about the space an icon takes up during\n * rendering.\n */\nexport class Icon extends Measurable {\n  /**\n   * @deprecated Will be removed in v11. Create a subclass of the Icon\n   *     measurable if this data is necessary for you.\n   */\n  isVisible: boolean;\n  flipRtl = false;\n\n  /**\n   * An object containing information about the space an icon takes up during\n   * rendering.\n   *\n   * @param constants The rendering constants provider.\n   * @param icon The icon to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public icon: BlocklyIcon,\n  ) {\n    super(constants);\n\n    this.isVisible = hasBubble(icon) && icon.bubbleIsVisible();\n    this.type |= Types.ICON;\n\n    const size = icon.getSize();\n    this.height = size.height;\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InRowSpacer\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two elements on a\n * row.\n */\nexport class InRowSpacer extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param width The width of the spacer.\n   */\n  constructor(constants: ConstantProvider, width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\n    this.width = width;\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InlineInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends InputConnection {\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.INLINE_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width = this.connectedBlockWidth;\n      this.height = this.connectedBlockHeight;\n    }\n\n    this.connectionHeight = !this.isDynamicShape\n      ? (this.shape.height as number)\n      : (this.shape.height as (p1: number) => number)(this.height);\n\n    this.connectionWidth = !this.isDynamicShape\n      ? (this.shape.width as number)\n      : (this.shape.width as (p1: number) => number)(this.height);\n    if (!this.connectedBlock) {\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\n    }\n\n    this.connectionOffsetY =\n      'connectionOffsetY' in this.shape\n        ? this.shape.connectionOffsetY(this.connectionHeight)\n        : this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionOffsetX =\n      'connectionOffsetX' in this.shape\n        ? this.shape.connectionOffsetX(this.connectionWidth)\n        : 0;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering\n */\nexport class StatementInput extends InputConnection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.STATEMENT_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height =\n        this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\n    }\n    this.width =\n      this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\n      (this.shape.width as number);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputRow\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {ExternalValueInput} from './external_value_input.js';\nimport {InputConnection} from './input_connection.js';\nimport {Row} from './row.js';\nimport {StatementInput} from './statement_input.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a row that holds one or more inputs.\n */\nexport class InputRow extends Row {\n  /**\n   * The total width of all blocks connected to this row.\n   */\n  connectedBlockWidths = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.INPUT_ROW;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  override measure() {\n    this.width = this.minWidth;\n    this.height = this.minHeight;\n    let connectedBlockWidths = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      this.width += elem.width;\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\n          connectedBlockWidths += elem.connectedBlockWidth;\n        } else if (\n          Types.isExternalInput(elem) &&\n          elem instanceof ExternalValueInput &&\n          elem.connectedBlockWidth !== 0\n        ) {\n          connectedBlockWidths +=\n            elem.connectedBlockWidth - elem.connectionWidth;\n        }\n      }\n      if (!Types.isSpacer(elem)) {\n        this.height = Math.max(this.height, elem.height);\n      }\n    }\n    this.connectedBlockWidths = connectedBlockWidths;\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\n  }\n\n  override endsWithElemSpacer() {\n    return !this.hasExternalInput && !this.hasStatement;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.JaggedEdge\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space the jagged edge of a\n * collapsed block takes up during rendering.\n */\nexport class JaggedEdge extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.JAGGED_EDGE;\n    this.height = this.constants_.JAGGED_TEETH.height;\n    this.width = this.constants_.JAGGED_TEETH.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.NextConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a next connection takes\n * up during rendering.\n */\nexport class NextConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.NEXT_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.OutputConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an output connection takes\n * up during rendering.\n */\nexport class OutputConnection extends Connection {\n  startX: number;\n  connectionOffsetY: number;\n  connectionOffsetX = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.OUTPUT_CONNECTION;\n\n    this.height = !this.isDynamicShape ? (this.shape.height as number) : 0;\n    this.width = !this.isDynamicShape ? (this.shape.width as number) : 0;\n\n    this.startX = this.width;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PreviousConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a previous connection takes\n * up during rendering.\n */\nexport class PreviousConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.PREVIOUS_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RoundCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a rounded corner takes up\n * during rendering.\n */\nexport class RoundCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_ROUND_CORNER\n        : Types.RIGHT_ROUND_CORNER) | Types.CORNER;\n    this.width = this.constants_.CORNER_RADIUS;\n    // The rounded corner extends into the next row by 4 so we only take the\n    // height that is aligned with this row.\n    this.height = this.constants_.CORNER_RADIUS / 2;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SpacerRow\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InRowSpacer} from './in_row_spacer.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two rows.\n */\nexport class SpacerRow extends Row {\n  followsStatement = false;\n\n  precedesStatement = false;\n\n  override widthWithConnectedBlocks = 0;\n  override elements: InRowSpacer[];\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param height The height of the spacer.\n   * @param width The width of the spacer.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public override height: number,\n    public override width: number,\n  ) {\n    super(constants);\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\n\n    this.elements = [new InRowSpacer(this.constants_, width)];\n  }\n\n  override measure() {}\n}\n// NOP.  Width and height were set at creation.\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SquareCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a square corner takes up\n * during rendering.\n */\nexport class SquareCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_SQUARE_CORNER\n        : Types.RIGHT_SQUARE_CORNER) | Types.CORNER;\n    this.height = this.constants_.NO_PADDING;\n    this.width = this.constants_.NO_PADDING;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.TopRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Hat} from './hat.js';\nimport type {PreviousConnection} from './previous_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends Row {\n  /**\n   * The starting point for drawing the row, in the y direction.\n   * This allows us to draw hats and similar shapes that don't start at the\n   * origin. Must be non-negative (see #2820).\n   */\n  capline = 0;\n\n  /** How much the row extends up above its capline. */\n  ascenderHeight = 0;\n\n  /** Whether the block has a previous connection. */\n  hasPreviousConnection = false;\n\n  /** The previous connection on the block, if any. */\n  connection: PreviousConnection | null = null;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n\n    this.type |= Types.TOP_ROW;\n  }\n\n  /**\n   * Returns whether or not the top row has a left square corner.\n   *\n   * @param block The block whose top row this represents.\n   * @returns Whether or not the top row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    const prevBlock = block.getPreviousBlock();\n\n    return (\n      !!block.outputConnection ||\n      hasHat ||\n      (prevBlock ? prevBlock.getNextBlock() === block : false)\n    );\n  }\n\n  /**\n   * Returns whether or not the top row has a right square corner.\n   *\n   * @param _block The block whose top row this represents.\n   * @returns Whether or not the top row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let ascenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        if (Types.isHat(elem) && elem instanceof Hat) {\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\n    this.ascenderHeight = ascenderHeight;\n    this.capline = this.ascenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Coordinate} from '../../utils.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport type {Icon} from '../measurables/icon.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {isDynamicShape} from './constants.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer {\n  block_: BlockSvg;\n  info_: RenderInfo;\n  topLeft_: Coordinate;\n  outlinePath_ = '';\n  inlinePath_ = '';\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    this.block_ = block;\n    this.info_ = info;\n    this.topLeft_ = block.getRelativeToSurfaceXY();\n\n    /** The renderer's constant provider. */\n    this.constants_ = info.getRenderer().getConstants();\n  }\n\n  /**\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\n   * elements and moving fields, icons, and connections on the screen.\n   *\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\n   * joined with spaces and set directly on the block.  This guarantees that\n   * the steps are separated by spaces for improved readability, but isn't\n   * required.\n   */\n  draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      this.block_.pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  /**\n   * Hide icons that were marked as hidden.\n   *\n   * @deprecated Manually hiding icons is no longer necessary. To be removed\n   *     in v11.\n   */\n  protected hideHiddenIcons_() {\n    deprecation.warn('hideHiddenIcons_', 'v10', 'v11');\n  }\n\n  /**\n   * Save sizing information back to the block\n   * Most of the rendering information can be thrown away at the end of the\n   * render. Anything that needs to be kept around should be set in this\n   * function.\n   */\n  protected recordSizeOnBlock_() {\n    // This is used when the block is reporting its size to anyone else.\n    // The dark path adds to the size of the block in both X and Y.\n    this.block_.height = this.info_.height;\n    this.block_.width = this.info_.widthWithChildren;\n  }\n\n  /** Create the outline of the block.  This is a single continuous path. */\n  protected drawOutline_() {\n    this.drawTop_();\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\n      const row = this.info_.rows[r];\n      if (row.hasJaggedEdge) {\n        this.drawJaggedEdge_(row);\n      } else if (row.hasStatement) {\n        this.drawStatementInput_(row);\n      } else if (row.hasExternalInput) {\n        this.drawValueInput_(row);\n      } else {\n        this.drawRightSideRow_(row);\n      }\n    }\n    this.drawBottom_();\n    this.drawLeft_();\n  }\n\n  /**\n   * Add steps for the top corner of the block, taking into account\n   * details such as hats and rounded corners.\n   */\n  protected drawTop_() {\n    const topRow = this.info_.topRow;\n    const elements = topRow.elements;\n\n    this.positionPreviousConnection_();\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = elements[i]); i++) {\n      if (Types.isLeftRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\n      } else if (\n        Types.isPreviousConnection(elem) &&\n        elem instanceof Connection\n      ) {\n        this.outlinePath_ += (\n          (elem as PreviousConnection).shape as Notch\n        ).pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.outlinePath_ += this.constants_.START_HAT.path;\n      } else if (Types.isSpacer(elem)) {\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\n      }\n    }\n    // No branch for a square corner, because it's a no-op.\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\n  }\n\n  /**\n   * Add steps for the jagged edge of a row on a collapsed block.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawJaggedEdge_(row: Row) {\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\n    this.outlinePath_ +=\n      this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\n  }\n\n  /**\n   * Add steps for an external value input, rendered as a notch in the side\n   * of the block.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawValueInput_(row: Row) {\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\n    this.positionExternalValueConnection_(row);\n\n    const pathDown = isDynamicShape(input.shape)\n      ? input.shape.pathDown(input.height)\n      : (input.shape as PuzzleTab).pathDown;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', input.xPos + input.width) +\n      pathDown +\n      svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\n  }\n\n  /**\n   * Add steps for a statement input.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawStatementInput_(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\n\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis(\n        'h',\n        -(input.notchOffset - this.constants_.INSIDE_CORNERS.width),\n      ) +\n      this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      this.constants_.INSIDE_CORNERS.pathBottom +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawRightSideRow_(row: Row) {\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps for the bottom edge of a block, possibly including a notch\n   * for the next connection.\n   */\n  protected drawBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    const elems = bottomRow.elements;\n    this.positionNextConnection_();\n\n    let rightCornerYOffset = 0;\n    let outlinePath = '';\n    for (let i = elems.length - 1, elem; (elem = elems[i]); i--) {\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\n        outlinePath += (elem.shape as Notch).pathRight;\n      } else if (Types.isLeftSquareCorner(elem)) {\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\n      } else if (Types.isSpacer(elem)) {\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\n      }\n    }\n\n    this.outlinePath_ += svgPaths.lineOnAxis(\n      'V',\n      bottomRow.baseline - rightCornerYOffset,\n    );\n    this.outlinePath_ += outlinePath;\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected drawLeft_() {\n    const outputConnection = this.info_.outputConnection;\n    this.positionOutputConnection_();\n\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      const pathUp = isDynamicShape(outputConnection.shape)\n        ? outputConnection.shape.pathUp(outputConnection.height)\n        : (outputConnection.shape as PuzzleTab).pathUp;\n\n      // Draw a line up to the bottom of the tab.\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\n    }\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /**\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\n   * do not depend on the outer path for placement.\n   */\n  protected drawInternals_() {\n    for (let i = 0, row; (row = this.info_.rows[i]); i++) {\n      for (let j = 0, elem; (elem = row.elements[j]); j++) {\n        if (Types.isInlineInput(elem)) {\n          this.drawInlineInput_(elem as InlineInput);\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\n          this.layoutField_(elem as Field | Icon);\n        }\n      }\n    }\n  }\n\n  /**\n   * Push a field or icon's new position to its SVG root.\n   *\n   * @param fieldInfo The rendering information for the field or icon.\n   */\n  protected layoutField_(fieldInfo: Icon | Field) {\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\n    let xPos = fieldInfo.xPos;\n    let scale = '';\n    if (this.info_.RTL) {\n      xPos = -(xPos + fieldInfo.width);\n      if (fieldInfo.flipRtl) {\n        xPos += fieldInfo.width;\n        scale = 'scale(-1 1)';\n      }\n    }\n\n    if (Types.isIcon(fieldInfo)) {\n      const icon = (fieldInfo as Icon).icon;\n      icon.setOffsetInBlock(new Coordinate(xPos, yPos));\n      if (this.info_.isInsertionMarker) {\n        icon.hideForInsertionMarker();\n      }\n    } else {\n      const svgGroup = (fieldInfo as Field).field.getSvgRoot()!;\n      svgGroup.setAttribute(\n        'transform',\n        'translate(' + xPos + ',' + yPos + ')' + scale,\n      );\n      if (this.info_.isInsertionMarker) {\n        svgGroup.setAttribute('display', 'none');\n      }\n    }\n  }\n\n  /**\n   * Add steps for an inline input.\n   *\n   * @param input The information about the input to render.\n   */\n  protected drawInlineInput_(input: InlineInput) {\n    const width = input.width;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionTop = input.connectionOffsetY;\n    const connectionBottom = input.connectionHeight + connectionTop;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    this.inlinePath_ +=\n      svgPaths.moveTo(connectionRight, yPos) +\n      svgPaths.lineOnAxis('v', connectionTop) +\n      (input.shape as PuzzleTab).pathDown +\n      svgPaths.lineOnAxis('v', height - connectionBottom) +\n      svgPaths.lineOnAxis('h', width - input.connectionWidth) +\n      svgPaths.lineOnAxis('v', -height) +\n      'z';\n\n    this.positionInlineInputConnection_(input);\n  }\n\n  /**\n   * Position the connection on an inline value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param input The information about the input that the connection is on.\n   */\n  protected positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY,\n      );\n    }\n  }\n\n  /**\n   * Position the connection on a statement input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /**\n   * Position the connection on an external value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /** Position the previous connection on a block. */\n  protected positionPreviousConnection_() {\n    const topRow = this.info_.topRow;\n    if (topRow.connection) {\n      const x = topRow.xPos + topRow.notchOffset;\n      const connX = this.info_.RTL ? -x : x;\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\n    }\n  }\n\n  /** Position the next connection on a block. */\n  protected positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX = this.info_.RTL ? -x : x;\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\n    }\n  }\n\n  /** Position the output connection on a block. */\n  protected positionOutputConnection_() {\n    if (this.info_.outputConnection) {\n      const x =\n        this.info_.startX + this.info_.outputConnection.connectionOffsetX;\n      const connX = this.info_.RTL ? -x : x;\n      this.block_.outputConnection.setOffsetInBlock(\n        connX,\n        this.info_.outputConnection.connectionOffsetY,\n      );\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Enum for alignment of inputs.\n */\nexport enum Align {\n  LEFT = -1,\n  CENTRE = 0,\n  RIGHT = 1,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, non-serializable text field.  Used for titles,\n *    labels, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabel\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, non-serializable text field.\n */\nexport class FieldLabel extends Field<string> {\n  /** The HTML class name to use for this field. */\n  private class: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /** Text labels should not truncate. */\n  override maxDisplayLength = Infinity;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    textClass?: string,\n    config?: FieldLabelConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.class = textClass || null;\n    }\n    this.setValue(value);\n  }\n\n  protected override configure_(config: FieldLabelConfig) {\n    super.configure_(config);\n    if (config.class) this.class = config.class;\n  }\n\n  /**\n   * Create block UI for this label.\n   */\n  override initView() {\n    this.createTextElement_();\n    if (this.class) {\n      dom.addClass(this.getTextElement(), this.class);\n    }\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Set the CSS class applied to the field's textElement_.\n   *\n   * @param cssClass The new CSS class name, or null to remove.\n   */\n  setClass(cssClass: string | null) {\n    if (this.textElement_) {\n      if (this.class) {\n        dom.removeClass(this.textElement_, this.class);\n      }\n      if (cssClass) {\n        dom.addClass(this.textElement_, cssClass);\n      }\n    }\n    this.class = cssClass;\n  }\n\n  /**\n   * Construct a FieldLabel from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabel if that class doesn't override\n    // the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label', FieldLabel);\n\nFieldLabel.prototype.DEFAULT_VALUE = '';\n\n// clang-format off\n// Clang does not like the 'class' keyword being used as a property.\n/**\n * Config options for the label field.\n */\nexport interface FieldLabelConfig extends FieldConfig {\n  class?: string;\n}\n// clang-format on\n\n/**\n * fromJson config options for the label field.\n */\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\n  text?: string;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an input (value, statement, or dummy).\n *\n * @class\n */\n// Former goog.module ID: Blockly.Input\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../field_label.js';\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport type {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport * as fieldRegistry from '../field_registry.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\nimport {inputTypes} from './input_types.js';\n\n/** Class for an input with optional fields. */\nexport class Input {\n  fieldRow: Field[] = [];\n  /** Alignment of input's fields (left, right or centre). */\n  align = Align.LEFT;\n\n  /** Is the input visible? */\n  private visible = true;\n\n  public readonly type: inputTypes = inputTypes.CUSTOM;\n\n  public connection: Connection | null = null;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param sourceBlock The block containing this input.\n   */\n  constructor(\n    public name: string,\n    private sourceBlock: Block,\n  ) {}\n\n  /**\n   * Get the source block for this input.\n   *\n   * @returns The block this input is part of.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock;\n  }\n\n  /**\n   * Add a field (or label from string), and all prefix and suffix fields, to\n   * the end of the input's field row.\n   *\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The input being append to (to allow chaining).\n   */\n  appendField<T>(field: string | Field<T>, opt_name?: string): Input {\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\n    return this;\n  }\n\n  /**\n   * Inserts a field (or label from string), and all prefix and suffix fields,\n   * at the location of the input's field row.\n   *\n   * @param index The index at which to insert field.\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The index following the last inserted field.\n   */\n  insertFieldAt<T>(\n    index: number,\n    field: string | Field<T>,\n    opt_name?: string,\n  ): number {\n    if (index < 0 || index > this.fieldRow.length) {\n      throw Error('index ' + index + ' out of bounds.');\n    }\n    // Falsy field values don't generate a field, unless the field is an empty\n    // string and named.\n    if (!field && !(field === '' && opt_name)) {\n      return index;\n    }\n\n    // Generate a FieldLabel when given a plain text field.\n    if (typeof field === 'string') {\n      field = fieldRegistry.fromJson({\n        type: 'field_label',\n        text: field,\n      })!;\n    }\n\n    field.setSourceBlock(this.sourceBlock);\n    if (this.sourceBlock.rendered) {\n      field.init();\n      field.applyColour();\n    }\n    field.name = opt_name;\n    field.setVisible(this.isVisible());\n\n    if (field.prefixField) {\n      // Add any prefix.\n      index = this.insertFieldAt(index, field.prefixField);\n    }\n    // Add the field to the field row.\n    this.fieldRow.splice(index, 0, field as Field);\n    index++;\n    if (field.suffixField) {\n      // Add any suffix.\n      index = this.insertFieldAt(index, field.suffixField);\n    }\n\n    if (this.sourceBlock.rendered) {\n      (this.sourceBlock as BlockSvg).queueRender();\n      // Adding a field will cause the block to change shape.\n      this.sourceBlock.bumpNeighbours();\n    }\n    return index;\n  }\n\n  /**\n   * Remove a field from this input.\n   *\n   * @param name The name of the field.\n   * @param opt_quiet True to prevent an error if field is not present.\n   * @returns True if operation succeeds, false if field is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the field is not present and opt_quiet is false.\n   */\n  removeField(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      if (field.name === name) {\n        field.dispose();\n        this.fieldRow.splice(i, 1);\n        if (this.sourceBlock.rendered) {\n          (this.sourceBlock as BlockSvg).queueRender();\n          // Removing a field will cause the block to change shape.\n          this.sourceBlock.bumpNeighbours();\n        }\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Field \"' + name + '\" not found.');\n  }\n\n  /**\n   * Gets whether this input is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Sets whether this input is visible or not.\n   * Should only be used to collapse/uncollapse a block.\n   *\n   * @param visible True if visible.\n   * @returns List of blocks to render.\n   * @internal\n   */\n  setVisible(visible: boolean): BlockSvg[] {\n    // Note: Currently there are only unit tests for block.setCollapsed()\n    // because this function is package. If this function goes back to being a\n    // public API tests (lots of tests) should be added.\n    let renderList: AnyDuringMigration[] = [];\n    if (this.visible === visible) {\n      return renderList;\n    }\n    this.visible = visible;\n\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.setVisible(visible);\n    }\n    if (this.connection) {\n      const renderedConnection = this.connection as RenderedConnection;\n      // Has a connection.\n      if (visible) {\n        renderList = renderedConnection.startTrackingAll();\n      } else {\n        renderedConnection.stopTrackingAll();\n      }\n      const child = renderedConnection.targetBlock();\n      if (child) {\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Mark all fields on this input as dirty.\n   *\n   * @internal\n   */\n  markDirty() {\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.markDirty();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types.  Null if all\n   *     types are compatible.\n   * @returns The input being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setCheck(check);\n    return this;\n  }\n\n  /**\n   * Change the alignment of the connection's field(s).\n   *\n   * @param align One of the values of Align.  In RTL mode directions\n   *     are reversed, and Align.RIGHT aligns to the left.\n   * @returns The input being modified (to allow chaining).\n   */\n  setAlign(align: Align): Input {\n    this.align = align;\n    if (this.sourceBlock.rendered) {\n      const sourceBlock = this.sourceBlock as BlockSvg;\n      sourceBlock.queueRender();\n    }\n    return this;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadow DOM representation of a block or null.\n   * @returns The input being modified (to allow chaining).\n   */\n  setShadowDom(shadow: Element | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setShadowDom(shadow);\n    return this;\n  }\n\n  /**\n   * Returns the XML representation of the connection's shadow block.\n   *\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(): Element | null {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    return this.connection.getShadowDom();\n  }\n\n  /** Initialize the fields on this input. */\n  init() {\n    if (!this.sourceBlock.workspace.rendered) {\n      return; // Headless blocks don't need fields initialized.\n    }\n    for (let i = 0; i < this.fieldRow.length; i++) {\n      this.fieldRow[i].init();\n    }\n  }\n\n  /**\n   * Sever all links to this input.\n   */\n  dispose() {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      field.dispose();\n    }\n    if (this.connection) {\n      this.connection.dispose();\n    }\n  }\n\n  /**\n   * Constructs a connection based on the type of this input's source block.\n   * Properly handles constructing headless connections for headless blocks\n   * and rendered connections for rendered blocks.\n   *\n   * @returns a connection of the given type, which is either a headless\n   *     or rendered connection, based on the type of this input's source block.\n   */\n  protected makeConnection(type: ConnectionType): Connection {\n    return this.sourceBlock.makeConnection_(type);\n  }\n}\n\nexport namespace Input {\n  // TODO(v11): When this is removed in v11, also re-enable errors on access\n  //     of deprecated things (in build_tasks.js).\n  /**\n   * Enum for alignment of inputs.\n   *\n   * @deprecated Use Blockly.inputs.Align. To be removed in v11.\n   */\n  export enum Align {\n    LEFT = -1,\n    CENTRE = 0,\n    RIGHT = 1,\n  }\n}\n\n/** @deprecated Use Blockly.inputs.Align. To be removed in v11. */\n/** @suppress {deprecated} */\nexport type Align = Input.Align;\n/** @deprecated Use Blockly.inputs.Align. To be removed in v11. */\n/** @suppress {deprecated} */\nexport const Align = Input.Align;\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with no connection. */\nexport class DummyInput extends Input {\n  readonly type = inputTypes.DUMMY;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/**\n * Represents an input on a block that is always the last input in the row. Any\n * following input will be rendered on the next row even if the block has inline\n * inputs. Any newline character in a JSON block definition's message will\n * automatically be parsed as an end-row input.\n */\nexport class EndRowInput extends Input {\n  readonly type = inputTypes.END_ROW;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a statement connection. */\nexport class StatementInput extends Input {\n  readonly type = inputTypes.STATEMENT;\n\n  public connection: Connection;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Statement inputs must have a non-empty name');\n\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.NEXT_STATEMENT);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a value connection. */\nexport class ValueInput extends Input {\n  readonly type = inputTypes.VALUE;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Value inputs must have a non-empty name');\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.INPUT_VALUE);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Input} from '../../inputs/input.js';\nimport {Align} from '../../inputs/align.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput as StatementInputMeasurable} from '../measurables/statement_input.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo {\n  block_: BlockSvg;\n  protected constants_: ConstantProvider;\n  outputConnection: OutputConnection | null;\n  isInline: boolean;\n  isCollapsed: boolean;\n  isInsertionMarker: boolean;\n  RTL: boolean;\n\n  /** The block renderer in use. */\n  protected readonly renderer_!: Renderer;\n\n  /** The height of the rendered block, including child blocks. */\n  height = 0;\n\n  /** The width of the rendered block, including child blocks. */\n  widthWithChildren = 0;\n\n  /**\n   * The width of the rendered block, excluding child blocks.  This is the\n   * right edge of the block when rendered LTR.\n   */\n  width = 0;\n  statementEdge = 0;\n\n  /** An array of Row objects containing sizing information. */\n  rows: Row[] = [];\n\n  /** An array of input rows on the block. */\n  inputRows: InputRow[] = [];\n\n  topRow: TopRow;\n  bottomRow: BottomRow;\n\n  // The position of the start point for drawing, relative to the block's\n  // location.\n  startX = 0;\n  startY = 0;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    this.renderer_ = renderer;\n\n    this.block_ = block;\n\n    /** The renderer's constant provider. */\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * A measurable representing the output connection if the block has one.\n     * Otherwise null.\n     */\n    this.outputConnection = block.outputConnection\n      ? new OutputConnection(this.constants_, block.outputConnection)\n      : null;\n\n    /**\n     * Whether the block should be rendered as a single line, either because\n     * it's inline or because it has been collapsed.\n     */\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\n\n    /** Whether the block is collapsed. */\n    this.isCollapsed = block.isCollapsed();\n\n    /**\n     * Whether the block is an insertion marker.  Insertion markers are the same\n     * shape as normal blocks, but don't show fields.\n     */\n    this.isInsertionMarker = block.isInsertionMarker();\n\n    /** True if the block should be rendered right-to-left. */\n    this.RTL = block.RTL;\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  /**\n   * Populate and return an object containing all sizing information needed to\n   * draw this block.\n   *\n   * This measure pass does not propagate changes to the block (although fields\n   * may choose to rerender when getSize() is called).  However, calling it\n   * repeatedly may be expensive.\n   */\n  measure() {\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  /**\n   * Create rows of Measurable objects representing all renderable parts of the\n   * block.\n   */\n  protected createRows_() {\n    this.populateTopRow_();\n    this.rows.push(this.topRow);\n    let activeRow = new InputRow(this.constants_);\n    this.inputRows.push(activeRow);\n\n    // Icons always go on the first row, before anything else.\n    const icons = this.block_.getIcons();\n    for (let i = 0, icon; (icon = icons[i]); i++) {\n      const iconInfo = new Icon(this.constants_, icon);\n      if (!this.isCollapsed || icon.isShownWhenCollapsed()) {\n        activeRow.elements.push(iconInfo);\n      }\n    }\n\n    let lastInput = undefined;\n    // Loop across all of the inputs on the block, creating objects for anything\n    // that needs to be rendered and breaking the block up into visual rows.\n    for (let i = 0, input; (input = this.block_.inputList[i]); i++) {\n      if (!input.isVisible()) {\n        continue;\n      }\n      if (this.shouldStartNewRow_(input, lastInput)) {\n        // Finish this row and create a new one.\n        this.rows.push(activeRow);\n        activeRow = new InputRow(this.constants_);\n        this.inputRows.push(activeRow);\n      }\n\n      // All of the fields in an input go on the same row.\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        activeRow.elements.push(new Field(this.constants_, field, input));\n      }\n      this.addInput_(input, activeRow);\n      lastInput = input;\n    }\n\n    if (this.isCollapsed) {\n      activeRow.hasJaggedEdge = true;\n      activeRow.elements.push(new JaggedEdge(this.constants_));\n    }\n\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\n      this.rows.push(activeRow);\n    }\n    this.populateBottomRow_();\n    this.rows.push(this.bottomRow);\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the top row.\n   */\n  protected populateTopRow_() {\n    const hasPrevious = !!this.block_.previousConnection;\n    const hasHat =\n      (this.block_.hat\n        ? this.block_.hat === 'cap'\n        : this.constants_.ADD_START_HATS) &&\n      !this.outputConnection &&\n      !hasPrevious;\n\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_));\n\n    if (hasHat) {\n      const hat = new Hat(this.constants_);\n      this.topRow.elements.push(hat);\n      this.topRow.capline = hat.ascenderHeight;\n    } else if (hasPrevious) {\n      this.topRow.hasPreviousConnection = true;\n      this.topRow.connection = new PreviousConnection(\n        this.constants_,\n        this.block_.previousConnection as RenderedConnection,\n      );\n      this.topRow.elements.push(this.topRow.connection);\n    }\n\n    const precedesStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[0] instanceof StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (precedesStatement && !this.block_.isCollapsed()) {\n      this.topRow.minHeight =\n        this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\n    }\n\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the bottom row.\n   */\n  protected populateBottomRow_() {\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\n    }\n\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\n\n    if (leftSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\n    }\n\n    if (this.bottomRow.hasNextConnection) {\n      this.bottomRow.connection = new NextConnection(\n        this.constants_,\n        this.block_.nextConnection as RenderedConnection,\n      );\n      this.bottomRow.elements.push(this.bottomRow.connection);\n    }\n\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\n\n    if (rightSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\n    }\n  }\n\n  /**\n   * Add an input element to the active row, if needed, and record the type of\n   * the input on the row.\n   *\n   * @param input The input to record information about.\n   * @param activeRow The row that is currently being populated.\n   */\n  protected addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        input.getSourceBlock() && input.getSourceBlock()!.isShadow()\n          ? this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT\n          : this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    if (activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  /**\n   * Decide whether to start a new row between the two Blockly.Inputs.\n   *\n   * @param currInput The current input.\n   * @param prevInput The previous input.\n   * @returns True if the current input should be rendered on a new row.\n   */\n  protected shouldStartNewRow_(currInput: Input, prevInput?: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value inputs, dummy inputs, and any input following an external value\n    // input get a new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      prevInput instanceof ValueInput\n    ) {\n      return !this.isInline;\n    }\n    return false;\n  }\n\n  /** Add horizontal spacing between and around elements within each row. */\n  protected addElemSpacing_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        // There's a spacer after the last element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null),\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Calculate the width of a spacer element in a row based on the previous and\n   * next elements in that row.  For instance, extra padding is added between\n   * two editable fields.\n   *\n   * @param prev The element before the spacer.\n   * @param next The element after the spacer.\n   * @returns The size of the spacing between the two elements.\n   */\n  protected getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Between inputs and the end of the row.\n    if (prev && Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a square corner and a previous or next connection\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Figure out where the right edge of the block and right edge of statement\n   * inputs should be placed.\n   */\n  protected computeBounds_() {\n    let widestStatementRowFields = 0;\n    let blockWidth = 0;\n    let widestRowWithConnectedBlocks = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.measure();\n      blockWidth = Math.max(blockWidth, row.width);\n      if (row.hasStatement) {\n        const statementInput = row.getLastInput();\n        const innerWidth = row.width - (statementInput?.width ?? 0);\n        widestStatementRowFields = Math.max(\n          widestStatementRowFields,\n          innerWidth,\n        );\n      }\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n    }\n\n    this.statementEdge = widestStatementRowFields;\n    this.width = blockWidth;\n\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        row.statementEdge = this.statementEdge;\n      }\n    }\n\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\n\n    if (this.outputConnection) {\n      this.startX = this.outputConnection.width;\n      this.width += this.outputConnection.width;\n      this.widthWithChildren += this.outputConnection.width;\n    }\n  }\n\n  /**\n   * Extra spacing may be necessary to make sure that the right sides of all\n   * rows line up.  This can only be calculated after a first pass to calculate\n   * the sizes of all rows.\n   */\n  protected alignRowElements_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        this.alignStatementRow_(row as InputRow);\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = this.getDesiredRowWidth_(row);\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        if (Types.isTopOrBottomRow(row)) {\n          row.widthWithConnectedBlocks = row.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Calculate the desired width of an input row.\n   *\n   * @param _row The input row.\n   * @returns The desired width of the input row.\n   */\n  protected getDesiredRowWidth_(_row: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Modify the given row to add the given amount of padding around its fields.\n   * The exact location of the padding is based on the alignment property of the\n   * last input in the field.\n   *\n   * @param row The row to add padding to.\n   * @param missingSpace How much padding to add.\n   */\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\n    const firstSpacer = row.getFirstSpacer();\n    const lastSpacer = row.getLastSpacer();\n    if (row.hasExternalInput || row.hasStatement) {\n      row.widthWithConnectedBlocks += missingSpace;\n    }\n\n    // Decide where the extra padding goes.\n    if (row.align === Align.LEFT && lastSpacer) {\n      // Add padding to the end of the row.\n      lastSpacer.width += missingSpace;\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\n      // Split the padding between the beginning and end of the row.\n      firstSpacer.width += missingSpace / 2;\n      lastSpacer.width += missingSpace / 2;\n    } else if (row.align === Align.RIGHT && firstSpacer) {\n      // Add padding at the beginning of the row.\n      firstSpacer.width += missingSpace;\n    } else if (lastSpacer) {\n      // Default to left-aligning.\n      lastSpacer.width += missingSpace;\n    } else {\n      return;\n    }\n    row.width += missingSpace;\n  }\n\n  /**\n   * Align the elements of a statement row based on computed bounds.\n   * Unlike other types of rows, statement rows add space in multiple places.\n   *\n   * @param row The statement row to resize.\n   */\n  protected alignStatementRow_(row: InputRow) {\n    const statementInput = row.getLastInput();\n    if (!statementInput) return;\n    let currentWidth = row.width - statementInput.width;\n    let desiredWidth = this.statementEdge;\n    // Add padding before the statement input.\n    const missingSpace = desiredWidth - currentWidth;\n    if (missingSpace > 0) {\n      this.addAlignmentPadding_(row, missingSpace);\n    }\n    // Also widen the statement input to reach to the right side of the\n    // block. Note that this does not add padding.\n    currentWidth = row.width;\n    desiredWidth = this.getDesiredRowWidth_(row);\n    statementInput.width += desiredWidth - currentWidth;\n    statementInput.height = Math.max(statementInput.height, row.height);\n    row.width += desiredWidth - currentWidth;\n    row.widthWithConnectedBlocks = Math.max(\n      row.width,\n      this.statementEdge + row.connectedBlockWidths,\n    );\n  }\n\n  /** Add spacers between rows and set their sizes. */\n  protected addRowSpacing_() {\n    const oldRows = this.rows;\n    this.rows = [];\n\n    for (let r = 0; r < oldRows.length; r++) {\n      this.rows.push(oldRows[r]);\n      if (r !== oldRows.length - 1) {\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\n      }\n    }\n  }\n\n  /**\n   * Create a spacer row to go between prev and next, and set its size.\n   *\n   * @param prev The previous row.\n   * @param next The next row.\n   * @returns The newly created spacer row.\n   */\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\n    const height = this.getSpacerRowHeight_(prev, next);\n    const width = this.getSpacerRowWidth_(prev, next);\n    const spacer = new SpacerRow(this.constants_, height, width);\n    if (prev.hasStatement) {\n      spacer.followsStatement = true;\n    }\n    if (next.hasStatement) {\n      spacer.precedesStatement = true;\n    }\n    return spacer;\n  }\n\n  /**\n   * Calculate the width of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired width of the spacer row between these two rows.\n   */\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Calculate the height of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired height of the spacer row between these two rows.\n   */\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Calculate the centerline of an element in a rendered row.\n   * This base implementation puts the centerline at the middle of the row\n   * vertically, with no special cases.  You will likely need extra logic to\n   * handle (at minimum) top and bottom rows.\n   *\n   * @param row The row containing the element.\n   * @param elem The element to place.\n   * @returns The desired centerline of the given element, as an offset from the\n   *     top left of the block.\n   */\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n    return row.yPos + row.height / 2;\n  }\n\n  /**\n   * Record final position information on elements on the given row, for use in\n   * drawing.  At minimum this records xPos and centerline on each element.\n   *\n   * @param row The row containing the elements.\n   */\n  protected recordElemPositions_(row: Row) {\n    let xCursor = row.xPos;\n    for (let j = 0, elem; (elem = row.elements[j]); j++) {\n      // Now that row heights are finalized, make spacers use the row height.\n      if (Types.isSpacer(elem)) {\n        elem.height = row.height;\n      }\n      elem.xPos = xCursor;\n      elem.centerline = this.getElemCenterline_(row, elem);\n      xCursor += elem.width;\n    }\n  }\n\n  /**\n   * Make any final changes to the rendering information object.  In particular,\n   * store the y position of each row, and record the height of the full block.\n   */\n  protected finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a marker move.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.MarkerMove\n\nimport type {Block} from '../block.js';\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners that a marker (used for keyboard navigation) has\n * moved.\n */\nexport class MarkerMove extends UiBase {\n  /** The ID of the block the marker is now on, if any. */\n  blockId?: string;\n\n  /** The old node the marker used to be on, if any. */\n  oldNode?: ASTNode;\n\n  /** The new node the marker is now on. */\n  newNode?: ASTNode;\n\n  /**\n   * True if this is a cursor event, false otherwise.\n   * For information about cursors vs markers see {@link\n   * https://blocklycodelabs.dev/codelabs/keyboard-navigation/index.html?index=..%2F..index#1}.\n   */\n  isCursor?: boolean;\n\n  override type = eventUtils.MARKER_MOVE;\n\n  /**\n   * @param opt_block The affected block. Null if current node is of type\n   *     workspace. Undefined for a blank event.\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\n   *     event.\n   * @param opt_oldNode The old node the marker used to be on.\n   *    Undefined for a blank event.\n   * @param opt_newNode The new node the marker is now on.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    isCursor?: boolean,\n    opt_oldNode?: ASTNode | null,\n    opt_newNode?: ASTNode,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block?.id;\n    this.oldNode = opt_oldNode || undefined;\n    this.newNode = opt_newNode;\n    this.isCursor = isCursor;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): MarkerMoveJson {\n    const json = super.toJson() as MarkerMoveJson;\n    if (this.isCursor === undefined) {\n      throw new Error(\n        'Whether this is a cursor event or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.newNode) {\n      throw new Error(\n        'The new node is undefined. Either pass a node to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isCursor'] = this.isCursor;\n    json['blockId'] = this.blockId;\n    json['oldNode'] = this.oldNode;\n    json['newNode'] = this.newNode;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of MarkerMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: MarkerMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): MarkerMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new MarkerMove(),\n    ) as MarkerMove;\n    newEvent.isCursor = json['isCursor'];\n    newEvent.blockId = json['blockId'];\n    newEvent.oldNode = json['oldNode'];\n    newEvent.newNode = json['newNode'];\n    return newEvent;\n  }\n}\n\nexport interface MarkerMoveJson extends AbstractEventJson {\n  isCursor: boolean;\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode: ASTNode;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MARKER_MOVE, MarkerMove);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.MarkerSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../../events/events_marker_move.js';\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as eventUtils from '../../events/utils.js';\nimport type {Field} from '../../field.js';\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\n\n/** The name of the CSS class for a cursor. */\nconst CURSOR_CLASS = 'blocklyCursor';\n\n/** The name of the CSS class for a marker. */\nconst MARKER_CLASS = 'blocklyMarker';\n\n/**\n * What we multiply the height by to get the height of the marker.\n * Only used for the block and block connections.\n */\nconst HEIGHT_MULTIPLIER = 3 / 4;\n\n/**\n * Class for a marker, containing methods for graphically rendering a marker as\n * SVG.\n */\nexport class MarkerSvg {\n  /**\n   * The workspace, field, or block that the marker SVG element should be\n   * attached to.\n   */\n  private parent: IASTNodeLocationSvg | null = null;\n\n  /** The current SVG element for the marker. */\n  currentMarkerSvg: SVGElement | null = null;\n  colour_: string;\n\n  /** The root SVG group containing the marker. */\n  protected markerSvg_: SVGGElement | null = null;\n  protected svgGroup_: SVGGElement | null = null;\n\n  protected markerBlock_: SVGPathElement | null = null;\n\n  protected markerInput_: SVGPathElement | null = null;\n  protected markerSvgLine_: SVGRectElement | null = null;\n\n  protected markerSvgRect_: SVGRectElement | null = null;\n\n  /** The constants necessary to draw the marker. */\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    constants: ConstantProvider,\n    private readonly marker: Marker,\n  ) {\n    this.constants_ = constants;\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n\n    /** The colour of the marker. */\n    this.colour_ = marker.colour || defaultColour;\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node.\n   */\n  getSvgRoot(): SVGElement | null {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the marker.\n   *\n   * @returns The marker to draw for.\n   */\n  getMarker(): Marker {\n    return this.marker;\n  }\n\n  /**\n   * True if the marker should be drawn as a cursor, false otherwise.\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\n   *\n   * @returns True if the marker is a cursor, false otherwise.\n   */\n  isCursor(): boolean {\n    return this.marker.type === 'cursor';\n  }\n\n  /**\n   * Create the DOM element for the marker.\n   *\n   * @returns The marker controls SVG group.\n   */\n  createDom(): SVGElement {\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\n\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\n\n    this.createDomInternal_();\n    return this.svgGroup_;\n  }\n\n  /**\n   * Attaches the SVG root of the marker to the SVG group of the parent.\n   *\n   * @param newParent The workspace, field, or block that the marker SVG element\n   *     should be attached to.\n   */\n  protected setParent_(newParent: IASTNodeLocationSvg) {\n    if (!this.isCursor()) {\n      if (this.parent) {\n        this.parent.setMarkerSvg(null);\n      }\n      newParent.setMarkerSvg(this.getSvgRoot());\n    } else {\n      if (this.parent) {\n        this.parent.setCursorSvg(null);\n      }\n      newParent.setCursorSvg(this.getSvgRoot());\n    }\n    this.parent = newParent;\n  }\n\n  /**\n   * Update the marker.\n   *\n   * @param oldNode The previous node the marker was on or null.\n   * @param curNode The node that we want to draw the marker for.\n   */\n  draw(oldNode: ASTNode, curNode: ASTNode) {\n    if (!curNode) {\n      this.hide();\n      return;\n    }\n\n    this.constants_ = this.workspace.getRenderer().getConstants();\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n    this.colour_ = this.marker.colour || defaultColour;\n    this.applyColour_(curNode);\n\n    this.showAtLocation_(curNode);\n\n    this.fireMarkerEvent(oldNode, curNode);\n\n    // Ensures the marker will be visible immediately after the move.\n    const animate = this.currentMarkerSvg!.childNodes[0];\n    if (animate !== undefined) {\n      (animate as SVGAnimationElement).beginElement &&\n        (animate as SVGAnimationElement).beginElement();\n    }\n  }\n\n  /**\n   * Update the marker's visible state based on the type of curNode..\n   *\n   * @param curNode The node that we want to draw the marker for.\n   */\n  protected showAtLocation_(curNode: ASTNode) {\n    const curNodeAsConnection = curNode.getLocation() as Connection;\n    const connectionType = curNodeAsConnection.type;\n    if (curNode.getType() === ASTNode.types.BLOCK) {\n      this.showWithBlock_(curNode);\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\n      this.showWithOutput_(curNode);\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\n      this.showWithInput_(curNode);\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\n      this.showWithNext_(curNode);\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\n      this.showWithPrevious_(curNode);\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\n      this.showWithField_(curNode);\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\n      this.showWithCoordinates_(curNode);\n    } else if (curNode.getType() === ASTNode.types.STACK) {\n      this.showWithStack_(curNode);\n    }\n  }\n\n  /**************************\n   * Display\n   **************************/\n\n  /**\n   * Show the marker as a combination of the previous connection and block,\n   * the output connection and block, or just the block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithBlockPrevOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const width = block.width;\n    const height = block.height;\n    const markerHeight = height * HEIGHT_MULTIPLIER;\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\n\n    if (block.previousConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.previousConnection,\n      ) as Notch;\n      this.positionPrevious_(\n        width,\n        markerOffset,\n        markerHeight,\n        connectionShape,\n      );\n    } else if (block.outputConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.outputConnection,\n      ) as PuzzleTab;\n      this.positionOutput_(width, height, connectionShape);\n    } else {\n      this.positionBlock_(width, markerOffset, markerHeight);\n    }\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlock_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a previous connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithPrevious_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithOutput_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a workspace coordinate.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithCoordinates_(curNode: ASTNode) {\n    const wsCoordinate = curNode.getWsCoordinate();\n    let x = wsCoordinate.x;\n    const y = wsCoordinate.y;\n\n    if (this.workspace.RTL) {\n      x -= this.constants_.CURSOR_WS_WIDTH;\n    }\n\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\n    this.setParent_(this.workspace);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a field.\n   * This is a box around the field.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithField_(curNode: ASTNode) {\n    const field = curNode.getLocation() as Field;\n    const width = field.getSize().width;\n    const height = field.getSize().height;\n\n    this.positionRect_(0, 0, width, height);\n    this.setParent_(field);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for an input.\n   * This is a puzzle piece.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithInput_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const sourceBlock = connection.getSourceBlock();\n\n    this.positionInput_(connection);\n    this.setParent_(sourceBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a next connection.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithNext_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const targetBlock = connection.getSourceBlock();\n    let x = 0;\n    const y = connection.getOffsetInBlock().y;\n    const width = targetBlock.getHeightWidth().width;\n    if (this.workspace.RTL) {\n      x = -width;\n    }\n    this.positionLine_(x, y, width);\n    this.setParent_(targetBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a stack.\n   * This is a box with extra padding around the entire stack of blocks.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithStack_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /** Show the current marker. */\n  protected showCurrent_() {\n    this.hide();\n    if (this.currentMarkerSvg) {\n      this.currentMarkerSvg.style.display = '';\n    }\n  }\n\n  /**************************\n   * Position\n   **************************/\n\n  /**\n   * Position the marker for a block.\n   * Displays an outline of the top half of a rectangle around a block.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The extra padding for around the block.\n   * @param markerHeight The height of the marker.\n   */\n  protected positionBlock_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n  ) {\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the marker',\n      );\n    }\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for an input connection.\n   * Displays a filled in puzzle piece.\n   *\n   * @param connection The connection to position marker around.\n   */\n  protected positionInput_(connection: RenderedConnection) {\n    const x = connection.getOffsetInBlock().x;\n    const y = connection.getOffsetInBlock().y;\n\n    const path =\n      svgPaths.moveTo(0, 0) +\n      (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\n\n    this.markerInput_!.setAttribute('d', path);\n    this.markerInput_!.setAttribute(\n      'transform',\n      'translate(' +\n        x +\n        ',' +\n        y +\n        ')' +\n        (this.workspace.RTL ? ' scale(-1 1)' : ''),\n    );\n    this.currentMarkerSvg = this.markerInput_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a horizontal line.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   */\n  protected positionLine_(x: number, y: number, width: number) {\n    if (!this.markerSvgLine_) {\n      throw new Error('createDom should be called before positioning the line');\n    }\n    this.markerSvgLine_.setAttribute('x', `${x}`);\n    this.markerSvgLine_.setAttribute('y', `${y}`);\n    this.markerSvgLine_.setAttribute('width', `${width}`);\n    this.currentMarkerSvg = this.markerSvgLine_;\n  }\n\n  /**\n   * Position the marker for an output connection.\n   * Displays a puzzle outline and the top and bottom path.\n   *\n   * @param width The width of the block.\n   * @param height The height of the block.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionOutput_(\n    width: number,\n    height: number,\n    connectionShape: PuzzleTab,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the output',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(width, 0) +\n      svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\n      svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\n      connectionShape.pathDown +\n      svgPaths.lineOnAxis('V', height) +\n      svgPaths.lineOnAxis('H', width);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for a previous connection.\n   * Displays a half rectangle with a notch in the top to represent the previous\n   * connection.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The offset of the marker from around the block.\n   * @param markerHeight The height of the marker.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionPrevious_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n    connectionShape: Notch,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the previous connection marker',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\n      connectionShape.pathLeft +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a filled in rectangle.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   * @param height The new height, in workspace units.\n   */\n  protected positionRect_(x: number, y: number, width: number, height: number) {\n    if (!this.markerSvgRect_) {\n      throw new Error('createDom should be called before positioning the rect');\n    }\n    this.markerSvgRect_.setAttribute('x', `${x}`);\n    this.markerSvgRect_.setAttribute('y', `${y}`);\n    this.markerSvgRect_.setAttribute('width', `${width}`);\n    this.markerSvgRect_.setAttribute('height', `${height}`);\n    this.currentMarkerSvg = this.markerSvgRect_;\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @param markerSvg The marker that we want to flip.\n   */\n  private flipRtl(markerSvg: SVGElement) {\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /** Hide the marker. */\n  hide() {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error('createDom should be called before hiding the marker');\n    }\n    this.markerSvgLine_.style.display = 'none';\n    this.markerSvgRect_.style.display = 'none';\n    this.markerInput_.style.display = 'none';\n    this.markerBlock_.style.display = 'none';\n  }\n\n  /**\n   * Fire event for the marker or marker.\n   *\n   * @param oldNode The old node the marker used to be on.\n   * @param curNode The new node the marker is currently on.\n   */\n  private fireMarkerEvent(oldNode: ASTNode, curNode: ASTNode) {\n    const curBlock = curNode.getSourceBlock();\n    const event = new (eventUtils.get(eventUtils.MARKER_MOVE))(\n      curBlock,\n      this.isCursor(),\n      oldNode,\n      curNode,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get the properties to make a marker blink.\n   *\n   * @returns The object holding attributes to make the marker blink.\n   */\n  protected getBlinkProperties_(): {[key: string]: string} {\n    return {\n      'attributeType': 'XML',\n      'attributeName': 'fill',\n      'dur': '1s',\n      'values': this.colour_ + ';transparent;transparent;',\n      'repeatCount': 'indefinite',\n    };\n  }\n\n  /**\n   * Create the marker SVG.\n   *\n   * @returns The SVG node created.\n   */\n  protected createDomInternal_(): Element {\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\"\n        repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n\n    this.markerSvg_ = dom.createSvgElement(\n      Svg.G,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.svgGroup_,\n    );\n\n    // A horizontal line used to represent a workspace coordinate or next\n    // connection.\n    this.markerSvgLine_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in rectangle used to represent a stack.\n    this.markerSvgRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyVerticalMarker',\n        'rx': 10,\n        'ry': 10,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in puzzle piece used to represent an input value.\n    this.markerInput_ = dom.createSvgElement(\n      Svg.PATH,\n      {'transform': ''},\n      this.markerSvg_,\n    );\n\n    // A path used to represent a previous connection and a block, an output\n    // connection and a block, or a block.\n    this.markerBlock_ = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'transform': '',\n        'fill': 'none',\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n\n    this.hide();\n\n    // Markers and stack markers don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\n      dom.createSvgElement(\n        Svg.ANIMATE,\n        {...blinkProperties, attributeName: 'stroke'},\n        this.markerBlock_,\n      );\n    }\n\n    return this.markerSvg_;\n  }\n\n  /**\n   * Apply the marker's colour.\n   *\n   * @param _curNode The node that we want to draw the marker for.\n   */\n  protected applyColour_(_curNode: ASTNode) {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error(\n        'createDom should be called before applying color to the markerj',\n      );\n    }\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\n    this.markerInput_.setAttribute('fill', this.colour_);\n    this.markerBlock_.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {IPathObject} from './i_path_object.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject implements IPathObject {\n  svgRoot: SVGElement;\n  svgPath: SVGElement;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null = null;\n\n  constants: ConstantProvider;\n  style: BlockStyle;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    this.constants = constants;\n    this.style = style;\n    this.svgRoot = root;\n\n    /** The primary path of the block. */\n    this.svgPath = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPath'},\n      this.svgRoot,\n    );\n  }\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string) {\n    this.svgPath.setAttribute('d', pathString);\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.svgRoot.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.cursorSvg) {\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\n    } else {\n      this.svgRoot.appendChild(markerSvg);\n    }\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg) {\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\n\n    this.updateShadow_(block.isShadow());\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\n  }\n\n  /**\n   * Set the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n  }\n\n  /**\n   * Add or remove the given CSS class on the path object's root SVG element.\n   *\n   * @param className The name of the class to add or remove\n   * @param add True if the class should be added.  False if it should be\n   *     removed.\n   */\n  protected setClass_(className: string, add: boolean) {\n    if (!className) {\n      return;\n    }\n    if (add) {\n      dom.addClass(this.svgRoot, className);\n    } else {\n      dom.removeClass(this.svgRoot, className);\n    }\n  }\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param enable True if highlighted.\n   */\n  updateHighlighted(enable: boolean) {\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a shadow state.\n   *\n   * @param shadow True if the block is a shadow block.\n   */\n  protected updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a disabled state.\n   *\n   * @param disabled True if disabled.\n   */\n  protected updateDisabled_(disabled: boolean) {\n    this.setClass_('blocklyDisabled', disabled);\n    if (disabled) {\n      this.svgPath.setAttribute(\n        'fill',\n        'url(#' + this.constants.disabledPatternId + ')',\n      );\n    }\n  }\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enable: boolean) {\n    this.setClass_('blocklyDraggingDelete', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enable: boolean) {\n    this.setClass_('blocklyInsertionMarker', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enable: boolean) {\n    this.setClass_('blocklyDraggable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   */\n  updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param _conn The connection on the input to highlight.\n   * @param _enable True if styling should be added.\n   */\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\n    // NOOP\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.constants\n\n/**\n * The language-neutral ID given to the collapsed input.\n */\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\n\n/**\n * The language-neutral ID given to the collapsed field.\n */\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class that controls updates to connections during drags.\n *\n * @class\n */\n// Former goog.module ID: Blockly.InsertionMarkerManager\n\nimport {finishQueuedRenders} from './render_management.js';\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport * as constants from './constants.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\n\n/** Represents a nearby valid connection. */\ninterface CandidateConnection {\n  /**\n   * A nearby valid connection that is compatible with local.\n   * This is not on any of the blocks that are being dragged.\n   */\n  closest: RenderedConnection;\n  /**\n   * A connection on the dragging stack that is compatible with closest. This is\n   * on the top block that is being dragged or the last block in the dragging\n   * stack.\n   */\n  local: RenderedConnection;\n  radius: number;\n}\n\n/**\n * An error message to throw if the block created by createMarkerBlock_ is\n * missing any components.\n */\nconst DUPLICATE_BLOCK_ERROR =\n  'The insertion marker ' +\n  'manager tried to create a marker but the result is missing %1. If ' +\n  'you are using a mutator, make sure your domToMutation method is ' +\n  'properly defined.';\n\n/**\n * Class that controls updates to connections during drags.  It is primarily\n * responsible for finding the closest eligible connection and highlighting or\n * unhighlighting it as needed during a drag.\n */\nexport class InsertionMarkerManager {\n  /**\n   * The top block in the stack being dragged.\n   * Does not change during a drag.\n   */\n  private readonly topBlock: BlockSvg;\n\n  /**\n   * The workspace on which these connections are being dragged.\n   * Does not change during a drag.\n   */\n  private readonly workspace: WorkspaceSvg;\n\n  /**\n   * The last connection on the stack, if it's not the last connection on the\n   * first block.\n   * Set in initAvailableConnections, if at all.\n   */\n  private lastOnStack: RenderedConnection | null = null;\n\n  /**\n   * The insertion marker corresponding to the last block in the stack, if\n   * that's not the same as the first block in the stack.\n   * Set in initAvailableConnections, if at all\n   */\n  private lastMarker: BlockSvg | null = null;\n\n  /**\n   * The insertion marker that shows up between blocks to show where a block\n   * would go if dropped immediately.\n   */\n  private firstMarker: BlockSvg;\n\n  /**\n   * Information about the connection that would be made if the dragging block\n   * were released immediately. Updated on every mouse move.\n   */\n  private activeCandidate: CandidateConnection | null = null;\n\n  /**\n   * Whether the block would be deleted if it were dropped immediately.\n   * Updated on every mouse move.\n   *\n   * @internal\n   */\n  public wouldDeleteBlock = false;\n\n  /**\n   * Connection on the insertion marker block that corresponds to\n   * the active candidate's local connection on the currently dragged block.\n   */\n  private markerConnection: RenderedConnection | null = null;\n\n  /** The block that currently has an input being highlighted, or null. */\n  private highlightedBlock: BlockSvg | null = null;\n\n  /** The block being faded to indicate replacement, or null. */\n  private fadedBlock: BlockSvg | null = null;\n\n  /**\n   * The connections on the dragging blocks that are available to connect to\n   * other blocks.  This includes all open connections on the top block, as\n   * well as the last connection on the block stack.\n   */\n  private availableConnections: RenderedConnection[];\n\n  /** @param block The top block in the stack being dragged. */\n  constructor(block: BlockSvg) {\n    common.setSelected(block);\n    this.topBlock = block;\n\n    this.workspace = block.workspace;\n\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\n\n    this.availableConnections = this.initAvailableConnections();\n\n    if (this.lastOnStack) {\n      this.lastMarker = this.createMarkerBlock(\n        this.lastOnStack.getSourceBlock(),\n      );\n    }\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.availableConnections.length = 0;\n    this.disposeInsertionMarker(this.firstMarker);\n    this.disposeInsertionMarker(this.lastMarker);\n  }\n\n  /**\n   * Update the available connections for the top block. These connections can\n   * change if a block is unplugged and the stack is healed.\n   *\n   * @internal\n   */\n  updateAvailableConnections() {\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Return whether the block would be connected if dropped immediately, based\n   * on information from the most recent move event.\n   *\n   * @returns True if the block would be connected if dropped immediately.\n   * @internal\n   */\n  wouldConnectBlock(): boolean {\n    return !!this.activeCandidate;\n  }\n\n  /**\n   * Connect to the closest connection and render the results.\n   * This should be called at the end of a drag.\n   *\n   * @internal\n   */\n  applyConnections() {\n    if (!this.activeCandidate) return;\n    eventUtils.disable();\n    this.hidePreview();\n    eventUtils.enable();\n    const {local, closest} = this.activeCandidate;\n    local.connect(closest);\n    if (this.topBlock.rendered) {\n      const inferiorConnection = local.isSuperior() ? closest : local;\n      const rootBlock = this.topBlock.getRootBlock();\n\n      finishQueuedRenders().then(() => {\n        blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\n        // bringToFront is incredibly expensive. Delay until the next frame.\n        setTimeout(() => {\n          rootBlock.bringToFront();\n        }, 0);\n      });\n    }\n  }\n\n  /**\n   * Update connections based on the most recent move location.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @param dragTarget The drag target that the block is currently over.\n   * @internal\n   */\n  update(dxy: Coordinate, dragTarget: IDragTarget | null) {\n    const newCandidate = this.getCandidate(dxy);\n\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\n\n    const shouldUpdate =\n      this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\n\n    if (shouldUpdate) {\n      // Don't fire events for insertion marker creation or movement.\n      eventUtils.disable();\n      this.maybeHidePreview(newCandidate);\n      this.maybeShowPreview(newCandidate);\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Create an insertion marker that represents the given block.\n   *\n   * @param sourceBlock The block that the insertion marker will represent.\n   * @returns The insertion marker that represents the given block.\n   */\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\n    const imType = sourceBlock.type;\n\n    eventUtils.disable();\n    let result: BlockSvg;\n    try {\n      result = this.workspace.newBlock(imType);\n      result.setInsertionMarker(true);\n      if (sourceBlock.saveExtraState) {\n        const state = sourceBlock.saveExtraState(true);\n        if (state && result.loadExtraState) {\n          result.loadExtraState(state);\n        }\n      } else if (sourceBlock.mutationToDom) {\n        const oldMutationDom = sourceBlock.mutationToDom();\n        if (oldMutationDom && result.domToMutation) {\n          result.domToMutation(oldMutationDom);\n        }\n      }\n      // Copy field values from the other block.  These values may impact the\n      // rendered size of the insertion marker.  Note that we do not care about\n      // child blocks here.\n      for (let i = 0; i < sourceBlock.inputList.length; i++) {\n        const sourceInput = sourceBlock.inputList[i];\n        if (sourceInput.name === constants.COLLAPSED_INPUT_NAME) {\n          continue; // Ignore the collapsed input.\n        }\n        const resultInput = result.inputList[i];\n        if (!resultInput) {\n          throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'an input'));\n        }\n        for (let j = 0; j < sourceInput.fieldRow.length; j++) {\n          const sourceField = sourceInput.fieldRow[j];\n          const resultField = resultInput.fieldRow[j];\n          if (!resultField) {\n            throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'a field'));\n          }\n          resultField.setValue(sourceField.getValue());\n        }\n      }\n\n      for (const block of result.getDescendants(false)) {\n        block.setInsertionMarker(true);\n      }\n\n      result.setCollapsed(sourceBlock.isCollapsed());\n      result.setInputsInline(sourceBlock.getInputsInline());\n\n      result.initSvg();\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\n    } finally {\n      eventUtils.enable();\n    }\n\n    return result;\n  }\n\n  /**\n   * Populate the list of available connections on this block stack. If the\n   * stack has more than one block, this function will also update lastOnStack.\n   *\n   * @returns A list of available connections.\n   */\n  private initAvailableConnections(): RenderedConnection[] {\n    const available = this.topBlock.getConnections_(false);\n    // Also check the last connection on this stack\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\n      available.push(lastOnStack);\n      this.lastOnStack = lastOnStack;\n    }\n    return available;\n  }\n\n  /**\n   * Whether the previews (insertion marker and replacement marker) should be\n   * updated based on the closest candidate and the current drag distance.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns Whether the preview should be updated.\n   */\n  private shouldUpdatePreviews(\n    newCandidate: CandidateConnection | null,\n    dxy: Coordinate,\n  ): boolean {\n    // Only need to update if we were showing a preview before.\n    if (!newCandidate) return !!this.activeCandidate;\n\n    // We weren't showing a preview before, but we should now.\n    if (!this.activeCandidate) return true;\n\n    // We're already showing an insertion marker.\n    // Decide whether the new connection has higher priority.\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\n    if (\n      activeClosest === newCandidate.closest &&\n      activeLocal === newCandidate.local\n    ) {\n      // The connection was the same as the current connection.\n      return false;\n    }\n\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n    // Slightly prefer the existing preview over a new preview.\n    return (\n      newCandidate.radius < curDistance - config.currentConnectionPreference\n    );\n  }\n\n  /**\n   * Find the nearest valid connection, which may be the same as the current\n   * closest connection.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns An object containing a local connection, a closest connection, and\n   *     a radius.\n   */\n  private getCandidate(dxy: Coordinate): CandidateConnection | null {\n    // It's possible that a block has added or removed connections during a\n    // drag, (e.g. in a drag/move event handler), so let's update the available\n    // connections. Note that this will be called on every move while dragging,\n    // so it might cause slowness, especially if the block stack is large.  If\n    // so, maybe it could be made more efficient. Also note that we won't update\n    // the connections if we've already connected the insertion marker to a\n    // block.\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\n      this.updateAvailableConnections();\n    }\n\n    let radius = this.getStartRadius();\n    let candidate = null;\n    for (let i = 0; i < this.availableConnections.length; i++) {\n      const myConnection = this.availableConnections[i];\n      const neighbour = myConnection.closest(radius, dxy);\n      if (neighbour.connection) {\n        candidate = {\n          closest: neighbour.connection,\n          local: myConnection,\n          radius: neighbour.radius,\n        };\n        radius = neighbour.radius;\n      }\n    }\n    return candidate;\n  }\n\n  /**\n   * Decide the radius at which to start searching for the closest connection.\n   *\n   * @returns The radius at which to start the search for the closest\n   *     connection.\n   */\n  private getStartRadius(): number {\n    // If there is already a connection highlighted,\n    // increase the radius we check for making new connections.\n    // When a connection is highlighted, blocks move around when the\n    // insertion marker is created, which could cause the connection became out\n    // of range. By increasing radiusConnection when a connection already\n    // exists, we never \"lose\" the connection from the offset.\n    return this.activeCandidate\n      ? config.connectingSnapRadius\n      : config.snapRadius;\n  }\n\n  /**\n   * Whether ending the drag would delete the block.\n   *\n   * @param newCandidate Whether there is a candidate connection that the\n   *     block could connect to if the drag ended immediately.\n   * @param dragTarget The drag target that the block is currently over.\n   * @returns Whether dropping the block immediately would delete the block.\n   */\n  private shouldDelete(\n    newCandidate: boolean,\n    dragTarget: IDragTarget | null,\n  ): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n        dragTarget.id,\n        ComponentManager.Capability.DELETE_AREA,\n      );\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(\n          this.topBlock,\n          newCandidate,\n        );\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Show an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the beginning of this function, this.activeConnection should be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeShowPreview(newCandidate: CandidateConnection | null) {\n    if (this.wouldDeleteBlock) return; // Nope, don't add a marker.\n    if (!newCandidate) return; // Nothing to connect to.\n\n    const closest = newCandidate.closest;\n\n    // Something went wrong and we're trying to connect to an invalid\n    // connection.\n    if (\n      closest === this.activeCandidate?.closest ||\n      closest.getSourceBlock().isInsertionMarker()\n    ) {\n      console.log('Trying to connect to an insertion marker');\n      return;\n    }\n    this.activeCandidate = newCandidate;\n    // Add an insertion marker or replacement marker.\n    this.showPreview(this.activeCandidate);\n  }\n\n  /**\n   * A preview should be shown.  This function figures out if it should be a\n   * block highlight or an insertion marker, and shows the appropriate one.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showPreview(activeCandidate: CandidateConnection) {\n    const renderer = this.workspace.getRenderer();\n    const method = renderer.getConnectionPreviewMethod(\n      activeCandidate.closest,\n      activeCandidate.local,\n      this.topBlock,\n    );\n\n    switch (method) {\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\n        this.showInsertionInputOutline(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\n        this.showInsertionMarker(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\n        this.showReplacementFade(activeCandidate);\n        break;\n    }\n\n    // Optionally highlight the actual connection, as a nod to previous\n    // behaviour.\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\n      activeCandidate.closest.highlight();\n    }\n  }\n\n  /**\n   * Hide an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the end of this function, this.activeCandidate will be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeHidePreview(newCandidate: CandidateConnection | null) {\n    // If there's no new preview, remove the old one but don't bother deleting\n    // it. We might need it later, and this saves disposing of it and recreating\n    // it.\n    if (!newCandidate) {\n      this.hidePreview();\n    } else {\n      if (this.activeCandidate) {\n        const closestChanged =\n          this.activeCandidate.closest !== newCandidate.closest;\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\n\n        // If there's a new preview and there was a preview before, and either\n        // connection has changed, remove the old preview.\n        // Also hide if we had a preview before but now we're going to delete\n        // instead.\n        if (closestChanged || localChanged || this.wouldDeleteBlock) {\n          this.hidePreview();\n        }\n      }\n    }\n\n    // Either way, clear out old state.\n    this.markerConnection = null;\n    this.activeCandidate = null;\n  }\n\n  /**\n   * A preview should be hidden. Loop through all possible preview modes\n   * and hide everything.\n   */\n  private hidePreview() {\n    const closest = this.activeCandidate?.closest;\n    if (\n      closest &&\n      closest.targetBlock() &&\n      this.workspace.getRenderer().shouldHighlightConnection(closest)\n    ) {\n      closest.unhighlight();\n    }\n    this.hideReplacementFade();\n    this.hideInsertionInputOutline();\n    this.hideInsertionMarker();\n  }\n\n  /**\n   * Shows an insertion marker connected to the appropriate blocks (based on\n   * manager state).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\n    const {local, closest} = activeCandidate;\n\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n    if (!insertionMarker) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no insertion ' +\n          'marker block',\n      );\n    }\n    let imConn;\n    try {\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    } catch (e) {\n      // It's possible that the number of connections on the local block has\n      // changed since the insertion marker was originally created.  Let's\n      // recreate the insertion marker and try again. In theory we could\n      // probably recreate the marker block (e.g. in getCandidate_), which is\n      // called more often during the drag, but creating a block that often\n      // might be too slow, so we only do it if necessary.\n      if (isLastInStack && this.lastOnStack) {\n        this.disposeInsertionMarker(this.lastMarker);\n        this.lastMarker = this.createMarkerBlock(\n          this.lastOnStack.getSourceBlock(),\n        );\n        insertionMarker = this.lastMarker;\n      } else {\n        this.disposeInsertionMarker(this.firstMarker);\n        this.firstMarker = this.createMarkerBlock(this.topBlock);\n        insertionMarker = this.firstMarker;\n      }\n\n      if (!insertionMarker) {\n        throw new Error(\n          'Cannot show the insertion marker because there is no insertion ' +\n            'marker block',\n        );\n      }\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    }\n\n    if (!imConn) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no ' +\n          'associated connection',\n      );\n    }\n\n    if (imConn === this.markerConnection) {\n      throw new Error(\n        \"Made it to showInsertionMarker_ even though the marker isn't \" +\n          'changing',\n      );\n    }\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    insertionMarker.queueRender();\n    renderManagement.triggerQueuedRenders();\n\n    // Connect() also renders the insertion marker.\n    imConn.connect(closest);\n\n    const originalOffsetToTarget = {\n      x: closest.x - imConn.x,\n      y: closest.y - imConn.y,\n    };\n    const originalOffsetInBlock = imConn.getOffsetInBlock().clone();\n    const imConnConst = imConn;\n    renderManagement.finishQueuedRenders().then(() => {\n      // Position so that the existing block doesn't move.\n      insertionMarker?.positionNearConnection(\n        imConnConst,\n        originalOffsetToTarget,\n        originalOffsetInBlock,\n      );\n      insertionMarker?.getSvgRoot().setAttribute('visibility', 'visible');\n    });\n\n    this.markerConnection = imConn;\n  }\n\n  /**\n   * Disconnects and hides the current insertion marker. Should return the\n   * blocks to their original state.\n   */\n  private hideInsertionMarker() {\n    if (!this.markerConnection) return;\n\n    const markerConn = this.markerConnection;\n    const imBlock = markerConn.getSourceBlock();\n    const markerPrev = imBlock.previousConnection;\n    const markerOutput = imBlock.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      imBlock.unplug(true);\n    }\n\n    if (markerConn.targetConnection) {\n      throw Error(\n        'markerConnection still connected at the end of ' +\n          'disconnectInsertionMarker',\n      );\n    }\n\n    this.markerConnection = null;\n    const svg = imBlock.getSvgRoot();\n    if (svg) {\n      svg.setAttribute('visibility', 'hidden');\n    }\n  }\n\n  /**\n   * Shows an outline around the input the closest connection belongs to.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\n    const closest = activeCandidate.closest;\n    this.highlightedBlock = closest.getSourceBlock();\n    this.highlightedBlock.highlightShapeForInput(closest, true);\n  }\n\n  /** Hides any visible input outlines. */\n  private hideInsertionInputOutline() {\n    if (!this.highlightedBlock) return;\n\n    if (!this.activeCandidate) {\n      throw new Error(\n        'Cannot hide the insertion marker outline because ' +\n          'there is no active candidate',\n      );\n    }\n    this.highlightedBlock.highlightShapeForInput(\n      this.activeCandidate.closest,\n      false,\n    );\n    this.highlightedBlock = null;\n  }\n\n  /**\n   * Shows a replacement fade affect on the closest connection's target block\n   * (the block that is currently connected to it).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showReplacementFade(activeCandidate: CandidateConnection) {\n    this.fadedBlock = activeCandidate.closest.targetBlock();\n    if (!this.fadedBlock) {\n      throw new Error(\n        'Cannot show the replacement fade because the ' +\n          'closest connection does not have a target block',\n      );\n    }\n    this.fadedBlock.fadeForReplacement(true);\n  }\n\n  /**\n   * Hides/Removes any visible fade affects.\n   */\n  private hideReplacementFade() {\n    if (!this.fadedBlock) return;\n\n    this.fadedBlock.fadeForReplacement(false);\n    this.fadedBlock = null;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    const result = [];\n    if (this.firstMarker) {\n      result.push(this.firstMarker);\n    }\n    if (this.lastMarker) {\n      result.push(this.lastMarker);\n    }\n    return result;\n  }\n\n  /**\n   * Safely disposes of an insertion marker.\n   */\n  private disposeInsertionMarker(marker: BlockSvg | null) {\n    if (marker) {\n      eventUtils.disable();\n      try {\n        marker.dispose();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n  }\n}\n\nexport namespace InsertionMarkerManager {\n  /**\n   * An enum describing different kinds of previews the InsertionMarkerManager\n   * could display.\n   */\n  export enum PREVIEW_TYPE {\n    INSERTION_MARKER = 0,\n    INPUT_OUTLINE = 1,\n    REPLACEMENT_FADE = 2,\n  }\n}\n\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Renderer\n\nimport type {Block} from '../../block.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {\n  InsertionMarkerManager,\n  PreviewType,\n} from '../../insertion_marker_manager.js';\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The base class for a block renderer.\n */\nexport class Renderer implements IRegistrable {\n  /** The renderer's constant provider. */\n  protected constants_!: ConstantProvider;\n\n  protected name: string;\n\n  /**\n   * Rendering constant overrides, passed in through options.\n   */\n  protected overrides: object | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Gets the class name that identifies this renderer.\n   *\n   * @returns The CSS class name.\n   */\n  getClassName(): string {\n    return this.name + '-renderer';\n  }\n\n  /**\n   * Initialize the renderer.\n   *\n   * @param theme The workspace theme object.\n   * @param opt_rendererOverrides Rendering constant overrides.\n   */\n  init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    this.constants_ = this.makeConstants_();\n    if (opt_rendererOverrides) {\n      this.overrides = opt_rendererOverrides;\n      Object.assign(this.constants_, opt_rendererOverrides);\n    }\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs.\n   * If you need to create additional DOM elements, override the\n   * {@link ConstantProvider#createDom} method instead.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  createDom(svg: SVGElement, theme: Theme) {\n    this.constants_.createDom(\n      svg,\n      this.name + '-' + theme.name,\n      '.' + this.getClassName() + '.' + theme.getClassName(),\n    );\n  }\n\n  /**\n   * Refresh the renderer after a theme change.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   */\n  refreshDom(svg: SVGElement, theme: Theme) {\n    const previousConstants = this.getConstants();\n    previousConstants.dispose();\n    this.constants_ = this.makeConstants_();\n    if (this.overrides) {\n      Object.assign(this.constants_, this.overrides);\n    }\n    // Ensure the constant provider's random identifier does not change.\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n    this.createDom(svg, theme);\n  }\n\n  /**\n   * Dispose of this renderer.\n   * Delete all DOM elements that this renderer and its constants created.\n   */\n  dispose() {\n    if (this.constants_) {\n      this.constants_.dispose();\n    }\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\n    return new Drawer(block, info);\n  }\n\n  /**\n   * Create a new instance of the renderer's marker drawer.\n   *\n   * @param workspace The workspace the marker belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\n    return new PathObject(root, style, this.constants_);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * Determine whether or not to highlight a connection.\n   *\n   * @param _conn The connection to determine whether or not to highlight.\n   * @returns True if we should highlight the connection.\n   */\n  shouldHighlightConnection(_conn: Connection): boolean {\n    return true;\n  }\n\n  /**\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\n   * block-clump. If the clump is a row the end is the last input. If the clump\n   * is a stack, the end is the last next connection. If the clump is neither,\n   * then this returns false.\n   *\n   * @param topBlock The top block of the block clump we want to try and connect\n   *     to.\n   * @param orphanBlock The orphan block that wants to find a home.\n   * @param localType The type of the connection being dragged.\n   * @returns Whether there is a home for the orphan or not.\n   */\n  protected orphanCanConnectAtEnd(\n    topBlock: BlockSvg,\n    orphanBlock: BlockSvg,\n    localType: number,\n  ): boolean {\n    const orphanConnection =\n      localType === ConnectionType.OUTPUT_VALUE\n        ? orphanBlock.outputConnection\n        : orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n      topBlock as Block,\n      orphanConnection as Connection,\n    );\n  }\n\n  /**\n   * Chooses a connection preview method based on the available connection, the\n   * current dragged connection, and the block being dragged.\n   *\n   * @param closest The available connection.\n   * @param local The connection currently being dragged.\n   * @param topBlock The block currently being dragged.\n   * @returns The preview type to display.\n   */\n  getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ): PreviewType {\n    if (\n      local.type === ConnectionType.OUTPUT_VALUE ||\n      local.type === ConnectionType.PREVIOUS_STATEMENT\n    ) {\n      if (\n        !closest.isConnected() ||\n        this.orphanCanConnectAtEnd(\n          topBlock,\n          closest.targetBlock() as BlockSvg,\n          local.type,\n        )\n      ) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n      }\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n  }\n\n  /**\n   * Render the block.\n   *\n   * @param block The block to render.\n   * @internal\n   */\n  render(block: BlockSvg) {\n    const info = this.makeRenderInfo_(block);\n    info.measure();\n    this.makeDrawer_(block, info).draw();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of storing and updating a workspace theme\n *     and UI components.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ThemeManager\n\nimport type {Theme} from './theme.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as dom from './utils/dom.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for storing and updating a workspace's theme and UI components.\n */\nexport class ThemeManager {\n  /** A list of workspaces that are subscribed to this theme. */\n  private subscribedWorkspaces_: Workspace[] = [];\n  private componentDB = new Map<string, Component[]>();\n\n  /**\n   * @param workspace The main workspace.\n   * @param theme The workspace theme.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private theme: Theme,\n  ) {}\n\n  /**\n   * Get the workspace theme.\n   *\n   * @returns The workspace theme.\n   * @internal\n   */\n  getTheme(): Theme {\n    return this.theme;\n  }\n\n  /**\n   * Set the workspace theme, and refresh the workspace and all components.\n   *\n   * @param theme The workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    const prevTheme = this.theme;\n    this.theme = theme;\n    // Set the theme name onto the injection div.\n    const injectionDiv = this.workspace.getInjectionDiv();\n    if (injectionDiv) {\n      if (prevTheme) {\n        const oldClassName = prevTheme.getClassName();\n        if (oldClassName) {\n          dom.removeClass(injectionDiv, oldClassName);\n        }\n      }\n      const newClassName = this.theme.getClassName();\n      if (newClassName) {\n        dom.addClass(injectionDiv, newClassName);\n      }\n    }\n\n    // Refresh all subscribed workspaces.\n    for (\n      let i = 0, workspace;\n      (workspace = this.subscribedWorkspaces_[i]);\n      i++\n    ) {\n      (workspace as WorkspaceSvg).refreshTheme();\n    }\n\n    // Refresh all registered Blockly UI components.\n    for (const [key, componentList] of this.componentDB) {\n      for (const component of componentList) {\n        const element = component.element;\n        const propertyName = component.propertyName;\n        const style = this.theme && this.theme.getComponentStyle(key);\n        element.style.setProperty(propertyName, style || '');\n      }\n    }\n\n    for (const workspace of this.subscribedWorkspaces_) {\n      (workspace as WorkspaceSvg).hideChaff();\n    }\n  }\n\n  /**\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\n   * set, the workspace is called to refresh its blocks.\n   *\n   * @param workspace The workspace to subscribe.\n   * @internal\n   */\n  subscribeWorkspace(workspace: Workspace) {\n    this.subscribedWorkspaces_.push(workspace);\n  }\n\n  /**\n   * Unsubscribe a workspace to changes to the selected theme.\n   *\n   * @param workspace The workspace to unsubscribe.\n   * @internal\n   */\n  unsubscribeWorkspace(workspace: Workspace) {\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces_, workspace)) {\n      throw Error(\n        \"Cannot unsubscribe a workspace that hasn't been subscribed.\",\n      );\n    }\n  }\n\n  /**\n   * Subscribe an element to changes to the selected theme.  If a new theme is\n   * selected, the element's style is refreshed with the new theme's style.\n   *\n   * @param element The element to subscribe.\n   * @param componentName The name used to identify the component. This must be\n   *     the same name used to configure the style in the Theme object.\n   * @param propertyName The inline style property name to update.\n   * @internal\n   */\n  subscribe(\n    element: HTMLElement | SVGElement,\n    componentName: string,\n    propertyName: string,\n  ) {\n    if (!this.componentDB.has(componentName)) {\n      this.componentDB.set(componentName, []);\n    }\n\n    // Add the element to our component map.\n    this.componentDB.get(componentName)!.push({element, propertyName});\n\n    // Initialize the element with its corresponding theme style.\n    const style = this.theme && this.theme.getComponentStyle(componentName);\n    element.style.setProperty(propertyName, style || '');\n  }\n\n  /**\n   * Unsubscribe an element to changes to the selected theme.\n   *\n   * @param element The element to unsubscribe.\n   * @internal\n   */\n  unsubscribe(element: HTMLElement | SVGElement) {\n    if (!element) {\n      return;\n    }\n    // Go through all component, and remove any references to this element.\n    for (const [componentName, elements] of this.componentDB) {\n      for (let i = elements.length - 1; i >= 0; i--) {\n        if (elements[i].element === element) {\n          elements.splice(i, 1);\n        }\n      }\n      // Clean up the component map entry if the list is empty.\n      if (!elements.length) {\n        this.componentDB.delete(componentName);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this theme manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.subscribedWorkspaces_.length = 0;\n    this.componentDB.clear();\n  }\n}\n\nexport namespace ThemeManager {\n  /** The type for a Blockly UI Component. */\n  export interface Component {\n    element: HTMLElement | SVGElement;\n    propertyName: string;\n  }\n}\n\nexport type Component = ThemeManager.Component;\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that encapsulates logic for checking whether a\n * potential connection is safe and valid.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionChecker\n\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n/**\n * Class for connection type checking logic.\n */\nexport class ConnectionChecker implements IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean {\n    return (\n      this.canConnectWithReason(a, b, isDragging, opt_distance) ===\n      Connection.CAN_CONNECT\n    );\n  }\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number {\n    const safety = this.doSafetyChecks(a, b);\n    if (safety !== Connection.CAN_CONNECT) {\n      return safety;\n    }\n\n    // If the safety checks passed, both connections are non-null.\n    const connOne = a!;\n    const connTwo = b!;\n    if (!this.doTypeChecks(connOne, connTwo)) {\n      return Connection.REASON_CHECKS_FAILED;\n    }\n\n    if (\n      isDragging &&\n      !this.doDragChecks(\n        a as RenderedConnection,\n        b as RenderedConnection,\n        opt_distance || 0,\n      )\n    ) {\n      return Connection.REASON_DRAG_CHECKS_FAILED;\n    }\n\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string {\n    switch (errorCode) {\n      case Connection.REASON_SELF_CONNECTION:\n        return 'Attempted to connect a block to itself.';\n      case Connection.REASON_DIFFERENT_WORKSPACES:\n        // Usually this means one block has been deleted.\n        return 'Blocks not on same workspace.';\n      case Connection.REASON_WRONG_TYPE:\n        return 'Attempt to connect incompatible types.';\n      case Connection.REASON_TARGET_NULL:\n        return 'Target connection is null.';\n      case Connection.REASON_CHECKS_FAILED: {\n        const connOne = a!;\n        const connTwo = b!;\n        let msg = 'Connection checks failed. ';\n        msg +=\n          connOne +\n          ' expected ' +\n          connOne.getCheck() +\n          ', found ' +\n          connTwo.getCheck();\n        return msg;\n      }\n      case Connection.REASON_SHADOW_PARENT:\n        return 'Connecting non-shadow to shadow block.';\n      case Connection.REASON_DRAG_CHECKS_FAILED:\n        return 'Drag checks failed.';\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\n        return 'Block would have an output and a previous connection.';\n      default:\n        return 'Unknown connection failure: this should never happen!';\n    }\n  }\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number {\n    if (!a || !b) {\n      return Connection.REASON_TARGET_NULL;\n    }\n    let superiorBlock;\n    let inferiorBlock;\n    let superiorConnection;\n    let inferiorConnection;\n    if (a.isSuperior()) {\n      superiorBlock = a.getSourceBlock();\n      inferiorBlock = b.getSourceBlock();\n      superiorConnection = a;\n      inferiorConnection = b;\n    } else {\n      inferiorBlock = a.getSourceBlock();\n      superiorBlock = b.getSourceBlock();\n      inferiorConnection = a;\n      superiorConnection = b;\n    }\n    if (superiorBlock === inferiorBlock) {\n      return Connection.REASON_SELF_CONNECTION;\n    } else if (\n      inferiorConnection.type !==\n      internalConstants.OPPOSITE_TYPE[superiorConnection.type]\n    ) {\n      return Connection.REASON_WRONG_TYPE;\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\n      return Connection.REASON_DIFFERENT_WORKSPACES;\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\n      return Connection.REASON_SHADOW_PARENT;\n    } else if (\n      inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\n      inferiorBlock.previousConnection &&\n      inferiorBlock.previousConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    } else if (\n      inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\n      inferiorBlock.outputConnection &&\n      inferiorBlock.outputConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    }\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean {\n    const checkArrayOne = a.getCheck();\n    const checkArrayTwo = b.getCheck();\n\n    if (!checkArrayOne || !checkArrayTwo) {\n      // One or both sides are promiscuous enough that anything will fit.\n      return true;\n    }\n    // Find any intersection in the check lists.\n    for (let i = 0; i < checkArrayOne.length; i++) {\n      if (checkArrayTwo.indexOf(checkArrayOne[i]) !== -1) {\n        return true;\n      }\n    }\n    // No intersection.\n    return false;\n  }\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare (on the block that's being dragged).\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean {\n    if (a.distanceFrom(b) > distance) {\n      return false;\n    }\n\n    // Don't consider insertion markers.\n    if (b.getSourceBlock().isInsertionMarker()) {\n      return false;\n    }\n\n    switch (b.type) {\n      case ConnectionType.PREVIOUS_STATEMENT:\n        return this.canConnectToPrevious_(a, b);\n      case ConnectionType.OUTPUT_VALUE: {\n        // Don't offer to connect an already connected left (male) value plug to\n        // an available right (female) value plug.\n        if (\n          (b.isConnected() && !b.targetBlock()!.isInsertionMarker()) ||\n          a.isConnected()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.INPUT_VALUE: {\n        // Offering to connect the left (male) of a value block to an already\n        // connected value pair is ok, we'll splice it in.\n        // However, don't offer to splice into an immovable block.\n        if (\n          b.isConnected() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.NEXT_STATEMENT: {\n        // Don't let a block with no next connection bump other blocks out of\n        // the stack.  But covering up a shadow block or stack of shadow blocks\n        // is fine.  Similarly, replacing a terminal statement with another\n        // terminal statement is allowed.\n        if (\n          b.isConnected() &&\n          !a.getSourceBlock().nextConnection &&\n          !b.targetBlock()!.isShadow() &&\n          b.targetBlock()!.nextConnection\n        ) {\n          return false;\n        }\n\n        // Don't offer to splice into a stack where the connected block is\n        // immovable, unless the block is a shadow block.\n        if (\n          b.targetBlock() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      default:\n        // Unexpected connection type.\n        return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Helper function for drag checking.\n   *\n   * @param a The connection to check, which must be a statement input or next\n   *     connection.\n   * @param b A nearby connection to check, which must be a previous connection.\n   * @returns True if the connection is allowed, false otherwise.\n   */\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\n    if (a.targetConnection) {\n      // This connection is already occupied.\n      // A next connection will never disconnect itself mid-drag.\n      return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    if (!b.targetConnection) {\n      return true;\n    }\n\n    const targetBlock = b.targetBlock();\n    // If it is connected to a real block, game over.\n    if (!targetBlock!.isInsertionMarker()) {\n      return false;\n    }\n    // If it's connected to an insertion marker but that insertion marker\n    // is the first block in a stack, it's still fine.  If that insertion\n    // marker is in the middle of a stack, it won't work.\n    return !targetBlock!.getPreviousBlock();\n  }\n}\n\nregistry.register(\n  registry.Type.CONNECTION_CHECKER,\n  registry.DEFAULT,\n  ConnectionChecker,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarDelete\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model has been deleted.\n *\n * @class\n */\nexport class VarDelete extends VarBase {\n  override type = eventUtils.VAR_DELETE;\n  /** The type of the variable that was deleted. */\n  varType?: string;\n  /** The name of the variable that was deleted. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The deleted variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarDeleteJson {\n    const json = super.toJson() as VarDeleteJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarDelete, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarDelete(),\n    ) as VarDelete;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.deleteVariableById(this.varId);\n    } else {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    }\n  }\n}\n\nexport interface VarDeleteJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_DELETE, VarDelete);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarRename\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a variable model was renamed.\n *\n * @class\n */\nexport class VarRename extends VarBase {\n  override type = eventUtils.VAR_RENAME;\n\n  /** The previous name of the variable. */\n  oldName?: string;\n\n  /** The new name of the variable. */\n  newName?: string;\n\n  /**\n   * @param opt_variable The renamed variable. Undefined for a blank event.\n   * @param newName The new name the variable will be changed to.\n   */\n  constructor(opt_variable?: VariableModel, newName?: string) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.oldName = opt_variable.name;\n    this.newName = typeof newName === 'undefined' ? '' : newName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarRenameJson {\n    const json = super.toJson() as VarRenameJson;\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldName'] = this.oldName;\n    json['newName'] = this.newName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarRename, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarRenameJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarRename {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarRename(),\n    ) as VarRename;\n    newEvent.oldName = json['oldName'];\n    newEvent.newName = json['newName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable rename event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.renameVariableById(this.varId, this.newName);\n    } else {\n      workspace.renameVariableById(this.varId, this.oldName);\n    }\n  }\n}\n\nexport interface VarRenameJson extends VarBaseJson {\n  oldName: string;\n  newName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_RENAME, VarRename);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a map of variables and their types.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableMap\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_delete.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_rename.js';\n\nimport type {Block} from './block.js';\nimport * as dialog from './dialog.js';\nimport * as eventUtils from './events/utils.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable map.  This contains a dictionary data structure with\n * variable types as keys and lists of variables as values.  The list of\n * variables are the type indicated by the key.\n */\nexport class VariableMap {\n  /**\n   * A map from variable type to list of variable names.  The lists contain\n   * all of the named variables in the workspace, including variables that are\n   * not currently in use.\n   */\n  private variableMap = new Map<string, VariableModel[]>();\n\n  /** @param workspace The workspace this map belongs to. */\n  constructor(public workspace: Workspace) {}\n\n  /** Clear the variable map.  Fires events for every deletion. */\n  clear() {\n    for (const variables of this.variableMap.values()) {\n      while (variables.length > 0) {\n        this.deleteVariable(variables[0]);\n      }\n    }\n    if (this.variableMap.size !== 0) {\n      throw Error('Non-empty variable map');\n    }\n  }\n\n  /* Begin functions for renaming variables. */\n  /**\n   * Rename the given variable by updating its name in the variable map.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @internal\n   */\n  renameVariable(variable: VariableModel, newName: string) {\n    if (variable.name === newName) return;\n    const type = variable.type;\n    const conflictVar = this.getVariable(newName, type);\n    const blocks = this.workspace.getAllBlocks(false);\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      // The IDs may match if the rename is a simple case change (name1 ->\n      // Name1).\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\n        this.renameVariableAndUses_(variable, newName, blocks);\n      } else {\n        this.renameVariableWithConflict_(\n          variable,\n          newName,\n          conflictVar,\n          blocks,\n        );\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    const variable = this.getVariableById(id);\n    if (!variable) {\n      throw Error(\"Tried to rename a variable that didn't exist. ID: \" + id);\n    }\n\n    this.renameVariable(variable, newName);\n  }\n\n  /**\n   * Update the name of the given variable and refresh all references to it.\n   * The new name must not conflict with any existing variable names.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableAndUses_(\n    variable: VariableModel,\n    newName: string,\n    blocks: Block[],\n  ) {\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.VAR_RENAME))(variable, newName),\n    );\n    variable.name = newName;\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].updateVarName(variable);\n    }\n  }\n\n  /**\n   * Update the name of the given variable to the same name as an existing\n   * variable.  The two variables are coalesced into a single variable with the\n   * ID of the existing variable that was already using newName. Refresh all\n   * references to the variable.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param conflictVar The variable that was already using newName.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableWithConflict_(\n    variable: VariableModel,\n    newName: string,\n    conflictVar: VariableModel,\n    blocks: Block[],\n  ) {\n    const type = variable.type;\n    const oldCase = conflictVar.name;\n\n    if (newName !== oldCase) {\n      // Simple rename to change the case and update references.\n      this.renameVariableAndUses_(conflictVar, newName, blocks);\n    }\n\n    // These blocks now refer to a different variable.\n    // These will fire change events.\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\n    }\n    // Finally delete the original variable, which is now unreferenced.\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n    // And remove it from the list.\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\n  }\n\n  /* End functions for renaming variables. */\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    let variable = this.getVariable(name, opt_type);\n    if (variable) {\n      if (opt_id && variable.getId() !== opt_id) {\n        throw Error(\n          'Variable \"' +\n            name +\n            '\" is already in use and its id is \"' +\n            variable.getId() +\n            '\" which conflicts with the passed in ' +\n            'id, \"' +\n            opt_id +\n            '\".',\n        );\n      }\n      // The variable already exists and has the same ID.\n      return variable;\n    }\n    if (opt_id && this.getVariableById(opt_id)) {\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\n    }\n    const id = opt_id || idGenerator.genUid();\n    const type = opt_type || '';\n    variable = new VariableModel(this.workspace, name, type, id);\n\n    const variables = this.variableMap.get(type) || [];\n    variables.push(variable);\n    // Delete the list of variables of this type, and re-add it so that\n    // the most recent addition is at the end.\n    // This is used so the toolbox's set block is set to the most recent\n    // variable.\n    this.variableMap.delete(type);\n    this.variableMap.set(type, variables);\n\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_CREATE))(variable));\n\n    return variable;\n  }\n\n  /* Begin functions for variable deletion. */\n  /**\n   * Delete a variable.\n   *\n   * @param variable Variable to delete.\n   */\n  deleteVariable(variable: VariableModel) {\n    const variableId = variable.getId();\n    const variableList = this.variableMap.get(variable.type);\n    if (variableList) {\n      for (let i = 0; i < variableList.length; i++) {\n        const tempVar = variableList[i];\n        if (tempVar.getId() === variableId) {\n          variableList.splice(i, 1);\n          eventUtils.fire(\n            new (eventUtils.get(eventUtils.VAR_DELETE))(variable),\n          );\n          if (variableList.length === 0) {\n            this.variableMap.delete(variable.type);\n          }\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    const variable = this.getVariableById(id);\n    if (variable) {\n      // Check whether this variable is a function parameter before deleting.\n      const variableName = variable.name;\n      const uses = this.getVariableUsesById(id);\n      for (let i = 0, block; (block = uses[i]); i++) {\n        if (\n          block.type === 'procedures_defnoreturn' ||\n          block.type === 'procedures_defreturn'\n        ) {\n          const procedureName = String(block.getFieldValue('NAME'));\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\n            .replace('%1', variableName)\n            .replace('%2', procedureName);\n          dialog.alert(deleteText);\n          return;\n        }\n      }\n\n      if (uses.length > 1) {\n        // Confirm before deleting multiple blocks.\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\n          .replace('%1', String(uses.length))\n          .replace('%2', variableName);\n        dialog.confirm(confirmText, (ok) => {\n          if (ok && variable) {\n            this.deleteVariableInternal(variable, uses);\n          }\n        });\n      } else {\n        // No confirmation necessary for a single block.\n        this.deleteVariableInternal(variable, uses);\n      }\n    } else {\n      console.warn(\"Can't delete non-existent variable: \" + id);\n    }\n  }\n\n  /**\n   * Deletes a variable and all of its uses from this workspace without asking\n   * the user for confirmation.\n   *\n   * @param variable Variable to delete.\n   * @param uses An array of uses of the variable.\n   * @internal\n   */\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      for (let i = 0; i < uses.length; i++) {\n        uses[i].dispose(true);\n      }\n      this.deleteVariable(variable);\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n  /* End functions for variable deletion. */\n  /**\n   * Find the variable by the given name and type and return it.  Return null if\n   *     it is not found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name, or null if it was not found.\n   */\n  getVariable(name: string, opt_type?: string | null): VariableModel | null {\n    const type = opt_type || '';\n    const list = this.variableMap.get(type);\n    if (list) {\n      for (let j = 0, variable; (variable = list[j]); j++) {\n        if (Names.equals(variable.name, name)) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the variable by the given ID and return it.  Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    for (const variables of this.variableMap.values()) {\n      for (const variable of variables) {\n        if (variable.getId() === id) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get a list containing all of the variables of a specified type. If type is\n   *     null, return list of variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    type = type || '';\n    const variableList = this.variableMap.get(type);\n    if (variableList) {\n      return variableList.slice();\n    }\n    return [];\n  }\n\n  /**\n   * Return all variable and potential variable types.  This list always\n   * contains the empty string.\n   *\n   * @param ws The workspace used to look for potential variables. This can be\n   *     different than the workspace stored on this object if the passed in ws\n   *     is a flyout workspace.\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(ws: Workspace | null): string[] {\n    const variableTypes = new Set<string>(this.variableMap.keys());\n    if (ws && ws.getPotentialVariableMap()) {\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\n        variableTypes.add(key);\n      }\n    }\n    if (!variableTypes.has('')) {\n      variableTypes.add('');\n    }\n    return Array.from(variableTypes.values());\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    let allVariables: VariableModel[] = [];\n    for (const variables of this.variableMap.values()) {\n      allVariables = allVariables.concat(variables);\n    }\n    return allVariables;\n  }\n\n  /**\n   * Returns all of the variable names of all types.\n   *\n   * @returns All of the variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return Array.from(this.variableMap.values())\n      .flat()\n      .map((variable) => variable.name);\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    const uses = [];\n    const blocks = this.workspace.getAllBlocks(false);\n    // Iterate through every block and check the name.\n    for (let i = 0; i < blocks.length; i++) {\n      const blockVariables = blocks[i].getVarModels();\n      if (blockVariables) {\n        for (let j = 0; j < blockVariables.length; j++) {\n          if (blockVariables[j].getId() === id) {\n            uses.push(blocks[i]);\n          }\n        }\n      }\n    }\n    return uses;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Workspace\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './connection_checker.js';\n\nimport type {Block} from './block.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport * as common from './common.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {Options} from './options.js';\nimport * as registry from './registry.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as math from './utils/math.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {WorkspaceComment} from './workspace_comment.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\n\n/**\n * Class for a workspace.  This is a data structure that contains blocks.\n * There is no UI, and can be created headlessly.\n */\nexport class Workspace implements IASTNodeLocation {\n  /**\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\n   * generally top to bottom, but a small angle changes the scan to give a bit\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\n   */\n  static SCAN_ANGLE = 3;\n  id: string;\n  options: Options;\n  RTL: boolean;\n  horizontalLayout: boolean;\n  toolboxPosition: toolbox.Position;\n\n  /**\n   * Returns `true` if the workspace is visible and `false` if it's headless.\n   */\n  rendered = false;\n\n  /**\n   * Is this workspace the surface for a flyout?\n   *\n   * @internal\n   */\n  internalIsFlyout = false;\n\n  /** Is this workspace the surface for a flyout? */\n  get isFlyout(): boolean {\n    return this.internalIsFlyout;\n  }\n\n  /**\n   * Is this workspace the surface for a mutator?\n   *\n   * @internal\n   */\n  internalIsMutator = false;\n\n  /** Is this workspace the surface for a mutator? */\n  get isMutator(): boolean {\n    return this.internalIsMutator;\n  }\n\n  /**\n   * Returns `true` if the workspace is currently in the process of a bulk\n   * clear.\n   *\n   * @internal\n   */\n  isClearing = false;\n\n  /**\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\n   * sets it to unlimited.\n   */\n  MAX_UNDO = 1024;\n\n  /** Set of databases for rapid lookup of connection locations. */\n  connectionDBList: ConnectionDB[] = [];\n  connectionChecker: IConnectionChecker;\n\n  private readonly topBlocks: Block[] = [];\n  private readonly topComments: WorkspaceComment[] = [];\n  private readonly commentDB = new Map<string, WorkspaceComment>();\n  private readonly listeners: Function[] = [];\n  protected undoStack_: Abstract[] = [];\n  protected redoStack_: Abstract[] = [];\n  private readonly blockDB = new Map<string, Block>();\n  private readonly typedBlocksDB = new Map<string, Block[]>();\n  private variableMap: VariableMap;\n  private procedureMap: IProcedureMap = new ObservableProcedureMap();\n\n  /**\n   * Blocks in the flyout can refer to variables that don't exist in the main\n   * workspace.  For instance, the \"get item in list\" block refers to an\n   * \"item\" variable regardless of whether the variable has been created yet.\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\n   * these by tracking \"potential\" variables in the flyout.  These variables\n   * become real when references to them are dragged into the main workspace.\n   */\n  private potentialVariableMap: VariableMap | null = null;\n\n  /** @param opt_options Dictionary of options. */\n  constructor(opt_options?: Options) {\n    this.id = idGenerator.genUid();\n    common.registerWorkspace(this);\n    this.options = opt_options || new Options({} as BlocklyOptions);\n    this.RTL = !!this.options.RTL;\n    this.horizontalLayout = !!this.options.horizontalLayout;\n    this.toolboxPosition = this.options.toolboxPosition;\n\n    const connectionCheckerClass = registry.getClassFromOptions(\n      registry.Type.CONNECTION_CHECKER,\n      this.options,\n      true,\n    );\n    /**\n     * An object that encapsulates logic for safety, type, and dragging checks.\n     */\n    this.connectionChecker = new connectionCheckerClass!(this);\n\n    /**\n     * A map from variable type to list of variable names.  The lists contain\n     * all of the named variables in the workspace, including variables that are\n     * not currently in use.\n     */\n    this.variableMap = new VariableMap(this);\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.listeners.length = 0;\n    this.clear();\n    // Remove from workspace database.\n    common.unregisterWorkpace(this);\n  }\n\n  /**\n   * Compare function for sorting objects (blocks, comments, etc) by position;\n   *    top to bottom (with slight LTR or RTL bias).\n   *\n   * @param a The first object to compare.\n   * @param b The second object to compare.\n   * @returns The comparison value. This tells Array.sort() how to change object\n   *     a's index.\n   */\n  private sortObjects_(\n    a: Block | WorkspaceComment,\n    b: Block | WorkspaceComment,\n  ): number {\n    const offset =\n      Math.sin(math.toRadians(Workspace.SCAN_ANGLE)) * (this.RTL ? -1 : 1);\n    const aXY = a.getRelativeToSurfaceXY();\n    const bXY = b.getRelativeToSurfaceXY();\n    return aXY.y + offset * aXY.x - (bXY.y + offset * bXY.x);\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  addTopBlock(block: Block) {\n    this.topBlocks.push(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  removeTopBlock(block: Block) {\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\n      throw Error(\"Block not present in workspace's list of top-most blocks.\");\n    }\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  getTopBlocks(ordered = false): Block[] {\n    // Copy the topBlocks list.\n    const blocks = new Array<Block>().concat(this.topBlocks);\n    if (ordered && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n    return blocks;\n  }\n\n  /**\n   * Add a block to the list of blocks keyed by type.\n   *\n   * @param block Block to add.\n   */\n  addTypedBlock(block: Block) {\n    if (!this.typedBlocksDB.has(block.type)) {\n      this.typedBlocksDB.set(block.type, []);\n    }\n    this.typedBlocksDB.get(block.type)!.push(block);\n  }\n\n  /**\n   * Remove a block from the list of blocks keyed by type.\n   *\n   * @param block Block to remove.\n   */\n  removeTypedBlock(block: Block) {\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\n    if (!this.typedBlocksDB.get(block.type)!.length) {\n      this.typedBlocksDB.delete(block.type);\n    }\n  }\n\n  /**\n   * Finds the blocks with the associated type and returns them. Blocks are\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param type The type of block to search for.\n   * @param ordered Sort the list if true.\n   * @returns The blocks of the given type.\n   */\n  getBlocksByType(type: string, ordered = false): Block[] {\n    if (!this.typedBlocksDB.has(type)) {\n      return [];\n    }\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\n    if (ordered && blocks && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n\n    return blocks.filter(function (block: Block) {\n      return !block.isInsertionMarker();\n    });\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   * @internal\n   */\n  addTopComment(comment: WorkspaceComment) {\n    this.topComments.push(comment);\n\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    if (this.commentDB.has(comment.id)) {\n      console.warn(\n        'Overriding an existing comment on this workspace, with id \"' +\n          comment.id +\n          '\"',\n      );\n    }\n    this.commentDB.set(comment.id, comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   * @internal\n   */\n  removeTopComment(comment: WorkspaceComment) {\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\n      throw Error(\n        \"Comment not present in workspace's list of top-most \" + 'comments.',\n      );\n    }\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    this.commentDB.delete(comment.id);\n  }\n\n  /**\n   * Finds the top-level comments and returns them.  Comments are optionally\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level comment objects.\n   * @internal\n   */\n  getTopComments(ordered = false): WorkspaceComment[] {\n    // Copy the topComments list.\n    const comments = new Array<WorkspaceComment>().concat(this.topComments);\n    if (ordered && comments.length > 1) {\n      comments.sort(this.sortObjects_.bind(this));\n    }\n    return comments;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getAllBlocks(ordered = false): Block[] {\n    let blocks: Block[];\n    if (ordered) {\n      // Slow, but ordered.\n      const topBlocks = this.getTopBlocks(true);\n      blocks = [];\n      for (let i = 0; i < topBlocks.length; i++) {\n        blocks.push(...topBlocks[i].getDescendants(true));\n      }\n    } else {\n      // Fast, but in no particular order.\n      blocks = this.getTopBlocks(false);\n      for (let i = 0; i < blocks.length; i++) {\n        blocks.push(...blocks[i].getChildren(false));\n      }\n    }\n\n    // Insertion markers exist on the workspace for rendering reasons, but\n    // aren't \"real\" blocks from a developer perspective.\n    const filtered = blocks.filter(function (block) {\n      return !block.isInsertionMarker();\n    });\n\n    return filtered;\n  }\n\n  /** Dispose of all blocks and comments in workspace. */\n  clear() {\n    this.isClearing = true;\n    try {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      while (this.topBlocks.length) {\n        this.topBlocks[0].dispose(false);\n      }\n      while (this.topComments.length) {\n        this.topComments[this.topComments.length - 1].dispose();\n      }\n      eventUtils.setGroup(existingGroup);\n      this.variableMap.clear();\n      if (this.potentialVariableMap) {\n        this.potentialVariableMap.clear();\n      }\n    } finally {\n      this.isClearing = false;\n    }\n  }\n\n  /* Begin functions that are just pass-throughs to the variable map. */\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    this.variableMap.renameVariableById(id, newName);\n  }\n\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    return this.variableMap.createVariable(name, opt_type, opt_id);\n  }\n\n  /**\n   * Find all the uses of the given variable, which is identified by ID.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    return this.variableMap.getVariableUsesById(id);\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    this.variableMap.deleteVariableById(id);\n  }\n\n  /**\n   * Find the variable by the given name and return it. Return null if not\n   * found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name.\n   */\n  getVariable(name: string, opt_type?: string): VariableModel | null {\n    // TODO (#1559): Possibly delete this function after resolving #1559.\n    return this.variableMap.getVariable(name, opt_type);\n  }\n\n  /**\n   * Find the variable by the given ID and return it. Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    return this.variableMap.getVariableById(id);\n  }\n\n  /**\n   * Find the variable with the specified type. If type is null, return list of\n   *     variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    return this.variableMap.getVariablesOfType(type);\n  }\n\n  /**\n   * Return all variable types.\n   *\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(): string[] {\n    return this.variableMap.getVariableTypes(this);\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    return this.variableMap.getAllVariables();\n  }\n\n  /**\n   * Returns all variable names of all types.\n   *\n   * @returns List of all variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return this.variableMap.getAllVariableNames();\n  }\n  /* End functions that are just pass-throughs to the variable map. */\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   * Not relevant for a headless workspace.\n   *\n   * @returns Width.\n   */\n  getWidth(): number {\n    return 0;\n  }\n\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  newBlock(prototypeName: string, opt_id?: string): Block {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * The number of blocks that may be added to the workspace before reaching\n   *     the maxBlocks.\n   *\n   * @returns Number of blocks left.\n   */\n  remainingCapacity(): number {\n    if (isNaN(this.options.maxBlocks)) {\n      return Infinity;\n    }\n\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\n  }\n\n  /**\n   * The number of blocks of the given type that may be added to the workspace\n   *    before reaching the maxInstances allowed for that type.\n   *\n   * @param type Type of block to return capacity for.\n   * @returns Number of blocks of type left.\n   */\n  remainingCapacityOfType(type: string): number {\n    if (!this.options.maxInstances) {\n      return Infinity;\n    }\n\n    const maxInstanceOfType =\n      this.options.maxInstances[type] !== undefined\n        ? this.options.maxInstances[type]\n        : Infinity;\n\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\n  }\n\n  /**\n   * Check if there is remaining capacity for blocks of the given counts to be\n   *    created. If the total number of blocks represented by the map is more\n   * than the total remaining capacity, it returns false. If a type count is\n   * more than the remaining capacity for that type, it returns false.\n   *\n   * @param typeCountsMap A map of types to counts (usually representing blocks\n   *     to be created).\n   * @returns True if there is capacity for the given map, false otherwise.\n   */\n  isCapacityAvailable(typeCountsMap: {[key: string]: number}): boolean {\n    if (!this.hasBlockLimits()) {\n      return true;\n    }\n    let copyableBlocksCount = 0;\n    for (const type in typeCountsMap) {\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\n        return false;\n      }\n      copyableBlocksCount += typeCountsMap[type];\n    }\n    if (copyableBlocksCount > this.remainingCapacity()) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Checks if the workspace has any limits on the maximum number of blocks,\n   *    or the maximum number of blocks of specific types.\n   *\n   * @returns True if it has block limits, false otherwise.\n   */\n  hasBlockLimits(): boolean {\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\n  }\n\n  /**\n   * Gets the undo stack for workplace.\n   *\n   * @returns undo stack\n   * @internal\n   */\n  getUndoStack(): Abstract[] {\n    return this.undoStack_;\n  }\n\n  /**\n   * Gets the redo stack for workplace.\n   *\n   * @returns redo stack\n   * @internal\n   */\n  getRedoStack(): Abstract[] {\n    return this.redoStack_;\n  }\n\n  /**\n   * Undo or redo the previous action.\n   *\n   * @param redo False if undo, true if redo.\n   */\n  undo(redo: boolean) {\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\n    const inputEvent = inputStack.pop();\n    if (!inputEvent) {\n      return;\n    }\n    let events = [inputEvent];\n    // Do another undo/redo if the next one is of the same group.\n    while (\n      inputStack.length &&\n      inputEvent.group &&\n      inputEvent.group === inputStack[inputStack.length - 1].group\n    ) {\n      const event = inputStack.pop();\n      if (!event) continue;\n      events.push(event);\n    }\n    // Push these popped events on the opposite stack.\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n      outputStack.push(event);\n    }\n    events = eventUtils.filter(events, redo);\n    eventUtils.setRecordUndo(false);\n    try {\n      for (let i = 0; i < events.length; i++) {\n        const event = events[i];\n        event.run(redo);\n      }\n    } finally {\n      eventUtils.setRecordUndo(true);\n    }\n  }\n\n  /** Clear the undo/redo stacks. */\n  clearUndo() {\n    this.undoStack_.length = 0;\n    this.redoStack_.length = 0;\n    // Stop any events already in the firing queue from being undoable.\n    eventUtils.clearPendingUndo();\n  }\n\n  /**\n   * When something in this workspace changes, call a function.\n   * Note that there may be a few recent events already on the stack.  Thus the\n   * new change listener might be called with events that occurred a few\n   * milliseconds before the change listener was added.\n   *\n   * @param func Function to call.\n   * @returns Obsolete return value, ignore.\n   */\n  addChangeListener(func: (e: Abstract) => void): Function {\n    this.listeners.push(func);\n    return func;\n  }\n\n  /**\n   * Stop listening for this workspace's changes.\n   *\n   * @param func Function to stop calling.\n   */\n  removeChangeListener(func: Function) {\n    arrayUtils.removeElem(this.listeners, func);\n  }\n\n  /**\n   * Fire a change event.\n   *\n   * @param event Event to fire.\n   */\n  fireChangeListener(event: Abstract) {\n    if (event.recordUndo) {\n      this.undoStack_.push(event);\n      this.redoStack_.length = 0;\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\n        this.undoStack_.shift();\n      }\n    }\n    for (let i = 0; i < this.listeners.length; i++) {\n      const func = this.listeners[i];\n      func(event);\n    }\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  getBlockById(id: string): Block | null {\n    return this.blockDB.get(id) || null;\n  }\n\n  /**\n   * Set a block on this workspace with the specified ID.\n   *\n   * @param id ID of block to set.\n   * @param block The block to set.\n   * @internal\n   */\n  setBlockById(id: string, block: Block) {\n    this.blockDB.set(id, block);\n  }\n\n  /**\n   * Delete a block off this workspace with the specified ID.\n   *\n   * @param id ID of block to delete.\n   * @internal\n   */\n  removeBlockById(id: string) {\n    this.blockDB.delete(id);\n  }\n\n  /**\n   * Find the comment on this workspace with the specified ID.\n   *\n   * @param id ID of comment to find.\n   * @returns The sought after comment, or null if not found.\n   * @internal\n   */\n  getCommentById(id: string): WorkspaceComment | null {\n    return this.commentDB.get(id) ?? null;\n  }\n\n  /**\n   * Checks whether all value and statement inputs in the workspace are filled\n   * with blocks.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    const blocks = this.getTopBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i];\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return the variable map that contains \"potential\" variables.\n   * These exist in the flyout but not in the workspace.\n   *\n   * @returns The potential variable map.\n   * @internal\n   */\n  getPotentialVariableMap(): VariableMap | null {\n    return this.potentialVariableMap;\n  }\n\n  /**\n   * Create and store the potential variable map for this workspace.\n   *\n   * @internal\n   */\n  createPotentialVariableMap() {\n    this.potentialVariableMap = new VariableMap(this);\n  }\n\n  /**\n   * Return the map of all variables on the workspace.\n   *\n   * @returns The variable map.\n   */\n  getVariableMap(): VariableMap {\n    return this.variableMap;\n  }\n\n  /**\n   * Set the map of all variables on the workspace.\n   *\n   * @param variableMap The variable map.\n   * @internal\n   */\n  setVariableMap(variableMap: VariableMap) {\n    this.variableMap = variableMap;\n  }\n\n  /** Returns the map of all procedures on the workpace. */\n  getProcedureMap(): IProcedureMap {\n    return this.procedureMap;\n  }\n\n  /**\n   * Returns the root workspace of this workspace if the workspace has\n   * parent(s).\n   *\n   * E.g. workspaces in flyouts and mini workspace bubbles have parent\n   * workspaces.\n   */\n  getRootWorkspace(): Workspace | null {\n    let outerWs = null;\n    const parent = this.options.parentWorkspace;\n    // If we were in a flyout in a mutator, need to go up two levels to find\n    // the actual parent.\n    if (this.isFlyout) {\n      if (parent && parent.options) {\n        outerWs = parent.options.parentWorkspace;\n      }\n    } else if (parent) {\n      outerWs = parent;\n    }\n    return outerWs;\n  }\n\n  /**\n   * Find the workspace with the specified ID.\n   *\n   * @param id ID of workspace to find.\n   * @returns The sought after workspace or null if not found.\n   */\n  static getById(id: string): Workspace | null {\n    return common.getWorkspaceById(id);\n  }\n\n  /**\n   * Find all workspaces.\n   *\n   * @returns Array of workspaces.\n   */\n  static getAll(): Workspace[] {\n    return common.getAllWorkspaces();\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of loading, storing, and playing audio for a\n *     workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceAudio\n\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Prevent a sound from playing if another sound preceded it within this many\n * milliseconds.\n */\nconst SOUND_LIMIT = 100;\n\n/**\n * Class for loading, storing, and playing audio for a workspace.\n */\nexport class WorkspaceAudio {\n  /** Database of pre-loaded sounds. */\n  private sounds = new Map<string, HTMLAudioElement>();\n\n  /** Time that the last sound was played. */\n  private lastSound_: Date | null = null;\n\n  /**\n   * @param parentWorkspace The parent of the workspace this audio object\n   *     belongs to, or null.\n   */\n  constructor(private parentWorkspace: WorkspaceSvg) {}\n\n  /**\n   * Dispose of this audio manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.sounds.clear();\n  }\n\n  /**\n   * Load an audio file.  Cache it, ready for instantaneous playing.\n   *\n   * @param filenames List of file types in decreasing order of preference (i.e.\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\n   *     include path from Blockly's root.  File extensions matter.\n   * @param name Name of sound.\n   */\n  load(filenames: string[], name: string) {\n    if (!filenames.length) {\n      return;\n    }\n    let audioTest;\n    try {\n      audioTest = new globalThis['Audio']();\n    } catch (e) {\n      // No browser support for Audio.\n      // IE can throw an error even if the Audio object exists.\n      return;\n    }\n    let sound;\n    for (let i = 0; i < filenames.length; i++) {\n      const filename = filenames[i];\n      const ext = filename.match(/\\.(\\w+)$/);\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\n        // Found an audio format we can play.\n        sound = new globalThis['Audio'](filename);\n        break;\n      }\n    }\n    if (sound) {\n      this.sounds.set(name, sound);\n    }\n  }\n\n  /**\n   * Preload all the audio files so that they play quickly when asked for.\n   *\n   * @internal\n   */\n  preload() {\n    for (const sound of this.sounds.values()) {\n      sound.volume = 0.01;\n      const playPromise = sound.play();\n      // Edge does not return a promise, so we need to check.\n      if (playPromise !== undefined) {\n        // If we don't wait for the play request to complete before calling\n        // pause() we will get an exception: (DOMException: The play() request\n        // was interrupted) See more:\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\n        playPromise.then(sound.pause).catch(\n          // Play without user interaction was prevented.\n          function () {},\n        );\n      } else {\n        sound.pause();\n      }\n\n      // iOS can only process one sound at a time.  Trying to load more than one\n      // corrupts the earlier ones.  Just load one and leave the others\n      // uncached.\n      if (userAgent.IPAD || userAgent.IPHONE) {\n        break;\n      }\n    }\n  }\n\n  /**\n   * Play a named sound at specified volume.  If volume is not specified,\n   * use full volume (1).\n   *\n   * @param name Name of sound.\n   * @param opt_volume Volume of sound (0-1).\n   */\n  play(name: string, opt_volume?: number) {\n    const sound = this.sounds.get(name);\n    if (sound) {\n      // Don't play one sound on top of another.\n      const now = new Date();\n      if (\n        this.lastSound_ !== null &&\n        now.getTime() - this.lastSound_.getTime() < SOUND_LIMIT\n      ) {\n        return;\n      }\n      this.lastSound_ = now;\n      let mySound;\n      if (userAgent.IPAD || userAgent.ANDROID) {\n        // Creating a new audio node causes lag in Android and iPad.  Android\n        // refetches the file from the server, iPad uses a singleton audio\n        // node which must be deleted and recreated for each new audio tag.\n        mySound = sound;\n      } else {\n        mySound = sound.cloneNode() as HTMLAudioElement;\n      }\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\n      mySound.play();\n    } else if (this.parentWorkspace) {\n      // Maybe a workspace on a lower level knows about this sound.\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {IRenderedElement} from './interfaces/i_rendered_element.js';\nimport * as layerNums from './layers.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/** @internal */\nexport class LayerManager {\n  /** The layer elements being dragged are appended to. */\n  private dragLayer: SVGGElement | undefined;\n  /** The layers elements not being dragged are appended to.  */\n  private layers = new Map<number, SVGGElement>();\n\n  /** @internal */\n  constructor(private workspace: WorkspaceSvg) {\n    const injectionDiv = workspace.getInjectionDiv();\n    // `getInjectionDiv` is actually nullable. We hit this if the workspace\n    // is part of a flyout and the workspace the flyout is attached to hasn't\n    // been appended yet.\n    if (injectionDiv) {\n      this.dragLayer = this.createDragLayer(injectionDiv);\n    }\n\n    // We construct these manually so we can add the css class for backwards\n    // compatibility.\n    const blockLayer = this.createLayer(layerNums.BLOCK);\n    dom.addClass(blockLayer, 'blocklyBlockCanvas');\n    const bubbleLayer = this.createLayer(layerNums.BUBBLE);\n    dom.addClass(bubbleLayer, 'blocklyBubbleCanvas');\n  }\n\n  private createDragLayer(injectionDiv: Element) {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'class': 'blocklyBlockDragSurface',\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n    });\n    injectionDiv.append(svg);\n    return dom.createSvgElement(Svg.G, {}, svg);\n  }\n\n  /**\n   * Translates layers when the workspace is dragged or zoomed.\n   *\n   * @internal\n   */\n  translateLayers(newCoord: Coordinate, newScale: number) {\n    const translation = `translate(${newCoord.x}, ${newCoord.y}) scale(${newScale})`;\n    this.dragLayer?.setAttribute('transform', translation);\n    for (const [_, layer] of this.layers) {\n      layer.setAttribute('transform', translation);\n    }\n  }\n\n  /**\n   * Moves the given element to the drag layer, which exists on top of all other\n   * layers, and the drag surface.\n   *\n   * @internal\n   */\n  moveToDragLayer(elem: IRenderedElement) {\n    this.dragLayer?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Moves the given element off of the drag layer.\n   *\n   * @internal\n   */\n  moveOffDragLayer(elem: IRenderedElement, layerNum: number) {\n    this.append(elem, layerNum);\n  }\n\n  /**\n   * Appends the given element to a layer. If the layer does not exist, it is\n   * created.\n   *\n   * @internal\n   */\n  append(elem: IRenderedElement, layerNum: number) {\n    if (!this.layers.has(layerNum)) {\n      this.createLayer(layerNum);\n    }\n    this.layers.get(layerNum)?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Creates a layer and inserts it at the proper place given the layer number.\n   *\n   * More positive layers exist later in the dom and are rendered ontop of\n   * less positive layers. Layers are added to the layer map as a side effect.\n   */\n  private createLayer(layerNum: number): SVGGElement {\n    const parent = this.workspace.getSvgGroup();\n    const layer = dom.createSvgElement(Svg.G, {});\n\n    let inserted = false;\n    const sortedLayers = [...this.layers].sort((a, b) => a[0] - b[0]);\n    for (const [num, sib] of sortedLayers) {\n      if (layerNum < num) {\n        parent.insertBefore(layer, sib);\n        inserted = true;\n        break;\n      }\n    }\n    if (!inserted) {\n      parent.appendChild(layer);\n    }\n    this.layers.set(layerNum, layer);\n    return layer;\n  }\n\n  /**\n   * Returns true if the given element is a layer managed by the layer manager.\n   * False otherwise.\n   *\n   * @internal\n   */\n  hasLayer(elem: SVGElement) {\n    return (\n      elem === this.dragLayer ||\n      new Set(this.layers.values()).has(elem as SVGGElement)\n    );\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBlockLayer(): SVGGElement {\n    return this.layers.get(layerNums.BLOCK)!;\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBubbleLayer(): SVGGElement {\n    return this.layers.get(layerNums.BUBBLE)!;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of trashcan flyout open and close.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.TrashcanOpen\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when the trashcan is opening or closing.\n */\nexport class TrashcanOpen extends UiBase {\n  /**\n   * True if the trashcan is currently opening (previously closed).\n   * False if it is currently closing (previously open).\n   */\n  isOpen?: boolean;\n  override type = eventUtils.TRASHCAN_OPEN;\n\n  /**\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\n   *     opening). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.isOpen = opt_isOpen;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): TrashcanOpenJson {\n    const json = super.toJson() as TrashcanOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this is already open or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of TrashcanOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: TrashcanOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): TrashcanOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new TrashcanOpen(),\n    ) as TrashcanOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface TrashcanOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.TRASHCAN_OPEN, TrashcanOpen);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block delete event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDelete\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * deleted.\n */\nexport class BlockDelete extends BlockBase {\n  /** The XML representation of the deleted block(s). */\n  oldXml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the deleted block(s). */\n  oldJson?: blocks.State;\n\n  /** All of the IDs of deleted blocks. */\n  ids?: string[];\n\n  /** True if the deleted block was a shadow block, false otherwise. */\n  wasShadow?: boolean;\n\n  override type = eventUtils.BLOCK_DELETE;\n\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.getParent()) {\n      throw Error('Connected blocks cannot be deleted.');\n    }\n    if (opt_block.isShadow()) {\n      // Respawning shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n    this.wasShadow = opt_block.isShadow();\n    this.oldJson = blocks.save(opt_block, {\n      addCoordinates: true,\n    }) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDeleteJson {\n    const json = super.toJson() as BlockDeleteJson;\n    if (!this.oldXml) {\n      throw new Error(\n        'The old block XML is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.wasShadow === undefined) {\n      throw new Error(\n        'Whether the block was a shadow is undefined. Either ' +\n          'pass a block to the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    json['oldXml'] = Xml.domToText(this.oldXml);\n    json['ids'] = this.ids;\n    json['wasShadow'] = this.wasShadow;\n    json['oldJson'] = this.oldJson;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDelete(),\n    ) as BlockDelete;\n    newEvent.oldXml = utilsXml.textToDom(json['oldXml']);\n    newEvent.ids = json['ids'];\n    newEvent.wasShadow =\n      json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\n    newEvent.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't delete non-existent block: \" + id);\n        }\n      }\n    } else {\n      blocks.append(this.oldJson, workspace);\n    }\n  }\n}\n\nexport interface BlockDeleteJson extends BlockBaseJson {\n  oldXml: string;\n  ids: string[];\n  wasShadow: boolean;\n  oldJson: blocks.State;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.DELETE, BlockDelete);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing one block.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Block\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_delete.js';\n\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport {DuplicateIconType} from './icons/exceptions.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport * as Extensions from './extensions.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Input} from './inputs/input.js';\nimport {Align} from './inputs/align.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IDeletable} from './interfaces/i_deletable.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport {CommentIcon} from './icons/comment_icon.js';\nimport type {MutatorIcon} from './icons/mutator_icon.js';\nimport * as Tooltip from './tooltip.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as parsing from './utils/parsing.js';\nimport * as registry from './registry.js';\nimport {Size} from './utils/size.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {ValueInput} from './inputs/value_input.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {IconType} from './icons/icon_types.js';\n\n/**\n * Class for one block.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class Block implements IASTNodeLocation, IDeletable {\n  /**\n   * An optional callback method to use whenever the block's parent workspace\n   * changes. This is usually only called from the constructor, the block type\n   * initializer function, or an extension initializer function.\n   */\n  onchange?: ((p1: Abstract) => void) | null;\n\n  /** The language-neutral ID given to the collapsed input. */\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\n\n  /** The language-neutral ID given to the collapsed field. */\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\n\n  /**\n   * Optional text data that round-trips between blocks and XML.\n   * Has no effect. May be used by 3rd parties for meta information.\n   */\n  data: string | null = null;\n\n  /**\n   * Has this block been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /**\n   * Colour of the block as HSV hue value (0-360)\n   * This may be null if the block colour was not set via a hue number.\n   */\n  private hue_: number | null = null;\n\n  /** Colour of the block in '#RRGGBB' format. */\n  protected colour_ = '#000000';\n\n  /** Name of the block style. */\n  protected styleName_ = '';\n\n  /** An optional method called during initialization. */\n  init?: () => void;\n\n  /** An optional method called during disposal. */\n  destroy?: () => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * mutation state to XML. This must be coupled with defining\n   * `domToMutation`.\n   */\n  mutationToDom?: (...p1: AnyDuringMigration[]) => Element;\n\n  /**\n   * An optional deserialization method for defining how to deserialize the\n   * mutation state from XML. This must be coupled with defining\n   * `mutationToDom`.\n   */\n  domToMutation?: (p1: Element) => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * block's extra state (eg mutation state) to something JSON compatible.\n   * This must be coupled with defining `loadExtraState`.\n   *\n   * @param doFullSerialization Whether or not to serialize the full state of\n   *     the extra state (rather than possibly saving a reference to some\n   *     state). This is used during copy-paste. See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/extensions#full_serialization_and_backing_data | block serialization docs}\n   *     for more information.\n   */\n  saveExtraState?: (doFullSerialization?: boolean) => AnyDuringMigration;\n\n  /**\n   * An optional serialization method for defining how to deserialize the\n   * block's extra state (eg mutation state) from something JSON compatible.\n   * This must be coupled with defining `saveExtraState`.\n   */\n  loadExtraState?: (p1: AnyDuringMigration) => void;\n\n  /**\n   * An optional property for suppressing adding STATEMENT_PREFIX and\n   * STATEMENT_SUFFIX to generated code.\n   */\n  suppressPrefixSuffix: boolean | null = false;\n\n  /**\n   * An optional property for declaring developer variables.  Return a list of\n   * variable names for use by generators.  Developer variables are never\n   * shown to the user, but are declared as global variables in the generated\n   * code.\n   */\n  getDeveloperVariables?: () => string[];\n\n  /**\n   * An optional function that reconfigures the block based on the contents of\n   * the mutator dialog.\n   */\n  compose?: (p1: Block) => void;\n\n  /**\n   * An optional function that populates the mutator's dialog with\n   * this block's components.\n   */\n  decompose?: (p1: Workspace) => Block;\n  id: string;\n  outputConnection: Connection | null = null;\n  nextConnection: Connection | null = null;\n  previousConnection: Connection | null = null;\n  inputList: Input[] = [];\n  inputsInline?: boolean;\n  icons: IIcon[] = [];\n  private disabled = false;\n  tooltip: Tooltip.TipInfo = '';\n  contextMenu = true;\n\n  protected parentBlock_: this | null = null;\n\n  protected childBlocks_: this[] = [];\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n\n  private isShadow_ = false;\n\n  protected collapsed_ = false;\n  protected outputShape_: number | null = null;\n\n  /**\n   * Is the current block currently in the process of being disposed?\n   */\n  private disposing = false;\n\n  private readonly xy_: Coordinate;\n  isInFlyout: boolean;\n  isInMutator: boolean;\n  RTL: boolean;\n\n  /** True if this block is an insertion marker. */\n  protected isInsertionMarker_ = false;\n\n  /** Name of the type of hat. */\n  hat?: string;\n\n  rendered: boolean | null = null;\n\n  /**\n   * String for block help, or function that returns a URL. Null for no help.\n   */\n  helpUrl: string | Function | null = null;\n\n  /** A bound callback function to use when the parent workspace changes. */\n  private onchangeWrapper_: ((p1: Abstract) => void) | null = null;\n\n  /**\n   * A count of statement inputs on the block.\n   *\n   * @internal\n   */\n  statementInputCount = 0;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  type!: string;\n  // Record initial inline state.\n  inputsInlineDefault?: boolean;\n  workspace: Workspace;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @throws When the prototypeName is not valid or not allowed.\n   */\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\n    this.workspace = workspace;\n\n    this.id =\n      opt_id && !workspace.getBlockById(opt_id) ? opt_id : idGenerator.genUid();\n    workspace.setBlockById(this.id, this);\n\n    /**\n     * The block's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n    this.isInFlyout = workspace.isFlyout;\n    this.isInMutator = workspace.isMutator;\n\n    this.RTL = workspace.RTL;\n\n    // Copy the type-specific functions and data from the prototype.\n    if (prototypeName) {\n      this.type = prototypeName;\n      const prototype = Blocks[prototypeName];\n      if (!prototype || typeof prototype !== 'object') {\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\n      }\n      Object.assign(this, prototype);\n    }\n\n    workspace.addTopBlock(this);\n    workspace.addTypedBlock(this);\n\n    if (new.target === Block) {\n      this.doInit_();\n    }\n  }\n\n  /** Calls the init() function and handles associated event firing, etc. */\n  protected doInit_() {\n    // All events fired should be part of the same group.\n    // Any events fired during init should not be undoable,\n    // so that block creation is atomic.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    const initialUndoFlag = eventUtils.getRecordUndo();\n\n    try {\n      // Call an initialization function, if it exists.\n      if (typeof this.init === 'function') {\n        eventUtils.setRecordUndo(false);\n        this.init();\n        eventUtils.setRecordUndo(initialUndoFlag);\n      }\n\n      // Fire a create event.\n      if (eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(this));\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n      // In case init threw, recordUndo flag should still be reset.\n      eventUtils.setRecordUndo(initialUndoFlag);\n    }\n    this.inputsInlineDefault = this.inputsInline;\n\n    // Bind an onchange function, if it exists.\n    if (typeof this.onchange === 'function') {\n      this.setOnChange(this.onchange);\n    }\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   */\n  dispose(healStack: boolean) {\n    if (this.isDeadOrDying()) return;\n\n    // Dispose of this change listener before unplugging.\n    // Technically not necessary due to the event firing delay.\n    // But future-proofing.\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.unplug(healStack);\n    if (eventUtils.isEnabled()) {\n      // Constructing the delete event is costly. Only perform if necessary.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_DELETE))(this));\n    }\n    this.workspace.removeTopBlock(this);\n    this.disposeInternal();\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does not fire events, unplug the block, etc.\n   */\n  protected disposeInternal() {\n    if (this.isDeadOrDying()) return;\n\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.workspace.removeTypedBlock(this);\n    this.workspace.removeBlockById(this.id);\n    this.disposing = true;\n\n    if (typeof this.destroy === 'function') this.destroy();\n\n    this.childBlocks_.forEach((c) => c.disposeInternal());\n    this.inputList.forEach((i) => i.dispose());\n    this.inputList.length = 0;\n    this.getConnections_(true).forEach((c) => c.dispose());\n    this.disposed = true;\n  }\n\n  /**\n   * Returns true if the block is either in the process of being disposed, or\n   * is disposed.\n   *\n   * @internal\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /**\n   * Call initModel on all fields on the block.\n   * May be called more than once.\n   * Either initModel or initSvg must be called after creating a block and\n   * before the first interaction with it.  Interactions include UI actions\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\n   * change).\n   */\n  initModel() {\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        if (field.initModel) {\n          field.initModel();\n        }\n      }\n    }\n  }\n\n  /**\n   * Unplug this block from its superior block.  If this block is a statement,\n   * optionally reconnect the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  unplug(opt_healStack?: boolean) {\n    if (this.outputConnection) {\n      this.unplugFromRow_(opt_healStack);\n    }\n    if (this.previousConnection) {\n      this.unplugFromStack_(opt_healStack);\n    }\n  }\n\n  /**\n   * Unplug this block's output from an input on another block.  Optionally\n   * reconnect the block's parent to the only child block, if possible.\n   *\n   * @param opt_healStack Disconnect right-side block and connect to left-side\n   *     block.  Defaults to false.\n   */\n  private unplugFromRow_(opt_healStack?: boolean) {\n    let parentConnection = null;\n    if (this.outputConnection?.isConnected()) {\n      parentConnection = this.outputConnection.targetConnection;\n      // Disconnect from any superior block.\n      this.outputConnection.disconnect();\n    }\n\n    // Return early in obvious cases.\n    if (!parentConnection || !opt_healStack) {\n      return;\n    }\n\n    const thisConnection = this.getOnlyValueConnection_();\n    if (\n      !thisConnection ||\n      !thisConnection.isConnected() ||\n      thisConnection.targetBlock()!.isShadow()\n    ) {\n      // Too many or too few possible connections on this block, or there's\n      // nothing on the other side of this connection.\n      return;\n    }\n\n    const childConnection = thisConnection.targetConnection;\n    // Disconnect the child block.\n    childConnection?.disconnect();\n    // Connect child to the parent if possible, otherwise bump away.\n    if (\n      this.workspace.connectionChecker.canConnect(\n        childConnection,\n        parentConnection,\n        false,\n      )\n    ) {\n      parentConnection.connect(childConnection!);\n    } else {\n      childConnection?.onFailedConnect(parentConnection);\n    }\n  }\n\n  /**\n   * Returns the connection on the value input that is connected to another\n   * block. When an insertion marker is connected to a connection with a block\n   * already attached, the connected block is attached to the insertion marker.\n   * Since only one block can be displaced and attached to the insertion marker\n   * this should only ever return one connection.\n   *\n   * @returns The connection on the value input, or null.\n   */\n  private getOnlyValueConnection_(): Connection | null {\n    let connection = null;\n    for (let i = 0; i < this.inputList.length; i++) {\n      const thisConnection = this.inputList[i].connection;\n      if (\n        thisConnection &&\n        thisConnection.type === ConnectionType.INPUT_VALUE &&\n        thisConnection.targetConnection\n      ) {\n        if (connection) {\n          return null; // More than one value input found.\n        }\n        connection = thisConnection;\n      }\n    }\n    return connection;\n  }\n\n  /**\n   * Unplug this statement block from its superior block.  Optionally reconnect\n   * the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  private unplugFromStack_(opt_healStack?: boolean) {\n    let previousTarget = null;\n    if (this.previousConnection?.isConnected()) {\n      // Remember the connection that any next statements need to connect to.\n      previousTarget = this.previousConnection.targetConnection;\n      // Detach this block from the parent's tree.\n      this.previousConnection.disconnect();\n    }\n    const nextBlock = this.getNextBlock();\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\n      // Disconnect the next statement.\n      const nextTarget = this.nextConnection?.targetConnection ?? null;\n      nextTarget?.disconnect();\n      if (\n        previousTarget &&\n        this.workspace.connectionChecker.canConnect(\n          previousTarget,\n          nextTarget,\n          false,\n        )\n      ) {\n        // Attach the next statement to the previous statement.\n        previousTarget.connect(nextTarget!);\n      }\n    }\n  }\n\n  /**\n   * Returns all connections originating from this block.\n   *\n   * @param _all If true, return all connections even hidden ones.\n   * @returns Array of connections.\n   * @internal\n   */\n  getConnections_(_all: boolean): Connection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        myConnections.push(input.connection);\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  lastConnectionInStack(ignoreShadows: boolean): Connection | null {\n    let nextConnection = this.nextConnection;\n    while (nextConnection) {\n      const nextBlock = nextConnection.targetBlock();\n      if (!nextBlock || (ignoreShadows && nextBlock.isShadow())) {\n        return nextConnection;\n      }\n      nextConnection = nextBlock.nextConnection;\n    }\n    return null;\n  }\n\n  /**\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\n   * connected should not coincidentally line up on screen.\n   */\n  bumpNeighbours() {}\n  // noop.\n\n  /**\n   * Return the parent block or null if this block is at the top level. The\n   * parent block is either the block connected to the previous connection (for\n   * a statement block) or the block connected to the output connection (for a\n   * value block).\n   *\n   * @returns The block (if any) that holds the current block.\n   */\n  getParent(): this | null {\n    return this.parentBlock_;\n  }\n\n  /**\n   * Return the input that connects to the specified block.\n   *\n   * @param block A block connected to an input on this block.\n   * @returns The input (if any) that connects to the specified block.\n   */\n  getInputWithBlock(block: Block): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection && input.connection.targetBlock() === block) {\n        return input;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the parent block that surrounds the current block, or null if this\n   * block has no surrounding block.  A parent block might just be the previous\n   * statement, whereas the surrounding block is an if statement, while loop,\n   * etc.\n   *\n   * @returns The block (if any) that surrounds the current block.\n   */\n  getSurroundParent(): this | null {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    let prevBlock;\n    do {\n      prevBlock = block;\n      block = block.getParent();\n      if (!block) {\n        // Ran off the top.\n        return null;\n      }\n    } while (block.getNextBlock() === prevBlock);\n    // This block is an enclosing parent, not just a statement in a stack.\n    return block;\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  getNextBlock(): Block | null {\n    return this.nextConnection && this.nextConnection.targetBlock();\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  getPreviousBlock(): Block | null {\n    return this.previousConnection && this.previousConnection.targetBlock();\n  }\n\n  /**\n   * Return the top-most block in this block's tree.\n   * This will return itself if this block is at the top level.\n   *\n   * @returns The root block.\n   */\n  getRootBlock(): this {\n    let rootBlock: this;\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    do {\n      rootBlock = block;\n      block = rootBlock.parentBlock_;\n    } while (block);\n    return rootBlock;\n  }\n\n  /**\n   * Walk up from the given block up through the stack of blocks to find\n   * the top block of the sub stack. If we are nested in a statement input only\n   * find the top-most nested block. Do not go all the way to the root block.\n   *\n   * @returns The top block in a stack.\n   * @internal\n   */\n  getTopStackBlock(): this {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block = this;\n    let previous;\n    do {\n      previous = block.getPreviousBlock();\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\n      // 'this'.\n    } while (\n      previous &&\n      previous.getNextBlock() === block &&\n      (block = previous as AnyDuringMigration)\n    );\n    return block;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getChildren(ordered: boolean): Block[] {\n    if (!ordered) {\n      return this.childBlocks_;\n    }\n    const blocks = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          blocks.push(child);\n        }\n      }\n    }\n    const next = this.getNextBlock();\n    if (next) {\n      blocks.push(next);\n    }\n    return blocks;\n  }\n\n  /**\n   * Set parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  setParent(newParent: this | null) {\n    if (newParent === this.parentBlock_) {\n      return;\n    }\n\n    // Check that block is connected to new parent if new parent is not null and\n    //    that block is not connected to superior one if new parent is null.\n    const targetBlock =\n      (this.previousConnection && this.previousConnection.targetBlock()) ||\n      (this.outputConnection && this.outputConnection.targetBlock());\n    const isConnected = !!targetBlock;\n\n    if (isConnected && newParent && targetBlock !== newParent) {\n      throw Error('Block connected to superior one that is not new parent.');\n    } else if (!isConnected && newParent) {\n      throw Error('Block not connected to new parent.');\n    } else if (isConnected && !newParent) {\n      throw Error(\n        'Cannot set parent to null while block is still connected to' +\n          ' superior block.',\n      );\n    }\n\n    // This block hasn't actually moved on-screen, so there's no need to\n    // update\n    //     its connection locations.\n    if (this.parentBlock_) {\n      // Remove this block from the old parent's child list.\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\n    } else {\n      // New parent must be non-null so remove this block from the workspace's\n      //     list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n    }\n\n    this.parentBlock_ = newParent;\n    if (newParent) {\n      // Add this block to the new parent's child list.\n      newParent.childBlocks_.push(this);\n    } else {\n      this.workspace.addTopBlock(this);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly or indirectly nested inside this one.\n   * Includes this block in the list.\n   * Includes value and statement inputs, as well as any following statements.\n   * Excludes any connection on an output tab or any preceding statements.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Flattened array of blocks.\n   */\n  getDescendants(ordered: boolean): this[] {\n    const blocks = [this];\n    const childBlocks = this.getChildren(ordered);\n    for (let child, i = 0; (child = childBlocks[i]); i++) {\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\n      // assignable to parameter of type 'this[]'.\n      blocks.push(...(child.getDescendants(ordered) as AnyDuringMigration));\n    }\n    return blocks;\n  }\n\n  /**\n   * Get whether this block is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean {\n    return (\n      this.deletable_ &&\n      !this.isShadow_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own deletable property is true or false.\n   *\n   * @returns True if the block's deletable property is true, false otherwise.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable_;\n  }\n\n  /**\n   * Set whether this block is deletable or not.\n   *\n   * @param deletable True if deletable.\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this block is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return (\n      this.movable_ &&\n      !this.isShadow_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own movable property is true or false.\n   *\n   * @returns True if the block's movable property is true, false otherwise.\n   * @internal\n   */\n  isOwnMovable(): boolean {\n    return this.movable_;\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether is block is duplicatable or not. If duplicating this block and\n   * descendants will put this block over the workspace's capacity this block is\n   * not duplicatable. If duplicating this block and descendants will put any\n   * type over their maxInstances this block is not duplicatable.\n   *\n   * @returns True if duplicatable.\n   */\n  isDuplicatable(): boolean {\n    if (!this.workspace.hasBlockLimits()) {\n      return true;\n    }\n    return this.workspace.isCapacityAvailable(\n      common.getBlockTypeCounts(this, true),\n    );\n  }\n\n  /**\n   * Get whether this block is a shadow block or not.\n   *\n   * @returns True if a shadow.\n   */\n  isShadow(): boolean {\n    return this.isShadow_;\n  }\n\n  /**\n   * Set whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  setShadow(shadow: boolean) {\n    this.isShadow_ = shadow;\n  }\n\n  /**\n   * Get whether this block is an insertion marker block or not.\n   *\n   * @returns True if an insertion marker.\n   */\n  isInsertionMarker(): boolean {\n    return this.isInsertionMarker_;\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  setInsertionMarker(insertionMarker: boolean) {\n    this.isInsertionMarker_ = insertionMarker;\n  }\n\n  /**\n   * Get whether this block is editable or not.\n   *\n   * @returns True if editable.\n   * @internal\n   */\n  isEditable(): boolean {\n    return (\n      this.editable_ &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own editable property is true or false.\n   *\n   * @returns True if the block's editable property is true, false otherwise.\n   */\n  isOwnEditable(): boolean {\n    return this.editable_;\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        field.updateEditable();\n      }\n    }\n  }\n\n  /**\n   * Returns if this block has been disposed of / deleted.\n   *\n   * @returns True if this block has been disposed of / deleted.\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * @returns True if this block is a value block with a single editable field.\n   * @internal\n   */\n  isSimpleReporter(): boolean {\n    if (!this.outputConnection) return false;\n\n    for (const input of this.inputList) {\n      if (input.connection || input.fieldRow.length > 1) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): Connection | null {\n    const connections = this.getConnections_(true);\n    const otherConnections = otherBlock.getConnections_(true);\n    if (connections.length !== otherConnections.length) {\n      throw Error('Connection lists did not match in length.');\n    }\n    for (let i = 0; i < otherConnections.length; i++) {\n      if (otherConnections[i] === conn) {\n        return connections[i];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the URL of this block's help page.\n   *\n   * @param url URL string for block help, or function that returns a URL.  Null\n   *     for no help.\n   */\n  setHelpUrl(url: string | Function) {\n    this.helpUrl = url;\n  }\n\n  /**\n   * Sets the tooltip for this block.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\n   *     display a tooltip pass the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo) {\n    this.tooltip = newTip;\n  }\n\n  /**\n   * Returns the tooltip text for this block.\n   *\n   * @returns The tooltip text for this block.\n   */\n  getTooltip(): string {\n    return Tooltip.getTooltipOfObject(this);\n  }\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColour(): string {\n    return this.colour_;\n  }\n\n  /**\n   * Get the name of the block style.\n   *\n   * @returns Name of the block style.\n   */\n  getStyleName(): string {\n    return this.styleName_;\n  }\n\n  /**\n   * Get the HSV hue value of a block.  Null if hue not set.\n   *\n   * @returns Hue value (0-360).\n   */\n  getHue(): number | null {\n    return this.hue_;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   */\n  setColour(colour: number | string) {\n    const parsed = parsing.parseBlockColour(colour);\n    this.hue_ = parsed.hue;\n    this.colour_ = parsed.hex;\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   */\n  setStyle(blockStyleName: string) {\n    this.styleName_ = blockStyleName;\n  }\n\n  /**\n   * Sets a callback function to use whenever the block's parent workspace\n   * changes, replacing any prior onchange handler. This is usually only called\n   * from the constructor, the block type initializer function, or an extension\n   * initializer function.\n   *\n   * @param onchangeFn The callback to call when the block's workspace changes.\n   * @throws {Error} if onchangeFn is not falsey and not a function.\n   */\n  setOnChange(onchangeFn: (p1: Abstract) => void) {\n    if (onchangeFn && typeof onchangeFn !== 'function') {\n      throw Error('onchange must be a function.');\n    }\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n    this.onchange = onchangeFn;\n    this.onchangeWrapper_ = onchangeFn.bind(this);\n    this.workspace.addChangeListener(this.onchangeWrapper_);\n  }\n\n  /**\n   * Returns the named field from a block.\n   *\n   * @param name The name of the field.\n   * @returns Named field, or null if field does not exist.\n   */\n  getField(name: string): Field | null {\n    if (typeof name !== 'string') {\n      throw TypeError(\n        'Block.prototype.getField expects a string ' +\n          'with the field name but received ' +\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\n          ' instead',\n      );\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.name === name) {\n          return field;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable ids.\n   */\n  getVars(): string[] {\n    const vars: string[] = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          // NOTE: This only applies to `FieldVariable`, a `Field<string>`\n          vars.push(field.getValue() as string);\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable models.\n   * @internal\n   */\n  getVarModels(): VariableModel[] {\n    const vars = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          const model = this.workspace.getVariableById(\n            field.getValue() as string,\n          );\n          // Check if the variable actually exists (and isn't just a potential\n          // variable).\n          if (model) {\n            vars.push(model);\n          }\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   *\n   * @param variable The variable being renamed.\n   * @internal\n   */\n  updateVarName(variable: VariableModel) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (\n          field.referencesVariables() &&\n          variable.getId() === field.getValue()\n        ) {\n          field.refreshVariableName();\n        }\n      }\n    }\n  }\n\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   *\n   * @param oldId ID of variable to rename.\n   * @param newId ID of new variable.  May be the same as oldId, but with an\n   *     updated name.\n   */\n  renameVarById(oldId: string, newId: string) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables() && oldId === field.getValue()) {\n          field.setValue(newId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the language-neutral value of the given field.\n   *\n   * @param name The name of the field.\n   * @returns Value of the field or null if field does not exist.\n   */\n  getFieldValue(name: string): AnyDuringMigration {\n    const field = this.getField(name);\n    if (field) {\n      return field.getValue();\n    }\n    return null;\n  }\n\n  /**\n   * Sets the value of the given field for this block.\n   *\n   * @param newValue The value to set.\n   * @param name The name of the field to set the value of.\n   */\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\n    const field = this.getField(name);\n    if (!field) {\n      throw Error('Field \"' + name + '\" not found.');\n    }\n    field.setValue(newValue);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.previousConnection) {\n        this.previousConnection = this.makeConnection_(\n          ConnectionType.PREVIOUS_STATEMENT,\n        );\n      }\n      this.previousConnection.setCheck(opt_check);\n    } else {\n      if (this.previousConnection) {\n        if (this.previousConnection.isConnected()) {\n          throw Error(\n            'Must disconnect previous statement before removing ' +\n              'connection.',\n          );\n        }\n        this.previousConnection.dispose();\n        this.previousConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setNextStatement(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.nextConnection) {\n        this.nextConnection = this.makeConnection_(\n          ConnectionType.NEXT_STATEMENT,\n        );\n      }\n      this.nextConnection.setCheck(opt_check);\n    } else {\n      if (this.nextConnection) {\n        if (this.nextConnection.isConnected()) {\n          throw Error(\n            'Must disconnect next statement before removing ' + 'connection.',\n          );\n        }\n        this.nextConnection.dispose();\n        this.nextConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  setOutput(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.outputConnection) {\n        this.outputConnection = this.makeConnection_(\n          ConnectionType.OUTPUT_VALUE,\n        );\n      }\n      this.outputConnection.setCheck(opt_check);\n    } else {\n      if (this.outputConnection) {\n        if (this.outputConnection.isConnected()) {\n          throw Error(\n            'Must disconnect output value before removing connection.',\n          );\n        }\n        this.outputConnection.dispose();\n        this.outputConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  setInputsInline(newBoolean: boolean) {\n    if (this.inputsInline !== newBoolean) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this,\n          'inline',\n          null,\n          this.inputsInline,\n          newBoolean,\n        ),\n      );\n      this.inputsInline = newBoolean;\n    }\n  }\n\n  /**\n   * Get whether value inputs are arranged horizontally or vertically.\n   *\n   * @returns True if inputs are horizontal.\n   */\n  getInputsInline(): boolean {\n    if (this.inputsInline !== undefined) {\n      // Set explicitly.\n      return this.inputsInline;\n    }\n    // Not defined explicitly.  Figure out what would look best.\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof DummyInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Two dummy inputs in a row.  Don't inline them.\n        return false;\n      }\n    }\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof ValueInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Dummy input after a value input.  Inline them.\n        return true;\n      }\n    }\n    for (let i = 0; i < this.inputList.length; i++) {\n      if (this.inputList[i] instanceof EndRowInput) {\n        // A row-end input is present. Inline value inputs.\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the block's output shape.\n   *\n   * @param outputShape Value representing an output shape.\n   */\n  setOutputShape(outputShape: number | null) {\n    this.outputShape_ = outputShape;\n  }\n\n  /**\n   * Get the block's output shape.\n   *\n   * @returns Value representing output shape if one exists.\n   */\n  getOutputShape(): number | null {\n    return this.outputShape_;\n  }\n\n  /**\n   * Get whether this block is enabled or not.\n   *\n   * @returns True if enabled.\n   */\n  isEnabled(): boolean {\n    return !this.disabled;\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      const oldValue = this.disabled;\n      this.disabled = !enabled;\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this,\n          'disabled',\n          null,\n          oldValue,\n          !enabled,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Get whether the block is disabled or not due to parents.\n   * The block's own disabled property is not considered.\n   *\n   * @returns True if disabled.\n   */\n  getInheritedDisabled(): boolean {\n    let ancestor = this.getSurroundParent();\n    while (ancestor) {\n      if (ancestor.disabled) {\n        return true;\n      }\n      ancestor = ancestor.getSurroundParent();\n    }\n    // Ran off the top.\n    return false;\n  }\n\n  /**\n   * Get whether the block is collapsed or not.\n   *\n   * @returns True if collapsed.\n   */\n  isCollapsed(): boolean {\n    return this.collapsed_;\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ !== collapsed) {\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this,\n          'collapsed',\n          null,\n          this.collapsed_,\n          collapsed,\n        ),\n      );\n      this.collapsed_ = collapsed;\n    }\n  }\n\n  /**\n   * Create a human-readable text representation of this block and any children.\n   *\n   * @param opt_maxLength Truncate the string to this length.\n   * @param opt_emptyToken The placeholder string used to denote an empty input.\n   *     If not specified, '?' is used.\n   * @returns Text of block.\n   */\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\n    const tokens = this.toTokens(opt_emptyToken);\n\n    // Run through our tokens array and simplify expression to remove\n    // parentheses around single field blocks.\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\n    for (let i = 2; i < tokens.length; i++) {\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\n        tokens[i - 2] = tokens[i - 1];\n        tokens.splice(i - 1, 2);\n      }\n    }\n\n    // Join the text array, removing the spaces around added parentheses.\n    let prev = '';\n    let text: string = tokens.reduce((acc, curr) => {\n      const val = acc + (prev === '(' || curr === ')' ? '' : ' ') + curr;\n      prev = curr[curr.length - 1];\n      return val;\n    }, '');\n\n    text = text.trim() || '???';\n    if (opt_maxLength) {\n      // TODO: Improve truncation so that text from this block is given\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\n      if (text.length > opt_maxLength) {\n        text = text.substring(0, opt_maxLength - 3) + '...';\n      }\n    }\n    return text;\n  }\n\n  /**\n   * Converts this block into string tokens.\n   *\n   * @param emptyToken The token to use in place of an empty input.\n   *     Defaults to '?'.\n   * @returns The array of string tokens representing this block.\n   */\n  private toTokens(emptyToken = '?'): string[] {\n    const tokens = [];\n    /**\n     * Whether or not to add parentheses around an input.\n     *\n     * @param connection The connection.\n     * @returns True if we should add parentheses around the input.\n     */\n    function shouldAddParentheses(connection: Connection): boolean {\n      let checks = connection.getCheck();\n      if (!checks && connection.targetConnection) {\n        checks = connection.targetConnection.getCheck();\n      }\n      return (\n        !!checks &&\n        (checks.indexOf('Boolean') !== -1 || checks.indexOf('Number') !== -1)\n      );\n    }\n\n    for (const input of this.inputList) {\n      if (input.name == constants.COLLAPSED_INPUT_NAME) {\n        continue;\n      }\n      for (const field of input.fieldRow) {\n        tokens.push(field.getText());\n      }\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          const shouldAddParens = shouldAddParentheses(input.connection);\n          if (shouldAddParens) tokens.push('(');\n          tokens.push(...child.toTokens(emptyToken));\n          if (shouldAddParens) tokens.push(')');\n        } else {\n          tokens.push(emptyToken);\n        }\n      }\n    }\n    return tokens;\n  }\n\n  /**\n   * Appends a value input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendValueInput(name: string): Input {\n    return this.appendInput(new ValueInput(name, this));\n  }\n\n  /**\n   * Appends a statement input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendStatementInput(name: string): Input {\n    this.statementInputCount++;\n    return this.appendInput(new StatementInput(name, this));\n  }\n\n  /**\n   * Appends a dummy input row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendDummyInput(name = ''): Input {\n    return this.appendInput(new DummyInput(name, this));\n  }\n\n  /**\n   * Appends an input that ends the row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendEndRowInput(name = ''): Input {\n    return this.appendInput(new EndRowInput(name, this));\n  }\n\n  /**\n   * Appends the given input row.\n   *\n   * Allows for custom inputs to be appended to the block.\n   */\n  appendInput(input: Input): Input {\n    this.inputList.push(input);\n    return input;\n  }\n\n  /**\n   * Appends an input with the given input type and name to the block after\n   * constructing it from the registry.\n   *\n   * @param type The name the input is registered under in the registry.\n   * @param name The name the input will have within the block.\n   * @returns The constucted input, or null if there was no constructor\n   *     associated with the type.\n   */\n  private appendInputFromRegistry(type: string, name: string): Input | null {\n    const inputConstructor = registry.getClass(\n      registry.Type.INPUT,\n      type,\n      false,\n    );\n    if (!inputConstructor) return null;\n    return this.appendInput(new inputConstructor(name, this));\n  }\n\n  /**\n   * Initialize this block using a cross-platform, internationalization-friendly\n   * JSON description.\n   *\n   * @param json Structured data describing the block.\n   */\n  jsonInit(json: AnyDuringMigration) {\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\n\n    // Validate inputs.\n    if (json['output'] && json['previousStatement']) {\n      throw Error(\n        warningPrefix + 'Must not have both an output and a previousStatement.',\n      );\n    }\n\n    // Validate that each arg has a corresponding message\n    let n = 0;\n    while (json['args' + n]) {\n      if (json['message' + n] === undefined) {\n        throw Error(\n          warningPrefix +\n            `args${n} must have a corresponding message (message${n}).`,\n        );\n      }\n      n++;\n    }\n\n    // Set basic properties of block.\n    // Makes styles backward compatible with old way of defining hat style.\n    if (json['style'] && json['style'].hat) {\n      this.hat = json['style'].hat;\n      // Must set to null so it doesn't error when checking for style and\n      // colour.\n      json['style'] = null;\n    }\n\n    if (json['style'] && json['colour']) {\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\n    } else if (json['style']) {\n      this.jsonInitStyle_(json, warningPrefix);\n    } else {\n      this.jsonInitColour_(json, warningPrefix);\n    }\n\n    // Interpolate the message blocks.\n    let i = 0;\n    while (json['message' + i] !== undefined) {\n      this.interpolate_(\n        json['message' + i],\n        json['args' + i] || [],\n        // Backwards compatibility: lastDummyAlign aliases implicitAlign.\n        json['implicitAlign' + i] || json['lastDummyAlign' + i],\n        warningPrefix,\n      );\n      i++;\n    }\n\n    if (json['inputsInline'] !== undefined) {\n      eventUtils.disable();\n      this.setInputsInline(json['inputsInline']);\n      eventUtils.enable();\n    }\n\n    // Set output and previous/next connections.\n    if (json['output'] !== undefined) {\n      this.setOutput(true, json['output']);\n    }\n    if (json['outputShape'] !== undefined) {\n      this.setOutputShape(json['outputShape']);\n    }\n    if (json['previousStatement'] !== undefined) {\n      this.setPreviousStatement(true, json['previousStatement']);\n    }\n    if (json['nextStatement'] !== undefined) {\n      this.setNextStatement(true, json['nextStatement']);\n    }\n    if (json['tooltip'] !== undefined) {\n      const rawValue = json['tooltip'];\n      const localizedText = parsing.replaceMessageReferences(rawValue);\n      this.setTooltip(localizedText);\n    }\n    if (json['enableContextMenu'] !== undefined) {\n      this.contextMenu = !!json['enableContextMenu'];\n    }\n    if (json['suppressPrefixSuffix'] !== undefined) {\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\n    }\n    if (json['helpUrl'] !== undefined) {\n      const rawValue = json['helpUrl'];\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\n      this.setHelpUrl(localizedValue);\n    }\n    if (typeof json['extensions'] === 'string') {\n      console.warn(\n        warningPrefix +\n          \"JSON attribute 'extensions' should be an array of\" +\n          \" strings. Found raw string in JSON for '\" +\n          json['type'] +\n          \"' block.\",\n      );\n      json['extensions'] = [json['extensions']]; // Correct and continue.\n    }\n\n    // Add the mutator to the block.\n    if (json['mutator'] !== undefined) {\n      Extensions.apply(json['mutator'], this, true);\n    }\n\n    const extensionNames = json['extensions'];\n    if (Array.isArray(extensionNames)) {\n      for (let j = 0; j < extensionNames.length; j++) {\n        Extensions.apply(extensionNames[j], this, false);\n      }\n    }\n  }\n\n  /**\n   * Initialize the colour of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitColour_(json: AnyDuringMigration, warningPrefix: string) {\n    if ('colour' in json) {\n      if (json['colour'] === undefined) {\n        console.warn(warningPrefix + 'Undefined colour value.');\n      } else {\n        const rawValue = json['colour'];\n        try {\n          this.setColour(rawValue);\n        } catch (e) {\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the style of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitStyle_(json: AnyDuringMigration, warningPrefix: string) {\n    const blockStyleName = json['style'];\n    try {\n      this.setStyle(blockStyleName);\n    } catch (styleError) {\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\n    }\n  }\n\n  /**\n   * Add key/values from mixinObj to this block object. By default, this method\n   * will check that the keys in mixinObj will not overwrite existing values in\n   * the block, including prototype values. This provides some insurance against\n   * mixin / extension incompatibilities with future block features. This check\n   * can be disabled by passing true as the second argument.\n   *\n   * @param mixinObj The key/values pairs to add to this block object.\n   * @param opt_disableCheck Option flag to disable overwrite checks.\n   */\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\n    if (\n      opt_disableCheck !== undefined &&\n      typeof opt_disableCheck !== 'boolean'\n    ) {\n      throw Error('opt_disableCheck must be a boolean if provided');\n    }\n    if (!opt_disableCheck) {\n      const overwrites = [];\n      for (const key in mixinObj) {\n        if ((this as AnyDuringMigration)[key] !== undefined) {\n          overwrites.push(key);\n        }\n      }\n      if (overwrites.length) {\n        throw Error(\n          'Mixin will overwrite block members: ' + JSON.stringify(overwrites),\n        );\n      }\n    }\n    Object.assign(this, mixinObj);\n  }\n\n  /**\n   * Interpolate a message description onto the block.\n   *\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\n   *     with fields or inputs defined in the args array.\n   * @param args Array of arguments to be interpolated.\n   * @param implicitAlign If an implicit input is added at the end or in place\n   *     of newline tokens, how should it be aligned?\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private interpolate_(\n    message: string,\n    args: AnyDuringMigration[],\n    implicitAlign: string | undefined,\n    warningPrefix: string,\n  ) {\n    const tokens = parsing.tokenizeInterpolation(message);\n    this.validateTokens_(tokens, args.length);\n    const elements = this.interpolateArguments_(tokens, args, implicitAlign);\n\n    // An array of [field, fieldName] tuples.\n    const fieldStack = [];\n    for (let i = 0, element; (element = elements[i]); i++) {\n      if (this.isInputKeyword_(element['type'])) {\n        const input = this.inputFromJson_(element, warningPrefix);\n        // Should never be null, but just in case.\n        if (input) {\n          for (let j = 0, tuple; (tuple = fieldStack[j]); j++) {\n            input.appendField(tuple[0], tuple[1]);\n          }\n          fieldStack.length = 0;\n        }\n      } else {\n        // All other types, including ones starting with 'input_' get routed\n        // here.\n        const field = this.fieldFromJson_(element);\n        if (field) {\n          fieldStack.push([field, element['name']]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates that the tokens are within the correct bounds, with no\n   * duplicates, and that all of the arguments are referred to. Throws errors if\n   * any of these things are not true.\n   *\n   * @param tokens An array of tokens to validate\n   * @param argsCount The number of args that need to be referred to.\n   */\n  private validateTokens_(tokens: Array<string | number>, argsCount: number) {\n    const visitedArgsHash = [];\n    let visitedArgsCount = 0;\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      if (typeof token !== 'number') {\n        continue;\n      }\n      if (token < 1 || token > argsCount) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' out of range.',\n        );\n      }\n      if (visitedArgsHash[token]) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' duplicated.',\n        );\n      }\n      visitedArgsHash[token] = true;\n      visitedArgsCount++;\n    }\n    if (visitedArgsCount !== argsCount) {\n      throw Error(\n        'Block \"' +\n          this.type +\n          '\": ' +\n          'Message does not reference all ' +\n          argsCount +\n          ' arg(s).',\n      );\n    }\n  }\n\n  /**\n   * Inserts args in place of numerical tokens. String args are converted to\n   * JSON that defines a label field. Newline characters are converted to\n   * end-row inputs, and if necessary an extra dummy input is added to the end\n   * of the elements.\n   *\n   * @param tokens The tokens to interpolate\n   * @param args The arguments to insert.\n   * @param implicitAlign The alignment to use for any implicitly added end-row\n   *     or dummy inputs, if necessary.\n   * @returns The JSON definitions of field and inputs to add to the block.\n   */\n  private interpolateArguments_(\n    tokens: Array<string | number>,\n    args: Array<AnyDuringMigration | string>,\n    implicitAlign: string | undefined,\n  ): AnyDuringMigration[] {\n    const elements = [];\n    for (let i = 0; i < tokens.length; i++) {\n      let element = tokens[i];\n      if (typeof element === 'number') {\n        element = args[element - 1];\n      }\n      // Args can be strings, which is why this isn't elseif.\n      if (typeof element === 'string') {\n        if (element === '\\n') {\n          // Convert newline tokens to end-row inputs.\n          const newlineInput = {'type': 'input_end_row'};\n          if (implicitAlign) {\n            (newlineInput as AnyDuringMigration)['align'] = implicitAlign;\n          }\n          element = newlineInput as AnyDuringMigration;\n        } else {\n          // AnyDuringMigration because:  Type '{ text: string; type: string; }\n          // | null' is not assignable to type 'string | number'.\n          element = this.stringToFieldJson_(element) as AnyDuringMigration;\n          if (!element) {\n            continue;\n          }\n        }\n      }\n      elements.push(element);\n    }\n\n    const length = elements.length;\n    if (\n      length &&\n      !this.isInputKeyword_(\n        (elements as AnyDuringMigration)[length - 1]['type'],\n      )\n    ) {\n      const dummyInput = {'type': 'input_dummy'};\n      if (implicitAlign) {\n        (dummyInput as AnyDuringMigration)['align'] = implicitAlign;\n      }\n      elements.push(dummyInput);\n    }\n\n    return elements;\n  }\n\n  /**\n   * Creates a field from the JSON definition of a field. If a field with the\n   * given type cannot be found, this attempts to create a different field using\n   * the 'alt' property of the JSON definition (if it exists).\n   *\n   * @param element The element to try to turn into a field.\n   * @returns The field defined by the JSON, or null if one couldn't be created.\n   */\n  private fieldFromJson_(element: {\n    alt?: string;\n    type: string;\n    text?: string;\n  }): Field | null {\n    const field = fieldRegistry.fromJson(element);\n    if (!field && element['alt']) {\n      if (typeof element['alt'] === 'string') {\n        const json = this.stringToFieldJson_(element['alt']);\n        return json ? this.fieldFromJson_(json) : null;\n      }\n      return this.fieldFromJson_(element['alt']);\n    }\n    return field;\n  }\n\n  /**\n   * Creates an input from the JSON definition of an input. Sets the input's\n   * check and alignment if they are provided.\n   *\n   * @param element The JSON to turn into an input.\n   * @param warningPrefix The prefix to add to warnings to help the developer\n   *     debug.\n   * @returns The input that has been created, or null if one could not be\n   *     created for some reason (should never happen).\n   */\n  private inputFromJson_(\n    element: AnyDuringMigration,\n    warningPrefix: string,\n  ): Input | null {\n    const alignmentLookup = {\n      'LEFT': Align.LEFT,\n      'RIGHT': Align.RIGHT,\n      'CENTRE': Align.CENTRE,\n      'CENTER': Align.CENTRE,\n    };\n\n    let input = null;\n    switch (element['type']) {\n      case 'input_value':\n        input = this.appendValueInput(element['name']);\n        break;\n      case 'input_statement':\n        input = this.appendStatementInput(element['name']);\n        break;\n      case 'input_dummy':\n        input = this.appendDummyInput(element['name']);\n        break;\n      case 'input_end_row':\n        input = this.appendEndRowInput(element['name']);\n        break;\n      default: {\n        input = this.appendInputFromRegistry(element['type'], element['name']);\n        break;\n      }\n    }\n    // Should never be hit because of interpolate_'s checks, but just in case.\n    if (!input) {\n      return null;\n    }\n\n    if (element['check']) {\n      input.setCheck(element['check']);\n    }\n    if (element['align']) {\n      const alignment = (alignmentLookup as AnyDuringMigration)[\n        element['align'].toUpperCase()\n      ];\n      if (alignment === undefined) {\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\n      } else {\n        input.setAlign(alignment);\n      }\n    }\n    return input;\n  }\n\n  /**\n   * Returns true if the given string matches one of the input keywords.\n   *\n   * @param str The string to check.\n   * @returns True if the given string matches one of the input keywords, false\n   *     otherwise.\n   */\n  private isInputKeyword_(str: string): boolean {\n    return (\n      str === 'input_value' ||\n      str === 'input_statement' ||\n      str === 'input_dummy' ||\n      str === 'input_end_row' ||\n      registry.hasItem(registry.Type.INPUT, str)\n    );\n  }\n\n  /**\n   * Turns a string into the JSON definition of a label field. If the string\n   * becomes an empty string when trimmed, this returns null.\n   *\n   * @param str String to turn into the JSON definition of a label field.\n   * @returns The JSON definition or null.\n   */\n  private stringToFieldJson_(str: string): {text: string; type: string} | null {\n    str = str.trim();\n    if (str) {\n      return {\n        'type': 'field_label',\n        'text': str,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Move a named input to a different location on this block.\n   *\n   * @param name The name of the input to move.\n   * @param refName Name of input that should be after the moved input, or null\n   *     to be the input at the end.\n   */\n  moveInputBefore(name: string, refName: string | null) {\n    if (name === refName) {\n      return;\n    }\n    // Find both inputs.\n    let inputIndex = -1;\n    let refIndex = refName ? -1 : this.inputList.length;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        inputIndex = i;\n        if (refIndex !== -1) {\n          break;\n        }\n      } else if (refName && input.name === refName) {\n        refIndex = i;\n        if (inputIndex !== -1) {\n          break;\n        }\n      }\n    }\n    if (inputIndex === -1) {\n      throw Error('Named input \"' + name + '\" not found.');\n    }\n    if (refIndex === -1) {\n      throw Error('Reference input \"' + refName + '\" not found.');\n    }\n    this.moveNumberedInputBefore(inputIndex, refIndex);\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    // Validate arguments.\n    if (inputIndex === refIndex) {\n      throw Error(\"Can't move input to itself.\");\n    }\n    if (inputIndex >= this.inputList.length) {\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\n    }\n    if (refIndex > this.inputList.length) {\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\n    }\n    // Remove input.\n    const input = this.inputList[inputIndex];\n    this.inputList.splice(inputIndex, 1);\n    if (inputIndex < refIndex) {\n      refIndex--;\n    }\n    // Reinsert input.\n    this.inputList.splice(refIndex, 0, input);\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent an error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  removeInput(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        if (input instanceof StatementInput) this.statementInputCount--;\n        input.dispose();\n        this.inputList.splice(i, 1);\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Input not found: ' + name);\n  }\n\n  /**\n   * Fetches the named input object.\n   *\n   * @param name The name of the input.\n   * @returns The input object, or null if input does not exist.\n   */\n  getInput(name: string): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        return input;\n      }\n    }\n    // This input does not exist.\n    return null;\n  }\n\n  /**\n   * Fetches the block attached to the named input.\n   *\n   * @param name The name of the input.\n   * @returns The attached value block, or null if the input is either\n   *     disconnected or if the input does not exist.\n   */\n  getInputTargetBlock(name: string): Block | null {\n    const input = this.getInput(name);\n    return input && input.connection && input.connection.targetBlock();\n  }\n\n  /**\n   * Returns the comment on this block (or null if there is no comment).\n   *\n   * @returns Block's comment.\n   */\n  getCommentText(): string | null {\n    const comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | null;\n    return comment?.getText() ?? null;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  setCommentText(text: string | null) {\n    const comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | null;\n    const oldText = comment?.getText() ?? null;\n    if (oldText === text) return;\n    if (text !== null) {\n      let comment = this.getIcon(CommentIcon.TYPE) as CommentIcon | undefined;\n      if (!comment) {\n        comment = this.addIcon(new CommentIcon(this));\n      }\n      eventUtils.disable();\n      comment.setText(text);\n      eventUtils.enable();\n    } else {\n      this.removeIcon(CommentIcon.TYPE);\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param _text The text, or null to delete.\n   * @param _opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  setWarningText(_text: string | null, _opt_id?: string) {\n    // NOOP.\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param _mutator A mutator dialog instance or null to remove.\n   */\n  setMutator(_mutator: MutatorIcon) {\n    // NOOP.\n  }\n\n  /** Adds the given icon to the block. */\n  addIcon<T extends IIcon>(icon: T): T {\n    if (this.hasIcon(icon.getType())) throw new DuplicateIconType(icon);\n    this.icons.push(icon);\n    this.icons.sort((a, b) => a.getWeight() - b.getWeight());\n    return icon;\n  }\n\n  /**\n   * Removes the icon whose getType matches the given type iconType from the\n   * block.\n   *\n   * @param type The type of the icon to remove from the block.\n   * @returns True if an icon with the given type was found, false otherwise.\n   */\n  removeIcon(type: IconType<IIcon>): boolean {\n    if (!this.hasIcon(type)) return false;\n    this.getIcon(type)?.dispose();\n    this.icons = this.icons.filter((icon) => !icon.getType().equals(type));\n    return true;\n  }\n\n  /**\n   * @returns True if an icon with the given type exists on the block,\n   *     false otherwise.\n   */\n  hasIcon(type: IconType<IIcon>): boolean {\n    return this.icons.some((icon) => icon.getType().equals(type));\n  }\n\n  /**\n   * @param type The type of the icon to retrieve. Prefer passing an `IconType`\n   *     for proper type checking when using typescript.\n   * @returns The icon with the given type if it exists on the block, undefined\n   *     otherwise.\n   */\n  getIcon<T extends IIcon>(type: IconType<T> | string): T | undefined {\n    if (type instanceof IconType) {\n      return this.icons.find((icon) => icon.getType().equals(type)) as T;\n    } else {\n      return this.icons.find((icon) => icon.getType().toString() === type) as T;\n    }\n  }\n\n  /** @returns An array of the icons attached to this block. */\n  getIcons(): IIcon[] {\n    return [...this.icons];\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.xy_;\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n      this,\n    ) as BlockMove;\n    reason && event.setReason(reason);\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  makeConnection_(type: ConnectionType): Connection {\n    return new Connection(this, type);\n  }\n\n  /**\n   * Recursively checks whether all statement and value inputs are filled with\n   * blocks. Also checks all following statement blocks in this stack.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    // Account for the shadow block filledness toggle.\n    if (opt_shadowBlocksAreFilled === undefined) {\n      opt_shadowBlocksAreFilled = true;\n    }\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\n      return false;\n    }\n\n    // Recursively check each input block of the current block.\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (!input.connection) {\n        continue;\n      }\n      const target = input.connection.targetBlock();\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n\n    // Recursively check the next block after the current block.\n    const next = this.getNextBlock();\n    if (next) {\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\n    }\n\n    return true;\n  }\n\n  /**\n   * This method returns a string describing this Block in developer terms (type\n   * name and ID; English only).\n   *\n   * Intended to on be used in console logs and errors. If you need a string\n   * that uses the user's native language (including block text, field values,\n   * and child blocks), use [toString()]{@link Block#toString}.\n   *\n   * @returns The description.\n   */\n  toDevString(): string {\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\n    if (this.id) {\n      msg += ' (id=\"' + this.id + '\")';\n    }\n    return msg;\n  }\n}\n\nexport namespace Block {\n  export interface CommentModel {\n    text: string | null;\n    pinned: boolean;\n    size: Size;\n  }\n}\n\nexport type CommentModel = Block.CommentModel;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a marker.\n * Used primarily for keyboard navigation to show a marked location.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Marker\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\n\nimport type {ASTNode} from './ast_node.js';\n\n/**\n * Class for a marker.\n * This is used in keyboard navigation to save a location in the Blockly AST.\n */\nexport class Marker {\n  /** The colour of the marker. */\n  colour: string | null = null;\n\n  /** The current location of the marker. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'ASTNode'.\n  private curNode: ASTNode = null as AnyDuringMigration;\n\n  /**\n   * The object in charge of drawing the visual representation of the current\n   * node.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'MarkerSvg'.\n  private drawer: MarkerSvg = null as AnyDuringMigration;\n\n  /** The type of the marker. */\n  type = 'marker';\n\n  /** Constructs a new Marker instance. */\n  constructor() {}\n\n  /**\n   * Sets the object in charge of drawing the marker.\n   *\n   * @param drawer The object in charge of drawing the marker.\n   */\n  setDrawer(drawer: MarkerSvg) {\n    this.drawer = drawer;\n  }\n\n  /**\n   * Get the current drawer for the marker.\n   *\n   * @returns The object in charge of drawing the marker.\n   */\n  getDrawer(): MarkerSvg {\n    return this.drawer;\n  }\n\n  /**\n   * Gets the current location of the marker.\n   *\n   * @returns The current field, connection, or block the marker is on.\n   */\n  getCurNode(): ASTNode {\n    return this.curNode;\n  }\n\n  /**\n   * Set the location of the marker and call the update method.\n   * Setting isStack to true will only work if the newLocation is the top most\n   * output or previous connection on a stack.\n   *\n   * @param newNode The new location of the marker.\n   */\n  setCurNode(newNode: ASTNode) {\n    const oldNode = this.curNode;\n    this.curNode = newNode;\n    if (this.drawer) {\n      this.drawer.draw(oldNode, this.curNode);\n    }\n  }\n\n  /**\n   * Redraw the current marker.\n   *\n   * @internal\n   */\n  draw() {\n    if (this.drawer) {\n      this.drawer.draw(this.curNode, this.curNode);\n    }\n  }\n\n  /** Hide the marker SVG. */\n  hide() {\n    if (this.drawer) {\n      this.drawer.hide();\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.getDrawer()) {\n      this.getDrawer().dispose();\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor.\n * Used primarily for keyboard navigation.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Cursor\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Marker} from './marker.js';\n\n/**\n * Class for a cursor.\n * A cursor controls how a user navigates the Blockly AST.\n */\nexport class Cursor extends Marker {\n  override type = 'cursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next connection, field, or block.\n   *\n   * @returns The next element, or null if the current node is not set or there\n   *     is no next value.\n   */\n  next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n\n    let newNode = curNode.next();\n    while (\n      newNode &&\n      newNode.next() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.next();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the in connection or field.\n   *\n   * @returns The in element, or null if the current node is not set or there is\n   *     no in value.\n   */\n  in(): ASTNode | null {\n    let curNode: ASTNode | null = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    // If we are on a previous or output connection, go to the block level\n    // before performing next operation.\n    if (\n      curNode.getType() === ASTNode.types.PREVIOUS ||\n      curNode.getType() === ASTNode.types.OUTPUT\n    ) {\n      curNode = curNode.next();\n    }\n    const newNode = curNode?.in() ?? null;\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the previous connection, field, or block.\n   *\n   * @returns The previous element, or null if the current node is not set or\n   *     there is no previous value.\n   */\n  prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.prev();\n\n    while (\n      newNode &&\n      newNode.prev() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.prev();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the out connection, field, or block.\n   *\n   * @returns The out element, or null if the current node is not set or there\n   *     is no out value.\n   */\n  out(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.out();\n\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\n      newNode = newNode.prev() || newNode;\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n}\n\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a basic cursor.\n * Used to demo switching between different cursors.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BasicCursor\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Cursor} from './cursor.js';\n\n/**\n * Class for a basic cursor.\n * This will allow the user to get to all nodes in the AST by hitting next or\n * previous.\n */\nexport class BasicCursor extends Cursor {\n  /** Name used for registering a basic cursor. */\n  static readonly registrationName = 'basicCursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next node in the pre order traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getNextNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * in will also allow the user to get to the next node in the pre order\n   * traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override in(): ASTNode | null {\n    return this.next();\n  }\n\n  /**\n   * Find the previous node in the pre order traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * out will allow the user to get to the previous node in the pre order\n   * traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override out(): ASTNode | null {\n    return this.prev();\n  }\n\n  /**\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\n   * a user to easily navigate the entire Blockly AST without having to go in\n   * and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The next node in the traversal.\n   */\n  protected getNextNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const newNode = node.in() || node.next();\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getNextNode_(newNode, isValid);\n    }\n    const siblingOrParent = this.findSiblingOrParent(node.out());\n    if (isValid(siblingOrParent)) {\n      return siblingOrParent;\n    } else if (siblingOrParent) {\n      return this.getNextNode_(siblingOrParent, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Reverses the pre order traversal in order to find the previous node. This\n   * will allow a user to easily navigate the entire Blockly AST without having\n   * to go in and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The previous node in the traversal or null if no previous node\n   *     exists.\n   */\n  protected getPreviousNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    let newNode: ASTNode | null = node.prev();\n\n    if (newNode) {\n      newNode = this.getRightMostChild(newNode);\n    } else {\n      newNode = node.out();\n    }\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getPreviousNode_(newNode, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Decides what nodes to traverse and which ones to skip. Currently, it\n   * skips output, stack and workspace nodes.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  protected validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (\n      type === ASTNode.types.OUTPUT ||\n      type === ASTNode.types.INPUT ||\n      type === ASTNode.types.FIELD ||\n      type === ASTNode.types.NEXT ||\n      type === ASTNode.types.PREVIOUS ||\n      type === ASTNode.types.WORKSPACE\n    ) {\n      isValid = true;\n    }\n    return isValid;\n  }\n\n  /**\n   * From the given node find either the next valid sibling or parent.\n   *\n   * @param node The current position in the AST.\n   * @returns The parent AST node or null if there are no valid parents.\n   */\n  private findSiblingOrParent(node: ASTNode | null): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const nextNode = node.next();\n    if (nextNode) {\n      return nextNode;\n    }\n    return this.findSiblingOrParent(node.out());\n  }\n\n  /**\n   * Get the right most child of a node.\n   *\n   * @param node The node to find the right most child of.\n   * @returns The right most child of the given node, or the node if no child\n   *     exists.\n   */\n  private getRightMostChild(node: ASTNode | null): ASTNode | null {\n    if (!node!.in()) {\n      return node;\n    }\n    let newNode = node!.in();\n    while (newNode && newNode.next()) {\n      newNode = newNode.next();\n    }\n    return this.getRightMostChild(newNode);\n  }\n}\n\nregistry.register(\n  registry.Type.CURSOR,\n  BasicCursor.registrationName,\n  BasicCursor,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor that is used to navigate\n * between tab navigable fields.\n *\n * @class\n */\n// Former goog.module ID: Blockly.TabNavigateCursor\n\nimport type {Field} from '../field.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {BasicCursor} from './basic_cursor.js';\n\n/**\n * A cursor for navigating between tab navigable fields.\n */\nexport class TabNavigateCursor extends BasicCursor {\n  /**\n   * Skip all nodes except for tab navigable fields.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  override validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (node) {\n      const location = node.getLocation() as Field;\n      if (\n        type === ASTNode.types.FIELD &&\n        location &&\n        location.isTabNavigable() &&\n        location.isClickable()\n      ) {\n        isValid = true;\n      }\n    }\n    return isValid;\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.RenderedConnection\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport {hasBubble} from './interfaces/i_has_bubble.js';\nimport * as internalConstants from './internal_constants.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgPaths from './utils/svg_paths.js';\n\n/** A shape that has a pathDown property. */\ninterface PathDownShape {\n  pathDown: string;\n}\n\n/** A shape that has a pathLeft property. */\ninterface PathLeftShape {\n  pathLeft: string;\n}\n\n/** Maximum randomness in workspace units for bumping a block. */\nconst BUMP_RANDOMNESS = 10;\n\n/**\n * Class for a connection between blocks that may be rendered on screen.\n */\nexport class RenderedConnection extends Connection {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  sourceBlock_!: BlockSvg;\n  private readonly db: ConnectionDB;\n  private readonly dbOpposite: ConnectionDB;\n  private readonly offsetInBlock: Coordinate;\n  private trackedState: TrackedState;\n  private highlightPath: SVGPathElement | null = null;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  override targetConnection: RenderedConnection | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: BlockSvg, type: number) {\n    super(source, type);\n\n    /**\n     * Connection database for connections of this type on the current\n     * workspace.\n     */\n    this.db = source.workspace.connectionDBList[type];\n\n    /**\n     * Connection database for connections compatible with this type on the\n     * current workspace.\n     */\n    this.dbOpposite =\n      source.workspace.connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\n\n    /** Workspace units, (0, 0) is top left of block. */\n    this.offsetInBlock = new Coordinate(0, 0);\n\n    /** Describes the state of this connection's tracked-ness. */\n    this.trackedState = RenderedConnection.TrackedState.WILL_TRACK;\n  }\n\n  /**\n   * Dispose of this connection. Remove it from the database (if it is\n   * tracked) and call the super-function to deal with connected blocks.\n   *\n   * @internal\n   */\n  override dispose() {\n    super.dispose();\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    if (this.highlightPath) {\n      dom.removeNode(this.highlightPath);\n      this.highlightPath = null;\n    }\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  override getSourceBlock(): BlockSvg {\n    return super.getSourceBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  override targetBlock(): BlockSvg | null {\n    return super.targetBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the distance between this connection and another connection in\n   * workspace units.\n   *\n   * @param otherConnection The other connection to measure the distance to.\n   * @returns The distance between connections, in workspace units.\n   */\n  distanceFrom(otherConnection: Connection): number {\n    const xDiff = this.x - otherConnection.x;\n    const yDiff = this.y - otherConnection.y;\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n  }\n\n  /**\n   * Move the block(s) belonging to the connection to a point where they don't\n   * visually interfere with the specified connection.\n   *\n   * @param staticConnection The connection to move away from.\n   * @internal\n   */\n  bumpAwayFrom(staticConnection: RenderedConnection) {\n    if (this.sourceBlock_.workspace.isDragging()) {\n      // Don't move blocks around while the user is doing the same.\n      return;\n    }\n    // Move the root block.\n    let rootBlock = this.sourceBlock_.getRootBlock();\n    if (rootBlock.isInFlyout) {\n      // Don't move blocks around in a flyout.\n      return;\n    }\n    let reverse = false;\n    if (!rootBlock.isMovable()) {\n      // Can't bump an uneditable block away.\n      // Check to see if the other block is movable.\n      rootBlock = staticConnection.getSourceBlock().getRootBlock();\n      if (!rootBlock.isMovable()) {\n        return;\n      }\n      // Swap the connections and move the 'static' connection instead.\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      staticConnection = this;\n      reverse = true;\n    }\n    // Raise it to the top for extra visibility.\n    const selected = common.getSelected() == rootBlock;\n    selected || rootBlock.addSelect();\n    let dx =\n      staticConnection.x +\n      config.snapRadius +\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\n      this.x;\n    let dy =\n      staticConnection.y +\n      config.snapRadius +\n      Math.floor(Math.random() * BUMP_RANDOMNESS) -\n      this.y;\n    if (reverse) {\n      // When reversing a bump due to an uneditable block, bump up.\n      dy = -dy;\n    }\n    if (rootBlock.RTL) {\n      dx =\n        staticConnection.x -\n        config.snapRadius -\n        Math.floor(Math.random() * BUMP_RANDOMNESS) -\n        this.x;\n    }\n    rootBlock.moveBy(dx, dy, ['bump']);\n    selected || rootBlock.removeSelect();\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param x New absolute x coordinate, in workspace coordinates.\n   * @param y New absolute y coordinate, in workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveTo(x: number, y: number): boolean {\n    // TODO(#6922): Readd this optimization.\n    // const moved = this.x !== x || this.y !== y;\n    const moved = true;\n    let updated = false;\n\n    if (this.trackedState === RenderedConnection.TrackedState.WILL_TRACK) {\n      this.db.addConnection(this, y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      updated = true;\n    } else if (\n      this.trackedState === RenderedConnection.TrackedState.TRACKED &&\n      moved\n    ) {\n      this.db.removeConnection(this, this.y);\n      this.db.addConnection(this, y);\n      updated = true;\n    }\n\n    this.x = x;\n    this.y = y;\n\n    return updated;\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param dx Change to x coordinate, in workspace units.\n   * @param dy Change to y coordinate, in workspace units.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveBy(dx: number, dy: number): boolean {\n    return this.moveTo(this.x + dx, this.y + dy);\n  }\n\n  /**\n   * Move this connection to the location given by its offset within the block\n   * and the location of the block's top left corner.\n   *\n   * @param blockTL The location of the top left corner of the block, in\n   *     workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveToOffset(blockTL: Coordinate): boolean {\n    return this.moveTo(\n      blockTL.x + this.offsetInBlock.x,\n      blockTL.y + this.offsetInBlock.y,\n    );\n  }\n\n  /**\n   * Set the offset of this connection relative to the top left of its block.\n   *\n   * @param x The new relative x, in workspace units.\n   * @param y The new relative y, in workspace units.\n   */\n  setOffsetInBlock(x: number, y: number) {\n    this.offsetInBlock.x = x;\n    this.offsetInBlock.y = y;\n  }\n\n  /**\n   * Get the offset of this connection relative to the top left of its block.\n   *\n   * @returns The offset of the connection.\n   */\n  getOffsetInBlock(): Coordinate {\n    return this.offsetInBlock;\n  }\n\n  /**\n   * Moves the blocks on either side of this connection right next to\n   * each other, based on their local offsets, not global positions.\n   *\n   * @internal\n   */\n  tightenEfficiently() {\n    const target = this.targetConnection;\n    const block = this.targetBlock();\n    if (!target || !block) return;\n    const offset = Coordinate.difference(\n      this.offsetInBlock,\n      target.offsetInBlock,\n    );\n    block.translate(offset.x, offset.y);\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   * All parameters are in workspace units.\n   *\n   * @param maxLimit The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  closest(\n    maxLimit: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    return this.dbOpposite.searchForClosest(this, maxLimit, dxy);\n  }\n\n  /** Add highlighting around this connection. */\n  highlight() {\n    if (this.highlightPath) {\n      // This connection is already highlighted\n      return;\n    }\n    let steps;\n    const sourceBlockSvg = this.sourceBlock_;\n    const renderConstants = sourceBlockSvg.workspace\n      .getRenderer()\n      .getConstants();\n    const shape = renderConstants.shapeFor(this);\n    if (\n      this.type === ConnectionType.INPUT_VALUE ||\n      this.type === ConnectionType.OUTPUT_VALUE\n    ) {\n      // Vertical line, puzzle tab, vertical line.\n      const yLen = renderConstants.TAB_OFFSET_FROM_TOP;\n      steps =\n        svgPaths.moveBy(0, -yLen) +\n        svgPaths.lineOnAxis('v', yLen) +\n        (shape as unknown as PathDownShape).pathDown +\n        svgPaths.lineOnAxis('v', yLen);\n    } else {\n      const xLen =\n        renderConstants.NOTCH_OFFSET_LEFT - renderConstants.CORNER_RADIUS;\n      // Horizontal line, notch, horizontal line.\n      steps =\n        svgPaths.moveBy(-xLen, 0) +\n        svgPaths.lineOnAxis('h', xLen) +\n        (shape as unknown as PathLeftShape).pathLeft +\n        svgPaths.lineOnAxis('h', xLen);\n    }\n    const offset = this.offsetInBlock;\n    this.highlightPath = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyHighlightedConnectionPath',\n        'd': steps,\n        'transform':\n          `translate(${offset.x}, ${offset.y})` +\n          (this.sourceBlock_.RTL ? ' scale(-1 1)' : ''),\n      },\n      this.sourceBlock_.getSvgRoot(),\n    );\n  }\n\n  /** Remove the highlighting around this connection. */\n  unhighlight() {\n    if (this.highlightPath) {\n      dom.removeNode(this.highlightPath);\n      this.highlightPath = null;\n    }\n  }\n\n  /**\n   * Set whether this connections is tracked in the database or not.\n   *\n   * @param doTracking If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setTracking(doTracking: boolean) {\n    if (\n      (doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.TRACKED) ||\n      (!doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.UNTRACKED)\n    ) {\n      return;\n    }\n    if (this.sourceBlock_.isInFlyout) {\n      // Don't bother maintaining a database of connections in a flyout.\n      return;\n    }\n    if (doTracking) {\n      this.db.addConnection(this, this.y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      return;\n    }\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    this.trackedState = RenderedConnection.TrackedState.UNTRACKED;\n  }\n\n  /**\n   * Stop tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * collapsed.\n   *\n   * Also closes down-stream icons/bubbles.\n   *\n   * @internal\n   */\n  stopTrackingAll() {\n    this.setTracking(false);\n    if (this.targetConnection) {\n      const blocks = this.targetBlock()!.getDescendants(false);\n      for (let i = 0; i < blocks.length; i++) {\n        const block = blocks[i];\n        // Stop tracking connections of all children.\n        const connections = block.getConnections_(true);\n        for (let j = 0; j < connections.length; j++) {\n          connections[j].setTracking(false);\n        }\n        // Close all bubbles of all children.\n        for (const icon of block.getIcons()) {\n          if (hasBubble(icon)) icon.setBubbleVisible(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Start tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * expanded.\n   *\n   * @returns List of blocks to render.\n   */\n  startTrackingAll(): Block[] {\n    this.setTracking(true);\n    // All blocks that are not tracked must start tracking before any\n    // rendering takes place, since rendering requires knowing the dimensions\n    // of lower blocks. Also, since rendering a block renders all its parents,\n    // we only need to render the leaf nodes.\n    let renderList: Block[] = [];\n    if (\n      this.type !== ConnectionType.INPUT_VALUE &&\n      this.type !== ConnectionType.NEXT_STATEMENT\n    ) {\n      // Only spider down.\n      return renderList;\n    }\n    const block = this.targetBlock();\n    if (block) {\n      let connections;\n      if (block.isCollapsed()) {\n        // This block should only be partially revealed since it is collapsed.\n        connections = [];\n        block.outputConnection && connections.push(block.outputConnection);\n        block.nextConnection && connections.push(block.nextConnection);\n        block.previousConnection && connections.push(block.previousConnection);\n      } else {\n        // Show all connections of this block.\n        connections = block.getConnections_(true);\n      }\n      for (let i = 0; i < connections.length; i++) {\n        renderList.push(...connections[i].startTrackingAll());\n      }\n      if (!renderList.length) {\n        // Leaf block.\n        renderList = [block];\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Behaviour after a connection attempt fails.\n   * Bumps this connection away from the other connection. Called when an\n   * attempted connection fails.\n   *\n   * @param otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  override onFailedConnect(otherConnection: Connection) {\n    const block = this.getSourceBlock();\n    if (eventUtils.getRecordUndo()) {\n      const group = eventUtils.getGroup();\n      setTimeout(\n        function (this: RenderedConnection) {\n          if (!block.isDisposed() && !block.getParent()) {\n            eventUtils.setGroup(group);\n            this.bumpAwayFrom(otherConnection as RenderedConnection);\n            eventUtils.setGroup(false);\n          }\n        }.bind(this),\n        config.bumpDelay,\n      );\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  override disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) return;\n    const parent = parentConnection.getSourceBlock() as BlockSvg;\n    const child = childConnection.getSourceBlock() as BlockSvg;\n    super.disconnectInternal(setParent);\n    // Rerender the parent so that it may reflow.\n    if (parent.rendered) {\n      parent.queueRender();\n    }\n    if (child.rendered) {\n      child.updateDisabled();\n      child.queueRender();\n      // Reset visibility, since the child is now a top block.\n      child.getSvgRoot().style.display = 'block';\n    }\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   * Render/rerender blocks as needed.\n   */\n  protected override respawnShadow_() {\n    super.respawnShadow_();\n    const blockShadow = this.targetBlock();\n    if (!blockShadow) {\n      return;\n    }\n    blockShadow.initSvg();\n    blockShadow.queueRender();\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param maxLimit The maximum radius to another connection, in workspace\n   *     units.\n   * @returns List of connections.\n   * @internal\n   */\n  override neighbours(maxLimit: number): RenderedConnection[] {\n    return this.dbOpposite.getNeighbours(this, maxLimit);\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.  Rerender blocks as needed.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected override connect_(childConnection: Connection) {\n    super.connect_(childConnection);\n\n    const renderedChildConnection = childConnection as RenderedConnection;\n\n    const parentBlock = this.getSourceBlock();\n    const childBlock = renderedChildConnection.getSourceBlock();\n    const parentRendered = parentBlock.rendered;\n    const childRendered = childBlock.rendered;\n\n    if (parentRendered) {\n      parentBlock.updateDisabled();\n    }\n    if (childRendered) {\n      childBlock.updateDisabled();\n    }\n    if (parentRendered && childRendered) {\n      if (\n        this.type === ConnectionType.NEXT_STATEMENT ||\n        this.type === ConnectionType.PREVIOUS_STATEMENT\n      ) {\n        // Child block may need to square off its corners if it is in a stack.\n        // Rendering a child will render its parent.\n        childBlock.queueRender();\n      } else {\n        // Child block does not change shape.  Rendering the parent node will\n        // move its connected children into position.\n        parentBlock.queueRender();\n      }\n    }\n\n    // The input the child block is connected to (if any).\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\n    if (parentInput) {\n      const visible = parentInput.isVisible();\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected override onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n      // Bump away.\n      this.sourceBlock_.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   * Rerender blocks as needed.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  override setCheck(check: string | string[] | null): RenderedConnection {\n    super.setCheck(check);\n    if (this.sourceBlock_.rendered) {\n      this.sourceBlock_.queueRender();\n    }\n    return this;\n  }\n}\n\nexport namespace RenderedConnection {\n  /**\n   * Enum for different kinds of tracked states.\n   *\n   * WILL_TRACK means that this connection will add itself to\n   * the db on the next moveTo call it receives.\n   *\n   * UNTRACKED means that this connection will not add\n   * itself to the database until setTracking(true) is explicitly called.\n   *\n   * TRACKED means that this connection is currently being tracked.\n   */\n  export enum TrackedState {\n    WILL_TRACK = -1,\n    UNTRACKED = 0,\n    TRACKED = 1,\n  }\n}\n\nexport type TrackedState = RenderedConnection.TrackedState;\nexport const TrackedState = RenderedConnection.TrackedState;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BlockSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport * as browserEvents from './browser_events.js';\nimport {CommentIcon} from './icons/comment_icon.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {\n  ContextMenuOption,\n  ContextMenuRegistry,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {FieldLabel} from './field_label.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport {IIcon} from './interfaces/i_icon.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Msg} from './msg.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport type {IPathObject} from './renderers/common/i_path_object.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {BlockStyle} from './theme.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {WarningIcon} from './icons/warning_icon.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as renderManagement from './render_management.js';\nimport * as deprecation from './utils/deprecation.js';\nimport {IconType} from './icons/icon_types.js';\nimport {BlockCopyData, BlockPaster} from './clipboard/block_paster.js';\n\n/**\n * Class for a block's SVG representation.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class BlockSvg\n  extends Block\n  implements\n    IASTNodeLocationSvg,\n    IBoundedElement,\n    ICopyable<BlockCopyData>,\n    IDraggable\n{\n  /**\n   * Constant for identifying rows that are to be rendered inline.\n   * Don't collide with Blockly.inputTypes.\n   */\n  static readonly INLINE = -1;\n\n  /**\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\n   * \"collapsed warnings\" warning without removing any warnings that belong to\n   * the block.\n   */\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\n  override decompose?: (p1: Workspace) => BlockSvg;\n  // override compose?: ((p1: BlockSvg) => void)|null;\n  saveConnections?: (p1: BlockSvg) => void;\n  customContextMenu?: (\n    p1: Array<ContextMenuOption | LegacyContextMenuOption>,\n  ) => void;\n\n  /**\n   * Height of this block, not including any statement blocks above or below.\n   * Height is in workspace units.\n   */\n  height = 0;\n\n  /**\n   * Width of this block, including any connected value blocks.\n   * Width is in workspace units.\n   */\n  width = 0;\n\n  /**\n   * Map from IDs for warnings text to PIDs of functions to apply them.\n   * Used to be able to maintain multiple warnings.\n   */\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\n\n  /** Block's mutator icon (if any). */\n  mutator: MutatorIcon | null = null;\n\n  /**\n   * Block's warning icon (if any).\n   *\n   * @deprecated Use `setWarningText` to modify warnings on this block.\n   */\n  warning: WarningIcon | null = null;\n\n  private svgGroup_: SVGGElement;\n  style: BlockStyle;\n  /** @internal */\n  pathObject: IPathObject;\n  override rendered = false;\n  private visuallyDisabled = false;\n\n  /**\n   * Is this block currently rendering? Used to stop recursive render calls\n   * from actually triggering a re-render.\n   */\n  private renderIsInProgress_ = false;\n\n  /** Whether mousedown events have been bound yet. */\n  private eventsInit_ = false;\n\n  override workspace: WorkspaceSvg;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override outputConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override nextConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override previousConnection!: RenderedConnection;\n\n  private translation = '';\n\n  /**\n   * The ID of the setTimeout callback for bumping neighbours, or 0 if no bump\n   * is currently scheduled.\n   */\n  private bumpNeighboursPid = 0;\n\n  /** Whether this block is currently being dragged. */\n  private dragging = false;\n\n  /**\n   * The location of the top left of this block (in workspace coordinates)\n   * relative to either its parent block, or the workspace origin if it has no\n   * parent.\n   *\n   * @internal\n   */\n  relativeCoords = new Coordinate(0, 0);\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\n    super(workspace, prototypeName, opt_id);\n    this.workspace = workspace;\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {});\n\n    /** A block style object. */\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\n\n    /** The renderer's path object. */\n    this.pathObject = workspace\n      .getRenderer()\n      .makePathObject(this.svgGroup_, this.style);\n\n    const svgPath = this.pathObject.svgPath;\n    (svgPath as any).tooltip = this;\n    Tooltip.bindMouseEvents(svgPath);\n\n    // Expose this block's ID on its top-level SVG group.\n    this.svgGroup_.setAttribute('data-id', this.id);\n\n    this.doInit_();\n  }\n\n  /**\n   * Create and initialize the SVG representation of the block.\n   * May be called more than once.\n   */\n  initSvg() {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      input.init();\n    }\n    for (const icon of this.getIcons()) {\n      icon.initView(this.createIconPointerDownListener(icon));\n      icon.updateEditable();\n    }\n    this.applyColour();\n    this.pathObject.updateMovable(this.isMovable());\n    const svg = this.getSvgRoot();\n    if (!this.workspace.options.readOnly && !this.eventsInit_ && svg) {\n      browserEvents.conditionalBind(\n        svg,\n        'pointerdown',\n        this,\n        this.onMouseDown_,\n      );\n    }\n    this.eventsInit_ = true;\n\n    if (!svg.parentNode) {\n      this.workspace.getCanvas().appendChild(svg);\n    }\n  }\n\n  /**\n   * Get the secondary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourSecondary(): string | undefined {\n    return this.style.colourSecondary;\n  }\n\n  /**\n   * Get the tertiary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourTertiary(): string | undefined {\n    return this.style.colourTertiary;\n  }\n\n  /**\n   * Selects this block. Highlights the block visually and fires a select event\n   * if the block is not already selected.\n   */\n  select() {\n    if (this.isShadow() && this.getParent()) {\n      // Shadow blocks should not be selected.\n      this.getParent()!.select();\n      return;\n    }\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n      oldId,\n      this.id,\n      this.workspace.id,\n    );\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselects this block. Unhighlights the block and fires a select (false)\n   * event if the block is currently selected.\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n      this.id,\n      null,\n      this.workspace.id,\n    );\n    event.workspaceId = this.workspace.id;\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n  }\n\n  /**\n   * Sets the parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  override setParent(newParent: this | null) {\n    const oldParent = this.parentBlock_;\n    if (newParent === oldParent) {\n      return;\n    }\n\n    dom.startTextWidthCache();\n    super.setParent(newParent);\n    dom.stopTextWidthCache();\n\n    const svgRoot = this.getSvgRoot();\n\n    // Bail early if workspace is clearing, or we aren't rendered.\n    // We won't need to reattach ourselves anywhere.\n    if (this.workspace.isClearing || !svgRoot) {\n      return;\n    }\n\n    const oldXY = this.getRelativeToSurfaceXY();\n    if (newParent) {\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\n    } else if (oldParent) {\n      // If we are losing a parent, we want to move our DOM element to the\n      // root of the workspace.\n      const draggingBlock = this.workspace\n        .getCanvas()\n        .querySelector('.blocklyDragging');\n      if (draggingBlock) {\n        this.workspace.getCanvas().insertBefore(svgRoot, draggingBlock);\n      } else {\n        this.workspace.getCanvas().appendChild(svgRoot);\n      }\n      this.translate(oldXY.x, oldXY.y);\n    }\n\n    this.applyColour();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    const layerManger = this.workspace.getLayerManager();\n    if (!layerManger) {\n      throw new Error(\n        'Cannot calculate position because the workspace has not been appended',\n      );\n    }\n    let x = 0;\n    let y = 0;\n\n    let element: SVGElement = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this block and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        element = element.parentNode as SVGElement;\n      } while (element && !layerManger.hasLayer(element));\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  override moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const eventsEnabled = eventUtils.isEnabled();\n    let event: BlockMove | null = null;\n    if (eventsEnabled) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE)!)(this) as BlockMove;\n      reason && event.setReason(reason);\n    }\n\n    const delta = new Coordinate(dx, dy);\n    const currLoc = this.getRelativeToSurfaceXY();\n    const newLoc = Coordinate.sum(currLoc, delta);\n    this.translate(newLoc.x, newLoc.y);\n    this.updateComponentLocations(newLoc);\n\n    if (eventsEnabled && event) {\n      event!.recordNew();\n      eventUtils.fire(event);\n    }\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a block by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   */\n  translate(x: number, y: number) {\n    this.translation = `translate(${x}, ${y})`;\n    this.relativeCoords = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n  }\n\n  /**\n   * Returns the SVG translation of this block.\n   *\n   * @internal\n   */\n  getTranslation(): string {\n    return this.translation;\n  }\n\n  /**\n   * Move a block to a position.\n   *\n   * @param xy The position to move to in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveTo(xy: Coordinate, reason?: string[]) {\n    const curXY = this.getRelativeToSurfaceXY();\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y, reason);\n  }\n\n  /**\n   * Move this block during a drag.\n   * This block must be a top-level block.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.translate(newLoc.x, newLoc.y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n    this.updateComponentLocations(newLoc);\n  }\n\n  /** Snap this block to the nearest grid point. */\n  snapToGrid() {\n    if (this.isDeadOrDying()) {\n      return; // Deleted block.\n    }\n    if (this.workspace.isDragging()) {\n      return; // Don't bump blocks during a drag.\n    }\n\n    if (this.getParent()) {\n      return; // Only snap top-level blocks.\n    }\n    if (this.isInFlyout) {\n      return; // Don't move blocks around in a flyout.\n    }\n    const grid = this.workspace.getGrid();\n    if (!grid || !grid.shouldSnap()) {\n      return; // Config says no snapping.\n    }\n    const spacing = grid.getSpacing();\n    const half = spacing / 2;\n    const xy = this.getRelativeToSurfaceXY();\n    const dx = Math.round(\n      Math.round((xy.x - half) / spacing) * spacing + half - xy.x,\n    );\n    const dy = Math.round(\n      Math.round((xy.y - half) / spacing) * spacing + half - xy.y,\n    );\n    if (dx || dy) {\n      this.moveBy(dx, dy, ['snap']);\n    }\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block and any blocks stacked below it.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const blockBounds = this.getHeightWidth();\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - blockBounds.width;\n      right = blockXY.x;\n    } else {\n      left = blockXY.x;\n      right = blockXY.x + blockBounds.width;\n    }\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\n  }\n\n  /**\n   * Notify every input on this block to mark its fields as dirty.\n   * A dirty field is a field that needs to be re-rendered.\n   */\n  markDirty() {\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      input.markDirty();\n    }\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  override setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ === collapsed) {\n      return;\n    }\n    super.setCollapsed(collapsed);\n    this.updateCollapsed_();\n  }\n\n  /**\n   * Makes sure that when the block is collapsed, it is rendered correctly\n   * for that state.\n   */\n  private updateCollapsed_() {\n    const collapsed = this.isCollapsed();\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\n\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name !== collapsedInputName) {\n        input.setVisible(!collapsed);\n      }\n    }\n\n    for (const icon of this.getIcons()) {\n      icon.updateCollapsed();\n    }\n\n    if (!collapsed) {\n      this.updateDisabled();\n      this.removeInput(collapsedInputName);\n      return;\n    }\n\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\n    const field = this.getField(collapsedFieldName);\n    if (field) {\n      field.setValue(text);\n      return;\n    }\n    const input =\n      this.getInput(collapsedInputName) ||\n      this.appendDummyInput(collapsedInputName);\n    input.appendField(new FieldLabel(text), collapsedFieldName);\n  }\n\n  /**\n   * Open the next (or previous) FieldTextInput.\n   *\n   * @param start Current field.\n   * @param forward If true go forward, otherwise backward.\n   */\n  tab(start: Field, forward: boolean) {\n    const tabCursor = new TabNavigateCursor();\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\n    const currentNode = tabCursor.getCurNode();\n\n    if (forward) {\n      tabCursor.next();\n    } else {\n      tabCursor.prev();\n    }\n\n    const nextNode = tabCursor.getCurNode();\n    if (nextNode && nextNode !== currentNode) {\n      const nextField = nextNode.getLocation() as Field;\n      nextField.showEditor();\n\n      // Also move the cursor if we're in keyboard nav mode.\n      if (this.workspace.keyboardAccessibilityMode) {\n        this.workspace.getCursor()!.setCurNode(nextNode);\n      }\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBlockStart(e, this);\n    }\n  }\n\n  /**\n   * Load the block's help page in a new window.\n   *\n   * @internal\n   */\n  showHelp() {\n    const url =\n      typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\n    if (url) {\n      window.open(url);\n    }\n  }\n\n  /**\n   * Generate the context menu for this block.\n   *\n   * @returns Context menu options or null if no menu.\n   */\n  protected generateContextMenu(): Array<\n    ContextMenuOption | LegacyContextMenuOption\n  > | null {\n    if (this.workspace.options.readOnly || !this.contextMenu) {\n      return null;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.BLOCK,\n      {block: this},\n    );\n\n    // Allow the block to add or modify menuOptions.\n    if (this.customContextMenu) {\n      this.customContextMenu(menuOptions);\n    }\n\n    return menuOptions;\n  }\n\n  /**\n   * Show the context menu for this block.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    const menuOptions = this.generateContextMenu();\n\n    if (menuOptions && menuOptions.length) {\n      ContextMenu.show(e, menuOptions, this.RTL);\n      ContextMenu.setCurrentBlock(this);\n    }\n  }\n\n  /**\n   * Updates the locations of any parts of the block that need to know where\n   * they are (e.g. connections, icons).\n   *\n   * @param blockOrigin The top-left of this block in workspace coordinates.\n   * @internal\n   */\n  updateComponentLocations(blockOrigin: Coordinate) {\n    if (!this.rendered) {\n      // Rendering is required to lay out the blocks.\n      // This is probably an invisible block attached to a collapsed block.\n      return;\n    }\n\n    if (!this.dragging) this.updateConnectionLocations(blockOrigin);\n    this.updateIconLocations(blockOrigin);\n    this.updateFieldLocations(blockOrigin);\n\n    for (const child of this.getChildren(false)) {\n      child.updateComponentLocations(\n        Coordinate.sum(blockOrigin, child.relativeCoords),\n      );\n    }\n  }\n\n  private updateConnectionLocations(blockOrigin: Coordinate) {\n    for (const conn of this.getConnections_(false)) {\n      conn.moveToOffset(blockOrigin);\n    }\n  }\n\n  private updateIconLocations(blockOrigin: Coordinate) {\n    for (const icon of this.getIcons()) {\n      icon.onLocationChange(blockOrigin);\n    }\n  }\n\n  private updateFieldLocations(blockOrigin: Coordinate) {\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.onLocationChange(blockOrigin);\n      }\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    this.dragging = adding;\n    if (adding) {\n      this.translation = '';\n      common.draggingConnections.push(...this.getConnections_(true));\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\n    } else {\n      common.draggingConnections.length = 0;\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\n    }\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\n    }\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.pathObject.updateMovable(movable);\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].updateEditable();\n    }\n  }\n\n  /**\n   * Sets whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  override setShadow(shadow: boolean) {\n    super.setShadow(shadow);\n    this.applyColour();\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  override setInsertionMarker(insertionMarker: boolean) {\n    if (this.isInsertionMarker_ === insertionMarker) {\n      return; // No change.\n    }\n    this.isInsertionMarker_ = insertionMarker;\n    if (this.isInsertionMarker_) {\n      this.setColour(\n        this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR,\n      );\n      this.pathObject.updateInsertionMarker(true);\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   */\n  getSvgRoot(): SVGGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @param animate If true, show a disposal animation and sound.\n   */\n  override dispose(healStack?: boolean, animate?: boolean) {\n    if (this.isDeadOrDying()) return;\n\n    Tooltip.dispose();\n    ContextMenu.hide();\n\n    if (animate && this.rendered) {\n      this.unplug(healStack);\n      blockAnimations.disposeUiEffect(this);\n    }\n\n    super.dispose(!!healStack);\n    dom.removeNode(this.svgGroup_);\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does trigger UI effects, remove nodes, etc.\n   */\n  override disposeInternal() {\n    if (this.isDeadOrDying()) return;\n    super.disposeInternal();\n\n    this.rendered = false;\n\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    [...this.warningTextDb.values()].forEach((n) => clearTimeout(n));\n    this.warningTextDb.clear();\n\n    this.getIcons().forEach((i) => i.dispose());\n  }\n\n  /**\n   * Delete a block and hide chaff when doing so. The block will not be deleted\n   * if it's in a flyout. This is called from the context menu and keyboard\n   * shortcuts as the full delete action. If you are disposing of a block from\n   * the workspace and don't need to perform flyout checks, handle event\n   * grouping, or hide chaff, then use `block.dispose()` directly.\n   */\n  checkAndDelete() {\n    if (this.workspace.isFlyout) {\n      return;\n    }\n    eventUtils.setGroup(true);\n    this.workspace.hideChaff();\n    if (this.outputConnection) {\n      // Do not attempt to heal rows\n      // (https://github.com/google/blockly/issues/4832)\n      this.dispose(false, true);\n    } else {\n      this.dispose(/* heal */ true, true);\n    }\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Encode a block for copying.\n   *\n   * @returns Copy metadata, or null if the block is an insertion marker.\n   */\n  toCopyData(): BlockCopyData | null {\n    if (this.isInsertionMarker_) {\n      return null;\n    }\n    return {\n      paster: BlockPaster.TYPE,\n      blockState: blocks.save(this, {\n        addCoordinates: true,\n        addNextBlocks: false,\n      }) as blocks.State,\n      typeCounts: common.getBlockTypeCounts(this, true),\n    };\n  }\n\n  /**\n   * Updates the colour of the block to match the block's state.\n   *\n   * @internal\n   */\n  applyColour() {\n    this.pathObject.applyColour(this);\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].applyColour();\n    }\n\n    for (let x = 0, input; (input = this.inputList[x]); x++) {\n      for (let y = 0, field; (field = input.fieldRow[y]); y++) {\n        field.applyColour();\n      }\n    }\n  }\n\n  /**\n   * Updates the colour of the block (and children) to match the current\n   * disabled state.\n   *\n   * @internal\n   */\n  updateDisabled() {\n    const disabled = !this.isEnabled() || this.getInheritedDisabled();\n\n    if (this.visuallyDisabled === disabled) {\n      this.getNextBlock()?.updateDisabled();\n      return;\n    }\n\n    this.applyColour();\n    this.visuallyDisabled = disabled;\n    for (const child of this.getChildren(false)) {\n      child.updateDisabled();\n    }\n  }\n\n  /**\n   * Get the comment icon attached to this block, or null if the block has no\n   * comment.\n   *\n   * @returns The comment icon attached to this block, or null.\n   * @deprecated Use getIcon. To be remove in v11.\n   */\n  getCommentIcon(): CommentIcon | null {\n    deprecation.warn('getCommentIcon', 'v10', 'v11', 'getIcon');\n    return (this.getIcon(CommentIcon.TYPE) ?? null) as CommentIcon | null;\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param text The text, or null to delete.\n   * @param id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  override setWarningText(text: string | null, id: string = '') {\n    if (!id) {\n      // Kill all previous pending processes, this edit supersedes them all.\n      for (const timeout of this.warningTextDb.values()) {\n        clearTimeout(timeout);\n      }\n      this.warningTextDb.clear();\n    } else if (this.warningTextDb.has(id)) {\n      // Only queue up the latest change.  Kill any earlier pending process.\n      clearTimeout(this.warningTextDb.get(id)!);\n      this.warningTextDb.delete(id);\n    }\n    if (this.workspace.isDragging()) {\n      // Don't change the warning text during a drag.\n      // Wait until the drag finishes.\n      this.warningTextDb.set(\n        id,\n        setTimeout(() => {\n          if (!this.isDeadOrDying()) {\n            this.warningTextDb.delete(id);\n            this.setWarningText(text, id);\n          }\n        }, 100),\n      );\n      return;\n    }\n    if (this.isInFlyout) {\n      text = null;\n    }\n\n    const icon = this.getIcon(WarningIcon.TYPE) as WarningIcon | undefined;\n    if (text) {\n      // Bubble up to add a warning on top-most collapsed block.\n      // TODO(#6020): This warning is never removed.\n      let parent = this.getSurroundParent();\n      let collapsedParent = null;\n      while (parent) {\n        if (parent.isCollapsed()) {\n          collapsedParent = parent;\n        }\n        parent = parent.getSurroundParent();\n      }\n      if (collapsedParent) {\n        collapsedParent.setWarningText(\n          Msg['COLLAPSED_WARNINGS_WARNING'],\n          BlockSvg.COLLAPSED_WARNING_ID,\n        );\n      }\n\n      if (icon) {\n        (icon as WarningIcon).addMessage(text, id);\n      } else {\n        this.addIcon(new WarningIcon(this).addMessage(text, id));\n      }\n    } else if (icon) {\n      // Dispose all warnings if no ID is given.\n      if (!id) {\n        this.removeIcon(WarningIcon.TYPE);\n      } else {\n        // Remove just this warning id's message.\n        icon.addMessage('', id);\n        // Then remove the entire icon if there is no longer any text.\n        if (!icon.getText()) this.removeIcon(WarningIcon.TYPE);\n      }\n    }\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param mutator A mutator dialog instance or null to remove.\n   */\n  override setMutator(mutator: MutatorIcon | null) {\n    this.removeIcon(MutatorIcon.TYPE);\n    if (mutator) this.addIcon(mutator);\n  }\n\n  override addIcon<T extends IIcon>(icon: T): T {\n    super.addIcon(icon);\n\n    if (icon instanceof WarningIcon) this.warning = icon;\n    if (icon instanceof MutatorIcon) this.mutator = icon;\n\n    if (this.rendered) {\n      icon.initView(this.createIconPointerDownListener(icon));\n      icon.applyColour();\n      icon.updateEditable();\n      this.queueRender();\n      renderManagement.triggerQueuedRenders();\n      this.bumpNeighbours();\n    }\n\n    return icon;\n  }\n\n  /**\n   * Creates a pointer down event listener for the icon to append to its\n   * root svg.\n   */\n  private createIconPointerDownListener(icon: IIcon) {\n    return (e: PointerEvent) => {\n      if (this.isDeadOrDying()) return;\n      const gesture = this.workspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartIcon(icon);\n      }\n    };\n  }\n\n  override removeIcon(type: IconType<IIcon>): boolean {\n    const removed = super.removeIcon(type);\n\n    if (type.equals(WarningIcon.TYPE)) this.warning = null;\n    if (type.equals(MutatorIcon.TYPE)) this.mutator = null;\n\n    if (this.rendered) {\n      this.queueRender();\n      renderManagement.triggerQueuedRenders();\n      this.bumpNeighbours();\n    }\n    return removed;\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  override setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      super.setEnabled(enabled);\n      if (this.rendered && !this.getInheritedDisabled()) {\n        this.updateDisabled();\n      }\n    }\n  }\n\n  /**\n   * Set whether the block is highlighted or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  setHighlighted(highlighted: boolean) {\n    if (!this.rendered) {\n      return;\n    }\n    this.pathObject.updateHighlighted(highlighted);\n  }\n\n  /**\n   * Adds the visual \"select\" effect to the block, but does not actually select\n   * it or fire an event.\n   *\n   * @see BlockSvg#select\n   */\n  addSelect() {\n    this.pathObject.updateSelected(true);\n  }\n\n  /**\n   * Removes the visual \"select\" effect from the block, but does not actually\n   * unselect it or fire an event.\n   *\n   * @see BlockSvg#unselect\n   */\n  removeSelect() {\n    this.pathObject.updateSelected(false);\n  }\n\n  /**\n   * Update the cursor over this block by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    this.pathObject.updateDraggingDelete(enable);\n  }\n\n  // Overrides of functions on Blockly.Block that take into account whether the\n  // block has been rendered.\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  override getColour(): string {\n    return this.style.colourPrimary;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value, or #RRGGBB string.\n   */\n  override setColour(colour: number | string) {\n    super.setColour(colour);\n    const styleObj = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyleForColour(this.colour_);\n\n    this.pathObject.setStyle(styleObj.style);\n    this.style = styleObj.style;\n    this.styleName_ = styleObj.name;\n\n    this.applyColour();\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   * @throws {Error} if the block style does not exist.\n   */\n  override setStyle(blockStyleName: string) {\n    const blockStyle = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyle(blockStyleName);\n    this.styleName_ = blockStyleName;\n\n    if (blockStyle) {\n      this.hat = blockStyle.hat;\n      this.pathObject.setStyle(blockStyle);\n      // Set colour to match Block.\n      this.colour_ = blockStyle.colourPrimary;\n      this.style = blockStyle;\n\n      this.applyColour();\n    } else {\n      throw Error('Invalid style name: ' + blockStyleName);\n    }\n  }\n\n  /**\n   * Move this block to the front of the visible workspace.\n   * <g> tags do not respect z-index so SVG renders them in the\n   * order that they are in the DOM.  By placing this block first within the\n   * block group's <g>, it will render on top of any other blocks.\n   *\n   * @param blockOnly: True to only move this block to the front without\n   *     adjusting its parents.\n   * @internal\n   */\n  bringToFront(blockOnly = false) {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    if (block.isDeadOrDying()) {\n      return;\n    }\n    do {\n      const root = block.getSvgRoot();\n      const parent = root.parentNode;\n      const childNodes = parent!.childNodes;\n      // Avoid moving the block if it's already at the bottom.\n      if (childNodes[childNodes.length - 1] !== root) {\n        parent!.appendChild(root);\n      }\n      if (blockOnly) break;\n      block = block.getParent();\n    } while (block);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setPreviousStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setNextStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setNextStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  override setOutput(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setOutput(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  override setInputsInline(newBoolean: boolean) {\n    super.setInputsInline(newBoolean);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\n    const removed = super.removeInput(name, opt_quiet);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Removing an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n\n    return removed;\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    super.moveNumberedInputBefore(inputIndex, refIndex);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Moving an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /** @override */\n  override appendInput(input: Input): Input {\n    super.appendInput(input);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Adding an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n    return input;\n  }\n\n  /**\n   * Sets whether this block's connections are tracked in the database or not.\n   *\n   * Used by the deserializer to be more efficient. Setting a connection's\n   * tracked_ value to false keeps it from adding itself to the db when it\n   * gets its first moveTo call, saving expensive ops for later.\n   *\n   * @param track If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setConnectionTracking(track: boolean) {\n    if (this.previousConnection) {\n      this.previousConnection.setTracking(track);\n    }\n    if (this.outputConnection) {\n      this.outputConnection.setTracking(track);\n    }\n    if (this.nextConnection) {\n      this.nextConnection.setTracking(track);\n      const child = this.nextConnection.targetBlock();\n      if (child) {\n        child.setConnectionTracking(track);\n      }\n    }\n\n    if (this.collapsed_) {\n      // When track is true, we don't want to start tracking collapsed\n      // connections. When track is false, we're already not tracking\n      // collapsed connections, so no need to update.\n      return;\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.setTracking(track);\n\n        // Pass tracking on down the chain.\n        const block = conn.targetBlock();\n        if (block) {\n          block.setConnectionTracking(track);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns connections originating from this block.\n   *\n   * @param all If true, return all connections even hidden ones.\n   *     Otherwise, for a non-rendered block return an empty list, and for a\n   *     collapsed block don't return inputs connections.\n   * @returns Array of connections.\n   * @internal\n   */\n  override getConnections_(all: boolean): RenderedConnection[] {\n    const myConnections = [];\n    if (all || this.rendered) {\n      if (this.outputConnection) {\n        myConnections.push(this.outputConnection);\n      }\n      if (this.previousConnection) {\n        myConnections.push(this.previousConnection);\n      }\n      if (this.nextConnection) {\n        myConnections.push(this.nextConnection);\n      }\n      if (all || !this.collapsed_) {\n        for (let i = 0, input; (input = this.inputList[i]); i++) {\n          if (input.connection) {\n            myConnections.push(input.connection as RenderedConnection);\n          }\n        }\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  override lastConnectionInStack(\n    ignoreShadows: boolean,\n  ): RenderedConnection | null {\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  override getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): RenderedConnection | null {\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  override makeConnection_(type: ConnectionType): RenderedConnection {\n    return new RenderedConnection(this, type);\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  override getNextBlock(): BlockSvg | null {\n    return super.getNextBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  override getPreviousBlock(): BlockSvg | null {\n    return super.getPreviousBlock() as BlockSvg;\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   *\n   * Two blocks which aren't actually connected should not coincidentally line\n   * up on screen, because that creates confusion for end-users.\n   */\n  override bumpNeighbours() {\n    if (this.bumpNeighboursPid) return;\n    const group = eventUtils.getGroup();\n\n    this.bumpNeighboursPid = setTimeout(() => {\n      const oldGroup = eventUtils.getGroup();\n      eventUtils.setGroup(group);\n      this.getRootBlock().bumpNeighboursInternal();\n      eventUtils.setGroup(oldGroup);\n      this.bumpNeighboursPid = 0;\n    }, config.bumpDelay);\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   */\n  private bumpNeighboursInternal() {\n    const root = this.getRootBlock();\n    if (\n      this.isDeadOrDying() ||\n      this.workspace.isDragging() ||\n      root.isInFlyout\n    ) {\n      return;\n    }\n\n    function neighbourIsInStack(neighbour: RenderedConnection) {\n      return neighbour.getSourceBlock().getRootBlock() === root;\n    }\n\n    for (const conn of this.getConnections_(false)) {\n      if (conn.isSuperior()) {\n        // Recurse down the block stack.\n        conn.targetBlock()?.bumpNeighboursInternal();\n      }\n\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\n        // Don't bump away from things that are in our stack.\n        if (neighbourIsInStack(neighbour)) continue;\n        // If both connections are connected, that's fine.\n        if (conn.isConnected() && neighbour.isConnected()) continue;\n\n        // Always bump the inferior connection.\n        if (conn.isSuperior()) {\n          neighbour.bumpAwayFrom(conn);\n        } else {\n          conn.bumpAwayFrom(neighbour);\n        }\n      }\n    }\n  }\n\n  /**\n   * Schedule snapping to grid and bumping neighbours to occur after a brief\n   * delay.\n   *\n   * @internal\n   */\n  scheduleSnapAndBump() {\n    // Ensure that any snap and bump are part of this move's event group.\n    const group = eventUtils.getGroup();\n\n    setTimeout(() => {\n      eventUtils.setGroup(group);\n      this.snapToGrid();\n      eventUtils.setGroup(false);\n    }, config.bumpDelay / 2);\n\n    this.bumpNeighbours();\n  }\n\n  /**\n   * Position a block so that it doesn't move the target block when connected.\n   * The block to position is usually either the first block in a dragged stack\n   * or an insertion marker.\n   *\n   * @param sourceConnection The connection on the moving block's stack.\n   * @param originalOffsetToTarget The connection original offset to the target connection\n   * @param originalOffsetInBlock The connection original offset in its block\n   * @internal\n   */\n  positionNearConnection(\n    sourceConnection: RenderedConnection,\n    originalOffsetToTarget: {x: number; y: number},\n    originalOffsetInBlock: Coordinate,\n  ) {\n    // We only need to position the new block if it's before the existing one,\n    // otherwise its position is set by the previous block.\n    if (\n      sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\n      sourceConnection.type === ConnectionType.INPUT_VALUE\n    ) {\n      // First move the block to match the orginal target connection position\n      let dx = originalOffsetToTarget.x;\n      let dy = originalOffsetToTarget.y;\n      // Then adjust its position according to the connection resize\n      dx += originalOffsetInBlock.x - sourceConnection.getOffsetInBlock().x;\n      dy += originalOffsetInBlock.y - sourceConnection.getOffsetInBlock().y;\n\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getChildren(ordered: boolean): BlockSvg[] {\n    return super.getChildren(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Triggers a rerender after a delay to allow for batching.\n   *\n   * @returns A promise that resolves after the currently queued renders have\n   *     been completed. Used for triggering other behavior that relies on\n   *     updated size/position location for the block.\n   * @internal\n   */\n  queueRender(): Promise<void> {\n    return renderManagement.queueRender(this);\n  }\n\n  /**\n   * Immediately lays out and reflows a block based on its contents and\n   * settings.\n   */\n  render() {\n    this.queueRender();\n    renderManagement.triggerQueuedRenders();\n  }\n\n  /**\n   * Renders this block in a way that's compatible with the more efficient\n   * render management system.\n   *\n   * @internal\n   */\n  renderEfficiently() {\n    this.rendered = true;\n    dom.startTextWidthCache();\n\n    if (this.isCollapsed()) {\n      this.updateCollapsed_();\n    }\n\n    if (!this.isEnabled()) {\n      this.updateDisabled();\n    }\n\n    this.workspace.getRenderer().render(this);\n    this.tightenChildrenEfficiently();\n\n    dom.stopTextWidthCache();\n    this.updateMarkers_();\n  }\n\n  /**\n   * Tightens all children of this block so they are snuggly rendered against\n   * their parent connections.\n   *\n   * Does not update connection locations, so that they can be updated more\n   * efficiently by the render management system.\n   *\n   * @internal\n   */\n  tightenChildrenEfficiently() {\n    for (const input of this.inputList) {\n      const conn = input.connection as RenderedConnection;\n      if (conn) conn.tightenEfficiently();\n    }\n    if (this.nextConnection) this.nextConnection.tightenEfficiently();\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\n      // TODO(#4592): Update all markers on the block.\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.updateMarkers_();\n      }\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.pathObject.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.pathObject.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this block\n   * and any blocks stacked below it.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number; width: number} {\n    let height = this.height;\n    let width = this.width;\n    // Recursively add size of subsequent blocks.\n    const nextBlock = this.getNextBlock();\n    if (nextBlock) {\n      const nextHeightWidth = nextBlock.getHeightWidth();\n      const tabHeight = this.workspace\n        .getRenderer()\n        .getConstants().NOTCH_HEIGHT;\n      height += nextHeightWidth.height - tabHeight;\n      width = Math.max(width, nextHeightWidth.width);\n    }\n    return {height, width};\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped, this block\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\n   * bump.\n   *\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  fadeForReplacement(add: boolean) {\n    this.pathObject.updateReplacementFade(add);\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped it will connect\n   * to this input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\n    this.pathObject.updateShapeForInputHighlight(conn, add);\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component with custom behaviour when a\n * block or bubble is dragged over or dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DragTarget\n\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {Rect} from './utils/rect.js';\n\n/**\n * Abstract class for a component with custom behaviour when a block or bubble\n * is dragged over or dropped on top of it.\n */\nexport class DragTarget implements IDragTarget {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  id!: string;\n\n  /**\n   * Constructor for DragTarget. It exists to add the id property and should not\n   * be called directly, only by a subclass.\n   */\n  constructor() {}\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(_dragElement: IDraggable) {}\n  // no-op\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDrop(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to the Blockly injection div.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null {\n    return null;\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(_dragElement: IDraggable): boolean {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component that can delete a block or\n * bubble that is dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DeleteArea\n\nimport {BlockSvg} from './block_svg.js';\nimport {DragTarget} from './drag_target.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\n\n/**\n * Abstract class for a component that can delete a block or bubble that is\n * dropped on top of it.\n */\nexport class DeleteArea extends DragTarget implements IDeleteArea {\n  /**\n   * Whether the last block or bubble dragged over this delete area would be\n   * deleted if dropped on this component.\n   * This property is not updated after the block or bubble is deleted.\n   */\n  protected wouldDelete_ = false;\n\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override id!: string;\n\n  /**\n   * Constructor for DeleteArea. Should not be called directly, only by a\n   * subclass.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\n      this.updateWouldDelete_(couldDeleteBlock && !couldConnect);\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected updateWouldDelete_(wouldDelete: boolean) {\n    this.wouldDelete_ = wouldDelete;\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a trash can icon.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Trashcan\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_trashcan_open.js';\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockDelete} from './events/events_block_delete.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as registry from './registry.js';\nimport type * as blocks from './serialization/blocks.js';\nimport {SPRITE} from './sprites.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport {BlockInfo} from './utils/toolbox.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a trash can.\n */\nexport class Trashcan\n  extends DeleteArea\n  implements IAutoHideable, IPositionable\n{\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'trashcan';\n\n  /**\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\n   */\n  private readonly contents: string[] = [];\n\n  /**\n   * The trashcan flyout.\n   *\n   * @internal\n   */\n  flyout: IFlyout | null = null;\n\n  /** Current open/close state of the lid. */\n  isLidOpen = false;\n\n  /**\n   * The minimum openness of the lid. Used to indicate if the trashcan\n   * contains blocks.\n   */\n  private minOpenness = 0;\n\n  /** The SVG group containing the trash can. */\n  private svgGroup: SVGElement | null = null;\n\n  /** The SVG image element of the trash can lid. */\n  private svgLid: SVGElement | null = null;\n\n  /** Task ID of opening/closing animation. */\n  private lidTask: ReturnType<typeof setTimeout> | null = null;\n\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\n  private lidOpen = 0;\n\n  /** Left coordinate of the trash can. */\n  private left = 0;\n\n  /** Top coordinate of the trash can. */\n  private top = 0;\n\n  /** Whether this trash can has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private workspace: WorkspaceSvg) {\n    super();\n\n    if (this.workspace.options.maxTrashcanContents <= 0) {\n      return;\n    }\n\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Options({\n      'scrollbars': true,\n      'parentWorkspace': this.workspace,\n      'rtl': this.workspace.RTL,\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\n      'renderer': this.workspace.options.renderer,\n      'rendererOverrides': this.workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Create vertical or horizontal flyout.\n    if (this.workspace.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.TOP\n          ? toolbox.Position.BOTTOM\n          : toolbox.Position.TOP;\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT\n          ? toolbox.Position.LEFT\n          : toolbox.Position.RIGHT;\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\n    }\n    this.workspace.addChangeListener(this.onDelete.bind(this));\n  }\n\n  /**\n   * Create the trash can elements.\n   *\n   * @returns The trash can's SVG group.\n   */\n  createDom(): SVGElement {\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyTrash\">\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\n          </clippath>\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\n          <clippath id=\"blocklyTrashLidClipPath837493\">\n            <rect width=\"47\" height=\"15\"></rect>\n          </clippath>\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\n        </g>\n        */\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\n    let clip;\n    const rnd = String(Math.random()).substring(2);\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashBodyClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\n      clip,\n    );\n    const body = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    body.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashLidClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': LID_HEIGHT},\n      clip,\n    );\n    this.svgLid = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    this.svgLid.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // bindEventWithChecks_ quashes events too aggressively. See:\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\n    // See #4303\n    browserEvents.bind(\n      this.svgGroup,\n      'pointerdown',\n      this,\n      this.blockMouseDownWhenOpenable,\n    );\n    browserEvents.bind(this.svgGroup, 'pointerup', this, this.click);\n    // Bind to body instead of this.svgGroup so that we don't get lid jitters\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver);\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut);\n    this.animateLid();\n    return this.svgGroup;\n  }\n\n  /** Initializes the trash can. */\n  init() {\n    if (this.workspace.options.maxTrashcanContents > 0) {\n      dom.insertAfter(\n        this.flyout!.createDom(Svg.SVG)!,\n        this.workspace.getParentSvg(),\n      );\n      this.flyout!.init(this.workspace);\n    }\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n        ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initialized = true;\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Dispose of this trash can.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('trashcan');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n  }\n\n  /**\n   * Whether the trashcan has contents.\n   *\n   * @returns True if the trashcan has contents.\n   */\n  private hasContents(): boolean {\n    return !!this.contents.length;\n  }\n\n  /**\n   * Returns true if the trashcan contents-flyout is currently open.\n   *\n   * @returns True if the trashcan contents-flyout is currently open.\n   */\n  contentsIsOpen(): boolean {\n    return !!this.flyout && this.flyout.isVisible();\n  }\n\n  /** Opens the trashcan flyout. */\n  openFlyout() {\n    if (this.contentsIsOpen()) {\n      return;\n    }\n    const contents = this.contents.map(function (string) {\n      return JSON.parse(string);\n    });\n    // Trashcans with lots of blocks can take a second to render.\n    const blocklyStyle = this.workspace.getParentSvg().style;\n    blocklyStyle.cursor = 'wait';\n    setTimeout(() => {\n      this.flyout?.show(contents);\n      blocklyStyle.cursor = '';\n      this.workspace.scrollbar?.setVisible(false);\n    }, 10);\n    this.fireUiEvent(true);\n  }\n\n  /** Closes the trashcan flyout. */\n  closeFlyout() {\n    if (!this.contentsIsOpen()) {\n      return;\n    }\n    this.flyout?.hide();\n    this.workspace.scrollbar?.setVisible(true);\n    this.fireUiEvent(false);\n    this.workspace.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // For now the trashcan flyout always autocloses because it overlays the\n    // trashcan UI (no trashcan to click to close it).\n    if (!onlyClosePopups && this.flyout) {\n      this.closeFlyout();\n    }\n  }\n\n  /**\n   * Empties the trashcan's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  emptyContents() {\n    if (!this.hasContents()) {\n      return;\n    }\n    this.contents.length = 0;\n    this.setMinOpenness(0);\n    this.closeFlyout();\n  }\n\n  /**\n   * Positions the trashcan.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n\n    const height = BODY_HEIGHT + LID_HEIGHT;\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(WIDTH, height),\n      MARGIN_HORIZONTAL,\n      MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    const bottom = this.top + BODY_HEIGHT + LID_HEIGHT;\n    const right = this.left + WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup) {\n      return null;\n    }\n\n    const trashRect = this.svgGroup.getBoundingClientRect();\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragOver(_dragElement: IDraggable) {\n    this.setLidOpen(this.wouldDelete_);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    setTimeout(this.setLidOpen.bind(this, false), 100);\n  }\n\n  /**\n   * Flip the lid open or shut.\n   *\n   * @param state True if open.\n   * @internal\n   */\n  setLidOpen(state: boolean) {\n    if (this.isLidOpen === state) {\n      return;\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n    this.isLidOpen = state;\n    this.animateLid();\n  }\n\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\n  private animateLid() {\n    const frames = ANIMATION_FRAMES;\n\n    const delta = 1 / (frames + 1);\n    this.lidOpen += this.isLidOpen ? delta : -delta;\n    this.lidOpen = Math.min(Math.max(this.lidOpen, this.minOpenness), 1);\n\n    this.setLidAngle(this.lidOpen * MAX_LID_ANGLE);\n\n    // Linear interpolation between min and max.\n    const opacity = OPACITY_MIN + this.lidOpen * (OPACITY_MAX - OPACITY_MIN);\n    if (this.svgGroup) {\n      this.svgGroup.style.opacity = `${opacity}`;\n    }\n\n    if (this.lidOpen > this.minOpenness && this.lidOpen < 1) {\n      this.lidTask = setTimeout(\n        this.animateLid.bind(this),\n        ANIMATION_LENGTH / frames,\n      );\n    }\n  }\n\n  /**\n   * Set the angle of the trashcan's lid.\n   *\n   * @param lidAngle The angle at which to set the lid.\n   */\n  private setLidAngle(lidAngle: number) {\n    const openAtRight =\n      this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\n      (this.workspace.horizontalLayout && this.workspace.RTL);\n    this.svgLid?.setAttribute(\n      'transform',\n      'rotate(' +\n        (openAtRight ? -lidAngle : lidAngle) +\n        ',' +\n        (openAtRight ? 4 : WIDTH - 4) +\n        ',' +\n        (LID_HEIGHT - 2) +\n        ')',\n    );\n  }\n\n  /**\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\n   * closed, this will update lid's position.\n   *\n   * @param newMin The new minimum openness of the lid. Should be between 0\n   *     and 1.\n   */\n  private setMinOpenness(newMin: number) {\n    this.minOpenness = newMin;\n    if (!this.isLidOpen) {\n      this.setLidAngle(newMin * MAX_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Flip the lid shut.\n   * Called externally after a drag.\n   */\n  closeLid() {\n    this.setLidOpen(false);\n  }\n\n  /** Inspect the contents of the trash. */\n  click() {\n    if (!this.hasContents() || this.workspace.isDragging()) {\n      return;\n    }\n    this.openFlyout();\n  }\n\n  /**\n   * Fires a UI event for trashcan flyout open or close.\n   *\n   * @param trashcanOpen Whether the flyout is opening.\n   */\n  private fireUiEvent(trashcanOpen: boolean) {\n    const uiEvent = new (eventUtils.get(eventUtils.TRASHCAN_OPEN))(\n      trashcanOpen,\n      this.workspace.id,\n    );\n    eventUtils.fire(uiEvent);\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\n   *\n   * @param e A mouse down event.\n   */\n  private blockMouseDownWhenOpenable(e: PointerEvent) {\n    if (!this.contentsIsOpen() && this.hasContents()) {\n      // Don't start a workspace scroll.\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\n   */\n  private mouseOver() {\n    if (this.hasContents()) {\n      this.setLidOpen(true);\n    }\n  }\n\n  /**\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\n   *    blocks).\n   */\n  private mouseOut() {\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\n    // won't be open in the first place, and setOpen won't run.\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\n   * array.\n   *\n   * @param event Workspace event.\n   */\n  private onDelete(event: Abstract) {\n    if (\n      this.workspace.options.maxTrashcanContents <= 0 ||\n      event.type !== eventUtils.BLOCK_DELETE\n    ) {\n      return;\n    }\n    const deleteEvent = event as BlockDelete;\n    if (event.type === eventUtils.BLOCK_DELETE && !deleteEvent.wasShadow) {\n      if (!deleteEvent.oldJson) {\n        throw new Error('Encountered a delete event without proper oldJson');\n      }\n      const cleanedJson = JSON.stringify(\n        this.cleanBlockJson(deleteEvent.oldJson),\n      );\n      if (this.contents.indexOf(cleanedJson) !== -1) {\n        return;\n      }\n      this.contents.unshift(cleanedJson);\n      while (\n        this.contents.length > this.workspace.options.maxTrashcanContents\n      ) {\n        this.contents.pop();\n      }\n\n      this.setMinOpenness(HAS_BLOCKS_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Converts JSON representing a block into text that can be stored in the\n   * content array.\n   *\n   * @param json A JSON representation of a block's state.\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\n   *     unnecessary attributes.\n   */\n  private cleanBlockJson(json: blocks.State): BlockInfo {\n    // Create a deep copy.\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\n\n    /**\n     * Reshape JSON into a nicer format.\n     *\n     * @param json The JSON to clean.\n     */\n    function cleanRec(json: blocks.State) {\n      if (!json) {\n        return;\n      }\n\n      delete json['id'];\n      delete json['x'];\n      delete json['y'];\n      delete json['enabled'];\n\n      if (json['icons'] && json['icons']['comment']) {\n        const comment = json['icons']['comment'];\n        delete comment['height'];\n        delete comment['width'];\n        delete comment['pinned'];\n      }\n\n      const inputs = json['inputs'];\n      for (const name in inputs) {\n        const input = inputs[name];\n        const block = input['block'];\n        const shadow = input['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n      if (json['next']) {\n        const next = json['next'];\n        const block = next['block'];\n        const shadow = next['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n    }\n\n    cleanRec(json);\n\n    const blockInfo: BlockInfo = {\n      'kind': 'BLOCK',\n      ...json,\n    };\n    return blockInfo;\n  }\n}\n\n/** Width of both the trash can and lid images. */\nconst WIDTH = 47;\n\n/** Height of the trashcan image (minus lid). */\nconst BODY_HEIGHT = 44;\n\n/** Height of the lid image. */\nconst LID_HEIGHT = 16;\n\n/** Distance between trashcan and bottom or top edge of workspace. */\nconst MARGIN_VERTICAL = 20;\n\n/** Distance between trashcan and right or left edge of workspace. */\nconst MARGIN_HORIZONTAL = 20;\n\n/** Extent of hotspot on all sides beyond the size of the image. */\nconst MARGIN_HOTSPOT = 10;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_LEFT = 0;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_TOP = 32;\n\n/**\n * The openness of the lid when the trashcan contains blocks.\n *    (0.0 = closed, 1.0 = open)\n */\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\n\n/** The length of the lid open/close animation in milliseconds. */\nconst ANIMATION_LENGTH = 80;\n\n/** The number of frames in the animation. */\nconst ANIMATION_FRAMES = 4;\n\n/** The minimum (resting) opacity of the trashcan and lid. */\nconst OPACITY_MIN = 0.4;\n\n/** The maximum (hovered) opacity of the trashcan and lid. */\nconst OPACITY_MAX = 0.8;\n\n/**\n * The maximum angle the trashcan lid can opens to. At the end of the open\n * animation the lid will be open to this angle.\n */\nconst MAX_LID_ANGLE = 45;\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The namespace used to keep track of keyboard shortcuts and the\n * key codes used to execute those shortcuts.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ShortcutRegistry\n\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as object from './utils/object.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of keyboard shortcuts. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ShortcutRegistry.registry.\n */\nexport class ShortcutRegistry {\n  static readonly registry = new ShortcutRegistry();\n\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\n  private shortcuts = new Map<string, KeyboardShortcut>();\n\n  /** Map of key codes to an array of shortcut names. */\n  private keyMap = new Map<string, string[]>();\n\n  /** Resets the existing ShortcutRegistry singleton. */\n  private constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry and keyMap. */\n  reset() {\n    this.shortcuts.clear();\n    this.keyMap.clear();\n  }\n\n  /**\n   * Registers a keyboard shortcut.\n   *\n   * @param shortcut The shortcut for this key code.\n   * @param opt_allowOverrides True to prevent a warning when overriding an\n   *     already registered item.\n   * @throws {Error} if a shortcut with the same name already exists.\n   */\n  register(shortcut: KeyboardShortcut, opt_allowOverrides?: boolean) {\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\n    if (registeredShortcut && !opt_allowOverrides) {\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\n    }\n    this.shortcuts.set(shortcut.name, shortcut);\n\n    const keyCodes = shortcut.keyCodes;\n    if (keyCodes && keyCodes.length > 0) {\n      for (let i = 0; i < keyCodes.length; i++) {\n        this.addKeyMapping(\n          keyCodes[i],\n          shortcut.name,\n          !!shortcut.allowCollision,\n        );\n      }\n    }\n  }\n\n  /**\n   * Unregisters a keyboard shortcut registered with the given key code. This\n   * will also remove any key mappings that reference this shortcut.\n   *\n   * @param shortcutName The name of the shortcut to unregister.\n   * @returns True if an item was unregistered, false otherwise.\n   */\n  unregister(shortcutName: string): boolean {\n    const shortcut = this.shortcuts.get(shortcutName);\n\n    if (!shortcut) {\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\n      return false;\n    }\n\n    this.removeAllKeyMappings(shortcutName);\n\n    this.shortcuts.delete(shortcutName);\n    return true;\n  }\n\n  /**\n   * Adds a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_allowCollision True to prevent an error when adding a shortcut\n   *     to a key that is already mapped to a shortcut.\n   * @throws {Error} if the given key code is already mapped to a shortcut.\n   */\n  addKeyMapping(\n    keyCode: string | number | KeyCodes,\n    shortcutName: string,\n    opt_allowCollision?: boolean,\n  ) {\n    keyCode = `${keyCode}`;\n    const shortcutNames = this.keyMap.get(keyCode);\n    if (shortcutNames && !opt_allowCollision) {\n      throw new Error(\n        `Shortcut named \"${shortcutName}\" collides with shortcuts \"${shortcutNames}\"`,\n      );\n    } else if (shortcutNames && opt_allowCollision) {\n      shortcutNames.unshift(shortcutName);\n    } else {\n      this.keyMap.set(keyCode, [shortcutName]);\n    }\n  }\n\n  /**\n   * Removes a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_quiet True to not console warn when there is no shortcut to\n   *     remove.\n   * @returns True if a key mapping was removed, false otherwise.\n   */\n  removeKeyMapping(\n    keyCode: string,\n    shortcutName: string,\n    opt_quiet?: boolean,\n  ): boolean {\n    const shortcutNames = this.keyMap.get(keyCode);\n\n    if (!shortcutNames) {\n      if (!opt_quiet) {\n        console.warn(\n          `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n        );\n      }\n      return false;\n    }\n\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\n    if (shortcutIdx > -1) {\n      shortcutNames.splice(shortcutIdx, 1);\n      if (shortcutNames.length === 0) {\n        this.keyMap.delete(keyCode);\n      }\n      return true;\n    }\n    if (!opt_quiet) {\n      console.warn(\n        `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n      );\n    }\n    return false;\n  }\n\n  /**\n   * Removes all the key mappings for a shortcut with the given name.\n   * Useful when changing the default key mappings and the key codes registered\n   * to the shortcut are unknown.\n   *\n   * @param shortcutName The name of the shortcut to remove from the key map.\n   */\n  removeAllKeyMappings(shortcutName: string) {\n    for (const keyCode of this.keyMap.keys()) {\n      this.removeKeyMapping(keyCode, shortcutName, true);\n    }\n  }\n\n  /**\n   * Sets the key map. Setting the key map will override any default key\n   * mappings.\n   *\n   * @param newKeyMap The object with key code to shortcut names.\n   */\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\n    this.keyMap.clear();\n    for (const key in newKeyMap) {\n      this.keyMap.set(key, newKeyMap[key]);\n    }\n  }\n\n  /**\n   * Gets the current key map.\n   *\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\n   */\n  getKeyMap(): {[key: string]: string[]} {\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\n    for (const [key, value] of this.keyMap) {\n      legacyKeyMap[key] = value;\n    }\n    return legacyKeyMap;\n  }\n\n  /**\n   * Gets the registry of keyboard shortcuts.\n   *\n   * @returns The registry of keyboard shortcuts.\n   */\n  getRegistry(): {[key: string]: KeyboardShortcut} {\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\n      Object.create(null);\n    for (const [key, value] of this.shortcuts) {\n      legacyRegistry[key] = value;\n    }\n    return object.deepMerge(Object.create(null), legacyRegistry);\n  }\n\n  /**\n   * Handles key down events.\n   *\n   * @param workspace The main workspace where the event was captured.\n   * @param e The key down event.\n   * @returns True if the event was handled, false otherwise.\n   */\n  onKeyDown(workspace: WorkspaceSvg, e: KeyboardEvent): boolean {\n    const key = this.serializeKeyEvent_(e);\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\n    if (!shortcutNames) {\n      return false;\n    }\n    for (let i = 0, shortcutName; (shortcutName = shortcutNames[i]); i++) {\n      const shortcut = this.shortcuts.get(shortcutName);\n      if (!shortcut?.preconditionFn || shortcut?.preconditionFn(workspace)) {\n        // If the key has been handled, stop processing shortcuts.\n        if (shortcut?.callback && shortcut?.callback(workspace, e, shortcut)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Gets the shortcuts registered to the given key code.\n   *\n   * @param keyCode The serialized key code.\n   * @returns The list of shortcuts to call when the given keyCode is used.\n   *     Undefined if no shortcuts exist.\n   */\n  getShortcutNamesByKeyCode(keyCode: string): string[] | undefined {\n    return this.keyMap.get(keyCode) || [];\n  }\n\n  /**\n   * Gets the serialized key codes that the shortcut with the given name is\n   * registered under.\n   *\n   * @param shortcutName The name of the shortcut.\n   * @returns An array with all the key codes the shortcut is registered under.\n   */\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\n    const keys = [];\n    for (const [keyCode, shortcuts] of this.keyMap) {\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\n      if (shortcutIdx > -1) {\n        keys.push(keyCode);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Serializes a key event.\n   *\n   * @param e A key down event.\n   * @returns The serialized key code for the given event.\n   */\n  private serializeKeyEvent_(e: KeyboardEvent): string {\n    let serializedKey = '';\n    for (const modifier in ShortcutRegistry.modifierKeys) {\n      if (e.getModifierState(modifier)) {\n        if (serializedKey !== '') {\n          serializedKey += '+';\n        }\n        serializedKey += modifier;\n      }\n    }\n    if (serializedKey !== '' && e.keyCode) {\n      serializedKey = serializedKey + '+' + e.keyCode;\n    } else if (e.keyCode) {\n      serializedKey = String(e.keyCode);\n    }\n    return serializedKey;\n  }\n\n  /**\n   * Checks whether any of the given modifiers are not valid.\n   *\n   * @param modifiers List of modifiers to be used with the key.\n   * @throws {Error} if the modifier is not in the valid modifiers list.\n   */\n  private checkModifiers_(modifiers: KeyCodes[]) {\n    for (let i = 0, modifier; (modifier = modifiers[i]); i++) {\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\n        throw new Error(modifier + ' is not a valid modifier key.');\n      }\n    }\n  }\n\n  /**\n   * Creates the serialized key code that will be used in the key map.\n   *\n   * @param keyCode Number code representing the key.\n   * @param modifiers List of modifier key codes to be used with the key. All\n   *     valid modifiers can be found in the ShortcutRegistry.modifierKeys.\n   * @returns The serialized key code for the given modifiers and key.\n   */\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[] | null): string {\n    let serializedKey = '';\n\n    if (modifiers) {\n      this.checkModifiers_(modifiers);\n      for (const modifier in ShortcutRegistry.modifierKeys) {\n        const modifierKeyCode = (\n          ShortcutRegistry.modifierKeys as AnyDuringMigration\n        )[modifier];\n        if (modifiers.indexOf(modifierKeyCode) > -1) {\n          if (serializedKey !== '') {\n            serializedKey += '+';\n          }\n          serializedKey += modifier;\n        }\n      }\n    }\n\n    if (serializedKey !== '' && keyCode) {\n      serializedKey = serializedKey + '+' + keyCode;\n    } else if (keyCode) {\n      serializedKey = `${keyCode}`;\n    }\n    return serializedKey;\n  }\n}\n\nexport namespace ShortcutRegistry {\n  export interface KeyboardShortcut {\n    callback?: (p1: WorkspaceSvg, p2: Event, p3: KeyboardShortcut) => boolean;\n    name: string;\n    preconditionFn?: (p1: WorkspaceSvg) => boolean;\n    metadata?: object;\n    keyCodes?: (number | string)[];\n    allowCollision?: boolean;\n  }\n\n  /** Supported modifiers. */\n  export enum modifierKeys {\n    Shift = KeyCodes.SHIFT,\n    Control = KeyCodes.CTRL,\n    Alt = KeyCodes.ALT,\n    Meta = KeyCodes.META,\n  }\n}\n\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\n// because (1) it wasn't automatically converted by the automatic migration\n// script, (2) the name doesn't follow the styleguide.\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.variables\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n/**\n * Represents the state of a given variable.\n */\nexport interface State {\n  name: string;\n  id: string;\n  type: string | undefined;\n}\n\n/**\n * Serializer for saving and loading variable state.\n */\nexport class VariableSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing variables. */\n    this.priority = priorities.VARIABLES;\n  }\n\n  /**\n   * Serializes the variables of the given workspace.\n   *\n   * @param workspace The workspace to save the variables of.\n   * @returns The state of the workspace's variables, or null if there are no\n   *     variables.\n   */\n  save(workspace: Workspace): State[] | null {\n    const variableStates = [];\n    for (const variable of workspace.getAllVariables()) {\n      const state = {\n        'name': variable.name,\n        'id': variable.getId(),\n      };\n      if (variable.type) {\n        (state as AnyDuringMigration)['type'] = variable.type;\n      }\n      variableStates.push(state);\n    }\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\n    // null' is not assignable to type 'State[] | null'.\n    return (\n      variableStates.length ? variableStates : null\n    ) as AnyDuringMigration;\n  }\n\n  /**\n   * Deserializes the variable defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the variables to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const varState of state) {\n      workspace.createVariable(\n        varState['name'],\n        varState['type'],\n        varState['id'],\n      );\n    }\n  }\n\n  /**\n   * Disposes of any variables that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the variables of.\n   */\n  clear(workspace: Workspace) {\n    workspace.getVariableMap().clear();\n  }\n}\n\nserializationRegistry.register('variables', new VariableSerializer());\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Serialization methods.\n */\n// Former goog.module ID: Blockly.serialization\n\nimport * as blocks from './serialization/blocks.js';\nimport * as exceptions from './serialization/exceptions.js';\nimport * as priorities from './serialization/priorities.js';\nimport * as procedures from './serialization/procedures.js';\nimport * as registry from './serialization/registry.js';\nimport * as variables from './serialization/variables.js';\nimport * as workspaces from './serialization/workspaces.js';\nimport {ISerializer} from './interfaces/i_serializer.js';\n\nexport {\n  blocks,\n  exceptions,\n  priorities,\n  procedures,\n  registry,\n  variables,\n  workspaces,\n  ISerializer,\n};\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a pair of scrollbars.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ScrollbarPair\n\nimport * as eventUtils from './events/utils.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a pair of scrollbars.  Horizontal and vertical.\n */\nexport class ScrollbarPair {\n  hScroll: Scrollbar | null = null;\n  vScroll: Scrollbar | null = null;\n  corner_: SVGRectElement | null = null;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics_: Metrics | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbars to.\n   * @param addHorizontal Whether to add a horizontal scrollbar.\n   *    Defaults to true.\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\n   * @param opt_class A class to be applied to these scrollbars.\n   * @param opt_margin The margin to apply to these scrollbars.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    addHorizontal?: boolean,\n    addVertical?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\n    addVertical = addVertical === undefined ? true : addVertical;\n    const isPair = addHorizontal && addVertical;\n\n    if (addHorizontal) {\n      this.hScroll = new Scrollbar(\n        workspace,\n        true,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n    if (addVertical) {\n      this.vScroll = new Scrollbar(\n        workspace,\n        false,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n\n    if (isPair) {\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\n        'height': Scrollbar.scrollbarThickness,\n        'width': Scrollbar.scrollbarThickness,\n        'class': 'blocklyScrollbarBackground',\n      });\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\n    }\n  }\n\n  /**\n   * Dispose of this pair of scrollbars.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    dom.removeNode(this.corner_);\n    this.corner_ = null;\n    this.oldHostMetrics_ = null;\n    if (this.hScroll) {\n      this.hScroll.dispose();\n      this.hScroll = null;\n    }\n    if (this.vScroll) {\n      this.vScroll.dispose();\n      this.vScroll = null;\n    }\n  }\n\n  /**\n   * Recalculate both of the scrollbars' locations and lengths.\n   * Also reposition the corner rectangle.\n   */\n  resize() {\n    // Look up the host metrics once, and use for both scrollbars.\n    const hostMetrics = this.workspace.getMetrics();\n    if (!hostMetrics) {\n      // Host element is likely not visible.\n      return;\n    }\n\n    // Only change the scrollbars if there has been a change in metrics.\n    let resizeH = false;\n    let resizeV = false;\n    if (\n      !this.oldHostMetrics_ ||\n      this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop ||\n      this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\n    ) {\n      // The window has been resized or repositioned.\n      resizeH = true;\n      resizeV = true;\n    } else {\n      // Has the content been resized or moved?\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.scrollWidth !== hostMetrics.scrollWidth ||\n        this.oldHostMetrics_.viewLeft !== hostMetrics.viewLeft ||\n        this.oldHostMetrics_.scrollLeft !== hostMetrics.scrollLeft\n      ) {\n        resizeH = true;\n      }\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.scrollHeight !== hostMetrics.scrollHeight ||\n        this.oldHostMetrics_.viewTop !== hostMetrics.viewTop ||\n        this.oldHostMetrics_.scrollTop !== hostMetrics.scrollTop\n      ) {\n        resizeV = true;\n      }\n    }\n\n    if (resizeH || resizeV) {\n      try {\n        eventUtils.disable();\n        if (this.hScroll && resizeH) {\n          this.hScroll.resize(hostMetrics);\n        }\n        if (this.vScroll && resizeV) {\n          this.vScroll.resize(hostMetrics);\n        }\n      } finally {\n        eventUtils.enable();\n      }\n      this.workspace.maybeFireViewportChangeEvent();\n    }\n\n    if (this.hScroll && this.vScroll) {\n      // Reposition the corner square.\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft\n      ) {\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\n      }\n      if (\n        !this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop\n      ) {\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\n      }\n    }\n\n    // Cache the current metrics to potentially short-cut the next resize event.\n    this.oldHostMetrics_ = hostMetrics;\n  }\n\n  /**\n   * Returns whether scrolling horizontally is enabled.\n   *\n   * @returns True if horizontal scroll is enabled.\n   */\n  canScrollHorizontally(): boolean {\n    return !!this.hScroll;\n  }\n\n  /**\n   * Returns whether scrolling vertically is enabled.\n   *\n   * @returns True if vertical scroll is enabled.\n   */\n  canScrollVertically(): boolean {\n    return !!this.vScroll;\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   * @internal\n   */\n  setOrigin(x: number, y: number) {\n    if (this.hScroll) {\n      this.hScroll.setOrigin(x, y);\n    }\n    if (this.vScroll) {\n      this.vScroll.setOrigin(x, y);\n    }\n  }\n\n  /**\n   * Set the handles of both scrollbars.\n   *\n   * @param x The horizontal content displacement, relative to the view in\n   *     pixels.\n   * @param y The vertical content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(x: number, y: number, updateMetrics: boolean) {\n    // This function is equivalent to:\n    //   this.hScroll.set(x);\n    //   this.vScroll.set(y);\n    // However, that calls setMetrics twice which causes a chain of\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\n    // pass. Combining them speeds up rendering.\n    if (this.hScroll) {\n      this.hScroll.set(x, false);\n    }\n    if (this.vScroll) {\n      this.vScroll.set(y, false);\n    }\n\n    if (updateMetrics || updateMetrics === undefined) {\n      // Update metrics.\n      const xyRatio: {x?: number; y?: number} = {};\n      if (this.hScroll) {\n        xyRatio.x = this.hScroll.getRatio_();\n      }\n      if (this.vScroll) {\n        xyRatio.y = this.vScroll.getRatio_();\n      }\n      this.workspace.setMetrics(xyRatio);\n    }\n  }\n\n  /**\n   * Set the handle of the horizontal scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param x Horizontal scroll value.\n   */\n  setX(x: number) {\n    if (this.hScroll) {\n      this.hScroll.set(x, true);\n    }\n  }\n\n  /**\n   * Set the handle of the vertical scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param y Vertical scroll value.\n   */\n  setY(y: number) {\n    if (this.vScroll) {\n      this.vScroll.set(y, true);\n    }\n  }\n\n  /**\n   * Set whether this scrollbar's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    if (this.hScroll) {\n      this.hScroll.setContainerVisible(visible);\n    }\n    if (this.vScroll) {\n      this.vScroll.setContainerVisible(visible);\n    }\n  }\n\n  /**\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\n   * when they aren't needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    let isVisible = false;\n    if (this.hScroll) {\n      isVisible = this.hScroll.isVisible();\n    }\n    if (this.vScroll) {\n      isVisible = isVisible || this.vScroll.isVisible();\n    }\n    return isVisible;\n  }\n\n  /**\n   * Sets the visibility of any existing scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    if (this.hScroll) this.hScroll.setVisibleInternal(visible);\n    if (this.vScroll) this.vScroll.setVisibleInternal(visible);\n  }\n\n  /**\n   * Recalculates the scrollbars' locations within their path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContent(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeContentHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculates the scrollbars' locations on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeView(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeViewHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeViewVertical(hostMetrics);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport * as registry from './registry.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Size} from './utils/size.js';\nimport * as toolboxUtils from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * The manager for all workspace metrics calculations.\n */\nexport class MetricsManager implements IMetricsManager {\n  /** The workspace to calculate metrics for. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace to calculate metrics for. */\n  constructor(workspace: WorkspaceSvg) {\n    this.workspace_ = workspace;\n  }\n\n  /**\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\n   *\n   * @param elem The element to get the dimensions of, or null.  It should be a\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\n   * @returns An object containing width and height attributes, which will both\n   *     be zero if elem did not exist.\n   */\n  protected getDimensionsPx_(elem: IToolbox | null | IFlyout): Size {\n    let width = 0;\n    let height = 0;\n    if (elem) {\n      width = elem.getWidth();\n      height = elem.getHeight();\n    }\n    return new Size(width, height);\n  }\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\n    const flyoutDimensions = this.getDimensionsPx_(\n      this.workspace_.getFlyout(opt_own),\n    );\n    return {\n      width: flyoutDimensions.width,\n      height: flyoutDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link MetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics {\n    const toolboxDimensions = this.getDimensionsPx_(\n      this.workspace_.getToolbox(),\n    );\n\n    return {\n      width: toolboxDimensions.width,\n      height: toolboxDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size {\n    return this.workspace_.getCachedParentSvgSize();\n  }\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics {\n    let absoluteLeft = 0;\n    let absoluteTop = 0;\n\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\n    if (atLeft) {\n      if (respectToolbox) absoluteLeft += toolboxMetrics.width;\n      if (respectFlyout) absoluteLeft += flyoutMetrics.width;\n    }\n    if (atTop) {\n      if (respectToolbox) absoluteTop += toolboxMetrics.height;\n      if (respectFlyout) absoluteTop += flyoutMetrics.height;\n    }\n\n    return {\n      top: absoluteTop,\n      left: absoluteLeft,\n    };\n  }\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const svgMetrics = this.getSvgMetrics();\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const horizToolbox =\n      toolboxPosition === toolboxUtils.Position.TOP ||\n      toolboxPosition === toolboxUtils.Position.BOTTOM;\n    const vertToolbox =\n      toolboxPosition === toolboxUtils.Position.LEFT ||\n      toolboxPosition === toolboxUtils.Position.RIGHT;\n    if (horizToolbox) {\n      if (respectToolbox) svgMetrics.height -= toolboxMetrics.height;\n      if (respectFlyout) svgMetrics.height -= flyoutMetrics.height;\n    }\n    if (vertToolbox) {\n      if (respectToolbox) svgMetrics.width -= toolboxMetrics.width;\n      if (respectFlyout) svgMetrics.width -= flyoutMetrics.width;\n    }\n    return {\n      height: svgMetrics.height / scale,\n      width: svgMetrics.width / scale,\n      top: -this.workspace_.scrollY / scale,\n      left: -this.workspace_.scrollX / scale,\n    };\n  }\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n    // Block bounding box is in workspace coordinates.\n    const blockBox = this.workspace_.getBlocksBoundingBox();\n\n    return {\n      height: (blockBox.bottom - blockBox.top) * scale,\n      width: (blockBox.right - blockBox.left) * scale,\n      top: blockBox.top * scale,\n      left: blockBox.left * scale,\n    };\n  }\n\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean {\n    // This exists for optimization of bump logic.\n    return (\n      !this.workspace_.isMovableHorizontally() ||\n      !this.workspace_.isMovableVertically()\n    );\n  }\n\n  /**\n   * Computes the fixed edges of the scroll area.\n   *\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @returns The fixed edges of the scroll area.\n   */\n  protected getComputedFixedEdges_(\n    opt_viewMetrics?: ContainerRegion,\n  ): FixedEdges {\n    if (!this.hasFixedEdges()) {\n      // Return early if there are no edges.\n      return {};\n    }\n\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\n    const vScrollEnabled = this.workspace_.isMovableVertically();\n\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n\n    const edges = {} as FixedEdges;\n    if (!vScrollEnabled) {\n      edges.top = viewMetrics.top;\n      edges.bottom = viewMetrics.top + viewMetrics.height;\n    }\n    if (!hScrollEnabled) {\n      edges.left = viewMetrics.left;\n      edges.right = viewMetrics.left + viewMetrics.width;\n    }\n    return edges;\n  }\n\n  /**\n   * Returns the content area with added padding.\n   *\n   * @param viewMetrics The view metrics.\n   * @param contentMetrics The content metrics.\n   * @returns The padded content area.\n   */\n  protected getPaddedContent_(\n    viewMetrics: ContainerRegion,\n    contentMetrics: ContainerRegion,\n  ): {top: number; bottom: number; left: number; right: number} {\n    const contentBottom = contentMetrics.top + contentMetrics.height;\n    const contentRight = contentMetrics.left + contentMetrics.width;\n\n    const viewWidth = viewMetrics.width;\n    const viewHeight = viewMetrics.height;\n    const halfWidth = viewWidth / 2;\n    const halfHeight = viewHeight / 2;\n\n    // Add a padding around the content that is at least half a screen wide.\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\n    const top = Math.min(\n      contentMetrics.top - halfHeight,\n      contentBottom - viewHeight,\n    );\n    const left = Math.min(\n      contentMetrics.left - halfWidth,\n      contentRight - viewWidth,\n    );\n    const bottom = Math.max(\n      contentBottom + halfHeight,\n      contentMetrics.top + viewHeight,\n    );\n    const right = Math.max(\n      contentRight + halfWidth,\n      contentMetrics.left + viewWidth,\n    );\n\n    return {top, bottom, left, right};\n  }\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container.\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\n\n    // Add padding around content.\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\n\n    // Use combination of fixed bounds and padded content to make scroll area.\n    const top =\n      fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\n    const left =\n      fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\n    const bottom =\n      fixedEdges.bottom !== undefined\n        ? fixedEdges.bottom\n        : paddedContent.bottom;\n    const right =\n      fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\n\n    return {\n      top: top / scale,\n      left: left / scale,\n      width: (right - left) / scale,\n      height: (bottom - top) / scale,\n    };\n  }\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics {\n    return {\n      viewMetrics: this.getViewMetrics(),\n      absoluteMetrics: this.getAbsoluteMetrics(),\n      toolboxMetrics: this.getToolboxMetrics(),\n    };\n  }\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .scrollHeight: Height of the scroll area.\n   * .scrollWidth: Width of the scroll area.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics {\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const svgMetrics = this.getSvgMetrics();\n    const absoluteMetrics = this.getAbsoluteMetrics();\n    const viewMetrics = this.getViewMetrics();\n    const contentMetrics = this.getContentMetrics();\n    const scrollMetrics = this.getScrollMetrics(\n      false,\n      viewMetrics,\n      contentMetrics,\n    );\n\n    return {\n      contentHeight: contentMetrics.height,\n      contentWidth: contentMetrics.width,\n      contentTop: contentMetrics.top,\n      contentLeft: contentMetrics.left,\n\n      scrollHeight: scrollMetrics.height,\n      scrollWidth: scrollMetrics.width,\n      scrollTop: scrollMetrics.top,\n      scrollLeft: scrollMetrics.left,\n\n      viewHeight: viewMetrics.height,\n      viewWidth: viewMetrics.width,\n      viewTop: viewMetrics.top,\n      viewLeft: viewMetrics.left,\n\n      absoluteTop: absoluteMetrics.top,\n      absoluteLeft: absoluteMetrics.left,\n\n      svgHeight: svgMetrics.height,\n      svgWidth: svgMetrics.width,\n\n      toolboxWidth: toolboxMetrics.width,\n      toolboxHeight: toolboxMetrics.height,\n      toolboxPosition: toolboxMetrics.position,\n\n      flyoutWidth: flyoutMetrics.width,\n      flyoutHeight: flyoutMetrics.height,\n    };\n  }\n}\n\nexport namespace MetricsManager {\n  /**\n   * Describes the width, height and location of the toolbox on the main\n   * workspace.\n   */\n  export interface ToolboxMetrics {\n    width: number;\n    height: number;\n    position: toolboxUtils.Position;\n  }\n\n  /** Describes where the viewport starts in relation to the workspace SVG. */\n  export interface AbsoluteMetrics {\n    left: number;\n    top: number;\n  }\n\n  /**\n   * All the measurements needed to describe the size and location of a\n   * container.\n   */\n  export interface ContainerRegion {\n    height: number;\n    width: number;\n    top: number;\n    left: number;\n  }\n\n  /** Describes fixed edges of the workspace. */\n  export interface FixedEdges {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }\n\n  /** Common metrics used for UI elements. */\n  export interface UiMetrics {\n    viewMetrics: ContainerRegion;\n    absoluteMetrics: AbsoluteMetrics;\n    toolboxMetrics: ToolboxMetrics;\n  }\n}\n\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\nexport type ContainerRegion = MetricsManager.ContainerRegion;\nexport type FixedEdges = MetricsManager.FixedEdges;\nexport type UiMetrics = MetricsManager.UiMetrics;\n\nregistry.register(\n  registry.Type.METRICS_MANAGER,\n  registry.DEFAULT,\n  MetricsManager,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a finished loading workspace event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.FinishedLoading\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {Abstract as AbstractEvent} from './events_abstract.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when the workspace has finished deserializing from\n * JSON/XML.\n */\nexport class FinishedLoading extends AbstractEvent {\n  override isBlank = true;\n  override recordUndo = false;\n  override type = eventUtils.FINISHED_LOADING;\n\n  /**\n   * @param opt_workspace The workspace that has finished loading.  Undefined\n   *     for a blank event.\n   */\n  constructor(opt_workspace?: Workspace) {\n    super();\n    this.isBlank = !!opt_workspace;\n\n    if (!opt_workspace) return;\n\n    this.workspaceId = opt_workspace.id;\n  }\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.FINISHED_LOADING,\n  FinishedLoading,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a block drag.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDrag\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners when a block is being manually dragged/dropped.\n */\nexport class BlockDrag extends UiBase {\n  /** The ID of the top-level block being dragged. */\n  blockId?: string;\n\n  /** True if this is the start of a drag, false if this is the end of one. */\n  isStart?: boolean;\n\n  /**\n   * A list of all of the blocks (i.e. all descendants of the block associated\n   * with the block ID) being dragged.\n   */\n  blocks?: Block[];\n\n  override type = eventUtils.BLOCK_DRAG;\n\n  /**\n   * @param opt_block The top block in the stack that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a block drag.\n   *    Undefined for a blank event.\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isStart = opt_isStart;\n    this.blocks = opt_blocks;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDragJson {\n    const json = super.toJson() as BlockDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n        'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (this.blockId === undefined) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isStart'] = this.isStart;\n    json['blockId'] = this.blockId;\n    // TODO: I don't think we should actually apply the blocks array to the JSON\n    //   object b/c they have functions and aren't actually serializable.\n    json['blocks'] = this.blocks;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses..\n   * @internal\n   */\n  static fromJson(\n    json: BlockDragJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDrag {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDrag(),\n    ) as BlockDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.blockId = json['blockId'];\n    newEvent.blocks = json['blocks'];\n    return newEvent;\n  }\n}\n\nexport interface BlockDragJson extends AbstractEventJson {\n  isStart: boolean;\n  blockId: string;\n  blocks?: Block[];\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BLOCK_DRAG, BlockDrag);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubbles/bubble.js';\nimport {TextBubble} from './bubbles/text_bubble.js';\nimport {TextInputBubble} from './bubbles/textinput_bubble.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\n\nexport {Bubble, TextBubble, TextInputBubble, MiniWorkspaceBubble};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for an event representing an intermediate change to a block's field's\n * value.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockFieldIntermediateChange\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when the value of a block's field has changed but the\n * change is not yet complete, and is expected to be followed by a block change\n * event.\n */\nexport class BlockFieldIntermediateChange extends BlockBase {\n  override type = eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\n\n  // Intermediate events do not undo or redo. They may be fired frequently while\n  // the field editor widget is open. A separate BLOCK_CHANGE event is fired\n  // when the editor is closed, which combines all of the field value changes\n  // into a single change that is recorded in the undo history instead. The\n  // intermediate changes are important for reacting to immediate changes, but\n  // some event handlers would prefer to handle the less frequent final events,\n  // like when triggering workspace serialization. Technically, this method of\n  // grouping changes can result in undo perfoming actions out of order if some\n  // other event occurs between opening and closing the field editor, but such\n  // events are unlikely to cause a broken state.\n  override recordUndo = false;\n\n  /** The name of the field that changed. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block. Undefined for a blank event.\n   * @param opt_name Name of the field affected.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_name?: string,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.name = opt_name;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockFieldIntermediateChangeJson {\n    const json = super.toJson() as BlockFieldIntermediateChangeJson;\n    if (!this.name) {\n      throw new Error(\n        'The changed field name is undefined. Either pass a ' +\n          'name to the constructor, or call fromJson.',\n      );\n    }\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockFieldIntermediateChange, but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be supertypes\n   *     of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockFieldIntermediateChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockFieldIntermediateChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockFieldIntermediateChange(),\n    ) as BlockFieldIntermediateChange;\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n\n    const value = forward ? this.newValue : this.oldValue;\n    const field = block.getField(this.name!);\n    if (field) {\n      field.setValue(value);\n    } else {\n      console.warn(\"Can't set non-existent field: \" + this.name);\n    }\n  }\n}\n\nexport interface BlockFieldIntermediateChangeJson extends BlockBaseJson {\n  name: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE,\n  BlockFieldIntermediateChange,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockMove\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\ninterface BlockLocation {\n  parentId?: string;\n  inputName?: string;\n  coordinate?: Coordinate;\n}\n\n/**\n * Notifies listeners when a block is moved. This could be from one\n * connection to another, or from one location on the workspace to another.\n */\nexport class BlockMove extends BlockBase {\n  override type = eventUtils.BLOCK_MOVE;\n\n  /** The ID of the old parent block. Undefined if it was a top-level block. */\n  oldParentId?: string;\n\n  /**\n   * The name of the old input. Undefined if it was a top-level block or the\n   * parent's next block.\n   */\n  oldInputName?: string;\n\n  /**\n   * The old X and Y workspace coordinates of the block if it was a top level\n   * block. Undefined if it was not a top level block.\n   */\n  oldCoordinate?: Coordinate;\n\n  /** The ID of the new parent block. Undefined if it is a top-level block. */\n  newParentId?: string;\n\n  /**\n   * The name of the new input. Undefined if it is a top-level block or the\n   * parent's next block.\n   */\n  newInputName?: string;\n\n  /**\n   * The new X and Y workspace coordinates of the block if it is a top-level\n   * block. Undefined if it is not a top level block.\n   */\n  newCoordinate?: Coordinate;\n\n  /**\n   * An explanation of what this move is for.  Known values include:\n   *  'drag' -- A drag operation completed.\n   *  'bump' -- Block got bumped away from an invalid connection.\n   *  'snap' -- Block got shifted to line up with the grid.\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\n   *  'connect' -- Block got connected to another block.\n   *  'disconnect' -- Block got disconnected from another block.\n   *  'create' -- Block created via XML.\n   *  'cleanup' -- Workspace aligned top-level blocks.\n   * Event merging may create multiple reasons: ['drag', 'bump', 'snap'].\n   */\n  reason?: string[];\n\n  /** @param opt_block The moved block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    const location = this.currentLocation_();\n    this.oldParentId = location.parentId;\n    this.oldInputName = location.inputName;\n    this.oldCoordinate = location.coordinate;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockMoveJson {\n    const json = super.toJson() as BlockMoveJson;\n    json['oldParentId'] = this.oldParentId;\n    json['oldInputName'] = this.oldInputName;\n    if (this.oldCoordinate) {\n      json['oldCoordinate'] =\n        `${Math.round(this.oldCoordinate.x)}, ` +\n        `${Math.round(this.oldCoordinate.y)}`;\n    }\n    json['newParentId'] = this.newParentId;\n    json['newInputName'] = this.newInputName;\n    if (this.newCoordinate) {\n      json['newCoordinate'] =\n        `${Math.round(this.newCoordinate.x)}, ` +\n        `${Math.round(this.newCoordinate.y)}`;\n    }\n    if (this.reason) {\n      json['reason'] = this.reason;\n    }\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockMove, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockMove(),\n    ) as BlockMove;\n    newEvent.oldParentId = json['oldParentId'];\n    newEvent.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    newEvent.newParentId = json['newParentId'];\n    newEvent.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['reason'] !== undefined) {\n      newEvent.reason = json['reason'];\n    }\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /** Record the block's new location.  Called after the move. */\n  recordNew() {\n    const location = this.currentLocation_();\n    this.newParentId = location.parentId;\n    this.newInputName = location.inputName;\n    this.newCoordinate = location.coordinate;\n  }\n\n  /**\n   * Set the reason for a move event.\n   *\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  setReason(reason: string[]) {\n    this.reason = reason;\n  }\n\n  /**\n   * Returns the parentId and input if the block is connected,\n   *   or the XY location if disconnected.\n   *\n   * @returns Collection of location info.\n   */\n  private currentLocation_(): BlockLocation {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The block associated with the block move event ' +\n          'could not be found',\n      );\n    }\n    const location = {} as BlockLocation;\n    const parent = block.getParent();\n    if (parent) {\n      location.parentId = parent.id;\n      const input = parent.getInputWithBlock(block);\n      if (input) {\n        location.inputName = input.name;\n      }\n    } else {\n      location.coordinate = block.getRelativeToSurfaceXY();\n    }\n    return location;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return (\n      this.oldParentId === this.newParentId &&\n      this.oldInputName === this.newInputName &&\n      Coordinate.equals(this.oldCoordinate, this.newCoordinate)\n    );\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      console.warn(\"Can't move non-existent block: \" + this.blockId);\n      return;\n    }\n    const parentId = forward ? this.newParentId : this.oldParentId;\n    const inputName = forward ? this.newInputName : this.oldInputName;\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\n    let parentBlock: Block | null;\n    if (parentId) {\n      parentBlock = workspace.getBlockById(parentId);\n      if (!parentBlock) {\n        console.warn(\"Can't connect to non-existent block: \" + parentId);\n        return;\n      }\n    }\n    if (block.getParent()) {\n      block.unplug();\n    }\n    if (coordinate) {\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y, this.reason);\n    } else {\n      let blockConnection = block.outputConnection;\n      if (\n        !blockConnection ||\n        (block.previousConnection && block.previousConnection.isConnected())\n      ) {\n        blockConnection = block.previousConnection;\n      }\n      let parentConnection;\n      const connectionType = blockConnection?.type;\n      if (inputName) {\n        const input = parentBlock!.getInput(inputName);\n        if (input) {\n          parentConnection = input.connection;\n        }\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\n        parentConnection = parentBlock!.nextConnection;\n      }\n      if (parentConnection && blockConnection) {\n        blockConnection.connect(parentConnection);\n      } else {\n        console.warn(\"Can't connect to non-existent input: \" + inputName);\n      }\n    }\n  }\n}\n\nexport interface BlockMoveJson extends BlockBaseJson {\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: string;\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: string;\n  reason?: string[];\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MOVE, BlockMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of bubble open.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BubbleOpen\n\nimport type {AbstractEventJson} from './events_abstract.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Class for a bubble open event.\n */\nexport class BubbleOpen extends UiBase {\n  /** The ID of the block the bubble is attached to. */\n  blockId?: string;\n\n  /** True if the bubble is opening, false if closing. */\n  isOpen?: boolean;\n\n  /** The type of bubble; one of 'mutator', 'comment', or 'warning'. */\n  bubbleType?: BubbleType;\n\n  override type = eventUtils.BUBBLE_OPEN;\n\n  /**\n   * @param opt_block The associated block. Undefined for a blank event.\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\n   *     Undefined for a blank event.\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\n   *     'warning'. Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: BlockSvg,\n    opt_isOpen?: boolean,\n    opt_bubbleType?: BubbleType,\n  ) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isOpen = opt_isOpen;\n    this.bubbleType = opt_bubbleType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BubbleOpenJson {\n    const json = super.toJson() as BubbleOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this event is for opening the bubble is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.bubbleType) {\n      throw new Error(\n        'The type of bubble is undefined. Either pass the ' +\n          'value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    json['bubbleType'] = this.bubbleType;\n    json['blockId'] = this.blockId || '';\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BubbleOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BubbleOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): BubbleOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BubbleOpen(),\n    ) as BubbleOpen;\n    newEvent.isOpen = json['isOpen'];\n    newEvent.bubbleType = json['bubbleType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum BubbleType {\n  MUTATOR = 'mutator',\n  COMMENT = 'comment',\n  WARNING = 'warning',\n}\n\nexport interface BubbleOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n  bubbleType: BubbleType;\n  blockId: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BUBBLE_OPEN, BubbleOpen);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for comment events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentBase\n\nimport * as utilsXml from '../utils/xml.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as Xml from '../xml.js';\n\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Abstract class for a comment event.\n */\nexport class CommentBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the comment that this event references. */\n  commentId?: string;\n\n  /**\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\n   *     blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super();\n    /** Whether or not an event is blank. */\n    this.isBlank = !opt_comment;\n\n    if (!opt_comment) return;\n\n    this.commentId = opt_comment.id;\n    this.workspaceId = opt_comment.workspace.id;\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentBaseJson {\n    const json = super.toJson() as CommentBaseJson;\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentBase, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentBase(),\n    ) as CommentBase;\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n\n  /**\n   * Helper function for Comment[Create|Delete]\n   *\n   * @param event The event to run.\n   * @param create if True then Create, if False then Delete\n   */\n  static CommentCreateDeleteHelper(\n    event: CommentCreate | CommentDelete,\n    create: boolean,\n  ) {\n    const workspace = event.getEventWorkspace_();\n    if (create) {\n      const xmlElement = utilsXml.createElement('xml');\n      if (!event.xml) {\n        throw new Error('Ecountered a comment event without proper xml');\n      }\n      xmlElement.appendChild(event.xml);\n      Xml.domToWorkspace(xmlElement, workspace);\n    } else {\n      if (!event.commentId) {\n        throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      const comment = workspace.getCommentById(event.commentId);\n      if (comment) {\n        comment.dispose();\n      } else {\n        // Only complain about root-level block.\n        console.warn(\"Can't uncreate non-existent comment: \" + event.commentId);\n      }\n    }\n  }\n}\n\nexport interface CommentBaseJson extends AbstractEventJson {\n  commentId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentChange\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that the contents of a workspace comment has changed.\n */\nexport class CommentChange extends CommentBase {\n  override type = eventUtils.COMMENT_CHANGE;\n\n  // TODO(#6774): We should remove underscores.\n  /** The previous contents of the comment. */\n  oldContents_?: string;\n\n  /** The new contents of the comment. */\n  newContents_?: string;\n\n  /**\n   * @param opt_comment The comment that is being changed.  Undefined for a\n   *     blank event.\n   * @param opt_oldContents Previous contents of the comment.\n   * @param opt_newContents New contents of the comment.\n   */\n  constructor(\n    opt_comment?: WorkspaceComment,\n    opt_oldContents?: string,\n    opt_newContents?: string,\n  ) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.oldContents_ =\n      typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\n    this.newContents_ =\n      typeof opt_newContents === 'undefined' ? '' : opt_newContents;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentChangeJson {\n    const json = super.toJson() as CommentChangeJson;\n    if (!this.oldContents_) {\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newContents_) {\n      throw new Error(\n        'The new contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldContents'] = this.oldContents_;\n    json['newContents'] = this.newContents_;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentChange(),\n    ) as CommentChange;\n    newEvent.oldContents_ = json['oldContents'];\n    newEvent.newContents_ = json['newContents'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldContents_ === this.newContents_;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn(\"Can't change non-existent comment: \" + this.commentId);\n      return;\n    }\n    const contents = forward ? this.newContents_ : this.oldContents_;\n    if (!contents) {\n      if (forward) {\n        throw new Error(\n          'The new contents is undefined. Either pass a value to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    comment.setContent(contents);\n  }\n}\n\nexport interface CommentChangeJson extends CommentBaseJson {\n  oldContents: string;\n  newContents: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_CHANGE,\n  CommentChange,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentCreate\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment was created.\n */\nexport class CommentCreate extends CommentBase {\n  override type = eventUtils.COMMENT_CREATE;\n\n  /** The XML representation of the created workspace comment. */\n  xml?: Element | DocumentFragment;\n\n  /**\n   * @param opt_comment The created comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCreateJson {\n    const json = super.toJson() as CommentCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentCreate(),\n    ) as CommentCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, forward);\n  }\n}\n\nexport interface CommentCreateJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_CREATE,\n  CommentCreate,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment deletion event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentDelete\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment has been deleted.\n */\nexport class CommentDelete extends CommentBase {\n  override type = eventUtils.COMMENT_DELETE;\n\n  /** The XML representation of the deleted workspace comment. */\n  xml?: Element;\n\n  /**\n   * @param opt_comment The deleted comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDeleteJson {\n    const json = super.toJson() as CommentDeleteJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentDelete(),\n    ) as CommentDelete;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    return newEvent;\n  }\n}\n\nexport interface CommentDeleteJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.COMMENT_DELETE,\n  CommentDelete,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentMove\n\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a workspace comment has moved.\n */\nexport class CommentMove extends CommentBase {\n  override type = eventUtils.COMMENT_MOVE;\n\n  /** The comment that is being moved. */\n  comment_?: WorkspaceComment;\n\n  // TODO(#6774): We should remove underscores.\n  /** The location of the comment before the move, in workspace coordinates. */\n  oldCoordinate_?: Coordinate;\n\n  /** The location of the comment after the move, in workspace coordinates. */\n  newCoordinate_?: Coordinate;\n\n  /**\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.comment_ = opt_comment;\n    this.oldCoordinate_ = opt_comment.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Record the comment's new location.  Called after the move.  Can only be\n   * called once.\n   */\n  recordNew() {\n    if (this.newCoordinate_) {\n      throw Error(\n        'Tried to record the new position of a comment on the ' +\n          'same event twice.',\n      );\n    }\n    if (!this.comment_) {\n      throw new Error(\n        'The comment is undefined. Pass a comment to ' +\n          'the constructor if you want to use the record functionality',\n      );\n    }\n    this.newCoordinate_ = this.comment_.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Override the location before the move.  Use this if you don't create the\n   * event until the end of the move, but you know the original location.\n   *\n   * @param xy The location before the move, in workspace coordinates.\n   */\n  setOldCoordinate(xy: Coordinate) {\n    this.oldCoordinate_ = xy;\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentMoveJson {\n    const json = super.toJson() as CommentMoveJson;\n    if (!this.oldCoordinate_) {\n      throw new Error(\n        'The old comment position is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newCoordinate_) {\n      throw new Error(\n        'The new comment position is undefined. Either call recordNew, or ' +\n          'call fromJson',\n      );\n    }\n    json['oldCoordinate'] =\n      `${Math.round(this.oldCoordinate_.x)}, ` +\n      `${Math.round(this.oldCoordinate_.y)}`;\n    json['newCoordinate'] =\n      Math.round(this.newCoordinate_.x) +\n      ',' +\n      Math.round(this.newCoordinate_.y);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentMove(),\n    ) as CommentMove;\n    let xy = json['oldCoordinate'].split(',');\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn(\"Can't move non-existent comment: \" + this.commentId);\n      return;\n    }\n\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\n    if (!target) {\n      throw new Error(\n        'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\n          'Either pass a comment to the constructor and call recordNew, ' +\n          'or call fromJson',\n      );\n    }\n    // TODO: Check if the comment is being dragged, and give up if so.\n    const current = comment.getRelativeToSurfaceXY();\n    comment.moveBy(target.x - current.x, target.y - current.y);\n  }\n}\n\nexport interface CommentMoveJson extends CommentBaseJson {\n  oldCoordinate: string;\n  newCoordinate: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.COMMENT_MOVE, CommentMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of selecting an item on the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ToolboxItemSelect\n\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Notifies listeners that a toolbox item has been selected.\n */\nexport class ToolboxItemSelect extends UiBase {\n  /** The previously selected toolbox item. */\n  oldItem?: string;\n\n  /** The newly selected toolbox item. */\n  newItem?: string;\n\n  override type = eventUtils.TOOLBOX_ITEM_SELECT;\n\n  /**\n   * @param opt_oldItem The previously selected toolbox item.\n   *     Undefined for a blank event.\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_oldItem?: string | null,\n    opt_newItem?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n    this.oldItem = opt_oldItem ?? undefined;\n    this.newItem = opt_newItem ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ToolboxItemSelectJson {\n    const json = super.toJson() as ToolboxItemSelectJson;\n    json['oldItem'] = this.oldItem;\n    json['newItem'] = this.newItem;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ToolboxItemSelectJson,\n    workspace: Workspace,\n    event?: any,\n  ): ToolboxItemSelect {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ToolboxItemSelect(),\n    ) as ToolboxItemSelect;\n    newEvent.oldItem = json['oldItem'];\n    newEvent.newItem = json['newItem'];\n    return newEvent;\n  }\n}\n\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\n  oldItem?: string;\n  newItem?: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  eventUtils.TOOLBOX_ITEM_SELECT,\n  ToolboxItemSelect,\n);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events\n\nimport {Abstract, AbstractEventJson} from './events_abstract.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {BlockChange, BlockChangeJson} from './events_block_change.js';\nimport {BlockCreate, BlockCreateJson} from './events_block_create.js';\nimport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\nimport {BlockDrag, BlockDragJson} from './events_block_drag.js';\nimport {\n  BlockFieldIntermediateChange,\n  BlockFieldIntermediateChangeJson,\n} from './events_block_field_intermediate_change.js';\nimport {BlockMove, BlockMoveJson} from './events_block_move.js';\nimport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\nimport {Click, ClickJson, ClickTarget} from './events_click.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {CommentChange, CommentChangeJson} from './events_comment_change.js';\nimport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\nimport {CommentDelete} from './events_comment_delete.js';\nimport {CommentMove, CommentMoveJson} from './events_comment_move.js';\nimport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\nimport {Selected, SelectedJson} from './events_selected.js';\nimport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\nimport {\n  ToolboxItemSelect,\n  ToolboxItemSelectJson,\n} from './events_toolbox_item_select.js';\nimport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\nimport {UiBase} from './events_ui_base.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {VarCreate, VarCreateJson} from './events_var_create.js';\nimport {VarDelete, VarDeleteJson} from './events_var_delete.js';\nimport {VarRename, VarRenameJson} from './events_var_rename.js';\nimport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\nimport * as eventUtils from './utils.js';\nimport {FinishedLoading} from './workspace_events.js';\n\n// Events.\nexport {Abstract};\nexport {AbstractEventJson};\nexport {BubbleOpen};\nexport {BubbleOpenJson};\nexport {BubbleType};\nexport {BlockBase};\nexport {BlockBaseJson};\nexport {BlockChange};\nexport {BlockChangeJson};\nexport {BlockCreate};\nexport {BlockCreateJson};\nexport {BlockDelete};\nexport {BlockDeleteJson};\nexport {BlockDrag};\nexport {BlockDragJson};\nexport {BlockFieldIntermediateChange};\nexport {BlockFieldIntermediateChangeJson};\nexport {BlockMove};\nexport {BlockMoveJson};\nexport {Click};\nexport {ClickJson};\nexport {ClickTarget};\nexport {CommentBase};\nexport {CommentBaseJson};\nexport {CommentChange};\nexport {CommentChangeJson};\nexport {CommentCreate};\nexport {CommentCreateJson};\nexport {CommentDelete};\nexport {CommentMove};\nexport {CommentMoveJson};\nexport {FinishedLoading};\nexport {MarkerMove};\nexport {MarkerMoveJson};\nexport {Selected};\nexport {SelectedJson};\nexport {ThemeChange};\nexport {ThemeChangeJson};\nexport {ToolboxItemSelect};\nexport {ToolboxItemSelectJson};\nexport {TrashcanOpen};\nexport {TrashcanOpenJson};\nexport {UiBase};\nexport {VarBase};\nexport {VarBaseJson};\nexport {VarCreate};\nexport {VarCreateJson};\nexport {VarDelete};\nexport {VarDeleteJson};\nexport {VarRename};\nexport {VarRenameJson};\nexport {ViewportChange};\nexport {ViewportChangeJson};\n\n// Event types.\nexport const BLOCK_CHANGE = eventUtils.BLOCK_CHANGE;\nexport const BLOCK_CREATE = eventUtils.BLOCK_CREATE;\nexport const BLOCK_DELETE = eventUtils.BLOCK_DELETE;\nexport const BLOCK_DRAG = eventUtils.BLOCK_DRAG;\nexport const BLOCK_MOVE = eventUtils.BLOCK_MOVE;\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\n  eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE;\nexport const BUBBLE_OPEN = eventUtils.BUBBLE_OPEN;\nexport type BumpEvent = eventUtils.BumpEvent;\nexport const BUMP_EVENTS = eventUtils.BUMP_EVENTS;\nexport const CHANGE = eventUtils.CHANGE;\nexport const CLICK = eventUtils.CLICK;\nexport const COMMENT_CHANGE = eventUtils.COMMENT_CHANGE;\nexport const COMMENT_CREATE = eventUtils.COMMENT_CREATE;\nexport const COMMENT_DELETE = eventUtils.COMMENT_DELETE;\nexport const COMMENT_MOVE = eventUtils.COMMENT_MOVE;\nexport const CREATE = eventUtils.CREATE;\nexport const DELETE = eventUtils.DELETE;\nexport const FINISHED_LOADING = eventUtils.FINISHED_LOADING;\nexport const MARKER_MOVE = eventUtils.MARKER_MOVE;\nexport const MOVE = eventUtils.MOVE;\nexport const SELECTED = eventUtils.SELECTED;\nexport const THEME_CHANGE = eventUtils.THEME_CHANGE;\nexport const TOOLBOX_ITEM_SELECT = eventUtils.TOOLBOX_ITEM_SELECT;\nexport const TRASHCAN_OPEN = eventUtils.TRASHCAN_OPEN;\nexport const UI = eventUtils.UI;\nexport const VAR_CREATE = eventUtils.VAR_CREATE;\nexport const VAR_DELETE = eventUtils.VAR_DELETE;\nexport const VAR_RENAME = eventUtils.VAR_RENAME;\nexport const VIEWPORT_CHANGE = eventUtils.VIEWPORT_CHANGE;\n\n// Event utils.\nexport const clearPendingUndo = eventUtils.clearPendingUndo;\nexport const disable = eventUtils.disable;\nexport const enable = eventUtils.enable;\nexport const filter = eventUtils.filter;\nexport const fire = eventUtils.fire;\nexport const fromJson = eventUtils.fromJson;\nexport const getDescendantIds = eventUtils.getDescendantIds;\nexport const get = eventUtils.get;\nexport const getGroup = eventUtils.getGroup;\nexport const getRecordUndo = eventUtils.getRecordUndo;\nexport const isEnabled = eventUtils.isEnabled;\nexport const setGroup = eventUtils.setGroup;\nexport const setRecordUndo = eventUtils.setRecordUndo;\nexport const disableOrphans = eventUtils.disableOrphans;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Theme} from '../../theme.js';\nimport * as utilsColour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport type {Shape} from '../common/constants.js';\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n  rightWidth: number;\n  rightHeight: number;\n  pathTopRight: string;\n  pathBottomRight: string;\n}\n\n/**\n * An object that provides constants for rendering blocks in Zelos mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  GRID_UNIT = 4;\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\n\n  override CURSOR_COLOUR = '#ffa200';\n\n  /**\n   * Radius of the cursor for input and output connections.\n   */\n  CURSOR_RADIUS = 5;\n\n  override JAGGED_TEETH_HEIGHT = 0;\n\n  override JAGGED_TEETH_WIDTH = 0;\n  override START_HAT_HEIGHT = 22;\n\n  override START_HAT_WIDTH = 96;\n\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\n\n  /**\n   * Map of output/input shapes and the amount they should cause a block to be\n   * padded. Outer key is the outer shape, inner key is the inner shape.\n   * When a block with the outer shape contains an input block with the inner\n   * shape on its left or right edge, the block elements are aligned such that\n   * the padding specified is reached.\n   */\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\n    1: {\n      // Outer shape: hexagon.\n      0: 5 * this.GRID_UNIT, // Field in hexagon.\n      1: 2 * this.GRID_UNIT, // Hexagon in hexagon.\n      2: 5 * this.GRID_UNIT, // Round in hexagon.\n      3: 5 * this.GRID_UNIT, // Square in hexagon.\n    },\n    2: {\n      // Outer shape: round.\n      0: 3 * this.GRID_UNIT, // Field in round.\n      1: 3 * this.GRID_UNIT, // Hexagon in round.\n      2: 1 * this.GRID_UNIT, // Round in round.\n      3: 2 * this.GRID_UNIT, // Square in round.\n    },\n    3: {\n      // Outer shape: square.\n      0: 2 * this.GRID_UNIT, // Field in square.\n      1: 2 * this.GRID_UNIT, // Hexagon in square.\n      2: 2 * this.GRID_UNIT, // Round in square.\n      3: 2 * this.GRID_UNIT, // Square in square.\n    },\n  };\n\n  override FULL_BLOCK_FIELDS = true;\n\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\n\n  override FIELD_TEXT_FONTFAMILY =\n    '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\n\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\n\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\n\n  override FIELD_DROPDOWN_SVG_ARROW = true;\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\n\n  override FIELD_COLOUR_FULL_BLOCK = true;\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\n\n  /** The selected glow colour. */\n  SELECTED_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  SELECTED_GLOW_SIZE = 0.5;\n\n  /** The replacement glow colour. */\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  REPLACEMENT_GLOW_SIZE = 2;\n\n  /**\n   * The ID of the selected glow filter, or the empty string if no filter is\n   * set.\n   */\n  selectedGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a selected glow, or null if not set.\n   */\n  private selectedGlowFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the replacement glow filter, or the empty string if no filter\n   * is set.\n   */\n  replacementGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a replacement glow, or null if not set.\n   */\n  private replacementGlowFilter: SVGElement | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a boolean\n   * reporter block. Null before init is called.\n   */\n  HEXAGONAL: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a number or\n   * string reporter block. Null before init is called.\n   */\n  ROUNDED: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a\n   * rectangular reporter block. Null before init is called.\n   */\n  SQUARED: Shape | null = null;\n\n  constructor() {\n    super();\n\n    this.SMALL_PADDING = this.GRID_UNIT;\n\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\n\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\n\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\n\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\n\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\n\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\n\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\n\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\n\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\n\n    /** Minimum statement input spacer width. */\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\n\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\n\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 6 * this.GRID_UNIT;\n\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\n\n    /** The maximum width of a dynamic connection shape. */\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\n  }\n\n  override setFontConstants_(theme: Theme) {\n    super.setFontConstants_(theme);\n\n    this.FIELD_BORDER_RECT_HEIGHT =\n      this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n  }\n\n  override init() {\n    super.init();\n    this.HEXAGONAL = this.makeHexagonal();\n    this.ROUNDED = this.makeRounded();\n    this.SQUARED = this.makeSquared();\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET =\n      this.NOTCH_OFFSET_LEFT +\n      (this.INSIDE_CORNERS as InsideCorners).rightWidth;\n  }\n\n  override setDynamicProperties_(theme: Theme) {\n    super.setDynamicProperties_(theme);\n\n    this.SELECTED_GLOW_COLOUR =\n      theme.getComponentStyle('selectedGlowColour') ||\n      this.SELECTED_GLOW_COLOUR;\n    const selectedGlowSize = Number(\n      theme.getComponentStyle('selectedGlowSize'),\n    );\n    this.SELECTED_GLOW_SIZE =\n      selectedGlowSize && !isNaN(selectedGlowSize)\n        ? selectedGlowSize\n        : this.SELECTED_GLOW_SIZE;\n    this.REPLACEMENT_GLOW_COLOUR =\n      theme.getComponentStyle('replacementGlowColour') ||\n      this.REPLACEMENT_GLOW_COLOUR;\n    const replacementGlowSize = Number(\n      theme.getComponentStyle('replacementGlowSize'),\n    );\n    this.REPLACEMENT_GLOW_SIZE =\n      replacementGlowSize && !isNaN(replacementGlowSize)\n        ? replacementGlowSize\n        : this.REPLACEMENT_GLOW_SIZE;\n  }\n\n  override dispose() {\n    super.dispose();\n    if (this.selectedGlowFilter) {\n      dom.removeNode(this.selectedGlowFilter);\n    }\n    if (this.replacementGlowFilter) {\n      dom.removeNode(this.replacementGlowFilter);\n    }\n  }\n\n  override makeStartHat() {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(25, -height),\n      svgPaths.point(71, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * Create sizing and path information about a hexagonal shape.\n   *\n   * @returns An object containing sizing and path information about a hexagonal\n   *     shape for connections.\n   */\n  protected makeHexagonal(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n\n    /**\n     * Make the main path for the hexagonal connection shape out of two lines.\n     * The lines are defined with relative positions and require the block\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\n     * sign flips.  The 'left' and 'right' versions of the path are also the\n     * same, but the X sign flips.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const halfHeight = height / 2;\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\n      const forward = up ? -1 : 1;\n      const direction = right ? -1 : 1;\n      const dy = (forward * height) / 2;\n      return (\n        svgPaths.lineTo(-direction * width, dy) +\n        svgPaths.lineTo(direction * width, dy)\n      );\n    }\n\n    return {\n      type: this.SHAPES.HEXAGONAL,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a rounded shape.\n   *\n   * @returns An object containing sizing and path information about a rounded\n   *     shape for connections.\n   */\n  protected makeRounded(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n    const maxHeight = maxWidth * 2;\n\n    /**\n     * Make the main path for the rounded connection shape out of two arcs and\n     * a line that joins them.  The arcs are defined with relative positions.\n     * Usually, the height of the block is split between the two arcs. In the\n     * case where the height of the block exceeds the maximum height, a line is\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\n     * path flip the sweep-flag which moves the arc at negative angles.\n     *\n     * @param blockHeight The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(\n      blockHeight: number,\n      up: boolean,\n      right: boolean,\n    ): string {\n      const remainingHeight =\n        blockHeight > maxHeight ? blockHeight - maxHeight : 0;\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\n      const radius = height / 2;\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,1',\n          radius,\n          svgPaths.point((up ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (right ? 1 : -1) * remainingHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,1',\n          radius,\n          svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.ROUND,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a squared shape.\n   *\n   * @returns An object containing sizing and path information about a squared\n   *     shape for connections.\n   */\n  protected makeSquared(): Shape {\n    const radius = this.CORNER_RADIUS;\n\n    /**\n     * Make the main path for the squared connection shape out of two corners\n     * and a single line in-between (a and v). These are defined in relative\n     * positions and require the height of the block.\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\n     * flips.  The 'up' and 'down' versions of the path determine where the\n     * corner point is placed and in turn the direction of the corners.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a squared connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const innerHeight = height - radius * 2;\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,1',\n          radius,\n          svgPaths.point((up ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (right ? 1 : -1) * innerHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,1',\n          radius,\n          svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.SQUARE,\n      isDynamic: true,\n      width(_height: number): number {\n        return radius;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  override shapeFor(connection: RenderedConnection): Shape {\n    let checks = connection.getCheck();\n    if (!checks && connection.targetConnection) {\n      checks = connection.targetConnection.getCheck();\n    }\n    let outputShape;\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        outputShape = connection.getSourceBlock().getOutputShape();\n        // If the block has an output shape set, use that instead.\n        if (outputShape !== null) {\n          switch (outputShape) {\n            case this.SHAPES.HEXAGONAL:\n              return this.HEXAGONAL!;\n            case this.SHAPES.ROUND:\n              return this.ROUNDED!;\n            case this.SHAPES.SQUARE:\n              return this.SQUARED!;\n          }\n        }\n        // Includes doesn't work in IE.\n        if (checks && checks.indexOf('Boolean') !== -1) {\n          return this.HEXAGONAL!;\n        }\n        if (checks && checks.indexOf('Number') !== -1) {\n          return this.ROUNDED!;\n        }\n        if (checks && checks.indexOf('String') !== -1) {\n          return this.ROUNDED!;\n        }\n        return this.ROUNDED!;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH!;\n      default:\n        throw Error('Unknown type');\n    }\n  }\n\n  override makeNotch() {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n\n    const innerWidth = width / 3;\n    const curveWidth = innerWidth / 3;\n\n    const halfHeight = height / 2;\n    const quarterHeight = halfHeight / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, quarterHeight / 2),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, quarterHeight / 2),\n          svgPaths.point((dir * curveWidth) / 2, quarterHeight),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.lineOnAxis('h', dir * innerWidth) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, -(quarterHeight / 2)),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, -(quarterHeight / 2)),\n          svgPaths.point((dir * curveWidth) / 2, -quarterHeight),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ])\n      );\n    }\n\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  override makeInsideCorners() {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerTopRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    const innerBottomRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n      rightWidth: radius,\n      rightHeight: radius,\n      pathTopRight: innerTopRightCorner,\n      pathBottomRight: innerBottomRightCorner,\n    };\n  }\n\n  override generateSecondaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.15) || colour;\n  }\n\n  override generateTertiaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.25) || colour;\n  }\n\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\n    super.createDom(svg, tagName, selector);\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const selectedGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\n      selectedGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const selectedComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      selectedComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.SELECTED_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      selectedGlowFilter,\n    );\n    this.selectedGlowFilterId = selectedGlowFilter.id;\n    this.selectedGlowFilter = selectedGlowFilter;\n\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const replacementGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\n      replacementGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const replacementComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      replacementComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.REPLACEMENT_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'outGlow',\n        'operator': 'over',\n      },\n      replacementGlowFilter,\n    );\n    this.replacementGlowFilterId = replacementGlowFilter.id;\n    this.replacementGlowFilter = replacementGlowFilter;\n  }\n\n  override getCSS_(selector: string) {\n    return [\n      /* eslint-disable indent */\n      // Text.\n      `${selector} .blocklyText,`,\n      `${selector} .blocklyFlyoutLabelText {`,\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\n        `pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n      `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text,`,\n      `${selector} .blocklyNonEditableText>g>text,`,\n      `${selector} .blocklyEditableText>g>text {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\n      `stroke: #fff;`,\n      `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `color: #575E75;`,\n      `}`,\n\n      // Dropdown field.\n      `${selector} .blocklyDropdownText {`,\n      `fill: #fff !important;`,\n      `}`,\n\n      // Widget and Dropdown Div\n      `${selector}.blocklyWidgetDiv .goog-menuitem,`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem-content {`,\n      `color: #fff;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\n      `}`,\n\n      // Disabled outline paths.\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n/* eslint-enable indent */\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {InsideCorners} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {StatementInput} from './measurables/inputs.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer extends BaseDrawer {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override info_!: RenderInfo;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n\n  override draw() {\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.beginDrawing();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n    if (this.info_.outputConnection) {\n      // Store the output connection shape type for parent blocks to use during\n      // rendering.\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\n    }\n    pathObject.endDrawing();\n  }\n\n  override drawOutline_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape &&\n      !this.info_.hasStatementInput &&\n      !this.info_.bottomRow.hasNextConnection\n    ) {\n      this.drawFlatTop_();\n      this.drawRightDynamicConnection_();\n      this.drawFlatBottom_();\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawOutline_();\n    }\n  }\n\n  override drawLeft_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape\n    ) {\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawLeft_();\n    }\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected override drawRightSideRow_(row: Row) {\n    if (row.height <= 0) {\n      return;\n    }\n    if (Types.isSpacer(row)) {\n      const spacerRow = row as SpacerRow;\n      const precedesStatement = spacerRow.precedesStatement;\n      const followsStatement = spacerRow.followsStatement;\n      if (precedesStatement || followsStatement) {\n        const insideCorners = this.constants_.INSIDE_CORNERS as InsideCorners;\n        const cornerHeight = insideCorners.rightHeight;\n        const remainingHeight =\n          spacerRow.height - (precedesStatement ? cornerHeight : 0);\n        const bottomRightPath = followsStatement\n          ? insideCorners.pathBottomRight\n          : '';\n        const verticalPath =\n          remainingHeight > 0\n            ? svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight)\n            : '';\n        const topRightPath = precedesStatement\n          ? insideCorners.pathTopRight\n          : '';\n        // Put all of the partial paths together.\n        this.outlinePath_ += bottomRightPath + verticalPath + topRightPath;\n        return;\n      }\n    }\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps to draw the right side of an output with a dynamic connection.\n   */\n  protected drawRightDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathRightDown(this.info_.outputConnection.height);\n  }\n\n  /**\n   * Add steps to draw the left side of an output with a dynamic connection.\n   */\n  protected drawLeftDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.positionOutputConnection_();\n\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathUp(this.info_.outputConnection.height);\n\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /** Add steps to draw a flat top row. */\n  protected drawFlatTop_() {\n    const topRow = this.info_.topRow;\n    this.positionPreviousConnection_();\n\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\n  }\n\n  /** Add steps to draw a flat bottom row. */\n  protected drawFlatBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    this.positionNextConnection_();\n\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.positionInlineInputConnection_(input);\n\n    const inputName = input.input.name;\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\n      return;\n    }\n\n    const width = input.width - input.connectionWidth * 2;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    const outlinePath =\n      svgPaths.moveTo(connectionRight, yPos) +\n      svgPaths.lineOnAxis('h', width) +\n      (input.shape as DynamicShape).pathRightDown(input.height) +\n      svgPaths.lineOnAxis('h', -width) +\n      (input.shape as DynamicShape).pathUp(input.height) +\n      'z';\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setOutlinePath(inputName, outlinePath);\n  }\n\n  override drawStatementInput_(row: Row) {\n    const input = row.getLastInput() as StatementInput;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\n\n    const insideCorners = this.constants_.INSIDE_CORNERS;\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis('h', -(input.notchOffset - insideCorners.width)) +\n      insideCorners.pathTop;\n\n    const innerHeight = row.height - 2 * insideCorners.height;\n\n    const innerBottomLeftCorner =\n      insideCorners.pathBottom +\n      svgPaths.lineOnAxis('h', input.notchOffset - insideCorners.width) +\n      (input.connectedBottomNextConnection\n        ? ''\n        : (input.shape as Notch).pathLeft);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      innerBottomLeftCorner +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Image field.  Used for pictures, icons, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldImage\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an image on a block.\n */\nexport class FieldImage extends Field<string> {\n  /**\n   * Vertical padding below the image, which is included in the reported height\n   * of the field.\n   */\n  private static readonly Y_PADDING = 1;\n  protected override size_: Size;\n  protected readonly imageHeight: number;\n\n  /** The function to be called when this field is clicked. */\n  private clickHandler: ((p1: FieldImage) => void) | null = null;\n\n  /** The rendered field's image element. */\n  protected imageElement: SVGImageElement | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override readonly EDITABLE = false;\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Image fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Whether to flip this image in RTL. */\n  private flipRtl = false;\n\n  /** Alt text of this image. */\n  private altText = '';\n\n  /**\n   * @param src The URL of the image.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param width Width of the image.\n   * @param height Height of the image.\n   * @param alt Optional alt text for when block is collapsed.\n   * @param onClick Optional function to be called when the image is\n   *     clicked. If onClick is defined, alt must also be defined.\n   * @param flipRtl Whether to flip the icon in RTL.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    src: string | typeof Field.SKIP_SETUP,\n    width: string | number,\n    height: string | number,\n    alt?: string,\n    onClick?: (p1: FieldImage) => void,\n    flipRtl?: boolean,\n    config?: FieldImageConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\n      throw Error(\n        'Height and width values of an image field must cast to' + ' numbers.',\n      );\n    }\n    if (imageHeight <= 0 || imageWidth <= 0) {\n      throw Error(\n        'Height and width values of an image field must be greater' +\n          ' than 0.',\n      );\n    }\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\n\n    /**\n     * Store the image height, since it is different from the field height.\n     */\n    this.imageHeight = imageHeight;\n\n    if (typeof onClick === 'function') {\n      this.clickHandler = onClick;\n    }\n\n    if (src === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.flipRtl = !!flipRtl;\n      this.altText = parsing.replaceMessageReferences(alt) || '';\n    }\n    this.setValue(parsing.replaceMessageReferences(src));\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldImageConfig) {\n    super.configure_(config);\n    if (config.flipRtl) this.flipRtl = config.flipRtl;\n    if (config.alt) {\n      this.altText = parsing.replaceMessageReferences(config.alt);\n    }\n  }\n\n  /**\n   * Create the block UI for this image.\n   */\n  override initView() {\n    this.imageElement = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.imageHeight + 'px',\n        'width': this.size_.width + 'px',\n        'alt': this.altText,\n      },\n      this.fieldGroup_,\n    );\n    this.imageElement.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.value_ as string,\n    );\n\n    if (this.clickHandler) {\n      this.imageElement.style.cursor = 'pointer';\n    }\n  }\n\n  override updateSize_() {}\n  // NOP\n\n  /**\n   * Ensure that the input value (the source URL) is a string.\n   *\n   * @param newValue The input value.\n   * @returns A string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string | null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this image field, and update the displayed image.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    this.value_ = newValue;\n    if (this.imageElement) {\n      this.imageElement.setAttributeNS(dom.XLINK_NS, 'xlink:href', this.value_);\n    }\n  }\n\n  /**\n   * Get whether to flip this image in RTL\n   *\n   * @returns True if we should flip in RTL.\n   */\n  override getFlipRtl(): boolean {\n    return this.flipRtl;\n  }\n\n  /**\n   * Set the alt text of this image.\n   *\n   * @param alt New alt text.\n   */\n  setAlt(alt: string | null) {\n    if (alt === this.altText) {\n      return;\n    }\n    this.altText = alt || '';\n    if (this.imageElement) {\n      this.imageElement.setAttribute('alt', this.altText);\n    }\n  }\n\n  /**\n   * If field click is called, and click handler defined,\n   * call the handler.\n   */\n  protected override showEditor_() {\n    if (this.clickHandler) {\n      this.clickHandler(this);\n    }\n  }\n\n  /**\n   * Set the function that is called when this image  is clicked.\n   *\n   * @param func The function that is called when the image is clicked, or null\n   *     to remove.\n   */\n  setOnClickHandler(func: ((p1: FieldImage) => void) | null) {\n    this.clickHandler = func;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.\n   * Return the image alt text instead.\n   *\n   * @returns The image alt text.\n   */\n  protected override getText_(): string | null {\n    return this.altText;\n  }\n\n  /**\n   * Construct a FieldImage from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (src, width, height, alt, and\n   *     flipRtl).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldImageFromJsonConfig): FieldImage {\n    if (!options.src || !options.width || !options.height) {\n      throw new Error(\n        'src, width, and height values for an image field are' +\n          'required. The width and height must be non-zero.',\n      );\n    }\n    // `this` might be a subclass of FieldImage if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.src,\n      options.width,\n      options.height,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_image', FieldImage);\n\nFieldImage.prototype.DEFAULT_VALUE = '';\n\n/**\n * Config options for the image field.\n */\nexport interface FieldImageConfig extends FieldConfig {\n  flipRtl?: boolean;\n  alt?: string;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\n  src?: string;\n  width?: number;\n  height?: number;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dialog from './dialog.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {Size} from './utils/size.js';\n\n/**\n * Supported types for FieldInput subclasses.\n *\n * @internal\n */\ntype InputTypes = string | number;\n\n/**\n * Abstract class for an editable input field.\n *\n * @typeParam T - The value stored on the field.\n * @internal\n */\nexport abstract class FieldInput<T extends InputTypes> extends Field<\n  string | T\n> {\n  /**\n   * Pixel size of input border radius.\n   * Should match blocklyText's border-radius in CSS.\n   */\n  static BORDERRADIUS = 4;\n\n  /** Allow browser to spellcheck this field. */\n  protected spellcheck_ = true;\n\n  /** The HTML input element. */\n  protected htmlInput_: HTMLInputElement | null = null;\n\n  /** True if the field's value is currently being edited via the UI. */\n  protected isBeingEdited_ = false;\n\n  /**\n   * True if the value currently displayed in the field's editory UI is valid.\n   */\n  protected isTextValid_ = false;\n\n  /**\n   * The intial value of the field when the user opened an editor to change its\n   * value. When the editor is disposed, an event will be fired that uses this\n   * as the event's oldValue.\n   */\n  protected valueWhenEditorWasOpened_: string | T | null = null;\n\n  /** Key down event data. */\n  private onKeyDownWrapper_: browserEvents.Data | null = null;\n\n  /** Key input event data. */\n  private onKeyInputWrapper_: browserEvents.Data | null = null;\n\n  /**\n   * Whether the field should consider the whole parent block to be its click\n   * target.\n   */\n  fullBlockClickTarget_: boolean = false;\n\n  /** The workspace that this field belongs to. */\n  protected workspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'text';\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldInputValidator<T> | null,\n    config?: FieldInputConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  protected override configure_(config: FieldInputConfig) {\n    super.configure_(config);\n    if (config.spellcheck !== undefined) {\n      this.spellcheck_ = config.spellcheck;\n    }\n  }\n\n  override initView() {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n    super.initView();\n\n    if (this.isFullBlockField()) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n  }\n\n  protected override isFullBlockField(): boolean {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n\n    // Side effect for backwards compatibility.\n    this.fullBlockClickTarget_ =\n      !!this.getConstants()?.FULL_BLOCK_FIELDS && block.isSimpleReporter();\n    return this.fullBlockClickTarget_;\n  }\n\n  /**\n   * Called by setValue if the text input is not valid. If the field is\n   * currently being edited it reverts value of the field to the previous\n   * value while allowing the display text to be handled by the htmlInput_.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   *    This is not used by the text input because its display value is stored\n   * on the htmlInput_.\n   */\n  protected override doValueInvalid_(_invalidValue: AnyDuringMigration) {\n    if (this.isBeingEdited_) {\n      this.isDirty_ = true;\n      this.isTextValid_ = false;\n      const oldValue = this.value_;\n      // Revert value when the text becomes invalid.\n      this.value_ = this.htmlInput_!.getAttribute('data-untyped-default-value');\n      if (this.sourceBlock_ && eventUtils.isEnabled()) {\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            this.sourceBlock_,\n            'field',\n            this.name || null,\n            oldValue,\n            this.value_,\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_).\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string | T) {\n    this.isDirty_ = true;\n    this.isTextValid_ = true;\n    this.value_ = newValue;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   */\n  override applyColour() {\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n\n    if (!this.getConstants()!.FULL_BLOCK_FIELDS) return;\n    if (!this.fieldGroup_) return;\n\n    if (!this.isFullBlockField() && this.borderRect_) {\n      this.borderRect_!.style.display = 'block';\n      this.borderRect_.setAttribute('stroke', block.style.colourTertiary);\n    } else {\n      this.borderRect_!.style.display = 'none';\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      block.pathObject.svgPath.setAttribute(\n        'fill',\n        this.getConstants()!.FIELD_BORDER_RECT_COLOUR,\n      );\n    }\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  override getSize(): Size {\n    if (this.getConstants()?.FULL_BLOCK_FIELDS) {\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      // Full block fields have more control of the block than they should\n      // (i.e. updating fill colour). Whenever we get the size, the field may\n      // no longer be a full-block field, so we need to rerender.\n      this.render_();\n      this.isDirty_ = false;\n    }\n    return super.getSize();\n  }\n\n  /**\n   * Notifies the field that it has changed locations. Moves the widget div to\n   * be in the correct place if it is open.\n   */\n  onLocationChange(): void {\n    if (this.isBeingEdited_) this.resizeEditor_();\n  }\n\n  /**\n   * Updates the colour of the htmlInput given the current validity of the\n   * field's value.\n   *\n   * Also updates the colour of the block to reflect whether this is a full\n   * block field or not.\n   */\n  protected override render_() {\n    super.render_();\n    // This logic is done in render_ rather than doValueInvalid_ or\n    // doValueUpdate_ so that the code is more centralized.\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n    // In general, do *not* let fields control the color of blocks. Having the\n    // field control the color is unexpected, and could have performance\n    // impacts.\n    // Whenever we render, the field may no longer be a full-block-field so\n    // we need to update the colour.\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) block.applyColour();\n  }\n\n  /**\n   * Set whether this field is spellchecked by the browser.\n   *\n   * @param check True if checked.\n   */\n  setSpellcheck(check: boolean) {\n    if (check === this.spellcheck_) {\n      return;\n    }\n    this.spellcheck_ = check;\n    if (this.htmlInput_) {\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\n      // assignable to parameter of type 'string'.\n      this.htmlInput_.setAttribute(\n        'spellcheck',\n        this.spellcheck_ as AnyDuringMigration,\n      );\n    }\n  }\n\n  /**\n   * Show an editor for the field.\n   * Shows the inline free-text editor on top of the text by default.\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\n   * enabled.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  protected override showEditor_(_e?: Event, quietInput = false) {\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\n    if (\n      !quietInput &&\n      this.workspace_.options.modalInputs &&\n      (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)\n    ) {\n      this.showPromptEditor_();\n    } else {\n      this.showInlineEditor_(quietInput);\n    }\n  }\n\n  /**\n   * Create and show a text input editor that is a prompt (usually a popup).\n   * Mobile browsers may have issues with in-line textareas (focus and\n   * keyboards).\n   */\n  private showPromptEditor_() {\n    dialog.prompt(\n      Msg['CHANGE_VALUE_TITLE'],\n      this.getText(),\n      (text: string | null) => {\n        // Text is null if user pressed cancel button.\n        if (text !== null) {\n          this.setValue(this.getValueFromEditorText_(text));\n        }\n        this.onFinishEditing_(this.value_);\n      },\n    );\n  }\n\n  /**\n   * Create and show a text input editor that sits directly over the text input.\n   *\n   * @param quietInput True if editor should be created without focus.\n   */\n  private showInlineEditor_(quietInput: boolean) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    WidgetDiv.show(this, block.RTL, this.widgetDispose_.bind(this));\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\n    this.isBeingEdited_ = true;\n    this.valueWhenEditorWasOpened_ = this.value_;\n\n    if (!quietInput) {\n      (this.htmlInput_ as HTMLElement).focus({\n        preventScroll: true,\n      });\n      this.htmlInput_.select();\n    }\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected widgetCreate_(): HTMLElement {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    eventUtils.setGroup(true);\n    const div = WidgetDiv.getDiv();\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.addClass(clickTarget, 'editing');\n\n    const htmlInput = document.createElement('input');\n    htmlInput.className = 'blocklyHtmlInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n      'spellcheck',\n      this.spellcheck_ as AnyDuringMigration,\n    );\n    const scale = this.workspace_!.getScale();\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\n\n    if (this.isFullBlockField()) {\n      const bBox = this.getScaledBBox();\n\n      // Override border radius.\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\n      // Pull stroke colour from the existing shadow block\n      const strokeColour = block.getParent()\n        ? (block.getParent() as BlockSvg).style.colourTertiary\n        : (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\n      div!.style.borderRadius = borderRadius;\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\n        div!.style.boxShadow =\n          'rgba(255, 255, 255, 0.3) 0 0 0 ' + 4 * scale + 'px';\n      }\n    }\n    htmlInput.style.borderRadius = borderRadius;\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n\n    this.resizeEditor_();\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Closes the editor, saves the results, and disposes of any events or\n   * DOM-references belonging to the editor.\n   */\n  protected widgetDispose_() {\n    // Non-disposal related things that we do when the editor closes.\n    this.isBeingEdited_ = false;\n    this.isTextValid_ = true;\n    // Make sure the field's node matches the field's internal value.\n    this.forceRerender();\n    this.onFinishEditing_(this.value_);\n\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.valueWhenEditorWasOpened_ !== null &&\n      this.valueWhenEditorWasOpened_ !== this.value_\n    ) {\n      // When closing a field input widget, fire an event indicating that the\n      // user has completed a sequence of changes. The value may have changed\n      // multiple times while the editor was open, but this will fire an event\n      // containing the value when the editor was opened as well as the new one.\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this.sourceBlock_,\n          'field',\n          this.name || null,\n          this.valueWhenEditorWasOpened_,\n          this.value_,\n        ),\n      );\n      this.valueWhenEditorWasOpened_ = null;\n    }\n\n    eventUtils.setGroup(false);\n\n    // Actual disposal.\n    this.unbindInputEvents_();\n    const style = WidgetDiv.getDiv()!.style;\n    style.width = 'auto';\n    style.height = 'auto';\n    style.fontSize = '';\n    style.transition = '';\n    style.boxShadow = '';\n    this.htmlInput_ = null;\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.removeClass(clickTarget, 'editing');\n  }\n\n  /**\n   * A callback triggered when the user is done editing the field via the UI.\n   *\n   * @param _value The new value of the field.\n   */\n  onFinishEditing_(_value: AnyDuringMigration) {}\n\n  /**\n   * Bind handlers for user input on the text input field's editor.\n   *\n   * @param htmlInput The htmlInput to which event handlers will be bound.\n   */\n  protected bindInputEvents_(htmlInput: HTMLElement) {\n    // Trap Enter without IME and Esc to hide.\n    this.onKeyDownWrapper_ = browserEvents.conditionalBind(\n      htmlInput,\n      'keydown',\n      this,\n      this.onHtmlInputKeyDown_,\n    );\n    // Resize after every input change.\n    this.onKeyInputWrapper_ = browserEvents.conditionalBind(\n      htmlInput,\n      'input',\n      this,\n      this.onHtmlInputChange_,\n    );\n  }\n\n  /** Unbind handlers for user input and workspace size changes. */\n  protected unbindInputEvents_() {\n    if (this.onKeyDownWrapper_) {\n      browserEvents.unbind(this.onKeyDownWrapper_);\n      this.onKeyDownWrapper_ = null;\n    }\n    if (this.onKeyInputWrapper_) {\n      browserEvents.unbind(this.onKeyInputWrapper_);\n      this.onKeyInputWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Escape') {\n      this.setValue(\n        this.htmlInput_!.getAttribute('data-untyped-default-value'),\n      );\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Tab') {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n      (this.sourceBlock_ as BlockSvg).tab(this, !e.shiftKey);\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a change to the editor.\n   *\n   * @param _e Keyboard event.\n   */\n  private onHtmlInputChange_(_e: Event) {\n    // Intermediate value changes from user input are not confirmed until the\n    // user closes the editor, and may be numerous. Inhibit reporting these as\n    // normal block change events, and instead report them as special\n    // intermediate changes that do not get recorded in undo history.\n    const oldValue = this.value_;\n    // Change the field's value without firing the normal change event.\n    this.setValue(this.getValueFromEditorText_(this.htmlInput_!.value), false);\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.value_ !== oldValue\n    ) {\n      // Fire a special event indicating that the value changed but the change\n      // isn't complete yet and normal field change listeners can wait.\n      eventUtils.fire(\n        new (eventUtils.get(eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\n          this.sourceBlock_,\n          this.name || null,\n          oldValue,\n          this.value_,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Set the HTML input value and the field's internal value. The difference\n   * between this and `setValue` is that this also updates the HTML input\n   * value whilst editing.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   */\n  protected setEditorValue_(\n    newValue: AnyDuringMigration,\n    fireChangeEvent = true,\n  ) {\n    this.isDirty_ = true;\n    if (this.isBeingEdited_) {\n      // In the case this method is passed an invalid value, we still\n      // pass it through the transformation method `getEditorText` to deal\n      // with. Otherwise, the internal field's state will be inconsistent\n      // with what's shown to the user.\n      this.htmlInput_!.value = this.getEditorText_(newValue);\n    }\n    this.setValue(newValue, fireChangeEvent);\n  }\n\n  /** Resize the editor to fit the text. */\n  protected resizeEditor_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const div = WidgetDiv.getDiv();\n    const bBox = this.getScaledBBox();\n    div!.style.width = bBox.right - bBox.left + 'px';\n    div!.style.height = bBox.bottom - bBox.top + 'px';\n\n    // In RTL mode block fields and LTR input fields the left edge moves,\n    // whereas the right edge is fixed.  Reposition the editor.\n    const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\n    const xy = new Coordinate(x, bBox.top);\n\n    div!.style.left = xy.x + 'px';\n    div!.style.top = xy.y + 'px';\n  }\n\n  /**\n   * Handles repositioning the WidgetDiv used for input fields when the\n   * workspace is resized. Will bump the block into the viewport and update the\n   * position of the text input if necessary.\n   *\n   * @returns True for rendered workspaces, as we never want to hide the widget\n   *     div.\n   */\n  override repositionForWindowResize(): boolean {\n    const block = this.getSourceBlock();\n    // This shouldn't be possible. We should never have a WidgetDiv if not using\n    // rendered blocks.\n    if (!(block instanceof BlockSvg)) return false;\n\n    const bumped = bumpObjects.bumpIntoBounds(\n      this.workspace_!,\n      this.workspace_!.getMetricsManager().getViewMetrics(true),\n      block,\n    );\n\n    if (!bumped) this.resizeEditor_();\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  override isTabNavigable(): boolean {\n    return true;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation. When we're currently editing, return the current HTML value\n   * instead. Otherwise, return null which tells the field to use the default\n   * behaviour (which is a string cast of the field's value).\n   *\n   * @returns The HTML value if we're editing, otherwise null.\n   */\n  protected override getText_(): string | null {\n    if (this.isBeingEdited_ && this.htmlInput_) {\n      // We are currently editing, return the HTML input value instead.\n      return this.htmlInput_.value;\n    }\n    return null;\n  }\n\n  /**\n   * Transform the provided value into a text to show in the HTML input.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getValueFromEditorText_`.\n   *\n   * @param value The value stored in this field.\n   * @returns The text to show on the HTML input.\n   */\n  protected getEditorText_(value: AnyDuringMigration): string {\n    return `${value}`;\n  }\n\n  /**\n   * Transform the text received from the HTML input into a value to store\n   * in this field.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getEditorText_`.\n   *\n   * @param text Text received from the HTML input.\n   * @returns The value to store.\n   */\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\n    return text;\n  }\n}\n\n/**\n * Config options for the input field.\n *\n * @internal\n */\nexport interface FieldInputConfig extends FieldConfig {\n  spellcheck?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n * @internal\n */\nexport type FieldInputValidator<T extends InputTypes> = FieldValidator<\n  string | T\n>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldTextInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {Field} from './field.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for an editable text field.\n */\nexport class FieldTextInput extends FieldInput<string> {\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldTextInputValidator | null,\n    config?: FieldTextInputConfig,\n  ) {\n    super(value, validator, config);\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Construct a FieldTextInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldTextInputFromJsonConfig): FieldTextInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldTextInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_input', FieldTextInput);\n\nFieldTextInput.prototype.DEFAULT_VALUE = '';\n\n/**\n *  Config options for the text input field.\n */\nexport type FieldTextInputConfig = FieldInputConfig;\n\n/**\n * fromJson config options for the text input field.\n */\nexport interface FieldTextInputFromJsonConfig extends FieldTextInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldTextInputValidator = FieldInputValidator<string>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.BottomRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the top row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends BaseBottomRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  connectedBottomNextConnection = false;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n\n    if (this.connectedBlock) {\n      // Find the bottom-most connected block in the stack.\n      let block = this.connectedBlock;\n      let nextBlock;\n      while ((nextBlock = block.getNextBlock())) {\n        block = nextBlock;\n      }\n      if (!block.nextConnection) {\n        this.height = this.connectedBlockHeight;\n        this.connectedBottomNextConnection = true;\n      }\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RightConnectionShape\n\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {Measurable} from '../../../renderers/measurables/base.js';\nimport {Types} from '../../../renderers/measurables/types.js';\n\n/**\n * An object containing information about the space a right connection shape\n * takes up during rendering.\n */\nexport class RightConnectionShape extends Measurable {\n  // Size is dynamic\n  override height = 0;\n  override width = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.getType('RIGHT_CONNECTION');\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.TopRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends BaseTopRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    return !!block.outputConnection || hasHat;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {FieldImage} from '../../field_image.js';\nimport {FieldLabel} from '../../field_label.js';\nimport {FieldTextInput} from '../../field_textinput.js';\nimport {Input} from '../../inputs/input.js';\nimport {Align} from '../../inputs/align.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider, InsideCorners} from './constants.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport type {PathObject} from './path_object.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  override topRow: TopRow;\n  override bottomRow: BottomRow;\n  override constants_: ConstantProvider;\n  override renderer_: Renderer;\n\n  override isInline = true;\n  isMultiRow: boolean;\n  hasStatementInput: boolean;\n  rightSide: RightConnectionShape | null;\n  private readonly rightAlignedDummyInputs: WeakMap<Row, Input>;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n\n    this.renderer_ = renderer;\n\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n\n    /**\n     * Whether the block should be rendered as a multi-line block, either\n     * because it's not inline or because it has been collapsed.\n     */\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\n\n    /**\n     * Whether or not the block has a statement input in one of its rows.\n     */\n    this.hasStatementInput = block.statementInputCount > 0;\n\n    /**\n     * An object with rendering information about the right connection shape.\n     */\n    this.rightSide = this.outputConnection\n      ? new RightConnectionShape(this.constants_)\n      : null;\n\n    /**\n     * A map of rows to right aligned dummy inputs within those rows. Used to\n     * add padding between left and right aligned inputs.\n     */\n    this.rightAlignedDummyInputs = new WeakMap();\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_ as Renderer;\n  }\n\n  override measure() {\n    // Modifying parent measure method to add `adjustXPosition_`.\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.adjustXPosition_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  override shouldStartNewRow_(currInput: Input, prevInput: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value, dummy, and end-row inputs get new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      currInput instanceof EndRowInput\n    ) {\n      return !this.isInline || this.isMultiRow;\n    }\n    return false;\n  }\n\n  override getDesiredRowWidth_(row: Row): number {\n    if (row.hasStatement) {\n      const rightCornerWidth =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\n      return this.width - this.startX - rightCornerWidth;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev || !next) {\n      // No need for padding at the beginning or end of the row if the\n      // output shape is dynamic.\n      if (\n        this.outputConnection &&\n        this.outputConnection.isDynamicShape &&\n        !this.hasStatementInput &&\n        !this.bottomRow.hasNextConnection\n      ) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n    // Spacing between a square corner and a hat.\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\n    if (precedesStatement || followsStatement) {\n      const cornerHeight =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\n      return precedesStatement && followsStatement\n        ? Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT)\n        : height;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev)) {\n      const topRow = prev as TopRow;\n      if (\n        !topRow.hasPreviousConnection &&\n        (!this.outputConnection || this.hasStatementInput)\n      ) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    if (Types.isBottomRow(next)) {\n      const bottomRow = next as BottomRow;\n      if (!this.outputConnection) {\n        const topHeight =\n          Math.max(\n            this.topRow.minHeight,\n            Math.max(\n              this.constants_.NOTCH_HEIGHT,\n              this.constants_.CORNER_RADIUS,\n            ),\n          ) - this.constants_.CORNER_RADIUS;\n        return topHeight;\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\n    const width = this.width - this.startX;\n    if (\n      (Types.isInputRow(prev) && prev.hasStatement) ||\n      (Types.isInputRow(next) && next.hasStatement)\n    ) {\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\n    }\n    return width;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable): number {\n    if (\n      row.hasStatement &&\n      !Types.isSpacer(elem) &&\n      !Types.isStatementInput(elem)\n    ) {\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        connectedBlock.nextConnection\n      ) {\n        return row.yPos + connectedBlock.height / 2;\n      }\n    }\n    return super.getElemCenterline_(row, elem);\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // If we have two dummy inputs on the same row, one aligned left and the\n    // other right, keep track of the right aligned dummy input so we can add\n    // padding later. An end-row input after a dummy input also counts.\n    if (\n      (input instanceof DummyInput || input instanceof EndRowInput) &&\n      activeRow.hasDummyInput &&\n      activeRow.align === Align.LEFT &&\n      input.align === Align.RIGHT\n    ) {\n      this.rightAlignedDummyInputs.set(activeRow, input);\n    } else if (input instanceof StatementInput) {\n      // Handle statements without next connections correctly.\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n\n      if (activeRow.align === null) {\n        activeRow.align = input.align;\n      }\n      return;\n    }\n    super.addInput_(input, activeRow);\n  }\n\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\n    if (this.rightAlignedDummyInputs.get(row)) {\n      let alignmentDivider;\n      for (let i = 0; i < row.elements.length; i++) {\n        const elem = row.elements[i];\n        if (Types.isSpacer(elem)) {\n          alignmentDivider = elem;\n        }\n        if (\n          Types.isField(elem) &&\n          elem instanceof Field &&\n          elem.parentInput === this.rightAlignedDummyInputs.get(row)\n        ) {\n          break;\n        }\n      }\n      if (alignmentDivider) {\n        alignmentDivider.width += missingSpace;\n        row.width += missingSpace;\n        return;\n      }\n    }\n    super.addAlignmentPadding_(row, missingSpace);\n  }\n\n  /**\n   * Adjust the x position of fields to bump all non-label fields in the first\n   * row past the notch position.  This must be called before `computeBounds`\n   * is called.\n   */\n  protected adjustXPosition_() {\n    const notchTotalWidth =\n      this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\n    let minXPos = notchTotalWidth;\n    // Run through every input row on the block and only apply bump logic to the\n    // first input row (if the block has prev connection) and every input row\n    // that has a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const hasPrevNotch =\n        i === 2\n          ? !!this.topRow.hasPreviousConnection\n          : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (Types.isInputRow(row) && row.hasStatement) {\n        row.measure();\n        minXPos =\n          row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\n      } else if (\n        hasPrevNotch &&\n        (i === 2 || hasNextNotch) &&\n        Types.isInputRow(row) &&\n        !row.hasStatement\n      ) {\n        let xCursor = row.xPos;\n        let prevInRowSpacer = null;\n        for (let j = 0; j < row.elements.length; j++) {\n          const elem = row.elements[j];\n          if (Types.isSpacer(elem)) {\n            prevInRowSpacer = elem;\n          }\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\n            if (\n              xCursor < minXPos &&\n              !(\n                Types.isField(elem) &&\n                elem instanceof Field &&\n                (elem.field instanceof FieldLabel ||\n                  elem.field instanceof FieldImage)\n              )\n            ) {\n              const difference = minXPos - xCursor;\n              prevInRowSpacer.width += difference;\n            }\n          }\n          xCursor += elem.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Finalize the output connection info.  In particular, set the height of the\n   * output connection to match that of the block.  For the right side, add a\n   * right connection shape element and have it match the dimensions of the\n   * output connection.\n   */\n  protected finalizeOutputConnection_() {\n    // Dynamic output connections depend on the height of the block.\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\n      return;\n    }\n    const outputConnectionShape = this.outputConnection.shape;\n    if (\n      !('isDynamic' in outputConnectionShape && outputConnectionShape.isDynamic)\n    ) {\n      return;\n    }\n\n    let yCursor = 0;\n    // Determine the block height.\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      yCursor += row.height;\n    }\n    this.height = yCursor;\n\n    // Adjust the height of the output connection.\n    const blockHeight = this.bottomRow.hasNextConnection\n      ? this.height - this.bottomRow.descenderHeight\n      : this.height;\n    const connectionHeight = outputConnectionShape.height(blockHeight);\n    const connectionWidth = outputConnectionShape.width(blockHeight);\n\n    this.outputConnection.height = connectionHeight;\n    this.outputConnection.width = connectionWidth;\n    this.outputConnection.startX = connectionWidth;\n    this.outputConnection.connectionOffsetY =\n      outputConnectionShape.connectionOffsetY(connectionHeight);\n    this.outputConnection.connectionOffsetX =\n      outputConnectionShape.connectionOffsetX(connectionWidth);\n\n    // Add the right connection measurable.\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\n    let rightConnectionWidth = 0;\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n      rightConnectionWidth = connectionWidth;\n      this.rightSide!.height = connectionHeight;\n      this.rightSide!.width = rightConnectionWidth;\n      this.rightSide!.centerline = connectionHeight / 2;\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\n    }\n    this.startX = connectionWidth;\n    this.width += connectionWidth + rightConnectionWidth;\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\n  }\n\n  /**\n   * Finalize horizontal alignment of elements on the block.  In particular,\n   * reduce the implicit spacing created by the left and right output connection\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\n   * spacers.\n   */\n  protected finalizeHorizontalAlignment_() {\n    if (\n      !this.outputConnection ||\n      this.hasStatementInput ||\n      this.bottomRow.hasNextConnection\n    ) {\n      return;\n    }\n    let totalNegativeSpacing = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (!Types.isInputRow(row)) {\n        continue;\n      }\n      const firstElem = row.elements[1];\n      const lastElem = row.elements[row.elements.length - 2];\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\n      const minBlockWidth =\n        this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\n        // Maintain a minimum block width, split negative spacing between left\n        // and right edge.\n        totalNegativeSpacing = this.width - minBlockWidth;\n        leftNegPadding = totalNegativeSpacing / 2;\n        rightNegPadding = totalNegativeSpacing / 2;\n      }\n      // Add a negative spacer on the start and end of the block.\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\n    }\n    if (totalNegativeSpacing) {\n      this.width -= totalNegativeSpacing;\n      this.widthWithChildren -= totalNegativeSpacing;\n      this.rightSide!.xPos -= totalNegativeSpacing;\n      for (let i = 0; i < this.rows.length; i++) {\n        const row = this.rows[i];\n        if (Types.isTopOrBottomRow(row)) {\n          row.elements[1].width -= totalNegativeSpacing;\n        }\n        row.width -= totalNegativeSpacing;\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\n      }\n    }\n  }\n\n  /**\n   * Calculate the spacing to reduce the left and right edges by based on the\n   * outer and inner connection shape.\n   *\n   * @param elem The first or last element on a block.\n   * @returns The amount of spacing to reduce the first or last spacer.\n   */\n  protected getNegativeSpacing_(elem: Measurable): number {\n    if (!elem || !this.outputConnection) {\n      return 0;\n    }\n    const connectionWidth = this.outputConnection.width;\n    const outerShape = this.outputConnection.shape.type;\n    const constants = this.constants_;\n    if (this.inputRows.length > 1) {\n      switch (outerShape) {\n        case constants.SHAPES.ROUND: {\n          // Special case for multi-row round reporter blocks.\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\n          const topPadding = this.constants_.SMALL_PADDING;\n          const roundPadding =\n            width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\n          return connectionWidth - roundPadding;\n        }\n        default:\n          return 0;\n      }\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      const innerShape = connectedBlock\n        ? (connectedBlock.pathObject as PathObject).outputShapeType\n        : elem.shape.type;\n      if (innerShape == null) {\n        return 0;\n      }\n      // Special case for value to stack / value to statement blocks.\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        (connectedBlock.statementInputCount || connectedBlock.nextConnection)\n      ) {\n        return 0;\n      }\n      // Special case for hexagonal output.\n      if (\n        outerShape === constants.SHAPES.HEXAGONAL &&\n        outerShape !== innerShape\n      ) {\n        return 0;\n      }\n      return (\n        connectionWidth -\n        this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape]\n      );\n    } else if (Types.isField(elem) && elem instanceof Field) {\n      // Special case for text inputs.\n      if (\n        outerShape === constants.SHAPES.ROUND &&\n        elem.field instanceof FieldTextInput\n      ) {\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\n      }\n      return (\n        connectionWidth - this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0]\n      );\n    } else if (Types.isIcon(elem)) {\n      return this.constants_.SMALL_PADDING;\n    }\n    return 0;\n  }\n\n  /**\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\n   * implicit spacing when a non-shadow block is connected to any of an input\n   * row's inline inputs.\n   */\n  protected finalizeVerticalAlignment_() {\n    if (this.outputConnection) {\n      return;\n    }\n    // Run through every input row on the block and only apply tight nesting\n    // logic to input rows that have a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const firstRow = i === 2;\n      const hasPrevNotch = firstRow\n        ? !!this.topRow.hasPreviousConnection\n        : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (hasPrevNotch) {\n        const elem = row.elements[1];\n        const hasSingleTextOrImageField =\n          row.elements.length === 3 &&\n          elem instanceof Field &&\n          (elem.field instanceof FieldLabel ||\n            elem.field instanceof FieldImage);\n        if (!firstRow && hasSingleTextOrImageField) {\n          // Remove some padding if we have a single image or text field.\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\n          row.height -= this.constants_.MEDIUM_PADDING;\n        } else if (!firstRow && !hasNextNotch) {\n          // Add a small padding so the notch doesn't clash with inputs/fields.\n          prevSpacer.height += this.constants_.SMALL_PADDING;\n        } else if (hasNextNotch) {\n          // Determine if the input row has non-shadow connected blocks.\n          let hasNonShadowConnectedBlocks = false;\n          const minVerticalTightNestingHeight = 40;\n          for (let j = 0; j < row.elements.length; j++) {\n            const elem = row.elements[j];\n            if (\n              elem instanceof InputConnection &&\n              Types.isInlineInput(elem) &&\n              elem.connectedBlock &&\n              !elem.connectedBlock.isShadow() &&\n              elem.connectedBlock.getHeightWidth().height >=\n                minVerticalTightNestingHeight\n            ) {\n              hasNonShadowConnectedBlocks = true;\n              break;\n            }\n          }\n          // Apply tight-nesting if we have both a prev and next notch and the\n          // block has non-shadow connected blocks.\n          if (hasNonShadowConnectedBlocks) {\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\n          }\n        }\n      }\n    }\n  }\n\n  override finalize_() {\n    this.finalizeOutputConnection_();\n    this.finalizeHorizontalAlignment_();\n    this.finalizeVerticalAlignment_();\n    super.finalize_();\n\n    if (this.rightSide) {\n      this.widthWithChildren += this.rightSide.width;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.MarkerSvg\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\n\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\n\n/**\n * Class to draw a marker.\n */\nexport class MarkerSvg extends BaseMarkerSvg {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  constants_!: ZelosConstantProvider;\n\n  private markerCircle: SVGCircleElement | null = null;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    workspace: WorkspaceSvg,\n    constants: BaseConstantProvider,\n    marker: Marker,\n  ) {\n    super(workspace, constants, marker);\n  }\n\n  /**\n   * Position and display the marker for an input or an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithInputOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const connection = curNode.getLocation() as RenderedConnection;\n    const offsetInBlock = connection.getOffsetInBlock();\n\n    this.positionCircle(offsetInBlock.x, offsetInBlock.y);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  override showWithOutput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  override showWithInput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  /**\n   * Draw a rectangle around the block.\n   *\n   * @param curNode The current node of the marker.\n   */\n  override showWithBlock_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position the circle we use for input and output connections.\n   *\n   * @param x The x position of the circle.\n   * @param y The y position of the circle.\n   */\n  private positionCircle(x: number, y: number) {\n    this.markerCircle?.setAttribute('cx', `${x}`);\n    this.markerCircle?.setAttribute('cy', `${y}`);\n    this.currentMarkerSvg = this.markerCircle;\n  }\n\n  override hide() {\n    super.hide();\n    if (this.markerCircle) {\n      this.markerCircle.style.display = 'none';\n    }\n  }\n\n  override createDomInternal_() {\n    /* clang-format off */\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n    /* clang-format on */\n    super.createDomInternal_();\n\n    this.markerCircle = dom.createSvgElement(\n      Svg.CIRCLE,\n      {\n        'r': this.constants_.CURSOR_RADIUS,\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n    this.hide();\n\n    // Markers and stack cursors don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle!);\n    }\n\n    return this.markerSvg_!;\n  }\n\n  override applyColour_(curNode: ASTNode) {\n    super.applyColour_(curNode);\n\n    this.markerCircle?.setAttribute('fill', this.colour_);\n    this.markerCircle?.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerCircle?.firstElementChild!.setAttribute('values', values);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  /** The selected path of the block. */\n  private svgPathSelected: SVGElement | null = null;\n\n  /** The outline paths on the block. */\n  private readonly outlines = new Map<string, SVGElement>();\n\n  /**\n   * A set used to determine which outlines were used during a draw pass.  The\n   * set is initialized with a reference to all the outlines in\n   * `this.outlines`. Every time we use an outline during the draw pass, the\n   * reference is removed from this set.\n   */\n  private remainingOutlines = new Set<string>();\n\n  /**\n   * The type of block's output connection shape.  This is set when a block\n   * with an output connection is drawn.\n   */\n  outputShapeType: number | null = null;\n\n  public override constants: ConstantProvider;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    this.constants = constants;\n  }\n\n  override setPath(pathString: string) {\n    super.setPath(pathString);\n    if (this.svgPathSelected) {\n      this.svgPathSelected.setAttribute('d', pathString);\n    }\n  }\n\n  override applyColour(block: BlockSvg) {\n    super.applyColour(block);\n    // Set shadow stroke colour.\n    const parent = block.getParent();\n    if (block.isShadow() && parent) {\n      this.svgPath.setAttribute('stroke', parent.style.colourTertiary);\n    }\n\n    // Apply colour to outlines.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('fill', this.style.colourTertiary);\n    }\n  }\n\n  override flipRTL() {\n    super.flipRTL();\n    // Mirror each input outline path.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('transform', 'scale(-1 1)');\n    }\n  }\n\n  override updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n    if (enable) {\n      if (!this.svgPathSelected) {\n        this.svgPathSelected = this.svgPath.cloneNode(true) as SVGElement;\n        this.svgPathSelected.setAttribute('fill', 'none');\n        this.svgPathSelected.setAttribute(\n          'filter',\n          'url(#' + this.constants.selectedGlowFilterId + ')',\n        );\n        this.svgRoot.appendChild(this.svgPathSelected);\n      }\n    } else {\n      if (this.svgPathSelected) {\n        this.svgRoot.removeChild(this.svgPathSelected);\n        this.svgPathSelected = null;\n      }\n    }\n  }\n\n  override updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      this.svgPath.removeAttribute('filter');\n    }\n  }\n\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\n    const name = conn.getParentInput()!.name;\n    const outlinePath = this.getOutlinePath(name);\n    if (!outlinePath) {\n      return;\n    }\n    if (enable) {\n      outlinePath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      outlinePath.removeAttribute('filter');\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is about to draw the block.\n   */\n  beginDrawing() {\n    this.remainingOutlines.clear();\n    for (const key of this.outlines.keys()) {\n      this.remainingOutlines.add(key);\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is done drawing.\n   */\n  endDrawing() {\n    // Go through all remaining outlines that were not used this draw pass, and\n    // remove them.\n    if (this.remainingOutlines.size) {\n      for (const key of this.remainingOutlines) {\n        this.removeOutlinePath(key);\n      }\n    }\n    this.remainingOutlines.clear();\n  }\n\n  /**\n   * Set the path generated by the renderer for an outline path on the\n   * respective outline path SVG element.\n   *\n   * @param name The input name.\n   * @param pathString The path.\n   */\n  setOutlinePath(name: string, pathString: string) {\n    const outline = this.getOutlinePath(name);\n    outline.setAttribute('d', pathString);\n    outline.setAttribute('fill', this.style.colourTertiary);\n  }\n\n  /**\n   * Create's an outline path for the specified input.\n   *\n   * @param name The input name.\n   * @returns The SVG outline path.\n   */\n  private getOutlinePath(name: string): SVGElement {\n    if (!this.outlines.has(name)) {\n      this.outlines.set(\n        name,\n        dom.createSvgElement(\n          Svg.PATH,\n          {\n            'class': 'blocklyOutlinePath', // IE doesn't like paths without the\n            // data definition, set empty\n            // default\n            'd': '',\n          },\n          this.svgRoot,\n        ),\n      );\n    }\n    this.remainingOutlines.delete(name);\n    return this.outlines.get(name)!;\n  }\n\n  /**\n   * Remove an outline path that is associated with the specified input.\n   *\n   * @param name The input name.\n   */\n  private removeOutlinePath(name: string) {\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\n    this.outlines.delete(name);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The zelos renderer. This renderer emulates Scratch-style and MakeCode-style\n * rendering.\n *\n * Zelos is the ancient Greek spirit of rivalry and emulation.\n */\nexport class Renderer extends BaseRenderer {\n  protected override constants_!: ConstantProvider;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of the renderer's cursor drawer.\n   *\n   * @param workspace The workspace the cursor belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  override makeMarkerDrawer(\n    workspace: WorkspaceSvg,\n    marker: Marker,\n  ): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  override getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  override shouldHighlightConnection(conn: Connection) {\n    return (\n      conn.type !== ConnectionType.INPUT_VALUE &&\n      conn.type !== ConnectionType.OUTPUT_VALUE\n    );\n  }\n\n  override getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ) {\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\n      if (!closest.isConnected()) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\n      }\n      // TODO: Returning this is a total hack, because we don't want to show\n      //   a replacement fade, we want to show an outline affect.\n      //   Sadly zelos does not support showing an outline around filled\n      //   inputs, so we have to pretend like the connected block is getting\n      //   replaced.\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\n  }\n}\n\nblockRendering.register('zelos', Renderer);\n", "/** @file Re-exports of Blockly.zelos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  BottomRow,\n  ConstantProvider,\n  Drawer,\n  MarkerSvg,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  RightConnectionShape,\n  StatementInput,\n  TopRow,\n};\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Angle input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldAngle\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as dom from './utils/dom.js';\nimport * as math from './utils/math.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for an editable angle field.\n */\nexport class FieldAngle extends FieldInput<number> {\n  /** Half the width of protractor image. */\n  static readonly HALF = 100 / 2;\n\n  /**\n   * Radius of protractor circle.  Slightly smaller than protractor size since\n   * otherwise SVG crops off half the border at the edges.\n   */\n  static readonly RADIUS: number = FieldAngle.HALF - 1;\n\n  /**\n   * Default property describing which direction makes an angle field's value\n   * increase. Angle increases clockwise (true) or counterclockwise (false).\n   */\n  static readonly CLOCKWISE = false;\n\n  /**\n   * The default offset of 0 degrees (and all angles). Always offsets in the\n   * counterclockwise direction, regardless of the field's clockwise property.\n   * Usually either 0 (0 = right) or 90 (0 = up).\n   */\n  static readonly OFFSET = 0;\n\n  /**\n   * The default maximum angle to allow before wrapping.\n   * Usually either 360 (for 0 to 359.9) or 180 (for -179.9 to 180).\n   */\n  static readonly WRAP = 360;\n\n  /**\n   * The default amount to round angles to when using a mouse or keyboard nav\n   * input. Must be a positive integer to support keyboard navigation.\n   */\n  static readonly ROUND = 15;\n\n  /**\n   * Whether the angle should increase as the angle picker is moved clockwise\n   * (true) or counterclockwise (false).\n   */\n  private clockwise = FieldAngle.CLOCKWISE;\n\n  /**\n   * The offset of zero degrees (and all other angles).\n   */\n  private offset = FieldAngle.OFFSET;\n\n  /**\n   * The maximum angle to allow before wrapping.\n   */\n  private wrap = FieldAngle.WRAP;\n\n  /**\n   * The amount to round angles to when using a mouse or keyboard nav input.\n   */\n  private round = FieldAngle.ROUND;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** Dynamic red line pointing at the value's angle. */\n  private line: SVGLineElement | null = null;\n\n  /** Dynamic pink area extending from 0 to the value's angle. */\n  private gauge: SVGPathElement | null = null;\n\n  /** The degree symbol for this field. */\n  protected symbol_: SVGTSpanElement | null = null;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/angle#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | number | typeof Field.SKIP_SETUP,\n    validator?: FieldAngleValidator,\n    config?: FieldAngleConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldAngleConfig) {\n    super.configure_(config);\n\n    switch (config.mode) {\n      case Mode.COMPASS:\n        this.clockwise = true;\n        this.offset = 90;\n        break;\n      case Mode.PROTRACTOR:\n        // This is the default mode, so we could do nothing. But just to\n        // future-proof, we'll set it anyway.\n        this.clockwise = false;\n        this.offset = 0;\n        break;\n    }\n\n    // Allow individual settings to override the mode setting.\n    if (config.clockwise) this.clockwise = config.clockwise;\n    if (config.offset) this.offset = config.offset;\n    if (config.wrap) this.wrap = config.wrap;\n    if (config.round) this.round = config.round;\n  }\n\n  /**\n   * Create the block UI for this field.\n   */\n  override initView() {\n    super.initView();\n    // Add the degree symbol to the left of the number,\n    // even in RTL (issue #2380).\n    this.symbol_ = dom.createSvgElement(Svg.TSPAN, {});\n    this.symbol_.appendChild(document.createTextNode('°'));\n    this.getTextElement().appendChild(this.symbol_);\n  }\n\n  /** Updates the angle when the field rerenders. */\n  protected override render_() {\n    super.render_();\n    this.updateGraph();\n  }\n\n  /**\n   * Create and show the angle field's editor.\n   *\n   * @param e Optional mouse event that triggered the field to open,\n   *     or undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: Event) {\n    // Mobile browsers have issues with in-line textareas (focus & keyboards).\n    const noFocus = userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD;\n    super.showEditor_(e, noFocus);\n\n    const editor = this.dropdownCreate();\n    dropDownDiv.getContentDiv().appendChild(editor);\n\n    if (this.sourceBlock_ instanceof BlockSvg) {\n      dropDownDiv.setColour(\n        this.sourceBlock_.style.colourPrimary,\n        this.sourceBlock_.style.colourTertiary,\n      );\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\n\n    this.updateGraph();\n  }\n\n  /**\n   * Creates the angle dropdown editor.\n   *\n   * @returns The newly created slider.\n   */\n  private dropdownCreate(): SVGSVGElement {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'height': FieldAngle.HALF * 2 + 'px',\n      'width': FieldAngle.HALF * 2 + 'px',\n    });\n    svg.style.touchAction = 'none';\n    const circle = dom.createSvgElement(\n      Svg.CIRCLE,\n      {\n        'cx': FieldAngle.HALF,\n        'cy': FieldAngle.HALF,\n        'r': FieldAngle.RADIUS,\n        'class': 'blocklyAngleCircle',\n      },\n      svg,\n    );\n    this.gauge = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyAngleGauge'},\n      svg,\n    );\n    this.line = dom.createSvgElement(\n      Svg.LINE,\n      {\n        'x1': FieldAngle.HALF,\n        'y1': FieldAngle.HALF,\n        'class': 'blocklyAngleLine',\n      },\n      svg,\n    );\n    // Draw markers around the edge.\n    for (let angle = 0; angle < 360; angle += 15) {\n      dom.createSvgElement(\n        Svg.LINE,\n        {\n          'x1': FieldAngle.HALF + FieldAngle.RADIUS,\n          'y1': FieldAngle.HALF,\n          'x2':\n            FieldAngle.HALF + FieldAngle.RADIUS - (angle % 45 === 0 ? 10 : 5),\n          'y2': FieldAngle.HALF,\n          'class': 'blocklyAngleMarks',\n          'transform':\n            'rotate(' +\n            angle +\n            ',' +\n            FieldAngle.HALF +\n            ',' +\n            FieldAngle.HALF +\n            ')',\n        },\n        svg,\n      );\n    }\n\n    // The angle picker is different from other fields in that it updates on\n    // mousemove even if it's not in the middle of a drag.  In future we may\n    // change this behaviour.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(svg, 'click', this, this.hide),\n    );\n    // On touch devices, the picker's value is only updated with a drag. Add\n    // a click handler on the drag surface to update the value if the surface\n    // is clicked.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        circle,\n        'pointerdown',\n        this,\n        this.onMouseMove_,\n        true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        circle,\n        'pointermove',\n        this,\n        this.onMouseMove_,\n        true,\n      ),\n    );\n    return svg;\n  }\n\n  /** Disposes of events and DOM-references belonging to the angle editor. */\n  private dropdownDispose() {\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    this.gauge = null;\n    this.line = null;\n  }\n\n  /** Hide the editor. */\n  private hide() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hide();\n  }\n\n  /**\n   * Set the angle to match the mouse's position.\n   *\n   * @param e Mouse move event.\n   */\n  protected onMouseMove_(e: PointerEvent) {\n    // Calculate angle.\n    const bBox = this.gauge!.ownerSVGElement!.getBoundingClientRect();\n    const dx = e.clientX - bBox.left - FieldAngle.HALF;\n    const dy = e.clientY - bBox.top - FieldAngle.HALF;\n    let angle = Math.atan(-dy / dx);\n    if (isNaN(angle)) {\n      // This shouldn't happen, but let's not let this error propagate further.\n      return;\n    }\n    angle = math.toDegrees(angle);\n    // 0: East, 90: North, 180: West, 270: South.\n    if (dx < 0) {\n      angle += 180;\n    } else if (dy > 0) {\n      angle += 360;\n    }\n\n    // Do offsetting.\n    if (this.clockwise) {\n      angle = this.offset + 360 - angle;\n    } else {\n      angle = 360 - (this.offset - angle);\n    }\n\n    this.displayMouseOrKeyboardValue(angle);\n  }\n\n  /**\n   * Handles and displays values that are input via mouse or arrow key input.\n   * These values need to be rounded and wrapped before being displayed so\n   * that the text input's value is appropriate.\n   *\n   * @param angle New angle.\n   */\n  private displayMouseOrKeyboardValue(angle: number) {\n    if (this.round) {\n      angle = Math.round(angle / this.round) * this.round;\n    }\n    angle = this.wrapValue(angle);\n    if (angle !== this.value_) {\n      // Intermediate value changes from user input are not confirmed until the\n      // user closes the editor, and may be numerous. Inhibit reporting these as\n      // normal block change events, and instead report them as special\n      // intermediate changes that do not get recorded in undo history.\n      const oldValue = this.value_;\n      this.setEditorValue_(angle, false);\n      if (\n        this.sourceBlock_ &&\n        eventUtils.isEnabled() &&\n        this.value_ !== oldValue\n      ) {\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\n            this.sourceBlock_,\n            this.name || null,\n            oldValue,\n            this.value_,\n          ),\n        );\n      }\n    }\n  }\n\n  /** Redraw the graph with the current angle. */\n  private updateGraph() {\n    if (!this.gauge || !this.line) {\n      return;\n    }\n    // Always display the input (i.e. getText) even if it is invalid.\n    let angleDegrees = Number(this.getText()) + this.offset;\n    angleDegrees %= 360;\n    let angleRadians = math.toRadians(angleDegrees);\n    const path = ['M ', FieldAngle.HALF, ',', FieldAngle.HALF];\n    let x2 = FieldAngle.HALF;\n    let y2 = FieldAngle.HALF;\n    if (!isNaN(angleRadians)) {\n      const clockwiseFlag = Number(this.clockwise);\n      const angle1 = math.toRadians(this.offset);\n      const x1 = Math.cos(angle1) * FieldAngle.RADIUS;\n      const y1 = Math.sin(angle1) * -FieldAngle.RADIUS;\n      if (clockwiseFlag) {\n        angleRadians = 2 * angle1 - angleRadians;\n      }\n      x2 += Math.cos(angleRadians) * FieldAngle.RADIUS;\n      y2 -= Math.sin(angleRadians) * FieldAngle.RADIUS;\n      // Don't ask how the flag calculations work.  They just do.\n      let largeFlag = Math.abs(\n        Math.floor((angleRadians - angle1) / Math.PI) % 2,\n      );\n      if (clockwiseFlag) {\n        largeFlag = 1 - largeFlag;\n      }\n      path.push(\n        ' l ',\n        x1,\n        ',',\n        y1,\n        ' A ',\n        FieldAngle.RADIUS,\n        ',',\n        FieldAngle.RADIUS,\n        ' 0 ',\n        largeFlag,\n        ' ',\n        clockwiseFlag,\n        ' ',\n        x2,\n        ',',\n        y2,\n        ' z',\n      );\n    }\n    this.gauge.setAttribute('d', path.join(''));\n    this.line.setAttribute('x2', `${x2}`);\n    this.line.setAttribute('y2', `${y2}`);\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\n    super.onHtmlInputKeyDown_(e);\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    let multiplier = 0;\n    switch (e.key) {\n      case 'ArrowLeft':\n        // decrement (increment in RTL)\n        multiplier = block.RTL ? 1 : -1;\n        break;\n      case 'ArrowRight':\n        // increment (decrement in RTL)\n        multiplier = block.RTL ? -1 : 1;\n        break;\n      case 'ArrowDown':\n        // decrement\n        multiplier = -1;\n        break;\n      case 'ArrowUp':\n        // increment\n        multiplier = 1;\n        break;\n    }\n    if (multiplier) {\n      const value = this.getValue() as number;\n      this.displayMouseOrKeyboardValue(value + multiplier * this.round);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Ensure that the input value is a valid angle.\n   *\n   * @param newValue The input value.\n   * @returns A valid angle, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): number | null {\n    const value = Number(newValue);\n    if (isNaN(value) || !isFinite(value)) {\n      return null;\n    }\n    return this.wrapValue(value);\n  }\n\n  /**\n   * Wraps the value so that it is in the range (-360 + wrap, wrap).\n   *\n   * @param value The value to wrap.\n   * @returns The wrapped value.\n   */\n  private wrapValue(value: number): number {\n    value %= 360;\n    if (value < 0) {\n      value += 360;\n    }\n    if (value > this.wrap) {\n      value -= 360;\n    }\n    return value;\n  }\n\n  /**\n   * Construct a FieldAngle from a JSON arg object.\n   *\n   * @param options A JSON object with options (angle).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldAngleFromJsonConfig): FieldAngle {\n    // `this` might be a subclass of FieldAngle if that class doesn't override\n    // the static fromJson method.\n    return new this(options.angle, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_angle', FieldAngle);\n\nFieldAngle.prototype.DEFAULT_VALUE = 0;\n\n/**\n * CSS for angle field.\n */\nCss.register(`\n.blocklyAngleCircle {\n  stroke: #444;\n  stroke-width: 1;\n  fill: #ddd;\n  fill-opacity: 0.8;\n}\n\n.blocklyAngleMarks {\n  stroke: #444;\n  stroke-width: 1;\n}\n\n.blocklyAngleGauge {\n  fill: #f88;\n  fill-opacity: 0.8;\n  pointer-events: none;\n}\n\n.blocklyAngleLine {\n  stroke: #f00;\n  stroke-width: 2;\n  stroke-linecap: round;\n  pointer-events: none;\n}\n`);\n\n/**\n * The two main modes of the angle field.\n * Compass specifies:\n *   - clockwise: true\n *   - offset: 90\n *   - wrap: 0\n *   - round: 15\n *\n * Protractor specifies:\n *   - clockwise: false\n *   - offset: 0\n *   - wrap: 0\n *   - round: 15\n */\nexport enum Mode {\n  COMPASS = 'compass',\n  PROTRACTOR = 'protractor',\n}\n\n/**\n * Extra configuration options for the angle field.\n */\nexport interface FieldAngleConfig extends FieldInputConfig {\n  mode?: Mode;\n  clockwise?: boolean;\n  offset?: number;\n  wrap?: number;\n  round?: number;\n}\n\n/**\n * fromJson configuration options for the angle field.\n */\nexport interface FieldAngleFromJsonConfig extends FieldAngleConfig {\n  angle?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldAngleValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Checkbox field.  Checked or not checked.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldCheckbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\n\ntype BoolString = 'TRUE' | 'FALSE';\ntype CheckboxBool = BoolString | boolean;\n\n/**\n * Class for a checkbox field.\n */\nexport class FieldCheckbox extends Field<CheckboxBool> {\n  /** Default character for the checkmark. */\n  static readonly CHECK_CHAR = '✓';\n  private checkChar: string;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * Mouse cursor style when over the hotspot that initiates editability.\n   */\n  override CURSOR = 'default';\n\n  /**\n   * NOTE: The default value is set in `Field`, so maintain that value instead\n   * of overwriting it here or in the constructor.\n   */\n  override value_: boolean | null = this.value_;\n\n  /**\n   * @param value The initial value of the field. Should either be 'TRUE',\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: CheckboxBool | typeof Field.SKIP_SETUP,\n    validator?: FieldCheckboxValidator,\n    config?: FieldCheckboxConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * Character for the check mark. Used to apply a different check mark\n     * character to individual fields.\n     */\n    this.checkChar = FieldCheckbox.CHECK_CHAR;\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldCheckboxConfig) {\n    super.configure_(config);\n    if (config.checkCharacter) this.checkChar = config.checkCharacter;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The boolean value held by this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldCheckbox);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValueBoolean();\n  }\n\n  /**\n   * Create the block UI for this checkbox.\n   */\n  override initView() {\n    super.initView();\n\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyCheckbox');\n    textElement.style.display = this.value_ ? 'block' : 'none';\n  }\n\n  override render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\n  }\n\n  override getDisplayText_() {\n    return this.checkChar;\n  }\n\n  /**\n   * Set the character used for the check mark.\n   *\n   * @param character The character to use for the check mark, or null to use\n   *     the default.\n   */\n  setCheckCharacter(character: string | null) {\n    this.checkChar = character || FieldCheckbox.CHECK_CHAR;\n    this.forceRerender();\n  }\n\n  /** Toggle the state of the checkbox on click. */\n  protected override showEditor_() {\n    this.setValue(!this.value_);\n  }\n\n  /**\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\n   *\n   * @param newValue The input value.\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): BoolString | null {\n    if (newValue === true || newValue === 'TRUE') {\n      return 'TRUE';\n    }\n    if (newValue === false || newValue === 'FALSE') {\n      return 'FALSE';\n    }\n    return null;\n  }\n\n  /**\n   * Update the value of the field, and update the checkElement.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a either 'TRUE' or 'FALSE'.\n   */\n  protected override doValueUpdate_(newValue: BoolString) {\n    this.value_ = this.convertValueToBool_(newValue);\n    // Update visual.\n    if (this.textElement_) {\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\n   *\n   * @returns The value of this field.\n   */\n  override getValue(): BoolString {\n    return this.value_ ? 'TRUE' : 'FALSE';\n  }\n\n  /**\n   * Get the boolean value of this field.\n   *\n   * @returns The boolean value of this field.\n   */\n  getValueBoolean(): boolean | null {\n    return this.value_;\n  }\n\n  /**\n   * Get the text of this field. Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field ('true' or 'false').\n   */\n  override getText(): string {\n    return String(this.convertValueToBool_(this.value_));\n  }\n\n  /**\n   * Convert a value into a pure boolean.\n   *\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\n   * is cast to a boolean.\n   *\n   * @param value The value to convert.\n   * @returns The converted value.\n   */\n  private convertValueToBool_(value: CheckboxBool | null): boolean {\n    if (typeof value === 'string') return value === 'TRUE';\n    return !!value;\n  }\n\n  /**\n   * Construct a FieldCheckbox from a JSON arg object.\n   *\n   * @param options A JSON object with options (checked).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldCheckboxFromJsonConfig): FieldCheckbox {\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\n    // 'override' the static fromJson method.\n    return new this(options.checked, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_checkbox', FieldCheckbox);\n\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\n\n/**\n * Config options for the checkbox field.\n */\nexport interface FieldCheckboxConfig extends FieldConfig {\n  checkCharacter?: string;\n}\n\n/**\n * fromJson config options for the checkbox field.\n */\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\n  checked?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldCheckboxValidator = FieldValidator<CheckboxBool>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Colour input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldColour\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as aria from './utils/aria.js';\nimport * as colour from './utils/colour.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Size} from './utils/size.js';\n\n/**\n * Class for a colour input field.\n */\nexport class FieldColour extends Field<string> {\n  /**\n   * An array of colour strings for the palette.\n   * Copied from goog.ui.ColorPicker.SIMPLE_GRID_COLORS\n   * All colour pickers use this unless overridden with setColours.\n   */\n  // prettier-ignore\n  static COLOURS: string[] = [\n    // grays\n    '#ffffff', '#cccccc', '#c0c0c0', '#999999',\n    '#666666', '#333333', '#000000',  // reds\n    '#ffcccc', '#ff6666', '#ff0000', '#cc0000',\n    '#990000', '#660000', '#330000',  // oranges\n    '#ffcc99', '#ff9966', '#ff9900', '#ff6600',\n    '#cc6600', '#993300', '#663300',  // yellows\n    '#ffff99', '#ffff66', '#ffcc66', '#ffcc33',\n    '#cc9933', '#996633', '#663333',  // olives\n    '#ffffcc', '#ffff33', '#ffff00', '#ffcc00',\n    '#999900', '#666600', '#333300',  // greens\n    '#99ff99', '#66ff99', '#33ff33', '#33cc00',\n    '#009900', '#006600', '#003300',  // turquoises\n    '#99ffff', '#33ffff', '#66cccc', '#00cccc',\n    '#339999', '#336666', '#003333',  // blues\n    '#ccffff', '#66ffff', '#33ccff', '#3366ff',\n    '#3333ff', '#000099', '#000066',  // purples\n    '#ccccff', '#9999ff', '#6666cc', '#6633ff',\n    '#6600cc', '#333399', '#330099',  // violets\n    '#ffccff', '#ff99ff', '#cc66cc', '#cc33cc',\n    '#993399', '#663366', '#330033',\n  ];\n\n  /**\n   * An array of tooltip strings for the palette.  If not the same length as\n   * COLOURS, the colour's hex code will be used for any missing titles.\n   * All colour pickers use this unless overridden with setColours.\n   */\n  static TITLES: string[] = [];\n\n  /**\n   * Number of columns in the palette.\n   * All colour pickers use this unless overridden with setColumns.\n   */\n  static COLUMNS = 7;\n\n  /** The field's colour picker element. */\n  private picker: HTMLElement | null = null;\n\n  /** Index of the currently highlighted element. */\n  private highlightedIndex: number | null = null;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Colour fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Array of colours used by this field.  If null, use the global list. */\n  private colours: string[] | null = null;\n\n  /**\n   * Array of colour tooltips used by this field.  If null, use the global\n   * list.\n   */\n  private titles: string[] | null = null;\n\n  /**\n   * Number of colour columns used by this field.  If 0, use the global\n   * setting. By default use the global constants for columns.\n   */\n  private columns = 0;\n\n  /**\n   * @param value The initial value of the field. Should be in '#rrggbb'\n   *     format. Defaults to the first value in the default colour array. Also\n   *     accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   *     subclasses that want to handle configuration and setting the field\n   *     value after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a colour string & returns a validated colour\n   *     string ('#rrggbb' format), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/colour}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldColourValidator,\n    config?: FieldColourConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldColourConfig) {\n    super.configure_(config);\n    if (config.colourOptions) this.colours = config.colourOptions;\n    if (config.colourTitles) this.titles = config.colourTitles;\n    if (config.columns) this.columns = config.columns;\n  }\n\n  /**\n   * Create the block UI for this colour field.\n   */\n  override initView() {\n    this.size_ = new Size(\n      this.getConstants()!.FIELD_COLOUR_DEFAULT_WIDTH,\n      this.getConstants()!.FIELD_COLOUR_DEFAULT_HEIGHT,\n    );\n    this.createBorderRect_();\n    this.getBorderRect().style['fillOpacity'] = '1';\n    this.getBorderRect().setAttribute('stroke', '#fff');\n    if (this.isFullBlockField()) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n  }\n\n  protected override isFullBlockField(): boolean {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n\n    const constants = this.getConstants();\n    return block.isSimpleReporter() && !!constants?.FIELD_COLOUR_FULL_BLOCK;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   */\n  override applyColour() {\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n\n    if (!this.fieldGroup_) return;\n\n    const borderRect = this.borderRect_;\n    if (!borderRect) {\n      throw new Error('The border rect has not been initialized');\n    }\n\n    if (!this.isFullBlockField()) {\n      borderRect.style.display = 'block';\n      borderRect.style.fill = this.getValue() as string;\n    } else {\n      borderRect.style.display = 'none';\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      block.pathObject.svgPath.setAttribute('fill', this.getValue() as string);\n      block.pathObject.svgPath.setAttribute('stroke', '#fff');\n    }\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  override getSize(): Size {\n    if (this.getConstants()?.FIELD_COLOUR_FULL_BLOCK) {\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      // Full block fields have more control of the block than they should\n      // (i.e. updating fill colour). Whenever we get the size, the field may\n      // no longer be a full-block field, so we need to rerender.\n      this.render_();\n      this.isDirty_ = false;\n    }\n    return super.getSize();\n  }\n\n  /**\n   * Updates the colour of the block to reflect whether this is a full\n   * block field or not.\n   */\n  protected override render_() {\n    super.render_();\n\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n    // Calling applyColour updates the UI (full-block vs non-full-block) for the\n    // colour field, and the colour of the field/block.\n    block.applyColour();\n  }\n\n  /**\n   * Updates the size of the field based on whether it is a full block field\n   * or not.\n   *\n   * @param margin margin to use when positioning the field.\n   */\n  protected updateSize_(margin?: number) {\n    const constants = this.getConstants();\n    let totalWidth;\n    let totalHeight;\n    if (this.isFullBlockField()) {\n      const xOffset = margin ?? 0;\n      totalWidth = xOffset * 2;\n      totalHeight = constants!.FIELD_TEXT_HEIGHT;\n    } else {\n      totalWidth = constants!.FIELD_COLOUR_DEFAULT_WIDTH;\n      totalHeight = constants!.FIELD_COLOUR_DEFAULT_HEIGHT;\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Ensure that the input value is a valid colour.\n   *\n   * @param newValue The input value.\n   * @returns A valid colour, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string | null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return colour.parse(newValue);\n  }\n\n  /**\n   * Get the text for this field.  Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field.\n   */\n  override getText(): string {\n    let colour = this.value_ as string;\n    // Try to use #rgb format if possible, rather than #rrggbb.\n    if (/^#(.)\\1(.)\\2(.)\\3$/.test(colour)) {\n      colour = '#' + colour[1] + colour[3] + colour[5];\n    }\n    return colour;\n  }\n\n  /**\n   * Set a custom colour grid for this field.\n   *\n   * @param colours Array of colours for this block, or null to use default\n   *     (FieldColour.COLOURS).\n   * @param titles Optional array of colour tooltips, or null to use default\n   *     (FieldColour.TITLES).\n   * @returns Returns itself (for method chaining).\n   */\n  setColours(colours: string[], titles?: string[]): FieldColour {\n    this.colours = colours;\n    if (titles) {\n      this.titles = titles;\n    }\n    return this;\n  }\n\n  /**\n   * Set a custom grid size for this field.\n   *\n   * @param columns Number of columns for this block, or 0 to use default\n   *     (FieldColour.COLUMNS).\n   * @returns Returns itself (for method chaining).\n   */\n  setColumns(columns: number): FieldColour {\n    this.columns = columns;\n    return this;\n  }\n\n  /** Create and show the colour field's editor. */\n  protected override showEditor_() {\n    this.dropdownCreate();\n    dropDownDiv.getContentDiv().appendChild(this.picker!);\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\n\n    // Focus so we can start receiving keyboard events.\n    this.picker!.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a click on a colour cell.\n   *\n   * @param e Mouse event.\n   */\n  private onClick(e: PointerEvent) {\n    const cell = e.target as Element;\n    const colour = cell && cell.getAttribute('data-colour');\n    if (colour !== null) {\n      this.setValue(colour);\n      dropDownDiv.hideIfOwner(this);\n    }\n  }\n\n  /**\n   * Handle a key down event. Navigate around the grid with the\n   * arrow keys. Enter selects the highlighted colour.\n   *\n   * @param e Keyboard event.\n   */\n  private onKeyDown(e: KeyboardEvent) {\n    let handled = true;\n    let highlighted: HTMLElement | null;\n    switch (e.key) {\n      case 'ArrowUp':\n        this.moveHighlightBy(0, -1);\n        break;\n      case 'ArrowDown':\n        this.moveHighlightBy(0, 1);\n        break;\n      case 'ArrowLeft':\n        this.moveHighlightBy(-1, 0);\n        break;\n      case 'ArrowRight':\n        this.moveHighlightBy(1, 0);\n        break;\n      case 'Enter':\n        // Select the highlighted colour.\n        highlighted = this.getHighlighted();\n        if (highlighted) {\n          const colour = highlighted.getAttribute('data-colour');\n          if (colour !== null) {\n            this.setValue(colour);\n          }\n        }\n        dropDownDiv.hideWithoutAnimation();\n        break;\n      default:\n        handled = false;\n    }\n    if (handled) {\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Move the currently highlighted position by dx and dy.\n   *\n   * @param dx Change of x.\n   * @param dy Change of y.\n   */\n  private moveHighlightBy(dx: number, dy: number) {\n    if (!this.highlightedIndex) {\n      return;\n    }\n\n    const colours = this.colours || FieldColour.COLOURS;\n    const columns = this.columns || FieldColour.COLUMNS;\n\n    // Get the current x and y coordinates.\n    let x = this.highlightedIndex % columns;\n    let y = Math.floor(this.highlightedIndex / columns);\n\n    // Add the offset.\n    x += dx;\n    y += dy;\n\n    if (dx < 0) {\n      // Move left one grid cell, even in RTL.\n      // Loop back to the end of the previous row if we have room.\n      if (x < 0 && y > 0) {\n        x = columns - 1;\n        y--;\n      } else if (x < 0) {\n        x = 0;\n      }\n    } else if (dx > 0) {\n      // Move right one grid cell, even in RTL.\n      // Loop to the start of the next row, if there's room.\n      if (x > columns - 1 && y < Math.floor(colours.length / columns) - 1) {\n        x = 0;\n        y++;\n      } else if (x > columns - 1) {\n        x--;\n      }\n    } else if (dy < 0) {\n      // Move up one grid cell, stop at the top.\n      if (y < 0) {\n        y = 0;\n      }\n    } else if (dy > 0) {\n      // Move down one grid cell, stop at the bottom.\n      if (y > Math.floor(colours.length / columns) - 1) {\n        y = Math.floor(colours.length / columns) - 1;\n      }\n    }\n\n    // Move the highlight to the new coordinates.\n    const cell = this.picker!.childNodes[y].childNodes[x] as Element;\n    const index = y * columns + x;\n    this.setHighlightedCell(cell, index);\n  }\n\n  /**\n   * Handle a mouse move event. Highlight the hovered colour.\n   *\n   * @param e Mouse event.\n   */\n  private onMouseMove(e: PointerEvent) {\n    const cell = e.target as Element;\n    const index = cell && Number(cell.getAttribute('data-index'));\n    if (index !== null && index !== this.highlightedIndex) {\n      this.setHighlightedCell(cell, index);\n    }\n  }\n\n  /** Handle a mouse enter event. Focus the picker. */\n  private onMouseEnter() {\n    this.picker?.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a mouse leave event. Blur the picker and unhighlight\n   * the currently highlighted colour.\n   */\n  private onMouseLeave() {\n    this.picker?.blur();\n    const highlighted = this.getHighlighted();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n  }\n\n  /**\n   * Returns the currently highlighted item (if any).\n   *\n   * @returns Highlighted item (null if none).\n   */\n  private getHighlighted(): HTMLElement | null {\n    if (!this.highlightedIndex) {\n      return null;\n    }\n\n    const columns = this.columns || FieldColour.COLUMNS;\n    const x = this.highlightedIndex % columns;\n    const y = Math.floor(this.highlightedIndex / columns);\n    const row = this.picker!.childNodes[y];\n    if (!row) {\n      return null;\n    }\n    return row.childNodes[x] as HTMLElement;\n  }\n\n  /**\n   * Update the currently highlighted cell.\n   *\n   * @param cell The new cell to highlight.\n   * @param index The index of the new cell.\n   */\n  private setHighlightedCell(cell: Element, index: number) {\n    // Unhighlight the current item.\n    const highlighted = this.getHighlighted();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n    // Highlight new item.\n    dom.addClass(cell, 'blocklyColourHighlighted');\n    // Set new highlighted index.\n    this.highlightedIndex = index;\n\n    // Update accessibility roles.\n    const cellId = cell.getAttribute('id');\n    if (cellId && this.picker) {\n      aria.setState(this.picker, aria.State.ACTIVEDESCENDANT, cellId);\n    }\n  }\n\n  /** Create a colour picker dropdown editor. */\n  private dropdownCreate() {\n    const columns = this.columns || FieldColour.COLUMNS;\n    const colours = this.colours || FieldColour.COLOURS;\n    const titles = this.titles || FieldColour.TITLES;\n    const selectedColour = this.getValue();\n    // Create the palette.\n    const table = document.createElement('table');\n    table.className = 'blocklyColourTable';\n    table.tabIndex = 0;\n    table.dir = 'ltr';\n    aria.setRole(table, aria.Role.GRID);\n    aria.setState(table, aria.State.EXPANDED, true);\n    aria.setState(\n      table,\n      aria.State.ROWCOUNT,\n      Math.floor(colours.length / columns),\n    );\n    aria.setState(table, aria.State.COLCOUNT, columns);\n    let row: Element;\n    for (let i = 0; i < colours.length; i++) {\n      if (i % columns === 0) {\n        row = document.createElement('tr');\n        aria.setRole(row, aria.Role.ROW);\n        table.appendChild(row);\n      }\n      const cell = document.createElement('td');\n      row!.appendChild(cell);\n      // This becomes the value, if clicked.\n      cell.setAttribute('data-colour', colours[i]);\n      cell.title = titles[i] || colours[i];\n      cell.id = idGenerator.getNextUniqueId();\n      cell.setAttribute('data-index', `${i}`);\n      aria.setRole(cell, aria.Role.GRIDCELL);\n      aria.setState(cell, aria.State.LABEL, colours[i]);\n      aria.setState(cell, aria.State.SELECTED, colours[i] === selectedColour);\n      cell.style.backgroundColor = colours[i];\n      if (colours[i] === selectedColour) {\n        cell.className = 'blocklyColourSelected';\n        this.highlightedIndex = i;\n      }\n    }\n\n    // Configure event handler on the table to listen for any event in a cell.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        table,\n        'pointerdown',\n        this,\n        this.onClick,\n        true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        table,\n        'pointermove',\n        this,\n        this.onMouseMove,\n        true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        table,\n        'pointerenter',\n        this,\n        this.onMouseEnter,\n        true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        table,\n        'pointerleave',\n        this,\n        this.onMouseLeave,\n        true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        table,\n        'keydown',\n        this,\n        this.onKeyDown,\n        false,\n      ),\n    );\n\n    this.picker = table;\n  }\n\n  /** Disposes of events and DOM-references belonging to the colour editor. */\n  private dropdownDispose() {\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    this.picker = null;\n    this.highlightedIndex = null;\n  }\n\n  /**\n   * Construct a FieldColour from a JSON arg object.\n   *\n   * @param options A JSON object with options (colour).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldColourFromJsonConfig): FieldColour {\n    // `this` might be a subclass of FieldColour if that class doesn't override\n    // the static fromJson method.\n    return new this(options.colour, undefined, options);\n  }\n}\n\n/** The default value for this field. */\nFieldColour.prototype.DEFAULT_VALUE = FieldColour.COLOURS[0];\n\nfieldRegistry.register('field_colour', FieldColour);\n\n/**\n * CSS for colour picker.\n */\nCss.register(`\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: 0.5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n`);\n\n/**\n * Config options for the colour field.\n */\nexport interface FieldColourConfig extends FieldConfig {\n  colourOptions?: string[];\n  colourTitles?: string[];\n  columns?: number;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldColourFromJsonConfig extends FieldColourConfig {\n  colour?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldColourValidator = FieldValidator<string>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, serializable text field. Behaves like a\n *    normal label but is serialized to XML. It may only be\n *    edited programmatically.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabelSerializable\n\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, serializable text field.\n */\nexport class FieldLabelSerializable extends FieldLabel {\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * Serializable fields are saved by the XML renderer, non-serializable\n   * fields are not.  This field should be serialized, but only edited\n   * programmatically.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined.\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(value?: string, textClass?: string, config?: FieldLabelConfig) {\n    super(String(value ?? ''), textClass, config);\n  }\n\n  /**\n   * Construct a FieldLabelSerializable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldLabelFromJsonConfig,\n  ): FieldLabelSerializable {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabelSerializable if that class\n    // doesn't override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text Area field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldMultilineInput\n\nimport * as Css from './css.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputValidator,\n} from './field_textinput.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for an editable text area field.\n */\nexport class FieldMultilineInput extends FieldTextInput {\n  /**\n   * The SVG group element that will contain a text element for each text row\n   *     when initialized.\n   */\n  textGroup: SVGGElement | null = null;\n\n  /**\n   * Defines the maximum number of lines of field.\n   * If exceeded, scrolling functionality is enabled.\n   */\n  protected maxLines_ = Infinity;\n\n  /** Whether Y overflow is currently occurring. */\n  protected isOverflowedY_ = false;\n\n  /**\n   * @param value The initial content of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator An optional function that is called to validate any\n   *     constraints on what the user entered.  Takes the new text as an\n   *     argument and returns either the accepted text, a replacement text, or\n   *     null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/multiline-text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldMultilineInputValidator,\n    config?: FieldMultilineInputConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldMultilineInputConfig) {\n    super.configure_(config);\n    if (config.maxLines) this.setMaxLines(config.maxLines);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  override toXml(fieldElement: Element): Element {\n    // Replace '\\n' characters with HTML-escaped equivalent '&#10'. This is\n    // needed so the plain-text representation of the XML produced by\n    // `Blockly.Xml.domToText` will appear on a single line (this is a\n    // limitation of the plain-text format).\n    fieldElement.textContent = (this.getValue() as string).replace(\n      /\\n/g,\n      '&#10;',\n    );\n    return fieldElement;\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    this.setValue(fieldElement.textContent!.replace(/&#10;/g, '\\n'));\n  }\n\n  /**\n   * Saves this field's value.\n   * This function only exists for subclasses of FieldMultilineInput which\n   * predate the load/saveState API and only define to/fromXml.\n   *\n   * @returns The state of this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldMultilineInput);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   * This function only exists for subclasses of FieldMultilineInput which\n   * predate the load/saveState API and only define to/fromXml.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this field.\n   */\n  override initView() {\n    this.createBorderRect_();\n    this.textGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'class': 'blocklyEditableText',\n      },\n      this.fieldGroup_,\n    );\n  }\n\n  /**\n   * Get the text from this field as displayed on screen.  May differ from\n   * getText due to ellipsis, and other formatting.\n   *\n   * @returns Currently displayed text.\n   */\n  protected override getDisplayText_(): string {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    let textLines = this.getText();\n    if (!textLines) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    const lines = textLines.split('\\n');\n    textLines = '';\n    const displayLinesNumber = this.isOverflowedY_\n      ? this.maxLines_\n      : lines.length;\n    for (let i = 0; i < displayLinesNumber; i++) {\n      let text = lines[i];\n      if (text.length > this.maxDisplayLength) {\n        // Truncate displayed string and add an ellipsis ('...').\n        text = text.substring(0, this.maxDisplayLength - 4) + '...';\n      } else if (this.isOverflowedY_ && i === displayLinesNumber - 1) {\n        text = text.substring(0, text.length - 3) + '...';\n      }\n      // Replace whitespace with non-breaking spaces so the text doesn't\n      // collapse.\n      text = text.replace(/\\s/g, Field.NBSP);\n\n      textLines += text;\n      if (i !== displayLinesNumber - 1) {\n        textLines += '\\n';\n      }\n    }\n    if (block.RTL) {\n      // The SVG is LTR, force value to be RTL.\n      textLines += '\\u200F';\n    }\n    return textLines;\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_). Is being redefined here to update\n   * overflow state of the field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    if (this.value_ !== null) {\n      this.isOverflowedY_ = this.value_.split('\\n').length > this.maxLines_;\n    }\n  }\n\n  /** Updates the text of the textElement. */\n  protected override render_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    // Remove all text group children.\n    let currentChild;\n    const textGroup = this.textGroup;\n    while ((currentChild = textGroup!.firstChild)) {\n      textGroup!.removeChild(currentChild);\n    }\n\n    // Add in text elements into the group.\n    const lines = this.getDisplayText_().split('\\n');\n    let y = 0;\n    for (let i = 0; i < lines.length; i++) {\n      const lineHeight =\n        this.getConstants()!.FIELD_TEXT_HEIGHT +\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n      const span = dom.createSvgElement(\n        Svg.TEXT,\n        {\n          'class': 'blocklyText blocklyMultilineText',\n          'x': this.getConstants()!.FIELD_BORDER_RECT_X_PADDING,\n          'y': y + this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING,\n          'dy': this.getConstants()!.FIELD_TEXT_BASELINE,\n        },\n        textGroup,\n      );\n      span.appendChild(document.createTextNode(lines[i]));\n      y += lineHeight;\n    }\n\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (this.isOverflowedY_) {\n        dom.addClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      } else {\n        dom.removeClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      }\n    }\n\n    this.updateSize_();\n\n    if (this.isBeingEdited_) {\n      if (block.RTL) {\n        // in RTL, we need to let the browser reflow before resizing\n        // in order to get the correct bounding box of the borderRect\n        // avoiding issue #2777.\n        setTimeout(this.resizeEditor_.bind(this), 0);\n      } else {\n        this.resizeEditor_();\n      }\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n  }\n\n  /** Updates the size of the field based on the text. */\n  protected override updateSize_() {\n    const nodes = (this.textGroup as SVGElement).childNodes;\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE;\n    const fontWeight = this.getConstants()!.FIELD_TEXT_FONTWEIGHT;\n    const fontFamily = this.getConstants()!.FIELD_TEXT_FONTFAMILY;\n    let totalWidth = 0;\n    let totalHeight = 0;\n    for (let i = 0; i < nodes.length; i++) {\n      const tspan = nodes[i] as SVGTextElement;\n      const textWidth = dom.getFastTextWidth(\n        tspan,\n        fontSize,\n        fontWeight,\n        fontFamily,\n      );\n      if (textWidth > totalWidth) {\n        totalWidth = textWidth;\n      }\n      totalHeight +=\n        this.getConstants()!.FIELD_TEXT_HEIGHT +\n        (i > 0 ? this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING : 0);\n    }\n    if (this.isBeingEdited_) {\n      // The default width is based on the longest line in the display text,\n      // but when it's being edited, width should be calculated based on the\n      // absolute longest line, even if it would be truncated after editing.\n      // Otherwise we would get wrong editor width when there are more\n      // lines than this.maxLines_.\n      const actualEditorLines = String(this.value_).split('\\n');\n      const dummyTextElement = dom.createSvgElement(Svg.TEXT, {\n        'class': 'blocklyText blocklyMultilineText',\n      });\n\n      for (let i = 0; i < actualEditorLines.length; i++) {\n        if (actualEditorLines[i].length > this.maxDisplayLength) {\n          actualEditorLines[i] = actualEditorLines[i].substring(\n            0,\n            this.maxDisplayLength,\n          );\n        }\n        dummyTextElement.textContent = actualEditorLines[i];\n        const lineWidth = dom.getFastTextWidth(\n          dummyTextElement,\n          fontSize,\n          fontWeight,\n          fontFamily,\n        );\n        if (lineWidth > totalWidth) {\n          totalWidth = lineWidth;\n        }\n      }\n\n      const scrollbarWidth =\n        this.htmlInput_!.offsetWidth - this.htmlInput_!.clientWidth;\n      totalWidth += scrollbarWidth;\n    }\n    if (this.borderRect_) {\n      totalHeight += this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * 2;\n      totalWidth += this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * 2;\n      this.borderRect_.setAttribute('width', `${totalWidth}`);\n      this.borderRect_.setAttribute('height', `${totalHeight}`);\n    }\n    this.size_.width = totalWidth;\n    this.size_.height = totalHeight;\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Show the inline free-text editor on top of the text.\n   * Overrides the default behaviour to force rerender in order to\n   * correct block size, based on editor text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  override showEditor_(e?: Event, quietInput?: boolean) {\n    super.showEditor_(e, quietInput);\n    this.forceRerender();\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected override widgetCreate_(): HTMLTextAreaElement {\n    const div = WidgetDiv.getDiv();\n    const scale = this.workspace_!.getScale();\n\n    const htmlInput = document.createElement('textarea');\n    htmlInput.className = 'blocklyHtmlInput blocklyHtmlTextAreaInput';\n    htmlInput.setAttribute('spellcheck', String(this.spellcheck_));\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    const borderRadius = FieldTextInput.BORDERRADIUS * scale + 'px';\n    htmlInput.style.borderRadius = borderRadius;\n    const paddingX = this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * scale;\n    const paddingY =\n      (this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * scale) / 2;\n    htmlInput.style.padding =\n      paddingY + 'px ' + paddingX + 'px ' + paddingY + 'px ' + paddingX + 'px';\n    const lineHeight =\n      this.getConstants()!.FIELD_TEXT_HEIGHT +\n      this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n    htmlInput.style.lineHeight = lineHeight * scale + 'px';\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n    htmlInput.setAttribute('data-old-value', '');\n    if (userAgent.GECKO) {\n      // In FF, ensure the browser reflows before resizing to avoid issue #2777.\n      setTimeout(this.resizeEditor_.bind(this), 0);\n    } else {\n      this.resizeEditor_();\n    }\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Sets the maxLines config for this field.\n   *\n   * @param maxLines Defines the maximum number of lines allowed, before\n   *     scrolling functionality is enabled.\n   */\n  setMaxLines(maxLines: number) {\n    if (\n      typeof maxLines === 'number' &&\n      maxLines > 0 &&\n      maxLines !== this.maxLines_\n    ) {\n      this.maxLines_ = maxLines;\n      this.forceRerender();\n    }\n  }\n\n  /**\n   * Returns the maxLines config of this field.\n   *\n   * @returns The maxLines config value.\n   */\n  getMaxLines(): number {\n    return this.maxLines_;\n  }\n\n  /**\n   * Handle key down to the editor. Override the text input definition of this\n   * so as to not close the editor when enter is typed in.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key !== 'Enter') {\n      super.onHtmlInputKeyDown_(e);\n    }\n  }\n\n  /**\n   * Construct a FieldMultilineInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldMultilineInputFromJsonConfig,\n  ): FieldMultilineInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldMultilineInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_multilinetext', FieldMultilineInput);\n\n/**\n * CSS for multiline field.\n */\nCss.register(`\n.blocklyHtmlTextAreaInput {\n  font-family: monospace;\n  resize: none;\n  overflow: hidden;\n  height: 100%;\n  text-align: left;\n}\n\n.blocklyHtmlTextAreaInputOverflowedY {\n  overflow-y: scroll;\n}\n`);\n\n/**\n * Config options for the multiline input field.\n */\nexport interface FieldMultilineInputConfig extends FieldTextInputConfig {\n  maxLines?: number;\n}\n\n/**\n * fromJson config options for the multiline input field.\n */\nexport interface FieldMultilineInputFromJsonConfig\n  extends FieldMultilineInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldMultilineInputValidator = FieldTextInputValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Number input field\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldNumber\n\nimport {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as aria from './utils/aria.js';\n\n/**\n * Class for an editable number field.\n */\nexport class FieldNumber extends FieldInput<number> {\n  /** The minimum value this number field can contain. */\n  protected min_ = -Infinity;\n\n  /** The maximum value this number field can contain. */\n  protected max_ = Infinity;\n\n  /** The multiple to which this fields value is rounded. */\n  protected precision_ = 0;\n\n  /**\n   * The number of decimal places to allow, or null to allow any number of\n   * decimal digits.\n   */\n  private decimalPlaces: number | null = null;\n\n  /** Don't spellcheck numbers.  Our validator does a better job. */\n  protected override spellcheck_ = false;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param min Minimum value. Will only be used if config is not\n   *     provided.\n   * @param max Maximum value. Will only be used if config is not\n   *     provided.\n   * @param precision Precision for value. Will only be used if config\n   *     is not provided.\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | number | typeof Field.SKIP_SETUP,\n    min?: string | number | null,\n    max?: string | number | null,\n    precision?: string | number | null,\n    validator?: FieldNumberValidator | null,\n    config?: FieldNumberConfig,\n  ) {\n    // Pass SENTINEL so that we can define properties before value validation.\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setConstraints(min, max, precision);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldNumberConfig) {\n    super.configure_(config);\n    this.setMinInternal(config.min);\n    this.setMaxInternal(config.max);\n    this.setPrecisionInternal(config.precision);\n  }\n\n  /**\n   * Set the maximum, minimum and precision constraints on this field.\n   * Any of these properties may be undefined or NaN to be disabled.\n   * Setting precision (usually a power of 10) enforces a minimum step between\n   * values. That is, the user's value will rounded to the closest multiple of\n   * precision. The least significant digit place is inferred from the\n   * precision. Integers values can be enforces by choosing an integer\n   * precision.\n   *\n   * @param min Minimum value.\n   * @param max Maximum value.\n   * @param precision Precision for value.\n   */\n  setConstraints(\n    min: number | string | undefined | null,\n    max: number | string | undefined | null,\n    precision: number | string | undefined | null,\n  ) {\n    this.setMinInternal(min);\n    this.setMaxInternal(max);\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param min Minimum value.\n   */\n  setMin(min: number | string | undefined | null) {\n    this.setMinInternal(min);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param min Minimum value.\n   */\n  private setMinInternal(min: number | string | undefined | null) {\n    if (min == null) {\n      this.min_ = -Infinity;\n    } else {\n      min = Number(min);\n      if (!isNaN(min)) {\n        this.min_ = min;\n      }\n    }\n  }\n\n  /**\n   * Returns the current minimum value this field can contain. Default is\n   * -Infinity.\n   *\n   * @returns The current minimum value this field can contain.\n   */\n  getMin(): number {\n    return this.min_;\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param max Maximum value.\n   */\n  setMax(max: number | string | undefined | null) {\n    this.setMaxInternal(max);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param max Maximum value.\n   */\n  private setMaxInternal(max: number | string | undefined | null) {\n    if (max == null) {\n      this.max_ = Infinity;\n    } else {\n      max = Number(max);\n      if (!isNaN(max)) {\n        this.max_ = max;\n      }\n    }\n  }\n\n  /**\n   * Returns the current maximum value this field can contain. Default is\n   * Infinity.\n   *\n   * @returns The current maximum value this field can contain.\n   */\n  getMax(): number {\n    return this.max_;\n  }\n\n  /**\n   * Sets the precision of this field's value, i.e. the number to which the\n   * value is rounded. Updates the field to reflect.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  setPrecision(precision: number | string | undefined | null) {\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the precision of this field's value. Called internally to avoid\n   * value updates.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  private setPrecisionInternal(precision: number | string | undefined | null) {\n    this.precision_ = Number(precision) || 0;\n    let precisionString = String(this.precision_);\n    if (precisionString.indexOf('e') !== -1) {\n      // String() is fast.  But it turns .0000001 into '1e-7'.\n      // Use the much slower toLocaleString to access all the digits.\n      precisionString = this.precision_.toLocaleString('en-US', {\n        maximumFractionDigits: 20,\n      });\n    }\n    const decimalIndex = precisionString.indexOf('.');\n    if (decimalIndex === -1) {\n      // If the precision is 0 (float) allow any number of decimals,\n      // otherwise allow none.\n      this.decimalPlaces = precision ? 0 : null;\n    } else {\n      this.decimalPlaces = precisionString.length - decimalIndex - 1;\n    }\n  }\n\n  /**\n   * Returns the current precision of this field. The precision being the\n   * number to which the field's value is rounded. A precision of 0 means that\n   * the value is not rounded.\n   *\n   * @returns The number to which this field's value is rounded.\n   */\n  getPrecision(): number {\n    return this.precision_;\n  }\n\n  /**\n   * Ensure that the input value is a valid number (must fulfill the\n   * constraints placed on the field).\n   *\n   * @param newValue The input value.\n   * @returns A valid number, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): number | null {\n    if (newValue === null) {\n      return null;\n    }\n\n    // Clean up text.\n    newValue = `${newValue}`;\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\n    newValue = newValue.replace(/O/gi, '0');\n    // Strip out thousands separators.\n    newValue = newValue.replace(/,/g, '');\n    // Ignore case of 'Infinity'.\n    newValue = newValue.replace(/infinity/i, 'Infinity');\n\n    // Clean up number.\n    let n = Number(newValue || 0);\n    if (isNaN(n)) {\n      // Invalid number.\n      return null;\n    }\n    // Get the value in range.\n    n = Math.min(Math.max(n, this.min_), this.max_);\n    // Round to nearest multiple of precision.\n    if (this.precision_ && isFinite(n)) {\n      n = Math.round(n / this.precision_) * this.precision_;\n    }\n    // Clean up floating point errors.\n    if (this.decimalPlaces !== null) {\n      n = Number(n.toFixed(this.decimalPlaces));\n    }\n    return n;\n  }\n\n  /**\n   * Create the number input editor widget.\n   *\n   * @returns The newly created number input editor.\n   */\n  protected override widgetCreate_(): HTMLInputElement {\n    const htmlInput = super.widgetCreate_() as HTMLInputElement;\n\n    // Set the accessibility state\n    if (this.min_ > -Infinity) {\n      htmlInput.min = `${this.min_}`;\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\n    }\n    if (this.max_ < Infinity) {\n      htmlInput.max = `${this.max_}`;\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\n    }\n    return htmlInput;\n  }\n\n  /**\n   * Construct a FieldNumber from a JSON arg object.\n   *\n   * @param options A JSON object with options (value, min, max, and precision).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\n    // `this` might be a subclass of FieldNumber if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.value,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_number', FieldNumber);\n\nFieldNumber.prototype.DEFAULT_VALUE = 0;\n\n/**\n * Config options for the number field.\n */\nexport interface FieldNumberConfig extends FieldInputConfig {\n  min?: number;\n  max?: number;\n  precision?: number;\n}\n\n/**\n * fromJson config options for the number field.\n */\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\n  value?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldNumberValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Variable input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldVariable\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\nimport {\n  FieldDropdown,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuOption,\n} from './field_dropdown.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as internalConstants from './internal_constants.js';\nimport type {Menu} from './menu.js';\nimport type {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a variable's dropdown field.\n */\nexport class FieldVariable extends FieldDropdown {\n  protected override menuGenerator_: MenuGenerator | undefined;\n  defaultVariableName: string;\n\n  /** The type of the default variable for this field. */\n  private defaultType = '';\n\n  /**\n   * All of the types of variables that will be available in this field's\n   * dropdown.\n   */\n  variableTypes: string[] | null = [];\n  protected override size_: Size;\n\n  /** The variable model associated with this field. */\n  private variable: VariableModel | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param varName The default name for the variable.\n   *     If null, a unique variable name will be generated.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a variable ID  & returns a validated variable\n   *     ID, or null to abort the change.\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown. Will only be used if config is not provided.\n   * @param defaultType The type of variable to create if this field's value\n   *     is not explicitly set.  Defaults to ''. Will only be used if config\n   *     is not provided.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    varName: string | null | typeof Field.SKIP_SETUP,\n    validator?: FieldVariableValidator,\n    variableTypes?: string[],\n    defaultType?: string,\n    config?: FieldVariableConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * An array of options for a dropdown list,\n     * or a function which generates these options.\n     */\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\n\n    /**\n     * The initial variable name passed to this field's constructor, or an\n     * empty string if a name wasn't provided. Used to create the initial\n     * variable.\n     */\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (varName === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setTypes(variableTypes, defaultType);\n    }\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldVariableConfig) {\n    super.configure_(config);\n    this.setTypes(config.variableTypes, config.defaultType);\n  }\n\n  /**\n   * Initialize the model for this field if it has not already been initialized.\n   * If the value has not been set to a variable by the first render, we make up\n   * a variable rather than let the value be invalid.\n   */\n  override initModel() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.variable) {\n      return; // Initialization already happened.\n    }\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      null,\n      this.defaultVariableName,\n      this.defaultType,\n    );\n    // Don't call setValue because we don't want to cause a rerender.\n    this.doValueUpdate_(variable.getId());\n  }\n\n  override shouldAddBorderRect_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    return (\n      super.shouldAddBorderRect_() &&\n      (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n        block.type !== 'variables_get')\n    );\n  }\n\n  /**\n   * Initialize this field based on the given XML.\n   *\n   * @param fieldElement The element containing information about the variable\n   *     field's state.\n   */\n  override fromXml(fieldElement: Element) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const id = fieldElement.getAttribute('id');\n    const variableName = fieldElement.textContent;\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\n    // recorded as 'variableType'.  Thus we need to check for both.\n    const variableType =\n      fieldElement.getAttribute('variabletype') ||\n      fieldElement.getAttribute('variableType') ||\n      '';\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | undefined'.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      id,\n      variableName as AnyDuringMigration,\n      variableType,\n    );\n\n    // This should never happen :)\n    if (variableType !== null && variableType !== variable.type) {\n      throw Error(\n        \"Serialized variable type with id '\" +\n          variable.getId() +\n          \"' had type \" +\n          variable.type +\n          ', and ' +\n          'does not match variable field that references it: ' +\n          Xml.domToText(fieldElement) +\n          '.',\n      );\n    }\n\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Serialize this field to XML.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   */\n  override toXml(fieldElement: Element): Element {\n    // Make sure the variable is initialized.\n    this.initModel();\n\n    fieldElement.id = this.variable!.getId();\n    fieldElement.textContent = this.variable!.name;\n    if (this.variable!.type) {\n      fieldElement.setAttribute('variabletype', this.variable!.type);\n    }\n    return fieldElement;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @param doFullSerialization If true, the variable field will serialize the\n   *     full state of the field being referenced (ie ID, name, and type) rather\n   *     than just a reference to it (ie ID).\n   * @returns The state of the variable field.\n   * @internal\n   */\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldVariable);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    // Make sure the variable is initialized.\n    this.initModel();\n    const state = {'id': this.variable!.getId()};\n    if (doFullSerialization) {\n      (state as AnyDuringMigration)['name'] = this.variable!.name;\n      (state as AnyDuringMigration)['type'] = this.variable!.type;\n    }\n    return state;\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.loadLegacyState(FieldVariable, state)) {\n      return;\n    }\n    // This is necessary so that blocks in the flyout can have custom var names.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      state['id'] || null,\n      state['name'],\n      state['type'] || '',\n    );\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  override setSourceBlock(block: Block) {\n    if (block.isShadow()) {\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\n    }\n    super.setSourceBlock(block);\n  }\n\n  /**\n   * Get the variable's ID.\n   *\n   * @returns Current variable's ID.\n   */\n  override getValue(): string | null {\n    return this.variable ? this.variable.getId() : null;\n  }\n\n  /**\n   * Get the text from this field, which is the selected variable's name.\n   *\n   * @returns The selected variable's name, or the empty string if no variable\n   *     is selected.\n   */\n  override getText(): string {\n    return this.variable ? this.variable.name : '';\n  }\n\n  /**\n   * Get the variable model for the selected variable.\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\n   * after the variable has been deleted).\n   *\n   * @returns The selected variable, or null if none was selected.\n   * @internal\n   */\n  getVariable(): VariableModel | null {\n    return this.variable;\n  }\n\n  /**\n   * Gets the validation function for this field, or null if not set.\n   * Returns null if the variable is not set, because validators should not\n   * run on the initial setValue call, because the field won't be attached to\n   * a block and workspace at that point.\n   *\n   * @returns Validation function, or null.\n   */\n  override getValidator(): FieldVariableValidator | null {\n    // Validators shouldn't operate on the initial setValue call.\n    // Normally this is achieved by calling setValidator after setValue, but\n    // this is not a possibility with variable fields.\n    if (this.variable) {\n      return this.validator_;\n    }\n    return null;\n  }\n\n  /**\n   * Ensure that the ID belongs to a valid variable of an allowed type.\n   *\n   * @param newValue The ID of the new variable to set.\n   * @returns The validated ID, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null) {\n      return null;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const newId = newValue as string;\n    const variable = Variables.getVariable(block.workspace, newId);\n    if (!variable) {\n      console.warn(\n        \"Variable id doesn't point to a real variable! \" + 'ID was ' + newId,\n      );\n      return null;\n    }\n    // Type Checks.\n    const type = variable.type;\n    if (!this.typeIsAllowed(type)) {\n      console.warn(\"Variable type doesn't match this field!  Type was \" + type);\n      return null;\n    }\n    return newId;\n  }\n\n  /**\n   * Update the value of this variable field, as well as its variable and text.\n   *\n   * The variable ID should be valid at this point, but if a variable field\n   * validator returns a bad ID, this could break.\n   *\n   * @param newId The value to be saved.\n   */\n  protected override doValueUpdate_(newId: string) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.variable = Variables.getVariable(block.workspace, newId as string);\n    super.doValueUpdate_(newId);\n  }\n\n  /**\n   * Check whether the given variable type is allowed on this field.\n   *\n   * @param type The type to check.\n   * @returns True if the type is in the list of allowed types.\n   */\n  private typeIsAllowed(type: string): boolean {\n    const typeList = this.getVariableTypes();\n    if (!typeList) {\n      return true; // If it's null, all types are valid.\n    }\n    for (let i = 0; i < typeList.length; i++) {\n      if (type === typeList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Return a list of variable types to include in the dropdown.\n   *\n   * @returns Array of variable types.\n   * @throws {Error} if variableTypes is an empty array.\n   */\n  private getVariableTypes(): string[] {\n    let variableTypes = this.variableTypes;\n    if (variableTypes === null) {\n      // If variableTypes is null, return all variable types.\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n        return this.sourceBlock_.workspace.getVariableTypes();\n      }\n    }\n    variableTypes = variableTypes || [''];\n    if (variableTypes.length === 0) {\n      // Throw an error if variableTypes is an empty list.\n      const name = this.getText();\n      throw Error(\n        \"'variableTypes' of field variable \" + name + ' was an empty list',\n      );\n    }\n    return variableTypes;\n  }\n\n  /**\n   * Parse the optional arguments representing the allowed variable types and\n   * the default variable type.\n   *\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown.  If null or undefined, variables of all types will be\n   *     displayed in the dropdown.\n   * @param defaultType The type of the variable to create if this field's\n   *     value is not explicitly set.  Defaults to ''.\n   */\n  private setTypes(variableTypes: string[] | null = null, defaultType = '') {\n    // If you expected that the default type would be the same as the only entry\n    // in the variable types array, tell the Blockly team by commenting on\n    // #1499.\n    // Set the allowable variable types.  Null means all types on the workspace.\n    if (Array.isArray(variableTypes)) {\n      variableTypes = variableTypes;\n      // Make sure the default type is valid.\n      let isInArray = false;\n      for (let i = 0; i < variableTypes.length; i++) {\n        if (variableTypes[i] === defaultType) {\n          isInArray = true;\n        }\n      }\n      if (!isInArray) {\n        throw Error(\n          \"Invalid default type '\" +\n            defaultType +\n            \"' in \" +\n            'the definition of a FieldVariable',\n        );\n      }\n    } else if (variableTypes !== null) {\n      throw Error(\n        \"'variableTypes' was not an array in the definition of \" +\n          'a FieldVariable',\n      );\n    }\n    // Only update the field once all checks pass.\n    this.defaultType = defaultType;\n    this.variableTypes = variableTypes;\n  }\n\n  /**\n   * Refreshes the name of the variable by grabbing the name of the model.\n   * Used when a variable gets renamed, but the ID stays the same. Should only\n   * be called by the block.\n   *\n   * @internal\n   */\n  override refreshVariableName() {\n    this.forceRerender();\n  }\n\n  /**\n   * Handle the selection of an item in the variable dropdown menu.\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\n   * In the rename case, prompt the user for a new name.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    const id = menuItem.getValue();\n    // Handle special cases.\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\n        // Rename variable.\n        Variables.renameVariable(\n          this.sourceBlock_.workspace,\n          this.variable as VariableModel,\n        );\n        return;\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\n        // Delete variable.\n        this.sourceBlock_.workspace.deleteVariableById(this.variable!.getId());\n        return;\n      }\n    }\n    // Handle unspecial case.\n    this.setValue(id);\n  }\n\n  /**\n   * Overrides referencesVariables(), indicating this field refers to a\n   * variable.\n   *\n   * @returns True.\n   * @internal\n   */\n  override referencesVariables(): boolean {\n    return true;\n  }\n\n  /**\n   * Construct a FieldVariable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (variable, variableTypes, and\n   *     defaultType).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldVariableFromJsonConfig,\n  ): FieldVariable {\n    const varName = parsing.replaceMessageReferences(options.variable);\n    // `this` might be a subclass of FieldVariable if that class doesn't\n    // override the static fromJson method.\n    return new this(varName, undefined, undefined, undefined, options);\n  }\n\n  /**\n   * Return a sorted list of variable names for variable dropdown menus.\n   * Include a special option at the end for creating a new variable name.\n   *\n   * @returns Array of variable names/id tuples.\n   */\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\n    if (!this.variable) {\n      throw Error(\n        'Tried to call dropdownCreate on a variable field with no' +\n          ' variable selected.',\n      );\n    }\n    const name = this.getText();\n    let variableModelList: VariableModel[] = [];\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      const variableTypes = this.getVariableTypes();\n      // Get a copy of the list, so that adding rename and new variable options\n      // doesn't modify the workspace's list.\n      for (let i = 0; i < variableTypes.length; i++) {\n        const variableType = variableTypes[i];\n        const variables =\n          this.sourceBlock_.workspace.getVariablesOfType(variableType);\n        variableModelList = variableModelList.concat(variables);\n      }\n    }\n    variableModelList.sort(VariableModel.compareByName);\n\n    const options: [string, string][] = [];\n    for (let i = 0; i < variableModelList.length; i++) {\n      // Set the UUID as the internal representation of the variable.\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\n    }\n    options.push([\n      Msg['RENAME_VARIABLE'],\n      internalConstants.RENAME_VARIABLE_ID,\n    ]);\n    if (Msg['DELETE_VARIABLE']) {\n      options.push([\n        Msg['DELETE_VARIABLE'].replace('%1', name),\n        internalConstants.DELETE_VARIABLE_ID,\n      ]);\n    }\n\n    return options;\n  }\n}\n\nfieldRegistry.register('field_variable', FieldVariable);\n\n/**\n * Config options for the variable field.\n */\nexport interface FieldVariableConfig extends FieldConfig {\n  variableTypes?: string[];\n  defaultType?: string;\n}\n\n/**\n * fromJson config options for the variable field.\n */\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\n  variable?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldVariableValidator = FieldDropdownValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a button in the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutButton\n\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a button or label in the flyout.\n */\nexport class FlyoutButton {\n  /** The horizontal margin around the text in the button. */\n  static TEXT_MARGIN_X = 5;\n\n  /** The vertical margin around the text in the button. */\n  static TEXT_MARGIN_Y = 2;\n\n  /** The radius of the flyout button's borders. */\n  static BORDER_RADIUS = 4;\n\n  private readonly text: string;\n  private readonly position: Coordinate;\n  private readonly callbackKey: string;\n  private readonly cssClass: string | null;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper: browserEvents.Data | null = null;\n  info: toolbox.ButtonOrLabelInfo;\n\n  /** The width of the button's rect. */\n  width = 0;\n\n  /** The height of the button's rect. */\n  height = 0;\n\n  /** The root SVG group for the button or label. */\n  private svgGroup: SVGGElement | null = null;\n\n  /** The SVG element with the text of the label or button. */\n  private svgText: SVGTextElement | null = null;\n\n  /**\n   * @param workspace The workspace in which to place this button.\n   * @param targetWorkspace The flyout's target workspace.\n   * @param json The JSON specifying the label/button.\n   * @param isLabel_ Whether this button should be styled as a label.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private readonly targetWorkspace: WorkspaceSvg,\n    json: toolbox.ButtonOrLabelInfo,\n    private readonly isLabel_: boolean,\n  ) {\n    this.text = json['text'];\n\n    this.position = new Coordinate(0, 0);\n\n    /** The key to the function called when this button is clicked. */\n    this.callbackKey =\n      (json as AnyDuringMigration)[\n        'callbackKey'\n      ] /* Check the lower case version\n                                                   too to satisfy IE */ ||\n      (json as AnyDuringMigration)['callbackkey'];\n\n    /** If specified, a CSS class to add to this button. */\n    this.cssClass = (json as AnyDuringMigration)['web-class'] || null;\n\n    /** The JSON specifying the label / button. */\n    this.info = json;\n  }\n\n  /**\n   * Create the button elements.\n   *\n   * @returns The button's SVG group.\n   */\n  createDom(): SVGElement {\n    let cssClass = this.isLabel_ ? 'blocklyFlyoutLabel' : 'blocklyFlyoutButton';\n    if (this.cssClass) {\n      cssClass += ' ' + this.cssClass;\n    }\n\n    this.svgGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': cssClass},\n      this.workspace.getCanvas(),\n    );\n\n    let shadow;\n    if (!this.isLabel_) {\n      // Shadow rectangle (light source does not mirror in RTL).\n      shadow = dom.createSvgElement(\n        Svg.RECT,\n        {\n          'class': 'blocklyFlyoutButtonShadow',\n          'rx': FlyoutButton.BORDER_RADIUS,\n          'ry': FlyoutButton.BORDER_RADIUS,\n          'x': 1,\n          'y': 1,\n        },\n        this.svgGroup!,\n      );\n    }\n    // Background rectangle.\n    const rect = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': this.isLabel_\n          ? 'blocklyFlyoutLabelBackground'\n          : 'blocklyFlyoutButtonBackground',\n        'rx': FlyoutButton.BORDER_RADIUS,\n        'ry': FlyoutButton.BORDER_RADIUS,\n      },\n      this.svgGroup!,\n    );\n\n    const svgText = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': this.isLabel_ ? 'blocklyFlyoutLabelText' : 'blocklyText',\n        'x': 0,\n        'y': 0,\n        'text-anchor': 'middle',\n      },\n      this.svgGroup!,\n    );\n    let text = parsing.replaceMessageReferences(this.text);\n    if (this.workspace.RTL) {\n      // Force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    svgText.textContent = text;\n    if (this.isLabel_) {\n      this.svgText = svgText;\n      this.workspace\n        .getThemeManager()\n        .subscribe(this.svgText, 'flyoutForegroundColour', 'fill');\n    }\n\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\n    this.width = dom.getFastTextWidthWithSizeString(\n      svgText,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    const fontMetrics = dom.measureFontMetrics(\n      text,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    this.height = fontMetrics.height;\n\n    if (!this.isLabel_) {\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\n      shadow?.setAttribute('width', String(this.width));\n      shadow?.setAttribute('height', String(this.height));\n    }\n    rect.setAttribute('width', String(this.width));\n    rect.setAttribute('height', String(this.height));\n\n    svgText.setAttribute('x', String(this.width / 2));\n    svgText.setAttribute(\n      'y',\n      String(this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline),\n    );\n\n    this.updateTransform();\n\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'EventTarget'.\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\n      this.svgGroup as AnyDuringMigration,\n      'pointerup',\n      this,\n      this.onMouseUp,\n    );\n    return this.svgGroup!;\n  }\n\n  /** Correctly position the flyout button and make it visible. */\n  show() {\n    this.updateTransform();\n    this.svgGroup!.setAttribute('display', 'block');\n  }\n\n  /** Update SVG attributes to match internal state. */\n  private updateTransform() {\n    this.svgGroup!.setAttribute(\n      'transform',\n      'translate(' + this.position.x + ',' + this.position.y + ')',\n    );\n  }\n\n  /**\n   * Move the button to the given x, y coordinates.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   */\n  moveTo(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n    this.updateTransform();\n  }\n\n  /** @returns Whether or not the button is a label. */\n  isLabel(): boolean {\n    return this.isLabel_;\n  }\n\n  /**\n   * Location of the button.\n   *\n   * @returns x, y coordinates.\n   * @internal\n   */\n  getPosition(): Coordinate {\n    return this.position;\n  }\n\n  /** @returns Text of the button. */\n  getButtonText(): string {\n    return this.text;\n  }\n\n  /**\n   * Get the button's target workspace.\n   *\n   * @returns The target workspace of the flyout where this button resides.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /** Dispose of this button. */\n  dispose() {\n    if (this.onMouseUpWrapper) {\n      browserEvents.unbind(this.onMouseUpWrapper);\n    }\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.svgText) {\n      this.workspace.getThemeManager().unsubscribe(this.svgText);\n    }\n  }\n\n  /**\n   * Do something when the button is clicked.\n   *\n   * @param e Pointer up event.\n   */\n  private onMouseUp(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.cancel();\n    }\n\n    if (this.isLabel_ && this.callbackKey) {\n      console.warn(\n        'Labels should not have callbacks. Label text: ' + this.text,\n      );\n    } else if (\n      !this.isLabel_ &&\n      !(\n        this.callbackKey &&\n        this.targetWorkspace.getButtonCallback(this.callbackKey)\n      )\n    ) {\n      console.warn('Buttons should have callbacks. Button text: ' + this.text);\n    } else if (!this.isLabel_) {\n      const callback = this.targetWorkspace.getButtonCallback(this.callbackKey);\n      if (callback) {\n        callback(this);\n      }\n    }\n  }\n}\n\n/** CSS for buttons and labels. See css.js for use. */\nCss.register(`\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n`);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports flyout workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutMetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Calculates metrics for a flyout's workspace.\n * The metrics are mainly used to size scrollbars for the flyout.\n */\nexport class FlyoutMetricsManager extends MetricsManager {\n  /** The flyout that owns the workspace to calculate metrics for. */\n  protected flyout_: IFlyout;\n\n  /**\n   * @param workspace The flyout's workspace.\n   * @param flyout The flyout.\n   */\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\n    super(workspace);\n    this.flyout_ = flyout;\n  }\n\n  /**\n   * Gets the bounding box of the blocks on the flyout's workspace.\n   * This is in workspace coordinates.\n   *\n   * @returns The bounding box of the blocks on the workspace.\n   */\n  private getBoundingBox_():\n    | SVGRect\n    | {height: number; y: number; width: number; x: number} {\n    let blockBoundingBox;\n    try {\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\n    } catch (e) {\n      // Firefox has trouble with hidden elements (Bug 528969).\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\n      // 2020.\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\n    }\n    return blockBoundingBox;\n  }\n\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\n    // The bounding box is in workspace coordinates.\n    const blockBoundingBox = this.getBoundingBox_();\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n\n    return {\n      height: blockBoundingBox.height * scale,\n      width: blockBoundingBox.width * scale,\n      top: blockBoundingBox.y * scale,\n      left: blockBoundingBox.x * scale,\n    };\n  }\n\n  override getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ) {\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n\n    // The left padding isn't just the margin. Some blocks are also offset by\n    // tabWidth so that value and statement blocks line up.\n    // The contentMetrics.left value is equivalent to the variable left padding.\n    const leftPadding = contentMetrics.left;\n\n    return {\n      height: (contentMetrics.height + 2 * margin) / scale,\n      width: (contentMetrics.width + leftPadding + margin) / scale,\n      top: 0,\n      left: 0,\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Flyout\n\nimport type {Abstract as AbstractEvent} from './events/events_abstract.js';\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as eventUtils from './events/utils.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as Variables from './variables.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Xml from './xml.js';\nimport * as renderManagement from './render_management.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\n\nenum FlyoutItemType {\n  BLOCK = 'block',\n  BUTTON = 'button',\n}\n\n/**\n * Class for a flyout.\n */\nexport abstract class Flyout\n  extends DeleteArea\n  implements IAutoHideable, IFlyout\n{\n  /**\n   * Position the flyout.\n   */\n  abstract position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has\n   *     moved from the position at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float\n   *     between 0 and 1 specifying the degree of scrolling and a\n   *     similar x property.\n   */\n  protected abstract setMetrics_(xyRatio: {x?: number; y?: number}): void;\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected abstract wheel_(e: WheelEvent): void;\n\n  /**\n   * Compute height of flyout.  Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected abstract reflowInternal_(): void;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  abstract getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  abstract getY(): number;\n\n  /**\n   * Scroll the flyout to the beginning of its contents.\n   */\n  abstract scrollToStart(): void;\n\n  /**\n   * The type of a flyout content item.\n   */\n  static FlyoutItemType = FlyoutItemType;\n\n  protected workspace_: WorkspaceSvg;\n  RTL: boolean;\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   *\n   * @internal\n   */\n  horizontalLayout = false;\n  protected toolboxPosition_: number;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Function that will be registered as a change listener on the workspace\n   * to reflow when blocks in the flyout workspace change.\n   */\n  private reflowWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * Function that disables blocks in the flyout based on max block counts\n   * allowed in the target workspace. Registered as a change listener on the\n   * target workspace.\n   */\n  private filterWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   */\n  private mats: SVGElement[] = [];\n\n  /**\n   * List of visible buttons.\n   */\n  protected buttons_: FlyoutButton[] = [];\n\n  /**\n   * List of event listeners.\n   */\n  private listeners: browserEvents.Data[] = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   */\n  private permanentlyDisabled: Block[] = [];\n\n  protected readonly tabWidth_: number;\n\n  /**\n   * The target workspace.\n   *\n   * @internal\n   */\n  targetWorkspace!: WorkspaceSvg;\n\n  /**\n   * A list of blocks that can be reused.\n   */\n  private recycledBlocks: BlockSvg[] = [];\n\n  /**\n   * Does the flyout automatically close when a block is created?\n   */\n  autoClose = true;\n\n  /**\n   * Whether the flyout is visible.\n   */\n  private isVisible_ = false;\n\n  /**\n   * Whether the workspace containing this flyout is visible.\n   */\n  private containerVisible = true;\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\n\n  /**\n   * Corner radius of the flyout background.\n   */\n  readonly CORNER_RADIUS: number = 8;\n  readonly MARGIN: number;\n  readonly GAP_X: number;\n  readonly GAP_Y: number;\n\n  /**\n   * Top/bottom padding between scrollbar and edge of flyout background.\n   */\n  readonly SCROLLBAR_MARGIN: number = 2.5;\n\n  /**\n   * Width of flyout.\n   */\n  protected width_ = 0;\n\n  /**\n   * Height of flyout.\n   */\n  protected height_ = 0;\n  // clang-format off\n  /**\n   * Range of a drag angle from a flyout considered \"dragging toward\n   * workspace\". Drags that are within the bounds of this many degrees from\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\n   * the workspace\".\n   *\n   * @example\n   *\n   * ```\n   * Flyout                                                 Edge   Workspace\n   * [block] /  <-within this angle, drags \"toward workspace\" |\n   * [block] ---- orthogonal to flyout boundary ----          |\n   * [block] \\                                                |\n   * ```\n   *\n   * The angle is given in degrees from the orthogonal.\n   *\n   * This is used to know when to create a new block and when to scroll the\n   * flyout. Setting it to 360 means that all drags create a new block.\n   */\n  // clang-format on\n  protected dragAngleRange_ = 70;\n\n  /**\n   * The path around the background of the flyout, which will be filled with a\n   * background colour.\n   */\n  protected svgBackground_: SVGPathElement | null = null;\n\n  /**\n   * The root SVG group for the button or label.\n   */\n  protected svgGroup_: SVGGElement | null = null;\n  /**\n   * @param workspaceOptions Dictionary of options for the\n   *     workspace.\n   */\n  constructor(workspaceOptions: Options) {\n    super();\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\n    this.workspace_.setMetricsManager(\n      new FlyoutMetricsManager(this.workspace_, this),\n    );\n\n    this.workspace_.internalIsFlyout = true;\n    // Keep the workspace visibility consistent with the flyout's visibility.\n    this.workspace_.setVisible(this.isVisible_);\n\n    /**\n     * The unique id for this component that is used to register with the\n     * ComponentManager.\n     */\n    this.id = idGenerator.genUid();\n\n    /**\n     * Is RTL vs LTR.\n     */\n    this.RTL = !!workspaceOptions.RTL;\n\n    /**\n     * Position of the toolbox and flyout relative to the workspace.\n     */\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n    /**\n     * Width of output tab.\n     */\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n    /**\n     * A map from blocks to the rects which are beneath them to act as input\n     * targets.\n     *\n     * @internal\n     */\n    this.rectMap_ = new WeakMap();\n\n    /**\n     * Margin around the edges of the blocks in the flyout.\n     */\n    this.MARGIN = this.CORNER_RADIUS;\n\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\n    /**\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_X = this.MARGIN * 3;\n\n    /**\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_Y = this.MARGIN * 3;\n  }\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own SVG element or be a g element nested inside a\n   * separate SVG element.\n   *\n   * @param tagName The type of tag to\n   *     put the flyout in. This should be <svg> or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement {\n    /*\n        <svg | g>\n          <path class=\"blocklyFlyoutBackground\"/>\n          <g class=\"blocklyFlyout\"></g>\n        </ svg | g>\n        */\n    // Setting style to display:none to start. The toolbox and flyout\n    // hide/show code will set up proper visibility and size later.\n    this.svgGroup_ = dom.createSvgElement(tagName, {\n      'class': 'blocklyFlyout',\n    });\n    this.svgGroup_.style.display = 'none';\n    this.svgBackground_ = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyFlyoutBackground'},\n      this.svgGroup_,\n    );\n    this.svgGroup_.appendChild(this.workspace_.createDom());\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n    return this.svgGroup_;\n  }\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to\n   *     create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg) {\n    this.targetWorkspace = targetWorkspace;\n    this.workspace_.targetWorkspace = targetWorkspace;\n\n    this.workspace_.scrollbar = new ScrollbarPair(\n      this.workspace_,\n      this.horizontalLayout,\n      !this.horizontalLayout,\n      'blocklyFlyoutScrollbar',\n      this.SCROLLBAR_MARGIN,\n    );\n\n    this.hide();\n\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgGroup_ as SVGGElement,\n        'wheel',\n        this,\n        this.wheel_,\n      ),\n    );\n    this.filterWrapper = this.filterForCapacity.bind(this);\n    this.targetWorkspace.addChangeListener(this.filterWrapper);\n\n    // Dragging the flyout up and down.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgBackground_ as SVGPathElement,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    // A flyout connected to a workspace doesn't have its own current gesture.\n    this.workspace_.getGesture = this.targetWorkspace.getGesture.bind(\n      this.targetWorkspace,\n    );\n\n    // Get variables from the main workspace rather than the target workspace.\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n    this.workspace_.createPotentialVariableMap();\n\n    targetWorkspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.hide();\n    this.targetWorkspace.getComponentManager().removeComponent(this.id);\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    if (this.filterWrapper) {\n      this.targetWorkspace.removeChangeListener(this.filterWrapper);\n    }\n    if (this.workspace_) {\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\n      this.workspace_.dispose();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Get the scale (zoom level) of the flyout. By default,\n   * this matches the target workspace scale, but this can be overridden.\n   *\n   * @returns Flyout workspace scale.\n   */\n  getFlyoutScale(): number {\n    return this.targetWorkspace.scale;\n  }\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Sets whether this flyout automatically closes when blocks are dragged out,\n   * the workspace is clicked, etc, or not.\n   */\n  setAutoClose(autoClose: boolean) {\n    this.autoClose = autoClose;\n    this.targetWorkspace.recordDragTargets();\n    this.targetWorkspace.resizeContents();\n  }\n\n  /** Automatically hides the flyout if it is an autoclosing flyout. */\n  autoHide(onlyClosePopups: boolean): void {\n    if (\n      !onlyClosePopups &&\n      this.targetWorkspace.getFlyout(true) === this &&\n      this.autoClose\n    )\n      this.hide();\n  }\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    this.isVisible_ = visible;\n    if (visibilityChanged) {\n      if (!this.autoClose) {\n        // Auto-close flyouts are ignored as drag targets, so only non\n        // auto-close flyouts need to have their drag target updated.\n        this.targetWorkspace.recordDragTargets();\n      }\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Update the display property of the flyout based whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   */\n  private updateDisplay() {\n    let show = true;\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (this.svgGroup_) {\n      this.svgGroup_.style.display = show ? 'block' : 'none';\n    }\n    // Update the scrollbar's visibility too since it should mimic the\n    // flyout's visibility.\n    this.workspace_.scrollbar?.setContainerVisible(show);\n  }\n\n  /**\n   * Update the view based on coordinates calculated in position().\n   *\n   * @param width The computed width of the flyout's SVG group\n   * @param height The computed height of the flyout's SVG group.\n   * @param x The computed x origin of the flyout's SVG group.\n   * @param y The computed y origin of the flyout's SVG group.\n   */\n  protected positionAt_(width: number, height: number, x: number, y: number) {\n    this.svgGroup_?.setAttribute('width', `${width}`);\n    this.svgGroup_?.setAttribute('height', `${height}`);\n    this.workspace_.setCachedParentSvgSize(width, height);\n\n    if (this.svgGroup_) {\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\n      dom.setCssTransform(this.svgGroup_, transform);\n    }\n\n    // Update the scrollbar (if one exists).\n    const scrollbar = this.workspace_.scrollbar;\n    if (scrollbar) {\n      // Set the scrollbars origin to be the top left of the flyout.\n      scrollbar.setOrigin(x, y);\n      scrollbar.resize();\n      // If origin changed and metrics haven't changed enough to trigger\n      // reposition in resize, we need to call setPosition. See issue #4692.\n      if (scrollbar.hScroll) {\n        scrollbar.hScroll.setPosition(\n          scrollbar.hScroll.position.x,\n          scrollbar.hScroll.position.y,\n        );\n      }\n      if (scrollbar.vScroll) {\n        scrollbar.vScroll.setPosition(\n          scrollbar.vScroll.position.x,\n          scrollbar.vScroll.position.y,\n        );\n      }\n    }\n  }\n\n  /**\n   * Hide and empty the flyout.\n   */\n  hide() {\n    if (!this.isVisible()) {\n      return;\n    }\n    this.setVisible(false);\n    // Delete all the event listeners.\n    for (const listen of this.listeners) {\n      browserEvents.unbind(listen);\n    }\n    this.listeners.length = 0;\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n      this.reflowWrapper = null;\n    }\n    // Do NOT delete the blocks here.  Wait until Flyout.show.\n    // https://neil.fraser.name/news/2014/08/09/\n  }\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\n   *     toolbox definition, or a string with the name of the dynamic category.\n   */\n  show(flyoutDef: toolbox.FlyoutDefinition | string) {\n    this.workspace_.setResizesEnabled(false);\n    this.hide();\n    this.clearOldBlocks();\n\n    // Handle dynamic categories, represented by a name instead of a list.\n    if (typeof flyoutDef === 'string') {\n      flyoutDef = this.getDynamicCategoryContents(flyoutDef);\n    }\n    this.setVisible(true);\n\n    // Parse the Array, Node or NodeList into a a list of flyout items.\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n    const flyoutInfo = this.createFlyoutInfo(parsedContent);\n\n    renderManagement.triggerQueuedRenders(this.workspace_);\n\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n    if (this.horizontalLayout) {\n      this.height_ = 0;\n    } else {\n      this.width_ = 0;\n    }\n    this.workspace_.setResizesEnabled(true);\n    this.reflow();\n\n    this.filterForCapacity();\n\n    // Correctly position the flyout's scrollbar when it opens.\n    this.position();\n\n    this.reflowWrapper = this.reflow.bind(this);\n    this.workspace_.addChangeListener(this.reflowWrapper);\n    this.emptyRecycledBlocks();\n  }\n\n  /**\n   * Create the contents array and gaps array necessary to create the layout for\n   * the flyout.\n   *\n   * @param parsedContent The array\n   *     of objects to show in the flyout.\n   * @returns The list of contents and gaps needed to lay out the flyout.\n   */\n  private createFlyoutInfo(parsedContent: toolbox.FlyoutItemInfoArray): {\n    contents: FlyoutItem[];\n    gaps: number[];\n  } {\n    const contents: FlyoutItem[] = [];\n    const gaps: number[] = [];\n    this.permanentlyDisabled.length = 0;\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n    for (const info of parsedContent) {\n      if ('custom' in info) {\n        const customInfo = info as toolbox.DynamicCategoryInfo;\n        const categoryName = customInfo['custom'];\n        const flyoutDef = this.getDynamicCategoryContents(categoryName);\n        const parsedDynamicContent =\n          toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n        const {contents: dynamicContents, gaps: dynamicGaps} =\n          this.createFlyoutInfo(parsedDynamicContent);\n        contents.push(...dynamicContents);\n        gaps.push(...dynamicGaps);\n      }\n\n      switch (info['kind'].toUpperCase()) {\n        case 'BLOCK': {\n          const blockInfo = info as toolbox.BlockInfo;\n          const block = this.createFlyoutBlock(blockInfo);\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\n          this.addBlockGap(blockInfo, gaps, defaultGap);\n          break;\n        }\n        case 'SEP': {\n          const sepInfo = info as toolbox.SeparatorInfo;\n          this.addSeparatorGap(sepInfo, gaps, defaultGap);\n          break;\n        }\n        case 'LABEL': {\n          const labelInfo = info as toolbox.LabelInfo;\n          // A label is a button with different styling.\n          const label = this.createButton(labelInfo, /** isLabel */ true);\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\n          gaps.push(defaultGap);\n          break;\n        }\n        case 'BUTTON': {\n          const buttonInfo = info as toolbox.ButtonInfo;\n          const button = this.createButton(buttonInfo, /** isLabel */ false);\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\n          gaps.push(defaultGap);\n          break;\n        }\n      }\n    }\n\n    return {contents: contents, gaps: gaps};\n  }\n\n  /**\n   * Gets the flyout definition for the dynamic category.\n   *\n   * @param categoryName The name of the dynamic category.\n   * @returns The definition of the\n   *     flyout in one of its many forms.\n   */\n  private getDynamicCategoryContents(\n    categoryName: string,\n  ): toolbox.FlyoutDefinition {\n    // Look up the correct category generation function and call that to get a\n    // valid XML list.\n    const fnToApply =\n      this.workspace_.targetWorkspace!.getToolboxCategoryCallback(categoryName);\n    if (typeof fnToApply !== 'function') {\n      throw TypeError(\n        \"Couldn't find a callback function when opening\" +\n          ' a toolbox category.',\n      );\n    }\n    return fnToApply(this.workspace_.targetWorkspace!);\n  }\n\n  /**\n   * Creates a flyout button or a flyout label.\n   *\n   * @param btnInfo The object holding information about a button or a label.\n   * @param isLabel True if the button is a label, false otherwise.\n   * @returns The object used to display the button in the\n   *    flyout.\n   */\n  private createButton(\n    btnInfo: toolbox.ButtonOrLabelInfo,\n    isLabel: boolean,\n  ): FlyoutButton {\n    const curButton = new FlyoutButton(\n      this.workspace_,\n      this.targetWorkspace as WorkspaceSvg,\n      btnInfo,\n      isLabel,\n    );\n    return curButton;\n  }\n\n  /**\n   * Create a block from the xml and permanently disable any blocks that were\n   * defined as disabled.\n   *\n   * @param blockInfo The info of the block.\n   * @returns The block created from the blockInfo.\n   */\n  private createFlyoutBlock(blockInfo: toolbox.BlockInfo): BlockSvg {\n    let block;\n    if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      block = this.getRecycledBlock(xml.getAttribute('type')!);\n      if (!block) {\n        block = Xml.domToBlockInternal(xml, this.workspace_);\n      }\n    } else {\n      block = this.getRecycledBlock(blockInfo['type']!);\n      if (!block) {\n        if (blockInfo['enabled'] === undefined) {\n          blockInfo['enabled'] =\n            blockInfo['disabled'] !== 'true' && blockInfo['disabled'] !== true;\n        }\n        block = blocks.appendInternal(\n          blockInfo as blocks.State,\n          this.workspace_,\n        );\n      }\n    }\n\n    if (!block.isEnabled()) {\n      // Record blocks that were initially disabled.\n      // Do not enable these blocks as a result of capacity filtering.\n      this.permanentlyDisabled.push(block);\n    }\n    return block as BlockSvg;\n  }\n\n  /**\n   * Returns a block from the array of recycled blocks with the given type, or\n   * undefined if one cannot be found.\n   *\n   * @param blockType The type of the block to try to recycle.\n   * @returns The recycled block, or undefined if\n   *     one could not be recycled.\n   */\n  private getRecycledBlock(blockType: string): BlockSvg | undefined {\n    let index = -1;\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      if (this.recycledBlocks[i].type === blockType) {\n        index = i;\n        break;\n      }\n    }\n    return index === -1 ? undefined : this.recycledBlocks.splice(index, 1)[0];\n  }\n\n  /**\n   * Adds a gap in the flyout based on block info.\n   *\n   * @param blockInfo Information about a block.\n   * @param gaps The list of gaps between items in the flyout.\n   * @param defaultGap The default gap between one element and the\n   *     next.\n   */\n  private addBlockGap(\n    blockInfo: toolbox.BlockInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    let gap;\n    if (blockInfo['gap']) {\n      gap = parseInt(String(blockInfo['gap']));\n    } else if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      gap = parseInt(xml.getAttribute('gap')!);\n    }\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\n  }\n\n  /**\n   * Add the necessary gap in the flyout for a separator.\n   *\n   * @param sepInfo The object holding\n   *    information about a separator.\n   * @param gaps The list gaps between items in the flyout.\n   * @param defaultGap The default gap between the button and next\n   *     element.\n   */\n  private addSeparatorGap(\n    sepInfo: toolbox.SeparatorInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    // Change the gap between two toolbox elements.\n    // <sep gap=\"36\"></sep>\n    // The default gap is 24, can be set larger or smaller.\n    // This overwrites the gap attribute on the previous element.\n    const newGap = parseInt(String(sepInfo['gap']));\n    // Ignore gaps before the first block.\n    if (!isNaN(newGap) && gaps.length > 0) {\n      gaps[gaps.length - 1] = newGap;\n    } else {\n      gaps.push(defaultGap);\n    }\n  }\n\n  /**\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\n   */\n  private clearOldBlocks() {\n    // Delete any blocks from a previous showing.\n    const oldBlocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = oldBlocks[i]); i++) {\n      if (this.blockIsRecyclable_(block)) {\n        this.recycleBlock(block);\n      } else {\n        block.dispose(false, false);\n      }\n    }\n    // Delete any mats from a previous showing.\n    for (let j = 0; j < this.mats.length; j++) {\n      const rect = this.mats[j];\n      if (rect) {\n        Tooltip.unbindMouseEvents(rect);\n        dom.removeNode(rect);\n      }\n    }\n    this.mats.length = 0;\n    // Delete any buttons from a previous showing.\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      button.dispose();\n    }\n    this.buttons_.length = 0;\n\n    // Clear potential variables from the previous showing.\n    this.workspace_.getPotentialVariableMap()?.clear();\n  }\n\n  /**\n   * Empties all of the recycled blocks, properly disposing of them.\n   */\n  private emptyRecycledBlocks() {\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      this.recycledBlocks[i].dispose();\n    }\n    this.recycledBlocks = [];\n  }\n\n  /**\n   * Returns whether the given block can be recycled or not.\n   *\n   * @param _block The block to check for recyclability.\n   * @returns True if the block can be recycled. False otherwise.\n   */\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\n    // By default, recycling is disabled.\n    return false;\n  }\n\n  /**\n   * Puts a previously created block into the recycle bin and moves it to the\n   * top of the workspace. Used during large workspace swaps to limit the number\n   * of new DOM elements we need to create.\n   *\n   * @param block The block to recycle.\n   */\n  private recycleBlock(block: BlockSvg) {\n    const xy = block.getRelativeToSurfaceXY();\n    block.moveBy(-xy.x, -xy.y);\n    this.recycledBlocks.push(block);\n  }\n\n  /**\n   * Add listeners to a block that has been added to the flyout.\n   *\n   * @param root The root node of the SVG group the block is in.\n   * @param block The block to add listeners for.\n   * @param rect The invisible rectangle under the block that acts\n   *     as a mat for that block.\n   */\n  protected addBlockListeners_(\n    root: SVGElement,\n    block: BlockSvg,\n    rect: SVGElement,\n  ) {\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        root,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        rect,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerenter', block, block.addSelect),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerleave', block, block.removeSelect),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerenter', block, block.addSelect),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerleave', block, block.removeSelect),\n    );\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\n   *\n   * @param block The flyout block to copy.\n   * @returns Function to call when block is clicked.\n   */\n  private blockMouseDown(block: BlockSvg): Function {\n    return (e: PointerEvent) => {\n      const gesture = this.targetWorkspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartBlock(block);\n        gesture.handleFlyoutStart(e, this);\n      }\n    };\n  }\n\n  /**\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.handleFlyoutStart(e, this);\n    }\n  }\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *    otherwise.\n   * @internal\n   */\n  isBlockCreatable(block: BlockSvg): boolean {\n    return block.isEnabled();\n  }\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   * @internal\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg {\n    let newBlock = null;\n    eventUtils.disable();\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n    this.targetWorkspace.setResizesEnabled(false);\n    try {\n      newBlock = this.placeNewBlock(originalBlock);\n    } finally {\n      eventUtils.enable();\n    }\n\n    // Close the flyout.\n    this.targetWorkspace.hideChaff();\n\n    const newVariables = Variables.getAddedVariables(\n      this.targetWorkspace,\n      variablesBeforeCreation,\n    );\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.setGroup(true);\n      // Fire a VarCreate event for each (if any) new variable created.\n      for (let i = 0; i < newVariables.length; i++) {\n        const thisVariable = newVariables[i];\n        eventUtils.fire(\n          new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable),\n        );\n      }\n\n      // Block events come after var events, in case they refer to newly created\n      // variables.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    if (this.autoClose) {\n      this.hide();\n    } else {\n      this.filterForCapacity();\n    }\n    return newBlock;\n  }\n\n  /**\n   * Initialize the given button: move it to the correct location,\n   * add listeners, etc.\n   *\n   * @param button The button to initialize and place.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   */\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\n    const buttonSvg = button.createDom();\n    button.moveTo(x, y);\n    button.show();\n    // Clicking on a flyout button or label is a lot like clicking on the\n    // flyout background.\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        buttonSvg,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    this.buttons_.push(button);\n  }\n\n  /**\n   * Create and place a rectangle corresponding to the given block.\n   *\n   * @param block The block to associate the rect to.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   * @param blockHW The height and width of\n   *     the block.\n   * @param index The index into the mats list where this rect should\n   *     be placed.\n   * @returns Newly created SVG element for the rectangle behind\n   *     the block.\n   */\n  protected createRect_(\n    block: BlockSvg,\n    x: number,\n    y: number,\n    blockHW: {height: number; width: number},\n    index: number,\n  ): SVGElement {\n    // Create an invisible rectangle under the block to act as a button.  Just\n    // using the block as a button is poor, since blocks have holes in them.\n    const rect = dom.createSvgElement(Svg.RECT, {\n      'fill-opacity': 0,\n      'x': x,\n      'y': y,\n      'height': blockHW.height,\n      'width': blockHW.width,\n    });\n    (rect as AnyDuringMigration).tooltip = block;\n    Tooltip.bindMouseEvents(rect);\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n    this.rectMap_.set(block, rect);\n    this.mats[index] = rect;\n    return rect;\n  }\n\n  /**\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\n   * hats, and any other protrusions we invent.\n   *\n   * @param rect The rectangle to move directly behind the block.\n   * @param block The block the rectangle should be behind.\n   */\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\n    const blockHW = block.getHeightWidth();\n    rect.setAttribute('width', String(blockHW.width));\n    rect.setAttribute('height', String(blockHW.height));\n\n    const blockXY = block.getRelativeToSurfaceXY();\n    rect.setAttribute('y', String(blockXY.y));\n    rect.setAttribute(\n      'x',\n      String(this.RTL ? blockXY.x - blockHW.width : blockXY.x),\n    );\n  }\n\n  /**\n   * Filter the blocks on the flyout to disable the ones that are above the\n   * capacity limit.  For instance, if the user may only place two more blocks\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\n   * disabled.\n   */\n  private filterForCapacity() {\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      if (this.permanentlyDisabled.indexOf(block) === -1) {\n        const enable = this.targetWorkspace.isCapacityAvailable(\n          common.getBlockTypeCounts(block),\n        );\n        while (block) {\n          block.setEnabled(enable);\n          block = block.getNextBlock();\n        }\n      }\n    }\n  }\n\n  /**\n   * Reflow blocks and their mats.\n   */\n  reflow() {\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n    }\n    this.reflowInternal_();\n    if (this.reflowWrapper) {\n      this.workspace_.addChangeListener(this.reflowWrapper);\n    }\n  }\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or\n   *     by dragging.\n   * @internal\n   */\n  isScrollable(): boolean {\n    return this.workspace_.scrollbar\n      ? this.workspace_.scrollbar.isVisible()\n      : false;\n  }\n\n  /**\n   * Copy a block from the flyout to the workspace and position it correctly.\n   *\n   * @param oldBlock The flyout block to copy.\n   * @returns The new block in the main workspace.\n   */\n  private placeNewBlock(oldBlock: BlockSvg): BlockSvg {\n    const targetWorkspace = this.targetWorkspace;\n    const svgRootOld = oldBlock.getSvgRoot();\n    if (!svgRootOld) {\n      throw Error('oldBlock is not rendered');\n    }\n\n    // Clone the block.\n    const json = blocks.save(oldBlock) as blocks.State;\n    // Normallly this resizes leading to weird jumps. Save it for terminateDrag.\n    targetWorkspace.setResizesEnabled(false);\n    const block = blocks.append(json, targetWorkspace) as BlockSvg;\n\n    this.positionNewBlock(oldBlock, block);\n\n    return block;\n  }\n\n  /**\n   * Positions a block on the target workspace.\n   *\n   * @param oldBlock The flyout block being copied.\n   * @param block The block to posiiton.\n   */\n  private positionNewBlock(oldBlock: BlockSvg, block: BlockSvg) {\n    const targetWorkspace = this.targetWorkspace;\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n    // The offset in pixels between the flyout workspace's origin and the upper\n    // left corner of the injection div.\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n    // The position of the old block in flyout workspace coordinates.\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n    // The position of the old block in pixels relative to the flyout\n    // workspace's origin.\n    oldBlockPos.scale(this.workspace_.scale);\n\n    // The position of the old block in pixels relative to the upper left corner\n    // of the injection div.\n    const oldBlockOffsetPixels = Coordinate.sum(\n      flyoutOffsetPixels,\n      oldBlockPos,\n    );\n\n    // The position of the old block in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset = Coordinate.difference(\n      oldBlockOffsetPixels,\n      mainOffsetPixels,\n    );\n    // The position of the old block in main workspace coordinates.\n    finalOffset.scale(1 / targetWorkspace.scale);\n\n    // No 'reason' provided since events are disabled.\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\n  }\n}\n\n/**\n * A flyout content item.\n */\nexport interface FlyoutItem {\n  type: FlyoutItemType;\n  button?: FlyoutButton | undefined;\n  block?: BlockSvg | undefined;\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Horizontal flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.HorizontalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class HorizontalFlyout extends Flyout {\n  override horizontalLayout = true;\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.workspace_.scrollX = -(\n        scrollMetrics.left +\n        (scrollMetrics.width - viewMetrics.width) * xyRatio.x\n      );\n    }\n\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    // X is always 0 since this is a horizontal flyout.\n    return 0;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n\n    let y = 0;\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (atTop) {\n          y = toolboxMetrics.height;\n        } else {\n          y = viewMetrics.height - this.height_;\n        }\n      } else {\n        if (atTop) {\n          y = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          y = viewMetrics.height;\n        }\n      }\n    } else {\n      if (atTop) {\n        y = 0;\n      } else {\n        // Because the anchor point of the flyout is on the top, but we want\n        // to align the bottom edge of the flyout with the bottom edge of the\n        // blocklyDiv, we calculate the full height of the div minus the height\n        // of the flyout.\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\n      }\n    }\n\n    return y;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.width_ = targetWorkspaceViewMetrics.width;\n\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // Start at top left.\n    const path: (string | number)[] = [\n      'M 0,' + (atTop ? 0 : this.CORNER_RADIUS),\n    ];\n\n    if (atTop) {\n      // Top.\n      path.push('h', width + 2 * this.CORNER_RADIUS);\n      // Right.\n      path.push('v', height);\n      // Bottom.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('h', -width);\n      // Left.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('z');\n    } else {\n      // Top.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('h', width);\n      // Right.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('v', height);\n      // Bottom.\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\n      // Left.\n      path.push('z');\n    }\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n    const delta = scrollDelta.x || scrollDelta.y;\n\n    if (delta) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\n      this.workspace_.scrollbar?.setX(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    let cursorX = margin + this.tabWidth_;\n    const cursorY = margin;\n    if (this.RTL) {\n      contents = contents.reverse();\n    }\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        // Figure out where to place the block.\n        const tab = block!.outputConnection ? this.tabWidth_ : 0;\n        let moveX;\n        if (this.RTL) {\n          moveX = cursorX + blockHW.width;\n        } else {\n          moveX = cursorX - tab;\n        }\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(block!, moveX, cursorY, blockHW, i);\n        cursorX += blockHW.width + gaps[i];\n\n        this.addBlockListeners_(root, block!, rect);\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorX += button.width + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for up or down dragging.\n    if (\n      (dragDirection < 90 + range && dragDirection > 90 - range) ||\n      (dragDirection > -90 - range && dragDirection < -90 + range)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const top = flyoutRect.top;\n\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\n      const height = flyoutRect.height;\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n    } else {\n      // Bottom.\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute height of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutHeight = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n    }\n    const buttons = this.buttons_;\n    for (let i = 0, button; (button = buttons[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, button.height);\n    }\n    flyoutHeight += this.MARGIN * 1.5;\n    flyoutHeight *= this.workspace_.scale;\n    flyoutHeight += Scrollbar.scrollbarThickness;\n\n    if (this.height_ !== flyoutHeight) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently open on the top.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.TOP\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX,\n          this.targetWorkspace.scrollY + flyoutHeight,\n        );\n      }\n\n      this.height_ = flyoutHeight;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n  registry.DEFAULT,\n  HorizontalFlyout,\n);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Layout code for a vertical variant of the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VerticalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class VerticalFlyout extends Flyout {\n  /** The name of the vertical flyout in the registry. */\n  static registryName = 'verticalFlyout';\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.y === 'number') {\n      this.workspace_.scrollY = -(\n        scrollMetrics.top +\n        (scrollMetrics.height - viewMetrics.height) * xyRatio.y\n      );\n    }\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n    let x = 0;\n\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = toolboxMetrics.width;\n        } else {\n          x = viewMetrics.width - this.width_;\n        }\n      } else {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          x = viewMetrics.width;\n        }\n      }\n    } else {\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n        x = 0;\n      } else {\n        // Because the anchor point of the flyout is on the left, but we want\n        // to align the right edge of the flyout with the right edge of the\n        // blocklyDiv, we calculate the full width of the div minus the width\n        // of the flyout.\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\n      }\n    }\n\n    return x;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    // Y is always 0 since this is a vertical flyout.\n    return 0;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.height_ = targetWorkspaceViewMetrics.height;\n\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\n    const edgeHeight =\n      targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\n    const totalWidth = width + this.CORNER_RADIUS;\n\n    // Decide whether to start on the left or right.\n    const path: Array<string | number> = [\n      'M ' + (atRight ? totalWidth : 0) + ',0',\n    ];\n    // Top.\n    path.push('h', atRight ? -width : width);\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Side closest to workspace.\n    path.push('v', Math.max(0, height));\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Bottom.\n    path.push('h', atRight ? width : -width);\n    path.push('z');\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setY(0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    if (scrollDelta.y) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\n\n      this.workspace_.scrollbar?.setY(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\n    let cursorY = margin;\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        const moveX = block!.outputConnection\n          ? cursorX - this.tabWidth_\n          : cursorX;\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(\n          block!,\n          this.RTL ? moveX - blockHW.width : moveX,\n          cursorY,\n          blockHW,\n          i,\n        );\n\n        this.addBlockListeners_(root, block!, rect);\n\n        cursorY += blockHW.height + gaps[i];\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorY += button.height + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for left or right dragging.\n    if (\n      (dragDirection < range && dragDirection > -range) ||\n      dragDirection < -180 + range ||\n      dragDirection > 180 - range\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const left = flyoutRect.left;\n\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n      const width = flyoutRect.width;\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute width of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutWidth = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let width = block.getHeightWidth().width;\n      if (block.outputConnection) {\n        width -= this.tabWidth_;\n      }\n      flyoutWidth = Math.max(flyoutWidth, width);\n    }\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      flyoutWidth = Math.max(flyoutWidth, button.width);\n    }\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n    flyoutWidth *= this.workspace_.scale;\n    flyoutWidth += Scrollbar.scrollbarThickness;\n\n    if (this.width_ !== flyoutWidth) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.RTL) {\n          // With the flyoutWidth known, right-align the blocks.\n          const oldX = block.getRelativeToSurfaceXY().x;\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n          if (!block.outputConnection) {\n            newX -= this.tabWidth_;\n          }\n          block.moveBy(newX - oldX, 0);\n        }\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the buttons.\n        for (let i = 0, button; (button = this.buttons_[i]); i++) {\n          const y = button.getPosition().y;\n          const x =\n            flyoutWidth / this.workspace_.scale -\n            button.width -\n            this.MARGIN -\n            this.tabWidth_;\n          button.moveTo(x, y);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently\n      // open on the left.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.LEFT\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX + flyoutWidth,\n          this.targetWorkspace.scrollY,\n        );\n      }\n\n      this.width_ = flyoutWidth;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n  registry.DEFAULT,\n  VerticalFlyout,\n);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for generating executable code from\n * Blockly code.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CodeGenerator\n\nimport type {Block} from './block.js';\nimport * as common from './common.js';\nimport {Names, NameType} from './names.js';\nimport type {Workspace} from './workspace.js';\nimport {warn} from './utils/deprecation.js';\n\n/**\n * Deprecated, no-longer used type declaration for per-block-type generator\n * functions.\n *\n * @deprecated\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/generating-code}\n * @param block The Block instance to generate code for.\n * @param genearator The CodeGenerator calling the function.\n * @returns A string containing the generated code (for statement blocks),\n *     or a [code, precedence] tuple (for value/expression blocks), or\n *     null if no code should be emitted for block.\n */\nexport type BlockGenerator = (\n  block: Block,\n  generator: CodeGenerator,\n) => [string, number] | string | null;\n\n/**\n * Class for a code generator that translates the blocks into a language.\n */\nexport class CodeGenerator {\n  name_: string;\n\n  /**\n   * A dictionary of block generator functions, keyed by block type.\n   * Each block generator function takes two parameters:\n   *\n   * - the Block to generate code for, and\n   * - the calling CodeGenerator (or subclass) instance, so the\n   *   function can call methods defined below (e.g. blockToCode) or\n   *   on the relevant subclass (e.g. JavascripGenerator),\n   *\n   * and returns:\n   *\n   * - a [code, precedence] tuple (for value/expression blocks), or\n   * - a string containing the generated code (for statement blocks), or\n   * - null if no code should be emitted for block.\n   */\n  forBlock: Record<\n    string,\n    (block: Block, generator: this) => [string, number] | string | null\n  > = Object.create(null);\n\n  /**\n   * This is used as a placeholder in functions defined using\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\n   * legitimately appear in a function definition (or comment), and it must\n   * not confuse the regular expression parser.\n   */\n  FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\n\n  /**\n   * Arbitrary code to inject into locations that risk causing infinite loops.\n   * Any instances of '%1' will be replaced by the block ID that failed.\n   * E.g. `  checkTimeout(%1);\\n`\n   */\n  INFINITE_LOOP_TRAP: string | null = null;\n\n  /**\n   * Arbitrary code to inject before every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_PREFIX: string | null = null;\n\n  /**\n   * Arbitrary code to inject after every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_SUFFIX: string | null = null;\n\n  /**\n   * The method of indenting.  Defaults to two spaces, but language generators\n   * may override this to increase indent or change to tabs.\n   */\n  INDENT = '  ';\n\n  /**\n   * Maximum length for a comment before wrapping.  Does not account for\n   * indenting level.\n   */\n  COMMENT_WRAP = 60;\n\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: number[][] = [];\n\n  /**\n   * Whether the init method has been called.\n   * Generators that set this flag to false after creation and true in init\n   * will cause blockToCode to emit a warning if the generator has not been\n   * initialized. If this flag is untouched, it will have no effect.\n   */\n  isInitialized: boolean | null = null;\n\n  /** Comma-separated list of reserved words. */\n  protected RESERVED_WORDS_ = '';\n\n  /** A dictionary of definitions to be printed before the code. */\n  protected definitions_: {[key: string]: string} = Object.create(null);\n\n  /**\n   * A dictionary mapping desired function names in definitions_ to actual\n   * function names (to avoid collisions with user functions).\n   */\n  protected functionNames_: {[key: string]: string} = Object.create(null);\n\n  /** A database of variable and procedure names. */\n  nameDB_?: Names = undefined;\n\n  /** @param name Language name of this generator. */\n  constructor(name: string) {\n    this.name_ = name;\n\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ = new RegExp(\n      this.FUNCTION_NAME_PLACEHOLDER_,\n      'g',\n    );\n  }\n\n  /**\n   * Generate code for all blocks in the workspace to the specified language.\n   *\n   * @param workspace Workspace to generate code from.\n   * @returns Generated code.\n   */\n  workspaceToCode(workspace?: Workspace): string {\n    if (!workspace) {\n      // Backwards compatibility from before there could be multiple workspaces.\n      console.warn(\n        'No workspace specified in workspaceToCode call.  Guessing.',\n      );\n      workspace = common.getMainWorkspace();\n    }\n    const code = [];\n    this.init(workspace);\n    const blocks = workspace.getTopBlocks(true);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let line = this.blockToCode(block);\n      if (Array.isArray(line)) {\n        // Value blocks return tuples of code and operator order.\n        // Top-level blocks don't care about operator order.\n        line = line[0];\n      }\n      if (line) {\n        if (block.outputConnection) {\n          // This block is a naked value.  Ask the language's code generator if\n          // it wants to append a semicolon, or something.\n          line = this.scrubNakedValue(line);\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\n          }\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\n          }\n        }\n        code.push(line);\n      }\n    }\n    // Blank line between each section.\n    let codeString = code.join('\\n');\n    codeString = this.finish(codeString);\n    // Final scrubbing of whitespace.\n    codeString = codeString.replace(/^\\s+\\n/, '');\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\n    return codeString;\n  }\n\n  /**\n   * Prepend a common prefix onto each line of code.\n   * Intended for indenting code or adding comment markers.\n   *\n   * @param text The lines of code.\n   * @param prefix The common prefix.\n   * @returns The prefixed lines of code.\n   */\n  prefixLines(text: string, prefix: string): string {\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\n  }\n\n  /**\n   * Recursively spider a tree of blocks, returning all their comments.\n   *\n   * @param block The block from which to start spidering.\n   * @returns Concatenated list of comments.\n   */\n  allNestedComments(block: Block): string {\n    const comments = [];\n    const blocks = block.getDescendants(true);\n    for (let i = 0; i < blocks.length; i++) {\n      const comment = blocks[i].getCommentText();\n      if (comment) {\n        comments.push(comment);\n      }\n    }\n    // Append an empty string to create a trailing line break when joined.\n    if (comments.length) {\n      comments.push('');\n    }\n    return comments.join('\\n');\n  }\n\n  /**\n   * Generate code for the specified block (and attached blocks).\n   * The generator must be initialized before calling this function.\n   *\n   * @param block The block to generate code for.\n   * @param opt_thisOnly True to generate code for only this statement.\n   * @returns For statement blocks, the generated code.\n   *     For value blocks, an array containing the generated code and an\n   * operator order value.  Returns '' if block is null.\n   */\n  blockToCode(\n    block: Block | null,\n    opt_thisOnly?: boolean,\n  ): string | [string, number] {\n    if (this.isInitialized === false) {\n      console.warn(\n        'CodeGenerator init was not called before blockToCode was called.',\n      );\n    }\n    if (!block) {\n      return '';\n    }\n    if (!block.isEnabled()) {\n      // Skip past this block if it is disabled.\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\n    }\n    if (block.isInsertionMarker()) {\n      // Skip past insertion markers.\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\n    }\n\n    // Look up block generator function in dictionary - but fall back\n    // to looking up on this if not found, for backwards compatibility.\n    let func = this.forBlock[block.type];\n    if (!func && (this as any)[block.type]) {\n      warn(\n        'block generator functions on CodeGenerator objects',\n        '10.0',\n        '11.0',\n        'the .forBlock[blockType] dictionary',\n      );\n      func = (this as any)[block.type];\n    }\n    if (typeof func !== 'function') {\n      throw Error(\n        `${this.name_} generator does not know how to generate code ` +\n          `for block type \"${block.type}\".`,\n      );\n    }\n    // First argument to func.call is the value of 'this' in the generator.\n    // Prior to 24 September 2013 'this' was the only way to access the block.\n    // The current preferred method of accessing the block is through the second\n    // argument to func.call, which becomes the first parameter to the\n    // generator.\n    let code = func.call(block, block, this);\n    if (Array.isArray(code)) {\n      // Value blocks return tuples of code and operator order.\n      if (!block.outputConnection) {\n        throw TypeError('Expecting string from statement block: ' + block.type);\n      }\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\n    } else if (typeof code === 'string') {\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\n      }\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\n      }\n      return this.scrub_(block, code, opt_thisOnly);\n    } else if (code === null) {\n      // Block has handled code generation itself.\n      return '';\n    }\n    throw SyntaxError('Invalid code generated: ' + code);\n  }\n\n  /**\n   * Generate code representing the specified value input.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @param outerOrder The maximum binding strength (minimum order value) of any\n   *     operators adjacent to \"block\".\n   * @returns Generated code or '' if no blocks are connected or the specified\n   *     input does not exist.\n   */\n  valueToCode(block: Block, name: string, outerOrder: number): string {\n    if (isNaN(outerOrder)) {\n      throw TypeError('Expecting valid order from block: ' + block.type);\n    }\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock) {\n      return '';\n    }\n    const tuple = this.blockToCode(targetBlock);\n    if (tuple === '') {\n      // Disabled block.\n      return '';\n    }\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (!Array.isArray(tuple)) {\n      throw TypeError(\n        `Expecting tuple from value block: ${targetBlock.type} See ` +\n          `developers.google.com/blockly/guides/create-custom-blocks/generating-code ` +\n          `for more information`,\n      );\n    }\n    let code = tuple[0];\n    const innerOrder = tuple[1];\n    if (isNaN(innerOrder)) {\n      throw TypeError(\n        'Expecting valid order from value block: ' + targetBlock.type,\n      );\n    }\n    if (!code) {\n      return '';\n    }\n\n    // Add parentheses if needed.\n    let parensNeeded = false;\n    const outerOrderClass = Math.floor(outerOrder);\n    const innerOrderClass = Math.floor(innerOrder);\n    if (outerOrderClass <= innerOrderClass) {\n      if (\n        outerOrderClass === innerOrderClass &&\n        (outerOrderClass === 0 || outerOrderClass === 99)\n      ) {\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\n        // In all known languages multiple such code blocks are not order\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\n      } else {\n        // The operators outside this code are stronger than the operators\n        // inside this code.  To prevent the code from being pulled apart,\n        // wrap the code in parentheses.\n        parensNeeded = true;\n        // Check for special exceptions.\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\n          if (\n            this.ORDER_OVERRIDES[i][0] === outerOrder &&\n            this.ORDER_OVERRIDES[i][1] === innerOrder\n          ) {\n            parensNeeded = false;\n            break;\n          }\n        }\n      }\n    }\n    if (parensNeeded) {\n      // Technically, this should be handled on a language-by-language basis.\n      // However all known (sane) languages use parentheses for grouping.\n      code = '(' + code + ')';\n    }\n    return code;\n  }\n\n  /**\n   * Generate a code string representing the blocks attached to the named\n   * statement input. Indent the code.\n   * This is mainly used in generators. When trying to generate code to evaluate\n   * look at using workspaceToCode or blockToCode.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @returns Generated code or '' if no blocks are connected.\n   */\n  statementToCode(block: Block, name: string): string {\n    const targetBlock = block.getInputTargetBlock(name);\n    let code = this.blockToCode(targetBlock);\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (typeof code !== 'string') {\n      throw TypeError(\n        'Expecting code from statement block: ' +\n          (targetBlock && targetBlock.type),\n      );\n    }\n    if (code) {\n      code = this.prefixLines(code, this.INDENT);\n    }\n    return code;\n  }\n\n  /**\n   * Add an infinite loop trap to the contents of a loop.\n   * Add statement suffix at the start of the loop block (right after the loop\n   * statement executes), and a statement prefix to the end of the loop block\n   * (right before the loop statement executes).\n   *\n   * @param branch Code for loop contents.\n   * @param block Enclosing block.\n   * @returns Loop contents, with infinite loop trap added.\n   */\n  addLoopTrap(branch: string, block: Block): string {\n    if (this.INFINITE_LOOP_TRAP) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.INFINITE_LOOP_TRAP, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.STATEMENT_SUFFIX, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n      branch =\n        branch +\n        this.prefixLines(\n          this.injectId(this.STATEMENT_PREFIX, block),\n          this.INDENT,\n        );\n    }\n    return branch;\n  }\n\n  /**\n   * Inject a block ID into a message to replace '%1'.\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\n   *\n   * @param msg Code snippet with '%1'.\n   * @param block Block which has an ID.\n   * @returns Code snippet with ID.\n   */\n  injectId(msg: string, block: Block): string {\n    const id = block.id.replace(/\\$/g, '$$$$'); // Issue 251.\n    return msg.replace(/%1/g, \"'\" + id + \"'\");\n  }\n\n  /**\n   * Add one or more words to the list of reserved words for this language.\n   *\n   * @param words Comma-separated list of words to add to the list.\n   *     No spaces.  Duplicates are ok.\n   */\n  addReservedWords(words: string) {\n    this.RESERVED_WORDS_ += words + ',';\n  }\n\n  /**\n   * Define a developer-defined function (not a user-defined procedure) to be\n   * included in the generated code.  Used for creating private helper\n   * functions. The first time this is called with a given desiredName, the code\n   * is saved and an actual name is generated.  Subsequent calls with the same\n   * desiredName have no effect but have the same return value.\n   *\n   * It is up to the caller to make sure the same desiredName is not\n   * used for different helper functions (e.g. use \"colourRandom\" and\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\n   * words, or user-defined variable or procedure names.\n   *\n   * The code gets output when CodeGenerator.finish() is called.\n   *\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\n   * @param code A list of statements or one multi-line code string.  Use '  '\n   *     for indents (they will be replaced).\n   * @returns The actual name of the new function.  This may differ from\n   *     desiredName if the former has already been taken by the user.\n   */\n  provideFunction_(desiredName: string, code: string[] | string): string {\n    if (!this.definitions_[desiredName]) {\n      const functionName = this.nameDB_!.getDistinctName(\n        desiredName,\n        NameType.PROCEDURE,\n      );\n      this.functionNames_[desiredName] = functionName;\n      if (Array.isArray(code)) {\n        code = code.join('\\n');\n      }\n      let codeText = code\n        .trim()\n        .replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\n      // Change all '  ' indents into the desired indent.\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\n      // character first, then replace them all with the indent.\n      // We are assuming that no provided functions contain a literal null char.\n      let oldCodeText;\n      while (oldCodeText !== codeText) {\n        oldCodeText = codeText;\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\n      }\n      codeText = codeText.replace(/\\0/g, this.INDENT);\n      this.definitions_[desiredName] = codeText;\n    }\n    return this.functionNames_[desiredName];\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined variable.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param nameOrId The ID of the variable to get a name for,\n   *    or the proposed name for a variable not associated with an id.\n   * @returns A unique, legal name for the variable.\n   */\n  getVariableName(nameOrId: string): string {\n    return this.getName(nameOrId, NameType.VARIABLE);\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined procedure.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param name The proposed name for a procedure.\n   * @returns A unique, legal name for the procedure.\n   */\n  getProcedureName(name: string): string {\n    return this.getName(name, NameType.PROCEDURE);\n  }\n\n  private getName(nameOrId: string, type: NameType): string {\n    if (!this.nameDB_) {\n      throw new Error(\n        'Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.',\n      );\n    }\n    return this.nameDB_.getName(nameOrId, type);\n  }\n\n  /**\n   * Hook for code to run before code generation starts.\n   * Subclasses may override this, e.g. to initialise the database of variable\n   * names.\n   *\n   * @param _workspace Workspace to generate code from.\n   */\n  init(_workspace: Workspace) {\n    // Optionally override\n    // Create a dictionary of definitions to be printed before the code.\n    this.definitions_ = Object.create(null);\n    // Create a dictionary mapping desired developer-defined function names in\n    // definitions_ to actual function names (to avoid collisions with\n    // user-defined procedures).\n    this.functionNames_ = Object.create(null);\n  }\n\n  /**\n   * Common tasks for generating code from blocks.  This is called from\n   * blockToCode and is called on every block, not just top level blocks.\n   * Subclasses may override this, e.g. to generate code for statements\n   * following the block, or to handle comments for the specified block and any\n   * connected value blocks.\n   *\n   * @param _block The current block.\n   * @param code The code created for this block.\n   * @param _opt_thisOnly True to generate code for only this statement.\n   * @returns Code with comments and subsequent blocks added.\n   */\n  protected scrub_(\n    _block: Block,\n    code: string,\n    _opt_thisOnly?: boolean,\n  ): string {\n    // Optionally override\n    return code;\n  }\n\n  /**\n   * Hook for code to run at end of code generation.\n   * Subclasses may override this, e.g. to prepend the generated code with\n   * import statements or variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Optionally override\n    // Clean up temporary data.\n    this.definitions_ = Object.create(null);\n    this.functionNames_ = Object.create(null);\n    return code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.\n   * Subclasses may override this, e.g. if their language does not allow\n   * naked values.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    // Optionally override\n    return line;\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Align} from './inputs/align.js';\nimport {Input} from './inputs/input.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {ValueInput} from './inputs/value_input.js';\nimport {inputTypes} from './inputs/input_types.js';\n\nexport {\n  Align,\n  Input,\n  DummyInput,\n  EndRowInput,\n  StatementInput,\n  ValueInput,\n  inputTypes,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.ConstantProvider\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n/**\n * An object that provides constants for rendering blocks in Geras mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  override FIELD_TEXT_BASELINE_CENTER = false;\n\n  // The dark/shadow path in classic rendering is the same as the normal block\n  // path, but translated down one and right one.\n  DARK_PATH_OFFSET = 1;\n\n  /**\n   * The maximum width of a bottom row that follows a statement input and has\n   * inputs inline.\n   */\n  MAX_BOTTOM_WIDTH = 30;\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\n\n  constructor() {\n    super();\n  }\n\n  override getCSS_(selector: string) {\n    return super.getCSS_(selector).concat([\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      '}',\n      /* clang-format on */\n      /* eslint-enable indent */\n    ]);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Highlighter\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {\n  HighlightConstantProvider,\n  InsideCorner,\n  JaggedTeeth,\n  Notch,\n  OutsideCorner,\n  PuzzleTab,\n  StartHat,\n} from './highlight_constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\n\n/**\n * An object that adds highlights to a block based on the given rendering\n * information.\n *\n * Highlighting is interesting because the highlights do not fully enclose the\n * block.  Instead, they are positioned based on a light source in the top left.\n * This means that rendering highlights requires exact information about the\n * position of each part of the block.  The resulting paths are not continuous\n * or closed paths.  The highlights for tabs and notches are loosely based on\n * tab and notch shapes, but are not exactly the same.\n */\nexport class Highlighter {\n  info_: RenderInfo;\n  steps_ = '';\n  inlineSteps_ = '';\n  RTL_: boolean;\n  constants_: ConstantProvider;\n  highlightConstants_: HighlightConstantProvider;\n  private readonly highlightOffset: number;\n  outsideCornerPaths_: OutsideCorner;\n  insideCornerPaths_: InsideCorner;\n  puzzleTabPaths_: PuzzleTab;\n  notchPaths_: Notch;\n  startPaths_: StartHat;\n  jaggedTeethPaths_: JaggedTeeth;\n\n  /**\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(info: RenderInfo) {\n    this.info_ = info;\n\n    this.RTL_ = this.info_.RTL;\n\n    const renderer = info.getRenderer();\n\n    /** The renderer's constant provider. */\n    this.constants_ = renderer.getConstants();\n\n    this.highlightConstants_ = renderer.getHighlightConstants();\n    /** The offset between the block's main path and highlight path. */\n    this.highlightOffset = this.highlightConstants_.OFFSET;\n\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\n    this.startPaths_ = this.highlightConstants_.START_HAT;\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\n  }\n\n  /**\n   * Get the steps for the highlight path.\n   *\n   * @returns The steps for the highlight path.\n   */\n  getPath(): string {\n    return this.steps_ + '\\n' + this.inlineSteps_;\n  }\n\n  /**\n   * Add a highlight to the top corner of a block.\n   *\n   * @param row The top row of the block.\n   */\n  drawTopCorner(row: TopRow) {\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = row.elements[i]); i++) {\n      if (Types.isLeftSquareCorner(elem)) {\n        this.steps_ += this.highlightConstants_.START_POINT;\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\n      } else if (Types.isPreviousConnection(elem)) {\n        this.steps_ += this.notchPaths_.pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.steps_ += this.startPaths_.path(this.RTL_);\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\n        // The end point of the spacer needs to be offset by the highlight\n        // amount. So instead of using the spacer's width for a relative\n        // horizontal, use its width and position for an absolute horizontal\n        // move.\n        this.steps_ += svgPaths.lineOnAxis(\n          'H',\n          elem.xPos + elem.width - this.highlightOffset,\n        );\n      }\n    }\n\n    const right = row.xPos + row.width - this.highlightOffset;\n    this.steps_ += svgPaths.lineOnAxis('H', right);\n  }\n\n  /**\n   * Add a highlight on a jagged edge for a collapsed block.\n   *\n   * @param row  The row to highlight.\n   */\n  drawJaggedEdge_(row: Row) {\n    if (this.info_.RTL) {\n      const remainder =\n        row.height - this.jaggedTeethPaths_.height - this.highlightOffset;\n      this.steps_ +=\n        this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\n    }\n  }\n\n  /**\n   * Add a highlight on a value input.\n   *\n   * @param row The row the input belongs to.\n   */\n  drawValueInput(row: Row) {\n    const input = row.getLastInput() as InlineInput;\n    if (this.RTL_) {\n      const belowTabHeight = row.height - input.connectionHeight;\n\n      this.steps_ +=\n        svgPaths.moveTo(\n          input.xPos + input.width - this.highlightOffset,\n          row.yPos,\n        ) +\n        this.puzzleTabPaths_.pathDown(this.RTL_) +\n        svgPaths.lineOnAxis('v', belowTabHeight);\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos + input.width, row.yPos) +\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n\n  /**\n   * Add a highlight on a statement input.\n   *\n   * @param row The row to highlight.\n   */\n  drawStatementInput(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    if (this.RTL_) {\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos) +\n        this.insideCornerPaths_.pathTop(this.RTL_) +\n        svgPaths.lineOnAxis('v', innerHeight) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos + row.height) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    }\n  }\n\n  /**\n   * Add a highlight on the right side of a row.\n   *\n   * @param row The row to highlight.\n   */\n  drawRightSideRow(row: Row) {\n    const rightEdge = row.xPos + row.width - this.highlightOffset;\n    if (row instanceof SpacerRow && row.followsStatement) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n    }\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n      if (row.height > this.highlightOffset) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          row.yPos + row.height - this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to the bottom row.\n   *\n   * @param row The row to highlight.\n   */\n  drawBottomRow(row: BottomRow) {\n    // Highlight the vertical edge of the bottom row on the input side.\n    // Highlighting is always from the top left, both in LTR and RTL.\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis(\n        'V',\n        row.baseline - this.highlightOffset,\n      );\n    } else {\n      const cornerElem = this.info_.bottomRow.elements[0];\n      if (Types.isLeftSquareCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(\n          row.xPos + this.highlightOffset,\n          row.baseline - this.highlightOffset,\n        );\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\n      }\n    }\n  }\n\n  /**\n   * Draw the highlight on the left side of the block.\n   */\n  drawLeft() {\n    const outputConnection = this.info_.outputConnection;\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      // Draw a line up to the bottom of the tab.\n      if (this.RTL_) {\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\n      } else {\n        const left = this.info_.startX + this.highlightOffset;\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset;\n        this.steps_ += svgPaths.moveTo(left, bottom);\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\n      }\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\n    }\n\n    if (!this.RTL_) {\n      const topRow = this.info_.topRow;\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          this.outsideCornerPaths_.height,\n        );\n      } else {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          topRow.capline + this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to an inline input.\n   *\n   * @param input The input to highlight.\n   */\n  drawInlineInput(input: InlineInput) {\n    const offset = this.highlightOffset;\n\n    // Relative to the block's left.\n    const connectionRight = input.xPos + input.connectionWidth;\n    const yPos = input.centerline - input.height / 2;\n    const bottomHighlightWidth = input.width - input.connectionWidth;\n    const startY = yPos + offset;\n\n    if (this.RTL_) {\n      const aboveTabHeight = input.connectionOffsetY - offset;\n      const belowTabHeight =\n        input.height -\n        (input.connectionOffsetY + input.connectionHeight) +\n        offset;\n\n      const startX = connectionRight - offset;\n\n      this.inlineSteps_ +=\n        svgPaths.moveTo(startX, startY) + // Right edge above tab.\n        svgPaths.lineOnAxis('v', aboveTabHeight) + // Back of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_) + // Right edge below tab.\n        svgPaths.lineOnAxis('v', belowTabHeight) + // Bottom.\n        svgPaths.lineOnAxis('h', bottomHighlightWidth);\n    } else {\n      this.inlineSteps_ += // Go to top right corner.\n        svgPaths.moveTo(input.xPos + input.width + offset, startY) + // Highlight right edge, bottom.\n        svgPaths.lineOnAxis('v', input.height) +\n        svgPaths.lineOnAxis('h', -bottomHighlightWidth) + // Go to top of tab.\n        svgPaths.moveTo(connectionRight, yPos + input.connectionOffsetY) + // Short highlight glint at\n        // bottom of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {Row} from '../measurables/row.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {Highlighter} from './highlighter.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information,\n * customized for the geras renderer.\n */\nexport class Drawer extends BaseDrawer {\n  highlighter_: Highlighter;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    // Unlike Thrasos, Geras has highlights and drop shadows.\n    this.highlighter_ = new Highlighter(info);\n  }\n\n  override draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    pathObject.setHighlightPath(this.highlighter_.getPath());\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  override drawTop_() {\n    this.highlighter_.drawTopCorner(this.info_.topRow);\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n    super.drawTop_();\n  }\n\n  override drawJaggedEdge_(row: Row) {\n    this.highlighter_.drawJaggedEdge_(row);\n\n    super.drawJaggedEdge_(row);\n  }\n\n  override drawValueInput_(row: Row) {\n    this.highlighter_.drawValueInput(row);\n\n    super.drawValueInput_(row);\n  }\n\n  override drawStatementInput_(row: Row) {\n    this.highlighter_.drawStatementInput(row);\n\n    super.drawStatementInput_(row);\n  }\n\n  override drawRightSideRow_(row: Row) {\n    this.highlighter_.drawRightSideRow(row);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', row.xPos + row.width) +\n      svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  override drawBottom_() {\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n    super.drawBottom_();\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected override drawLeft_() {\n    this.highlighter_.drawLeft();\n\n    super.drawLeft_();\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.highlighter_.drawInlineInput(input as InlineInput);\n\n    super.drawInlineInput_(input);\n  }\n\n  override positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX =\n        input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      } else {\n        connX += this.constants_.DARK_PATH_OFFSET;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        row.yPos + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  override positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX =\n        (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\n      connInfo.connectionModel.setOffsetInBlock(\n        connX,\n        bottomRow.baseline + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.HighlightConstantProvider\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\n/** An object containing sizing and path information about an outside corner. */\nexport interface OutsideCorner {\n  height: number;\n  topLeft: (p1: boolean) => string;\n  bottomLeft: () => string;\n}\n\n/** An object containing sizing and path information about an inside corner. */\nexport interface InsideCorner {\n  width: number;\n  height: number;\n  pathTop: (p1: boolean) => string;\n  pathBottom: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  path: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  pathLeft: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  width: number;\n  height: number;\n  pathDown: (p1: boolean) => string;\n  pathUp: (p1: boolean) => string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  pathLeft: string;\n}\n\n/**\n * An object that provides constants for rendering highlights on blocks.\n * Some highlights are simple offsets of the parent paths and can be generated\n * programmatically.  Others, especially on curves, are just made out of piles\n * of constants and are hard to tweak.\n */\nexport class HighlightConstantProvider {\n  constantProvider: ConstantProvider;\n\n  /** The offset between the block's main path and highlight path. */\n  OFFSET = 0.5;\n  START_POINT: string;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNER!: InsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNER!: OutsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constantProvider = constants;\n\n    /**\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\n     */\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about inside corner\n     * highlights.\n     */\n    this.INSIDE_CORNER = this.makeInsideCorner();\n\n    /**\n     * An object containing sizing and path information about outside corner\n     * highlights.\n     */\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\n\n    /**\n     * An object containing sizing and path information about puzzle tab\n     * highlights.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about notch highlights.\n     */\n    this.NOTCH = this.makeNotch();\n\n    /**\n     * An object containing sizing and path information about highlights for\n     * collapsed block indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /**\n     * An object containing sizing and path information about start hat\n     * highlights.\n     */\n    this.START_HAT = this.makeStartHat();\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corner highlights.\n   */\n  protected makeInsideCorner(): InsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the outside of a curve.\n     */\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\n\n    const pathTopRtl =\n      svgPaths.moveBy(distance45outside, distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius,\n        svgPaths.point(-distance45outside - offset, radius - distance45outside),\n      );\n\n    const pathBottomRtl = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius + offset,\n      svgPaths.point(radius + offset, radius + offset),\n    );\n\n    const pathBottomLtr =\n      svgPaths.moveBy(distance45outside, -distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius + offset,\n        svgPaths.point(radius - distance45outside, distance45outside + offset),\n      );\n\n    return {\n      width: radius + offset,\n      height: radius,\n      pathTop(rtl) {\n        return rtl ? pathTopRtl : '';\n      },\n      pathBottom(rtl) {\n        return rtl ? pathBottomRtl : pathBottomLtr;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corner highlights.\n   */\n  protected makeOutsideCorner(): OutsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the inside of a curve.\n     */\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\n\n    const topLeftStartX = distance45inside;\n    const topLeftStartY = distance45inside;\n    const topLeftCornerHighlightRtl =\n      svgPaths.moveBy(topLeftStartX, topLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset),\n      );\n    /**\n     * SVG path for drawing the highlight on the rounded top-left corner.\n     */\n    const topLeftCornerHighlightLtr =\n      svgPaths.moveBy(offset, radius) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius, -radius + offset),\n      );\n\n    const bottomLeftStartX = distance45inside;\n    const bottomLeftStartY = -distance45inside;\n    const bottomLeftPath =\n      svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(-bottomLeftStartX + offset, -bottomLeftStartY - radius),\n      );\n\n    return {\n      height: radius,\n      topLeft(rtl) {\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\n      },\n      bottomLeft() {\n        return bottomLeftPath;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle tab\n   *     highlights.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.constantProvider.TAB_WIDTH;\n    const height = this.constantProvider.TAB_HEIGHT;\n\n    // This is how much of the vertical block edge is actually drawn by the\n    // puzzle tab.\n    const verticalOverlap = 2.5;\n\n    const highlightRtlUp =\n      svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\n      svgPaths.lineTo(width * -0.45, -2.1);\n\n    const highlightRtlDown =\n      svgPaths.lineOnAxis('v', verticalOverlap) +\n      svgPaths.moveBy(-width * 0.97, 2.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(-width * 0.05, 10),\n        svgPaths.point(width * 0.3, 9.5),\n      ]) +\n      svgPaths.moveBy(width * 0.67, -1.9) +\n      svgPaths.lineOnAxis('v', verticalOverlap);\n\n    const highlightLtrUp =\n      svgPaths.lineOnAxis('v', -1.5) +\n      svgPaths.moveBy(width * -0.92, -0.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(width * -0.19, -5.5),\n        svgPaths.point(0, -11),\n      ]) +\n      svgPaths.moveBy(width * 0.92, 1);\n\n    const highlightLtrDown =\n      svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\n\n    return {\n      width,\n      height,\n      pathUp(rtl) {\n        return rtl ? highlightRtlUp : highlightLtrUp;\n      },\n      pathDown(rtl) {\n        return rtl ? highlightRtlDown : highlightLtrDown;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notch\n   *     highlights.\n   */\n  protected makeNotch(): Notch {\n    // This is only for the previous connection.\n    const pathLeft =\n      svgPaths.lineOnAxis('h', this.OFFSET) +\n      this.constantProvider.NOTCH.pathLeft;\n    return {pathLeft};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block edge highlights.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const pathLeft =\n      svgPaths.lineTo(5.1, 2.6) +\n      svgPaths.moveBy(-10.2, 6.8) +\n      svgPaths.lineTo(5.1, 2.6);\n    return {pathLeft, height: 12, width: 10.2};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start\n   *     highlights.\n   */\n  protected makeStartHat(): StartHat {\n    const hatHeight = this.constantProvider.START_HAT.height;\n    const pathRtl =\n      svgPaths.moveBy(25, -8.7) +\n      svgPaths.curve('c', [\n        svgPaths.point(29.7, -6.2),\n        svgPaths.point(57.2, -0.5),\n        svgPaths.point(75, 8.7),\n      ]);\n\n    const pathLtr =\n      svgPaths.curve('c', [\n        svgPaths.point(17.8, -9.2),\n        svgPaths.point(45.3, -14.9),\n        svgPaths.point(75, -8.7),\n      ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\n    return {\n      path(rtl) {\n        return rtl ? pathRtl : pathLtr;\n      },\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.InlineInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends BaseInlineInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width += this.constants_.DARK_PATH_OFFSET;\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.StatementInput\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../inputs/input.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {InputRow} from '../measurables/input_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport {ValueInput} from '../../inputs/value_input.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/statement_input.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block,\n * customized for the geras renderer.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  protected override readonly renderer_: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override populateBottomRow_() {\n    super.populateBottomRow_();\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n    // The minimum height of the bottom row is smaller in Geras than in other\n    // renderers, because the dark path adds a pixel.\n    // If one of the row's elements has a greater height this will be\n    // overwritten in the compute pass.\n    if (!followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    // Ignore row alignment if inline.\n    if (!this.isInline && activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n      }\n    }\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row or a statement input.\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset + offset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\n      }\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) || Types.isIcon(elem)) {\n      result += elem.height / 2;\n      if (\n        (row.hasInlineInput || row.hasStatement) &&\n        elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <= row.height\n      ) {\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\n      }\n    } else if (Types.isInlineInput(elem)) {\n      result += elem.height / 2;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override alignRowElements_() {\n    if (!this.isInline) {\n      super.alignRowElements_();\n      return;\n    }\n    // Walk backgrounds through rows on the block, keeping track of the right\n    // input edge.\n    let nextRightEdge = 0;\n    const rowNextRightEdges = new WeakMap();\n    let prevInput = null;\n    for (let i = this.rows.length - 1, row; (row = this.rows[i]); i--) {\n      rowNextRightEdges.set(row, nextRightEdge);\n      if (Types.isInputRow(row)) {\n        if (row.hasStatement) {\n          this.alignStatementRow_(row as InputRow);\n        }\n        if (\n          prevInput &&\n          prevInput.hasStatement &&\n          row.width < prevInput.width\n        ) {\n          rowNextRightEdges.set(row, prevInput.width);\n        } else if (row.hasStatement) {\n          nextRightEdge = row.width;\n        } else {\n          // To keep right edges of consecutive non-statement rows aligned, use\n          // the maximum width.\n          nextRightEdge = Math.max(nextRightEdge, row.width);\n        }\n        prevInput = row;\n      }\n    }\n    // Walk down each row from the top, comparing the prev and next right input\n    // edges and setting the desired width to the max of the two.\n    let prevRightEdge = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        prevRightEdge = this.getDesiredRowWidth_(row);\n      } else if (Types.isSpacer(row)) {\n        // Set the spacer row to the max of the prev or next input width.\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = Math.max(\n          prevRightEdge,\n          rowNextRightEdges.get(row),\n        );\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        prevRightEdge = row.width;\n      }\n    }\n  }\n\n  override getDesiredRowWidth_(row: Row) {\n    // Limit the width of a statement row when a block is inline.\n    if (this.isInline && row.hasStatement) {\n      return (\n        this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH + this.startX\n      );\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren =\n      widestRowWithConnectedBlocks +\n      this.startX +\n      this.constants_.DARK_PATH_OFFSET;\n    this.width += this.constants_.DARK_PATH_OFFSET;\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  svgPathDark: SVGElement;\n  svgPathLight: SVGElement;\n\n  /**\n   * The colour of the dark path on the block in '#RRGGBB' format.\n   */\n  colourDark = '#000000';\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    public override constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    /** The dark path of the block. */\n    this.svgPathDark = dom.createSvgElement(Svg.PATH, {\n      'class': 'blocklyPathDark',\n      'transform': 'translate(1,1)',\n    });\n    // SVG draw order is based on the order of elements (top most = back most)\n    // So we need to insert the dark path before the base path to make sure it\n    // gets drawn first.\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\n\n    /** The light path of the block. */\n    this.svgPathLight = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPathLight'},\n      this.svgRoot,\n    );\n  }\n\n  override setPath(mainPath: string) {\n    this.svgPath.setAttribute('d', mainPath);\n    this.svgPathDark.setAttribute('d', mainPath);\n  }\n\n  /**\n   * Set the highlight path generated by the renderer onto the SVG element.\n   *\n   * @param highlightPath The highlight path.\n   */\n  setHighlightPath(highlightPath: string) {\n    this.svgPathLight.setAttribute('d', highlightPath);\n  }\n\n  override flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\n  }\n\n  override applyColour(block: BlockSvg) {\n    this.svgPathLight.style.display = '';\n    this.svgPathDark.style.display = '';\n    if (!this.style.colourTertiary) {\n      throw new Error(\n        'The renderer did not properly initialize the tertiary colour of ' +\n          'the block style',\n      );\n    }\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPathDark.setAttribute('fill', this.colourDark);\n\n    super.applyColour(block);\n\n    this.svgPath.setAttribute('stroke', 'none');\n  }\n\n  override setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n    this.colourDark =\n      colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\n  }\n\n  override updateHighlighted(highlighted: boolean) {\n    if (highlighted) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n      this.svgPathLight.style.display = 'none';\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n      this.svgPathLight.style.display = 'inline';\n    }\n  }\n\n  override updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPathLight.style.display = 'none';\n      if (!this.style.colourSecondary) {\n        throw new Error(\n          'The renderer did not properly initialize the secondary colour ' +\n            'of the block style block style',\n        );\n      }\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  override updateDisabled_(disabled: boolean) {\n    super.updateDisabled_(disabled);\n    if (disabled) {\n      this.svgPath.setAttribute('stroke', 'none');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {RenderInfo} from './info.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The geras renderer. This renderer was designed to be backwards compatible\n * with pre-2019 Blockly. Newer projects that are not constrained by backwards\n * compatibility should use thrasos, which is a more modern take on this\n * renderer.\n *\n * Geras is the ancient Greek spirit of old age.\n */\nexport class Renderer extends BaseRenderer {\n  /** The renderer's highlight constant provider. */\n  private highlightConstants: HighlightConstantProvider | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Initialize the renderer.  Geras has a highlight provider in addition to\n   * the normal constant provider.\n   */\n  override init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    super.init(theme, opt_rendererOverrides);\n    this.highlightConstants = this.makeHighlightConstants_();\n    this.highlightConstants.init();\n  }\n\n  override refreshDom(svg: SVGElement, theme: Theme) {\n    super.refreshDom(svg, theme);\n    this.getHighlightConstants().init();\n  }\n\n  override makeConstants_() {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Create a new instance of the renderer's highlight constant provider.\n   *\n   * @returns The highlight constant provider.\n   */\n  protected makeHighlightConstants_(): HighlightConstantProvider {\n    return new HighlightConstantProvider(this.getConstants());\n  }\n\n  /**\n   * Get the renderer's highlight constant provider.  We assume that when this\n   * is called, the renderer has already been initialized.\n   *\n   * @returns The highlight constant provider.\n   */\n  getHighlightConstants(): HighlightConstantProvider {\n    if (!this.highlightConstants) {\n      throw new Error(\n        'Cannot access the highlight constants because init has not ' +\n          'been called',\n      );\n    }\n    return this.highlightConstants;\n  }\n}\n\nblockRendering.register('geras', Renderer);\n", "/** @file Re-exports of Blockly.geras.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {Highlighter} from './highlighter.js';\nimport {RenderInfo} from './info.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  ConstantProvider,\n  Drawer,\n  HighlightConstantProvider,\n  Highlighter,\n  InlineInput,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  StatementInput,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.minimalist.ConstantProvider\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\n/**\n * An object that provides constants for rendering blocks in the minimalist\n * renderer.\n *\n * @deprecated Use Blockly.blockRendering.ConstantProvider instead.\n *     To be removed in v11.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  /**\n   * @deprecated Use Blockly.blockRendering.ConstantProvider instead.\n   *     To be removed in v11.\n   */\n  constructor() {\n    super();\n    deprecation.warn(\n      'Blockly.minimalist.ConstantProvider',\n      'v10',\n      'v11',\n      'Blockly.blockRendering.ConstantProvider',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.minimalist.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\nimport type {RenderInfo} from './info.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n *\n * @deprecated Use Blockly.blockRendering.Drawer instead.\n *     To be removed in v11.\n */\nexport class Drawer extends BaseDrawer {\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   *\n   * @deprecated Use Blockly.blockRendering.Drawer instead.\n   *     To be removed in v11.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    deprecation.warn(\n      'Blockly.minimalist.Drawer',\n      'v10',\n      'v11',\n      'Blockly.blockRendering.Drawer',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.minimalist.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @deprecated Use Blockly.blockRendering.RenderInfo instead. To be removed\n *     in v11.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @deprecated Use Blockly.blockRendering.RenderInfo instead. To be removed\n   *     in v11.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    deprecation.warn(\n      'Blockly.minimalist.RenderInfo',\n      'v10',\n      'v11',\n      'Blockly.blockRendering.RenderInfo',\n    );\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.minimalist.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\nimport * as deprecation from '../../utils/deprecation.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\n\n/**\n * The minimalist renderer.\n *\n * @deprecated Use Blockly.blockRendering.Renderer instead. To be removed\n *     in v11.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   * @deprecated Use Blockly.blockRendering.Renderer instead. To be removed\n   *     in v11.\n   */\n  constructor(name: string) {\n    super(name);\n    deprecation.warn(\n      'Blockly.minimalist.Renderer',\n      'v10',\n      'v11',\n      'Blockly.blockRendering.Renderer',\n    );\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n}\n\nblockRendering.register('minimalist', Renderer);\n", "/** @file Re-exports of Blockly.minimalist.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.minimalist\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\nexport {ConstantProvider, Drawer, Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n        break;\n      }\n    }\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row.\n    if (!Types.isInput(prev) && !next) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput || next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) && row.hasStatement) {\n      const offset =\n        this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\n      result += offset;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {RenderInfo} from './info.js';\n\n/**\n * The thrasos renderer. This is a more modern take on the legacy geras\n * renderer.\n *\n * Thrasos is the ancient Greek spirit of boldness.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n}\n\nblockRendering.register('thrasos', Renderer);\n", "/** @file Re-exports of Blockly.thrasos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos\n\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\nexport {Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Zelos\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {\n    'colourPrimary': '#CF63CF',\n    'colourSecondary': '#C94FC9',\n    'colourTertiary': '#BD42BD',\n  },\n  'list_blocks': {\n    'colourPrimary': '#9966FF',\n    'colourSecondary': '#855CD6',\n    'colourTertiary': '#774DCB',\n  },\n  'logic_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n  },\n  'loop_blocks': {\n    'colourPrimary': '#0fBD8C',\n    'colourSecondary': '#0DA57A',\n    'colourTertiary': '#0B8E69',\n  },\n  'math_blocks': {\n    'colourPrimary': '#59C059',\n    'colourSecondary': '#46B946',\n    'colourTertiary': '#389438',\n  },\n  'procedure_blocks': {\n    'colourPrimary': '#FF6680',\n    'colourSecondary': '#FF4D6A',\n    'colourTertiary': '#FF3355',\n  },\n  'text_blocks': {\n    'colourPrimary': '#FFBF00',\n    'colourSecondary': '#E6AC00',\n    'colourTertiary': '#CC9900',\n  },\n  'variable_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'variable_dynamic_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'hat_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n    'hat': 'cap',\n  },\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '#CF63CF'},\n  'list_category': {'colour': '#9966FF'},\n  'logic_category': {'colour': '#4C97FF'},\n  'loop_category': {'colour': '#0fBD8C'},\n  'math_category': {'colour': '#59C059'},\n  'procedure_category': {'colour': '#FF6680'},\n  'text_category': {'colour': '#FFBF00'},\n  'variable_category': {'colour': '#FF8C1A'},\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\n};\n\n/**\n * Zelos theme.\n */\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes\n\nimport {Classic} from './classic.js';\nimport {Zelos} from './zelos.js';\n\nexport {Classic, Zelos};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An item in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxItem\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Class for an item in the toolbox.\n */\nexport class ToolboxItem implements IToolboxItem {\n  protected id_: string;\n  protected parent_: ICollapsibleToolboxItem | null;\n  protected level_: number;\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo | null;\n  protected workspace_: WorkspaceSvg;\n  /** The toolbox this category belongs to. */\n  protected readonly parentToolbox_: IToolbox;\n\n  /**\n   * @param toolboxItemDef The JSON defining the toolbox item.\n   * @param parentToolbox The toolbox that holds the toolbox item.\n   * @param opt_parent The parent toolbox item or null if the category does not\n   *     have a parent.\n   */\n  constructor(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    /** The ID for the category. */\n    this.id_ =\n      (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\n      idGenerator.getNextUniqueId();\n\n    /** The parent of the category. */\n    this.parent_ = opt_parent || null;\n\n    /** The level that the category is nested at. */\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\n\n    /** The JSON definition of the toolbox item. */\n    this.toolboxItemDef_ = toolboxItemDef;\n\n    this.parentToolbox_ = parentToolbox;\n\n    /** The workspace of the parent toolbox. */\n    this.workspace_ = this.parentToolbox_.getWorkspace();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init() {}\n  // No-op by default.\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks, or null if this item should\n   *     not receive clicks.\n   */\n  getClickTarget(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): ICollapsibleToolboxItem | null {\n    return null;\n  }\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number {\n    return this.level_;\n  }\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean {\n    return false;\n  }\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean {\n    return false;\n  }\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose() {}\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param _isVisible True if category should be visible.\n   */\n  setVisible_(_isVisible: boolean) {}\n}\n// nop by default\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxCategory\n\nimport * as Css from '../css.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport type {\n  CategoryInfo,\n  DynamicCategoryInfo,\n  FlyoutDefinition,\n  FlyoutItemInfo,\n  FlyoutItemInfoArray,\n  StaticCategoryInfo,\n} from '../utils/toolbox.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as colourUtils from '../utils/colour.js';\nimport * as dom from '../utils/dom.js';\nimport * as parsing from '../utils/parsing.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a category in a toolbox.\n */\nexport class ToolboxCategory\n  extends ToolboxItem\n  implements ISelectableToolboxItem\n{\n  /** Name used for registering a toolbox category. */\n  static registrationName = 'category';\n\n  /** The number of pixels to move the category over at each nested level. */\n  static nestedPadding = 19;\n\n  /** The width in pixels of the strip of colour next to each category. */\n  static borderWidth = 8;\n\n  /**\n   * The default colour of the category. This is used as the background colour\n   * of the category when it is selected.\n   */\n  static defaultBackgroundColour = '#57e';\n\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override toolboxItemDef_!: CategoryInfo;\n\n  /** The name that will be displayed on the category. */\n  protected name_ = '';\n\n  /** The colour of the category. */\n  protected colour_ = '';\n\n  /** The HTML container for the category. */\n  protected htmlDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element for the category row. */\n  protected rowDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element that holds children elements of the category row. */\n  protected rowContents_: HTMLDivElement | null = null;\n\n  /** The HTML element for the toolbox icon. */\n  protected iconDom_: Element | null = null;\n\n  /** The HTML element for the toolbox label. */\n  protected labelDom_: Element | null = null;\n  protected cssConfig_: CssConfig;\n\n  /** True if the category is meant to be hidden, false otherwise. */\n  protected isHidden_ = false;\n\n  /** True if this category is disabled, false otherwise. */\n  protected isDisabled_ = false;\n\n  /** The flyout items for this category. */\n  protected flyoutItems_: string | FlyoutItemInfoArray = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param parentToolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: CategoryInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, parentToolbox, opt_parent);\n\n    /** All the css class names that are used to create a category. */\n    this.cssConfig_ = this.makeDefaultCssConfig_();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   * Init should be called immediately after the construction of the toolbox\n   * item, to ensure that the category contents are properly parsed.\n   */\n  override init() {\n    this.parseCategoryDef_(this.toolboxItemDef_);\n    this.parseContents_(this.toolboxItemDef_);\n    this.createDom_();\n    if (this.toolboxItemDef_['hidden'] === 'true') {\n      this.hide();\n    }\n  }\n\n  /**\n   * Creates an object holding the default classes for a category.\n   *\n   * @returns The configuration object holding all the CSS classes for a\n   *     category.\n   */\n  protected makeDefaultCssConfig_(): CssConfig {\n    return {\n      'container': 'blocklyToolboxCategory',\n      'row': 'blocklyTreeRow',\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\n      'icon': 'blocklyTreeIcon',\n      'label': 'blocklyTreeLabel',\n      'contents': 'blocklyToolboxContents',\n      'selected': 'blocklyTreeSelected',\n      'openicon': 'blocklyTreeIconOpen',\n      'closedicon': 'blocklyTreeIconClosed',\n    };\n  }\n\n  /**\n   * Parses the contents array depending on if the category is a dynamic\n   * category, or if its contents are meant to be shown in the flyout.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseContents_(categoryDef: CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        const flyoutItem = itemDef as FlyoutItemInfo;\n        if (Array.isArray(this.flyoutItems_)) {\n          this.flyoutItems_.push(flyoutItem);\n        }\n      }\n    }\n  }\n\n  /**\n   * Parses the non-contents parts of the category def.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\n    this.name_ =\n      'name' in categoryDef\n        ? parsing.replaceMessageReferences(categoryDef['name'])\n        : '';\n    this.colour_ = this.getColour_(categoryDef);\n    Object.assign(\n      this.cssConfig_,\n      categoryDef['cssconfig'] || (categoryDef as any)['cssConfig'],\n    );\n  }\n\n  /**\n   * Creates the DOM for the category.\n   *\n   * @returns The parent element for the category.\n   */\n  protected createDom_(): HTMLDivElement {\n    this.htmlDiv_ = this.createContainer_();\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_ + 1);\n\n    this.rowDiv_ = this.createRowContainer_();\n    this.rowDiv_.style.pointerEvents = 'auto';\n    this.htmlDiv_.appendChild(this.rowDiv_);\n\n    this.rowContents_ = this.createRowContentsContainer_();\n    this.rowContents_.style.pointerEvents = 'none';\n    this.rowDiv_.appendChild(this.rowContents_);\n\n    this.iconDom_ = this.createIconDom_();\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\n    this.rowContents_.appendChild(this.iconDom_);\n\n    this.labelDom_ = this.createLabelDom_(this.name_);\n    this.rowContents_.appendChild(this.labelDom_);\n\n    const id = this.labelDom_.getAttribute('id');\n    if (id) {\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\n    }\n\n    this.addColourBorder_(this.colour_);\n\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Creates the container that holds the row and any subcategories.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    return container;\n  }\n\n  /**\n   * Creates the parent of the contents container. All clicks will happen on\n   * this div.\n   *\n   * @returns The div that holds the contents container.\n   */\n  protected createRowContainer_(): HTMLDivElement {\n    const rowDiv = document.createElement('div');\n    const className = this.cssConfig_['row'];\n    if (className) {\n      dom.addClass(rowDiv, className);\n    }\n    const nestedPadding = `${\n      ToolboxCategory.nestedPadding * this.getLevel()\n    }px`;\n    this.workspace_.RTL\n      ? (rowDiv.style.paddingRight = nestedPadding)\n      : (rowDiv.style.paddingLeft = nestedPadding);\n    return rowDiv;\n  }\n\n  /**\n   * Creates the container for the label and icon.\n   * This is necessary so we can set all subcategory pointer events to none.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createRowContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['rowcontentcontainer'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Creates the span that holds the category icon.\n   *\n   * @returns The span that holds the category icon.\n   */\n  protected createIconDom_(): Element {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Creates the span that holds the category label.\n   * This should have an ID for accessibility purposes.\n   *\n   * @param name The name of the category.\n   * @returns The span that holds the category label.\n   */\n  protected createLabelDom_(name: string): Element {\n    const toolboxLabel = document.createElement('span');\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\n    toolboxLabel.textContent = name;\n    const className = this.cssConfig_['label'];\n    if (className) {\n      dom.addClass(toolboxLabel, className);\n    }\n    return toolboxLabel;\n  }\n\n  /** Updates the colour for this category. */\n  refreshTheme() {\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\n    this.addColourBorder_(this.colour_);\n  }\n\n  /**\n   * Add the strip of colour to the toolbox category.\n   *\n   * @param colour The category colour.\n   */\n  protected addColourBorder_(colour: string) {\n    if (colour) {\n      const border =\n        ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\n      if (this.workspace_.RTL) {\n        this.rowDiv_!.style.borderRight = border;\n      } else {\n        this.rowDiv_!.style.borderLeft = border;\n      }\n    }\n  }\n\n  /**\n   * Gets either the colour or the style for a category.\n   *\n   * @param categoryDef The object holding information on the category.\n   * @returns The hex colour for the category.\n   */\n  protected getColour_(categoryDef: CategoryInfo): string {\n    const styleName =\n      categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\n    const colour = categoryDef['colour'];\n\n    if (colour && styleName) {\n      console.warn(\n        'Toolbox category \"' +\n          this.name_ +\n          '\" must not have both a style and a colour',\n      );\n    } else if (styleName) {\n      return this.getColourfromStyle_(styleName);\n    } else if (colour) {\n      return this.parseColour_(colour);\n    }\n    return '';\n  }\n\n  /**\n   * Sets the colour for the category using the style name and returns the new\n   * colour as a hex string.\n   *\n   * @param styleName Name of the style.\n   * @returns The hex colour for the category.\n   */\n  private getColourfromStyle_(styleName: string): string {\n    const theme = this.workspace_.getTheme();\n    if (styleName && theme) {\n      const style = theme.categoryStyles[styleName];\n      if (style && style.colour) {\n        return this.parseColour_(style.colour);\n      } else {\n        console.warn(\n          'Style \"' + styleName + '\" must exist and contain a colour value',\n        );\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  override getClickTarget(): Element {\n    return this.rowDiv_ as Element;\n  }\n\n  /**\n   * Parses the colour on the category.\n   *\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   * @returns The hex colour for the category.\n   */\n  private parseColour_(colourValue: number | string): string {\n    // Decode the colour for any potential message references\n    // (eg. `%{BKY_MATH_HUE}`).\n    const colour = parsing.replaceMessageReferences(colourValue);\n    if (colour == null || colour === '') {\n      // No attribute. No colour.\n      return '';\n    } else {\n      const hue = Number(colour);\n      if (!isNaN(hue)) {\n        return colourUtils.hueToHex(hue);\n      } else {\n        const hex = colourUtils.parse(colour);\n        if (hex) {\n          return hex;\n        } else {\n          console.warn(\n            'Toolbox category \"' +\n              this.name_ +\n              '\" has unrecognized colour attribute: ' +\n              colour,\n          );\n          return '';\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display an open icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected openIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const closedIconClass = this.cssConfig_['closedicon'];\n    if (closedIconClass) {\n      dom.removeClasses(iconDiv, closedIconClass);\n    }\n    const className = this.cssConfig_['openicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display a closed icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected closeIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const openIconClass = this.cssConfig_['openicon'];\n    if (openIconClass) {\n      dom.removeClasses(iconDiv, openIconClass);\n    }\n    const className = this.cssConfig_['closedicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /** Hide the category. */\n  hide() {\n    this.setVisible_(false);\n  }\n\n  /**\n   * Show the category. Category will only appear if its parent category is also\n   * expanded.\n   */\n  show() {\n    this.setVisible_(true);\n  }\n\n  /**\n   * Whether the category is visible.\n   * A category is only visible if all of its ancestors are expanded and\n   * isHidden_ is false.\n   *\n   * @returns True if the category is visible, false otherwise.\n   */\n  isVisible(): boolean {\n    return !this.isHidden_ && this.allAncestorsExpanded_();\n  }\n\n  /**\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\n   * expanded.\n   *\n   * @returns True only if every ancestor is expanded\n   */\n  protected allAncestorsExpanded_(): boolean {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let category: IToolboxItem = this;\n    while (category.getParent()) {\n      category = category.getParent()!;\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  override isSelectable() {\n    return this.isVisible() && !this.isDisabled_;\n  }\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event) {}\n  // No-op\n\n  /**\n   * Sets the current category as selected.\n   *\n   * @param isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(isSelected: boolean) {\n    if (!this.rowDiv_) {\n      return;\n    }\n    const className = this.cssConfig_['selected'];\n    if (isSelected) {\n      const defaultColour = this.parseColour_(\n        ToolboxCategory.defaultBackgroundColour,\n      );\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\n      if (className) {\n        dom.addClass(this.rowDiv_, className);\n      }\n    } else {\n      this.rowDiv_.style.backgroundColor = '';\n      if (className) {\n        dom.removeClass(this.rowDiv_, className);\n      }\n    }\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\n  }\n\n  /**\n   * Sets whether the category is disabled.\n   *\n   * @param isDisabled True to disable the category, false otherwise.\n   */\n  setDisabled(isDisabled: boolean) {\n    this.isDisabled_ = isDisabled;\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\n    isDisabled\n      ? this.getDiv()!.setAttribute('disabled', 'true')\n      : this.getDiv()!.removeAttribute('disabled');\n  }\n\n  /**\n   * Gets the name of the category. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string {\n    return this.name_;\n  }\n\n  override getParent() {\n    return this.parent_;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets the contents of the category. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string {\n    return this.flyoutItems_;\n  }\n\n  /**\n   * Updates the contents to be displayed in the flyout.\n   * If the flyout is open when the contents are updated, refreshSelection on\n   * the toolbox must also be called.\n   *\n   * @param contents The contents to be displayed in the flyout. A string can be\n   *     supplied to create a dynamic category.\n   */\n  updateFlyoutContents(contents: FlyoutDefinition | string) {\n    this.flyoutItems_ = [];\n\n    if (typeof contents === 'string') {\n      const newDefinition: DynamicCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        custom: contents,\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    } else {\n      const newDefinition: StaticCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        name:\n          'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] : '',\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    }\n    this.parseContents_(this.toolboxItemDef_);\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_);\n  }\n}\n\nexport namespace ToolboxCategory {\n  /** All the CSS class names that are used to create a category. */\n  export interface CssConfig {\n    container?: string;\n    row?: string;\n    rowcontentcontainer?: string;\n    icon?: string;\n    label?: string;\n    contents?: string;\n    selected?: string;\n    openicon?: string;\n    closedicon?: string;\n  }\n}\n\nexport type CssConfig = ToolboxCategory.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxCategory.registrationName,\n  ToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A separator used for separating toolbox categories.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxSeparator\n\nimport * as Css from '../css.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a toolbox separator. This is the thin visual line that appears on\n * the toolbox. This item is not interactable.\n */\nexport class ToolboxSeparator extends ToolboxItem {\n  /** Name used for registering a toolbox separator. */\n  static registrationName = 'sep';\n\n  /** All the CSS class names that are used to create a separator. */\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\n\n  private htmlDiv_: HTMLDivElement | null = null;\n\n  /**\n   * @param separatorDef The information needed to create a separator.\n   * @param toolbox The parent toolbox for the separator.\n   */\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\n    super(separatorDef, toolbox);\n\n    const cssConfig =\n      separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\n    Object.assign(this.cssConfig_, cssConfig);\n  }\n\n  override init() {\n    this.createDom_();\n  }\n\n  /**\n   * Creates the DOM for a separator.\n   *\n   * @returns The parent element for the separator.\n   */\n  protected createDom_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    this.htmlDiv_ = container;\n    return container;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_ as HTMLDivElement;\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_ as HTMLDivElement);\n  }\n}\n\nexport namespace ToolboxSeparator {\n  export interface CssConfig {\n    container: string | undefined;\n  }\n}\n\nexport type CssConfig = ToolboxSeparator.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxSeparator.registrationName,\n  ToolboxSeparator,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CollapsibleToolboxCategory\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxCategory} from './category.js';\nimport {ToolboxSeparator} from './separator.js';\n\n/**\n * Class for a category in a toolbox that can be collapsed.\n */\nexport class CollapsibleToolboxCategory\n  extends ToolboxCategory\n  implements ICollapsibleToolboxItem\n{\n  /** Name used for registering a collapsible toolbox category. */\n  static override registrationName = 'collapsibleCategory';\n\n  /** Container for any child categories. */\n  protected subcategoriesDiv_: HTMLDivElement | null = null;\n\n  /** Whether or not the category should display its subcategories. */\n  protected expanded_ = false;\n\n  /** The child toolbox items for this category. */\n  protected toolboxItems_: IToolboxItem[] = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param toolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: toolbox.CategoryInfo,\n    toolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, toolbox, opt_parent);\n  }\n\n  override makeDefaultCssConfig_() {\n    const cssConfig = super.makeDefaultCssConfig_();\n    cssConfig['contents'] = 'blocklyToolboxContents';\n    return cssConfig;\n  }\n\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n      this.flyoutItems_ = [];\n      let prevIsFlyoutItem = true;\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        // Separators can exist as either a flyout item or a toolbox item so\n        // decide where it goes based on the type of the previous item.\n        if (\n          !registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\n          (itemDef['kind'].toLowerCase() ===\n            ToolboxSeparator.registrationName &&\n            prevIsFlyoutItem)\n        ) {\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\n          this.flyoutItems_.push(flyoutItem);\n          prevIsFlyoutItem = true;\n        } else {\n          this.createToolboxItem_(itemDef);\n          prevIsFlyoutItem = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates a toolbox item and adds it to the list of toolbox items.\n   *\n   * @param itemDef The information needed to create a toolbox item.\n   */\n  private createToolboxItem_(itemDef: toolbox.ToolboxItemInfo) {\n    let registryName = itemDef['kind'];\n    const categoryDef = itemDef as toolbox.CategoryInfo;\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(categoryDef)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName,\n    );\n    const toolboxItem = new ToolboxItemClass!(\n      itemDef,\n      this.parentToolbox_,\n      this,\n    );\n    this.toolboxItems_.push(toolboxItem);\n  }\n\n  override init() {\n    super.init();\n\n    this.setExpanded(\n      this.toolboxItemDef_['expanded'] === 'true' ||\n        this.toolboxItemDef_['expanded'] === true,\n    );\n  }\n\n  override createDom_() {\n    super.createDom_();\n\n    const subCategories = this.getChildToolboxItems();\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\n    this.closeIcon_(this.iconDom_);\n    aria.setState(this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, false);\n\n    return this.htmlDiv_!;\n  }\n\n  override createIconDom_() {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n      toolboxIcon.style.visibility = 'visible';\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Create the DOM for all subcategories.\n   *\n   * @param subcategories The subcategories.\n   * @returns The div holding all the subcategories.\n   */\n  protected createSubCategoriesDom_(\n    subcategories: IToolboxItem[],\n  ): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    contentsContainer.style.display = 'none';\n    const className = this.cssConfig_['contents'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n\n    for (let i = 0; i < subcategories.length; i++) {\n      const newCategory = subcategories[i];\n      newCategory.init();\n      const newCategoryDiv = newCategory.getDiv();\n      contentsContainer.appendChild(newCategoryDiv!);\n      if (newCategory.getClickTarget) {\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\n      }\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Opens or closes the current category and the associated flyout.\n   *\n   * @param isExpanded True to expand the category, false to close.\n   */\n  setExpanded(isExpanded: boolean) {\n    if (this.expanded_ === isExpanded) return;\n\n    this.expanded_ = isExpanded;\n    if (isExpanded) {\n      this.subcategoriesDiv_!.style.display = 'block';\n      this.openIcon_(this.iconDom_);\n    } else {\n      this.parentToolbox_.getFlyout()?.setVisible(false);\n      this.subcategoriesDiv_!.style.display = 'none';\n      this.closeIcon_(this.iconDom_);\n    }\n    aria.setState(\n      this.htmlDiv_ as HTMLDivElement,\n      aria.State.EXPANDED,\n      isExpanded,\n    );\n\n    this.parentToolbox_.handleToolboxItemResize();\n  }\n\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    const childToolboxItems = this.getChildToolboxItems();\n    for (let i = 0; i < childToolboxItems.length; i++) {\n      const child = childToolboxItems[i];\n      child.setVisible_(isVisible);\n    }\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /**\n   * Whether the category is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean {\n    return this.expanded_;\n  }\n\n  override isCollapsible() {\n    return true;\n  }\n\n  override onClick(_e: Event) {\n    this.toggleExpanded();\n  }\n\n  /** Toggles whether or not the category is expanded. */\n  toggleExpanded() {\n    this.setExpanded(!this.expanded_);\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[] {\n    return this.toolboxItems_;\n  }\n}\n\nexport namespace CollapsibleToolboxCategory {\n  /**\n   * All the CSS class names that are used to create a collapsible\n   * category. This is all the properties from the regular category plus\n   * contents.\n   */\n  export interface CssConfig {\n    container: string | null;\n    row: string | null;\n    rowcontentcontainer: string | null;\n    icon: string | null;\n    label: string | null;\n    selected: string | null;\n    openicon: string | null;\n    closedicon: string | null;\n    contents: string | null;\n  }\n}\n\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  CollapsibleToolboxCategory.registrationName,\n  CollapsibleToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Toolbox from whence to create blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Toolbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../events/events_toolbox_item_select.js';\n\nimport {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as Css from '../css.js';\nimport {DeleteArea} from '../delete_area.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IDraggable} from '../interfaces/i_draggable.js';\nimport type {IFlyout} from '../interfaces/i_flyout.js';\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport {isSelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IStyleable} from '../interfaces/i_styleable.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport {Options} from '../options.js';\nimport * as registry from '../registry.js';\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\nimport * as Touch from '../touch.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {ToolboxCategory} from './category.js';\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\n\n/**\n * Class for a Toolbox.\n * Creates the toolbox's DOM.\n */\nexport class Toolbox\n  extends DeleteArea\n  implements IAutoHideable, IKeyboardAccessible, IStyleable, IToolbox\n{\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'toolbox';\n  protected toolboxDef_: toolbox.ToolboxInfo;\n  private readonly horizontalLayout_: boolean;\n\n  /** The HTML container for the toolbox. */\n  HtmlDiv: HTMLDivElement | null = null;\n\n  /** The HTML container for the contents of a toolbox. */\n  protected contentsDiv_: HTMLDivElement | null = null;\n\n  /** Whether the Toolbox is visible. */\n  protected isVisible_ = false;\n\n  /** The list of items in the toolbox. */\n  protected contents_: IToolboxItem[] = [];\n\n  /** The width of the toolbox. */\n  protected width_ = 0;\n\n  /** The height of the toolbox. */\n  protected height_ = 0;\n  RTL: boolean;\n\n  /** The flyout for the toolbox. */\n  private flyout_: IFlyout | null = null;\n  protected contentMap_: {[key: string]: IToolboxItem};\n  toolboxPosition: toolbox.Position;\n\n  /** The currently selected item. */\n  protected selectedItem_: ISelectableToolboxItem | null = null;\n\n  /** The previously selected item. */\n  protected previouslySelectedItem_: ISelectableToolboxItem | null = null;\n\n  /**\n   * Array holding info needed to unbind event handlers.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  protected boundEvents_: browserEvents.Data[] = [];\n\n  /** The workspace this toolbox is on. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace in which to create new blocks. */\n  constructor(workspace: WorkspaceSvg) {\n    super();\n\n    this.workspace_ = workspace;\n\n    /** The JSON describing the contents of this toolbox. */\n    this.toolboxDef_ = workspace.options.languageTree || {\n      contents: new Array<toolbox.ToolboxItemInfo>(),\n    };\n\n    /** Whether the toolbox should be laid out horizontally. */\n    this.horizontalLayout_ = workspace.options.horizontalLayout;\n\n    /** Is RTL vs LTR. */\n    this.RTL = workspace.options.RTL;\n\n    /** A map from toolbox item IDs to toolbox items. */\n    this.contentMap_ = Object.create(null);\n\n    /** Position of the toolbox and flyout relative to the workspace. */\n    this.toolboxPosition = workspace.options.toolboxPosition;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /** Initializes the toolbox */\n  init() {\n    const workspace = this.workspace_;\n    const svg = workspace.getParentSvg();\n\n    this.flyout_ = this.createFlyout_();\n\n    this.HtmlDiv = this.createDom_(this.workspace_);\n    dom.insertAfter(this.flyout_.createDom('svg'), svg);\n    this.setVisible(true);\n    this.flyout_.init(workspace);\n\n    this.render(this.toolboxDef_);\n    const themeManager = workspace.getThemeManager();\n    themeManager.subscribe(\n      this.HtmlDiv,\n      'toolboxBackgroundColour',\n      'background-color',\n    );\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Creates the DOM for the toolbox.\n   *\n   * @param workspace The workspace this toolbox is on.\n   * @returns The HTML container for the toolbox.\n   */\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\n    const svg = workspace.getParentSvg();\n\n    const container = this.createContainer_();\n\n    this.contentsDiv_ = this.createContentsContainer_();\n    this.contentsDiv_.tabIndex = 0;\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\n    container.appendChild(this.contentsDiv_);\n\n    svg.parentNode!.insertBefore(container, svg);\n\n    this.attachEvents_(container, this.contentsDiv_);\n    return container;\n  }\n\n  /**\n   * Creates the container div for the toolbox.\n   *\n   * @returns The HTML container for the toolbox.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const toolboxContainer = document.createElement('div');\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\n    dom.addClass(toolboxContainer, 'blocklyNonSelectable');\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    return toolboxContainer;\n  }\n\n  /**\n   * Creates the container for all the contents in the toolbox.\n   *\n   * @returns The HTML container for the toolbox contents.\n   */\n  protected createContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\n    if (this.isHorizontal()) {\n      contentsContainer.style.flexDirection = 'row';\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Adds event listeners to the toolbox container div.\n   *\n   * @param container The HTML container for the toolbox.\n   * @param contentsContainer The HTML container for the contents of the\n   *     toolbox.\n   */\n  protected attachEvents_(\n    container: HTMLDivElement,\n    contentsContainer: HTMLDivElement,\n  ) {\n    // Clicking on toolbox closes popups.\n    const clickEvent = browserEvents.conditionalBind(\n      container,\n      'pointerdown',\n      this,\n      this.onClick_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(clickEvent);\n\n    const keyDownEvent = browserEvents.conditionalBind(\n      contentsContainer,\n      'keydown',\n      this,\n      this.onKeyDown_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(keyDownEvent);\n  }\n\n  /**\n   * Handles on click events for when the toolbox or toolbox items are clicked.\n   *\n   * @param e Click event to handle.\n   */\n  protected onClick_(e: PointerEvent) {\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\n      // Close flyout.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\n    } else {\n      const targetElement = e.target;\n      const itemId = (targetElement as Element).getAttribute('id');\n      if (itemId) {\n        const item = this.getToolboxItemById(itemId);\n        if (item!.isSelectable()) {\n          this.setSelectedItem(item);\n          (item as ISelectableToolboxItem).onClick(e);\n        }\n      }\n      // Just close popups.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\n    }\n    Touch.clearTouchIdentifier();\n  }\n\n  /**\n   * Handles key down events for the toolbox.\n   *\n   * @param e The key down event.\n   */\n  protected onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    switch (e.key) {\n      case 'ArrowDown':\n        handled = this.selectNext_();\n        break;\n      case 'ArrowUp':\n        handled = this.selectPrevious_();\n        break;\n      case 'ArrowLeft':\n        handled = this.selectParent_();\n        break;\n      case 'ArrowRight':\n        handled = this.selectChild_();\n        break;\n      case 'Enter':\n      case ' ':\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n          collapsibleItem.toggleExpanded();\n          handled = true;\n        }\n        break;\n      default:\n        handled = false;\n        break;\n    }\n    if (!handled && this.selectedItem_) {\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\n      // should be part of.\n      if ((this.selectedItem_ as any).onKeyDown) {\n        handled = (this.selectedItem_ as any).onKeyDown(e);\n      }\n    }\n\n    if (handled) {\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Creates the flyout based on the toolbox layout.\n   *\n   * @returns The flyout for the toolbox.\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\n   */\n  protected createFlyout_(): IFlyout {\n    const workspace = this.workspace_;\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\n    const workspaceOptions = new Options({\n      'parentWorkspace': workspace,\n      'rtl': workspace.RTL,\n      'oneBasedIndex': workspace.options.oneBasedIndex,\n      'horizontalLayout': workspace.horizontalLayout,\n      'renderer': workspace.options.renderer,\n      'rendererOverrides': workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Options takes in either 'end' or 'start'. This has already been parsed to\n    // be either 0 or 1, so set it after.\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\n    let FlyoutClass = null;\n    if (workspace.horizontalLayout) {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    } else {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    }\n    return new FlyoutClass!(workspaceOptions);\n  }\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   * @internal\n   */\n  render(toolboxDef: toolbox.ToolboxInfo) {\n    this.toolboxDef_ = toolboxDef;\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      if (toolboxItem) {\n        toolboxItem.dispose();\n      }\n    }\n    this.contents_ = [];\n    this.contentMap_ = Object.create(null);\n    this.renderContents_(toolboxDef['contents']);\n    this.position();\n    this.handleToolboxItemResize();\n  }\n\n  /**\n   * Adds all the toolbox items to the toolbox.\n   *\n   * @param toolboxDef Array holding objects containing information on the\n   *     contents of the toolbox.\n   */\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\n    // This is for performance reasons. By using document fragment we only have\n    // to add to the DOM once.\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < toolboxDef.length; i++) {\n      const toolboxItemDef = toolboxDef[i];\n      this.createToolboxItem_(toolboxItemDef, fragment);\n    }\n    this.contentsDiv_!.appendChild(fragment);\n  }\n\n  /**\n   * Creates and renders the toolbox item.\n   *\n   * @param toolboxItemDef Any information that can be used to create an item in\n   *     the toolbox.\n   * @param fragment The document fragment to add the child toolbox elements to.\n   */\n  private createToolboxItem_(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    fragment: DocumentFragment,\n  ) {\n    let registryName = toolboxItemDef['kind'];\n\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName.toLowerCase(),\n    );\n    if (ToolboxItemClass) {\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\n      toolboxItem.init();\n      this.addToolboxItem_(toolboxItem);\n      const toolboxItemDom = toolboxItem.getDiv();\n      if (toolboxItemDom) {\n        fragment.appendChild(toolboxItemDom);\n      }\n      // Adds the ID to the HTML element that can receive a click.\n      // This is used in onClick_ to find the toolboxItem that was clicked.\n      if (toolboxItem.getClickTarget()) {\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\n      }\n    }\n  }\n\n  /**\n   * Adds an item to the toolbox.\n   *\n   * @param toolboxItem The item in the toolbox.\n   */\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\n    this.contents_.push(toolboxItem);\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\n    if (toolboxItem.isCollapsible()) {\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\n      for (let i = 0; i < childToolboxItems.length; i++) {\n        const child = childToolboxItems[i];\n        this.addToolboxItem_(child);\n      }\n    }\n  }\n\n  /**\n   * Gets the items in the toolbox.\n   *\n   * @returns The list of items in the toolbox.\n   */\n  getToolboxItems(): IToolboxItem[] {\n    return this.contents_;\n  }\n\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   * @internal\n   */\n  addStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.addClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   * @internal\n   */\n  removeStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.removeClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.HtmlDiv || !this.isVisible_) {\n      return null;\n    }\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\n    // area are still deleted.  Must be smaller than Infinity, but larger than\n    // the largest screen size.\n    const BIG_NUM = 10000000;\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\n\n    const top = toolboxRect.top;\n    const bottom = top + toolboxRect.height;\n    const left = toolboxRect.left;\n    const right = left + toolboxRect.width;\n\n    // Assumes that the toolbox is on the SVG edge.  If this changes\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\n    if (this.toolboxPosition === toolbox.Position.TOP) {\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param _couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  override wouldDelete(element: IDraggable, _couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      // Prefer dragging to the toolbox over connecting to other blocks.\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragEnter(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected override updateWouldDelete_(wouldDelete: boolean) {\n    if (wouldDelete === this.wouldDelete_) {\n      return;\n    }\n    // This logic handles updating the deleteStyle properly if the delete state\n    // changes while the block is over the Toolbox. This could happen if the\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\n    // or if the isDeletable property of the block currently being dragged\n    // changes during the drag.\n    this.updateCursorDeleteStyle_(false);\n    this.wouldDelete_ = wouldDelete;\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\n   * the block or bubble over it is expected to be deleted if dropped (using the\n   * internal this.wouldDelete_ property).\n   *\n   * @param addStyle Whether the style should be added or removed.\n   */\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\n    const style = this.wouldDelete_\n      ? 'blocklyToolboxDelete'\n      : 'blocklyToolboxGrab';\n    if (addStyle) {\n      this.addStyle(style);\n    } else {\n      this.removeStyle(style);\n    }\n  }\n\n  /**\n   * Gets the toolbox item with the given ID.\n   *\n   * @param id The ID of the toolbox item.\n   * @returns The toolbox item with the given ID, or null if no item exists.\n   */\n  getToolboxItemById(id: string): IToolboxItem | null {\n    return this.contentMap_[id] || null;\n  }\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null {\n    return this.flyout_;\n  }\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): ISelectableToolboxItem | null {\n    return this.selectedItem_;\n  }\n\n  /**\n   * Gets the previously selected item.\n   *\n   * @returns The previously selected item, or null if no item was previously\n   *     selected.\n   */\n  getPreviouslySelectedItem(): ISelectableToolboxItem | null {\n    return this.previouslySelectedItem_;\n  }\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean {\n    return this.horizontalLayout_;\n  }\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position() {\n    const workspaceMetrics = this.workspace_.getMetrics();\n    const toolboxDiv = this.HtmlDiv;\n    if (!toolboxDiv) {\n      // Not initialized yet.\n      return;\n    }\n\n    if (this.horizontalLayout_) {\n      toolboxDiv.style.left = '0';\n      toolboxDiv.style.height = 'auto';\n      toolboxDiv.style.width = '100%';\n      this.height_ = toolboxDiv.offsetHeight;\n      this.width_ = workspaceMetrics.viewWidth;\n      if (this.toolboxPosition === toolbox.Position.TOP) {\n        toolboxDiv.style.top = '0';\n      } else {\n        // Bottom\n        toolboxDiv.style.bottom = '0';\n      }\n    } else {\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\n        toolboxDiv.style.right = '0';\n      } else {\n        // Left\n        toolboxDiv.style.left = '0';\n      }\n      toolboxDiv.style.height = '100%';\n      this.width_ = toolboxDiv.offsetWidth;\n      this.height_ = workspaceMetrics.viewHeight;\n    }\n    this.flyout_!.position();\n  }\n\n  /**\n   * Handles resizing the toolbox when a toolbox item resizes.\n   *\n   * @internal\n   */\n  handleToolboxItemResize() {\n    // Reposition the workspace so that (0,0) is in the correct position\n    // relative to the new absolute edge (ie toolbox edge).\n    const workspace = this.workspace_;\n    const rect = this.HtmlDiv!.getBoundingClientRect();\n    const newX =\n      this.toolboxPosition === toolbox.Position.LEFT\n        ? workspace.scrollX + rect.width\n        : workspace.scrollX;\n    const newY =\n      this.toolboxPosition === toolbox.Position.TOP\n        ? workspace.scrollY + rect.height\n        : workspace.scrollY;\n    workspace.translate(newX, newY);\n\n    // Even though the div hasn't changed size, the visible workspace\n    // surface of the workspace has, so we may need to reposition everything.\n    common.svgResize(workspace);\n  }\n\n  /** Unhighlights any previously selected item. */\n  clearSelection() {\n    this.setSelectedItem(null);\n  }\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   *\n   * @internal\n   */\n  refreshTheme() {\n    for (let i = 0; i < this.contents_.length; i++) {\n      const child = this.contents_[i];\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\n      const childAsCategory = child as ToolboxCategory;\n      if (childAsCategory.refreshTheme) {\n        childAsCategory.refreshTheme();\n      }\n    }\n  }\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection() {\n    if (\n      this.selectedItem_ &&\n      this.selectedItem_.isSelectable() &&\n      this.selectedItem_.getContents().length\n    ) {\n      this.flyout_!.show(this.selectedItem_.getContents());\n    }\n  }\n\n  /**\n   * Shows or hides the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    if (this.isVisible_ === isVisible) {\n      return;\n    }\n\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\n    this.isVisible_ = isVisible;\n    // Invisible toolbox is ignored as drag targets and must have the drag\n    // target updated.\n    this.workspace_.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    if (!onlyClosePopups && this.flyout_ && this.flyout_.autoClose) {\n      this.clearSelection();\n    }\n  }\n\n  /**\n   * Sets the given item as selected.\n   * No-op if the item is not selectable.\n   *\n   * @param newItem The toolbox item to select.\n   */\n  setSelectedItem(newItem: IToolboxItem | null) {\n    const oldItem = this.selectedItem_;\n\n    if (\n      (!newItem && !oldItem) ||\n      (newItem && !isSelectableToolboxItem(newItem))\n    ) {\n      return;\n    }\n\n    if (this.shouldDeselectItem_(oldItem, newItem) && oldItem !== null) {\n      this.deselectItem_(oldItem);\n    }\n\n    if (this.shouldSelectItem_(oldItem, newItem) && newItem !== null) {\n      this.selectItem_(oldItem, newItem);\n    }\n\n    this.updateFlyout_(oldItem, newItem);\n    this.fireSelectEvent_(oldItem, newItem);\n  }\n\n  /**\n   * Decides whether the old item should be deselected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the old item should be deselected, false otherwise.\n   */\n  protected shouldDeselectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Deselect the old item unless the old item is collapsible and has been\n    // previously clicked on.\n    return (\n      oldItem !== null && (!oldItem.isCollapsible() || oldItem !== newItem)\n    );\n  }\n\n  /**\n   * Decides whether the new item should be selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the new item should be selected, false otherwise.\n   */\n  protected shouldSelectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Select the new item unless the old item equals the new item.\n    return newItem !== null && newItem !== oldItem;\n  }\n\n  /**\n   * Deselects the given item, marks it as unselected, and updates aria state.\n   *\n   * @param item The previously selected toolbox item which should be\n   *     deselected.\n   */\n  protected deselectItem_(item: ISelectableToolboxItem) {\n    this.selectedItem_ = null;\n    this.previouslySelectedItem_ = item;\n    item.setSelected(false);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      '',\n    );\n  }\n\n  /**\n   * Selects the given item, marks it selected, and updates aria state.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected selectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem,\n  ) {\n    this.selectedItem_ = newItem;\n    this.previouslySelectedItem_ = oldItem;\n    newItem.setSelected(true);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      newItem.getId(),\n    );\n  }\n\n  /**\n   * Selects the toolbox item by its position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number) {\n    if (position > -1 && position < this.contents_.length) {\n      const item = this.contents_[position];\n      if (item.isSelectable()) {\n        this.setSelectedItem(item);\n      }\n    }\n  }\n\n  /**\n   * Decides whether to hide or show the flyout depending on the selected item.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected updateFlyout_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    if (\n      !newItem ||\n      (oldItem === newItem && !newItem.isCollapsible()) ||\n      !newItem.getContents().length\n    ) {\n      this.flyout_!.hide();\n    } else {\n      this.flyout_!.show(newItem.getContents());\n      this.flyout_!.scrollToStart();\n    }\n  }\n\n  /**\n   * Emits an event when a new toolbox item is selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  private fireSelectEvent_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    const oldElement = oldItem && oldItem.getName();\n    let newElement = newItem && newItem.getName();\n    // In this case the toolbox closes, so the newElement should be null.\n    if (oldItem === newItem) {\n      newElement = null;\n    }\n    const event = new (eventUtils.get(eventUtils.TOOLBOX_ITEM_SELECT))(\n      oldElement,\n      newElement,\n      this.workspace_.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Closes the current item if it is expanded, or selects the parent.\n   *\n   * @returns True if a parent category was selected, false otherwise.\n   */\n  private selectParent_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    if (\n      this.selectedItem_.isCollapsible() &&\n      (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()\n    ) {\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else if (\n      this.selectedItem_.getParent() &&\n      this.selectedItem_.getParent()!.isSelectable()\n    ) {\n      this.setSelectedItem(this.selectedItem_.getParent());\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Selects the first child of the currently selected item, or nothing if the\n   * toolbox item has no children.\n   *\n   * @returns True if a child category was selected, false otherwise.\n   */\n  private selectChild_(): boolean {\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\n      return false;\n    }\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n    if (!collapsibleItem.isExpanded()) {\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else {\n      this.selectNext_();\n      return true;\n    }\n  }\n\n  /**\n   * Selects the next visible toolbox item.\n   *\n   * @returns True if a next category was selected, false otherwise.\n   */\n  private selectNext_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\n      let nextItem = this.contents_[nextItemIdx];\n      while (nextItem && !nextItem.isSelectable()) {\n        nextItem = this.contents_[++nextItemIdx];\n      }\n      if (nextItem && nextItem.isSelectable()) {\n        this.setSelectedItem(nextItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Selects the previous visible toolbox item.\n   *\n   * @returns True if a previous category was selected, false otherwise.\n   */\n  private selectPrevious_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\n      let prevItem = this.contents_[prevItemIdx];\n      while (prevItem && !prevItem.isSelectable()) {\n        prevItem = this.contents_[--prevItemIdx];\n      }\n      if (prevItem && prevItem.isSelectable()) {\n        this.setSelectedItem(prevItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Disposes of this toolbox. */\n  dispose() {\n    this.workspace_.getComponentManager().removeComponent('toolbox');\n    this.flyout_!.dispose();\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      toolboxItem.dispose();\n    }\n\n    for (let j = 0; j < this.boundEvents_.length; j++) {\n      browserEvents.unbind(this.boundEvents_[j]);\n    }\n    this.boundEvents_ = [];\n    this.contents_ = [];\n\n    if (this.HtmlDiv) {\n      this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);\n      dom.removeNode(this.HtmlDiv);\n    }\n  }\n}\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyToolboxDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n`);\n\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file The entrypoint for blockly_compressed.js.  Provides various\n * backwards-compatibility hacks.  Not used when loading in\n * uncompressed mode.\n */\n\n// Former goog.module ID: Blockly.main\n\nimport * as Blockly from './blockly.js';\nimport * as Msg from './msg.js';\nimport * as colour from './utils/colour.js';\nimport * as deprecation from './utils/deprecation.js';\n\n/*\n * Aliased functions and properties that used to be on the Blockly namespace.\n * Everything in this section is deprecated. Both external and internal code\n * should avoid using these functions and use the designated replacements.\n * Everything in this section will be removed in a future version of Blockly.\n */\n\n// Add accessors for properties on Blockly that have now been deprecated.\n// This will not work in uncompressed mode; it depends on Blockly being\n// transpiled from a ES Module object to a plain object by Closure Compiler.\nObject.defineProperties(Blockly, {\n  /**\n   * The richness of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   *\n   * @name Blockly.HSV_SATURATION\n   * @type {number}\n   * @deprecated Use Blockly.utils.colour.getHsvSaturation() /\n   *     .setHsvSaturation() instead.  (July 2023)\n   * @suppress {checkTypes}\n   */\n  HSV_SATURATION: {\n    get: function () {\n      deprecation.warn(\n        'Blockly.HSV_SATURATION',\n        'version 10',\n        'version 11',\n        'Blockly.utils.colour.getHsvSaturation()',\n      );\n      return colour.getHsvSaturation();\n    },\n    set: function (newValue) {\n      deprecation.warn(\n        'Blockly.HSV_SATURATION',\n        'version 10',\n        'version 11',\n        'Blockly.utils.colour.setHsvSaturation()',\n      );\n      colour.setHsvSaturation(newValue);\n    },\n  },\n  /**\n   * The intensity of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   *\n   * @name Blockly.HSV_VALUE\n   * @type {number}\n   * @deprecated Use Blockly.utils.colour.getHsvValue() / .setHsvValue instead.\n   *     (July 2023)\n   * @suppress {checkTypes}\n   */\n  HSV_VALUE: {\n    get: function () {\n      deprecation.warn(\n        'Blockly.HSV_VALUE',\n        'version 10',\n        'version 11',\n        'Blockly.utils.colour.getHsvValue()',\n      );\n      return colour.getHsvValue();\n    },\n    set: function (newValue) {\n      deprecation.warn(\n        'Blockly.HSV_VALUE',\n        'version 10',\n        'version 11',\n        'Blockly.utils.colour.setHsvValue()',\n      );\n      colour.setHsvValue(newValue);\n    },\n  },\n});\n\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\n// CJS or ES module there will not be a Blockly global variable\n// created.  This can cause problems because a very common way of\n// loading translations is to use a <script> tag to load one of\n// the generated msg/*.js files, which consists of lines like:\n//\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\n//\n// This obviously only works if Blockly.Msg is the Msg export from the\n// Blockly.Msg module - so make sure it is, but only if there is not\n// yet a Blockly global variable.\nif (!('Blockly' in globalThis)) {\n  (globalThis as any)['Blockly'] = {'Msg': Msg};\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.BlocklyOptions\n\nimport type {Theme, ITheme} from './theme.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {ToolboxDefinition} from './utils/toolbox.js';\n\n/**\n * Blockly options.\n */\nexport interface BlocklyOptions {\n  collapse?: boolean;\n  comments?: boolean;\n  css?: boolean;\n  disable?: boolean;\n  grid?: GridOptions;\n  horizontalLayout?: boolean;\n  maxBlocks?: number;\n  maxInstances?: {[blockType: string]: number};\n  media?: string;\n  modalInputs?: boolean;\n  move?: MoveOptions;\n  oneBasedIndex?: boolean;\n  readOnly?: boolean;\n  renderer?: string;\n  rendererOverrides?: {[rendererConstant: string]: any};\n  rtl?: boolean;\n  scrollbars?: ScrollbarOptions | boolean;\n  sounds?: boolean;\n  theme?: Theme | string | ITheme;\n  toolbox?: string | ToolboxDefinition | Element;\n  toolboxPosition?: string;\n  trashcan?: boolean;\n  maxTrashcanContents?: number;\n  plugins?: {[key: string]: (new (...p1: any[]) => any) | string};\n  zoom?: ZoomOptions;\n  parentWorkspace?: WorkspaceSvg;\n}\n\nexport interface GridOptions {\n  colour?: string;\n  length?: number;\n  snap?: boolean;\n  spacing?: number;\n}\n\nexport interface MoveOptions {\n  drag?: boolean;\n  scrollbars?: boolean | ScrollbarOptions;\n  wheel?: boolean;\n}\n\nexport interface ScrollbarOptions {\n  horizontal?: boolean;\n  vertical?: boolean;\n}\n\nexport interface ZoomOptions {\n  controls?: boolean;\n  maxScale?: number;\n  minScale?: number;\n  pinch?: boolean;\n  scaleSpeed?: number;\n  startScale?: number;\n  wheel?: boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.Metrics\n\nexport interface Metrics {\n  /** Height of the visible portion of the workspace. */\n  viewHeight: number;\n\n  /** Width of the visible portion of the workspace. */\n  viewWidth: number;\n\n  /** Height of the content. */\n  contentHeight: number;\n\n  /** Width of the content. */\n  contentWidth: number;\n\n  /** Height of the scroll area. */\n  scrollHeight: number;\n\n  /** Width of the scroll area. */\n  scrollWidth: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the workspace\n   * origin.\n   */\n  viewTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewLeft: number;\n\n  /** Top-edge of the content, relative to the workspace origin. */\n  contentTop: number;\n\n  /** Left-edge of the content relative to the workspace origin. */\n  contentLeft: number;\n\n  /** Top-edge of the scroll area, relative to the workspace origin. */\n  scrollTop: number;\n\n  /** Left-edge of the scroll area relative to the workspace origin. */\n  scrollLeft: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteLeft: number;\n\n  /**\n   * Height of the Blockly div (the view + the toolbox, simple of otherwise).\n   */\n  svgHeight: number;\n\n  /** Width of the Blockly div (the view + the toolbox, simple or otherwise). */\n  svgWidth: number;\n\n  /** Width of the toolbox, if it exists.  Otherwise zero. */\n  toolboxWidth: number;\n\n  /** Height of the toolbox, if it exists.  Otherwise zero. */\n  toolboxHeight: number;\n\n  /** Top, bottom, left or right. Use TOOLBOX_AT constants to compare. */\n  toolboxPosition: number;\n\n  /** Width of the flyout if it is always open.  Otherwise zero. */\n  flyoutWidth: number;\n\n  /** Height of the flyout if it is always open.  Otherwise zero. */\n  flyoutHeight: number;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.IPathObject\n\nimport type {BlockStyle} from '../../theme.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from './constants.js';\nimport {RenderedConnection} from '../../rendered_connection.js';\n\n/**\n * An interface for a block's path object.\n *\n * @param _root The root SVG element.\n * @param _constants The renderer's constants.\n */\nexport interface IPathObject {\n  /**\n   * The primary path of the block.\n   */\n  svgPath: SVGElement;\n\n  /** The renderer's constant provider. */\n  constants: ConstantProvider;\n\n  /** The primary path of the block. */\n  style: BlockStyle;\n\n  /**\n   * Holds the cursors SVG element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null;\n\n  /**\n   * Holds the markers SVG element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null;\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string): void;\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg): void;\n\n  /**\n   * Update the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle): void;\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL(): void;\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement): void;\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement): void;\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  updateHighlighted(highlighted: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enabled: boolean): void;\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   */\n  updateReplacementFade(enabled: boolean): void;\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param enable True if styling should be added.\n   */\n  updateShapeForInputHighlight(conn: RenderedConnection, enable: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolboxItem\n\n/**\n * Interface for an item in the toolbox.\n */\nexport interface IToolboxItem {\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init(): void;\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null;\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string;\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): IToolboxItem | null;\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number;\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean;\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean;\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose(): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element | null;\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  setVisible_(isVisible: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolbox\n\nimport type {IRegistrable} from './i_registrable.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\nimport type {ToolboxInfo} from '../utils/toolbox.js';\nimport type {IFlyout} from './i_flyout.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Interface for a toolbox.\n */\nexport interface IToolbox extends IRegistrable {\n  /** Initializes the toolbox. */\n  init(): void;\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   */\n  render(toolboxDef: ToolboxInfo): void;\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number;\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The height of the toolbox.\n   */\n  getHeight(): number;\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null;\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean;\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position(): void;\n\n  /** Handles resizing the toolbox when a toolbox item resizes. */\n  handleToolboxItemResize(): void;\n\n  /** Unhighlights any previously selected item. */\n  clearSelection(): void;\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   */\n  refreshTheme(): void;\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection(): void;\n\n  /**\n   * Sets the visibility of the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean): void;\n\n  /**\n   * Selects the toolbox item by it's position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number): void;\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): IToolboxItem | null;\n\n  /** Disposes of this toolbox. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IStyleable\n\n/**\n * Interface for an object that a style can be added to.\n */\nexport interface IStyleable {\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   */\n  addStyle(style: string): void;\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   */\n  removeStyle(style: string): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.ISerializer\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Serializes and deserializes a plugin or system.\n */\nexport interface ISerializer {\n  /**\n   * A priority value used to determine the order of deserializing state.\n   * More positive priorities are deserialized before less positive\n   * priorities. Eg if you have priorities (0, -10, 10, 100) the order of\n   * deserialiation will be (100, 10, 0, -10).\n   * If two serializers have the same priority, they are deserialized in an\n   * arbitrary order relative to each other.\n   */\n  priority: number;\n\n  /* eslint-disable no-unused-vars, valid-jsdoc */\n\n  /**\n   * Saves the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to serialize is associated with.\n   * @returns A JS object containing the system's state, or null if there is no\n   *     state to record.\n   */\n  save(workspace: Workspace): Object | null;\n  /* eslint-enable valid-jsdoc */\n\n  /**\n   * Loads the state of the plugin or system.\n   *\n   * @param state The state of the system to deserialize. This will always be\n   *     non-null.\n   * @param workspace The workspace the system to deserialize is associated\n   *     with.\n   */\n  load(state: Object, workspace: Workspace): void;\n\n  /**\n   * Clears the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to clear the state of is\n   *     associated with.\n   */\n  clear(workspace: Workspace): void;\n}\n/* eslint-enable no-unused-vars */\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ISelectable\n\nimport type {IDeletable} from './i_deletable.js';\nimport type {IMovable} from './i_movable.js';\n\n/**\n * The interface for an object that is selectable.\n */\nexport interface ISelectable extends IDeletable, IMovable {\n  id: string;\n\n  /** Select this.  Highlight it visually. */\n  select(): void;\n\n  /** Unselect this.  Unhighlight it visually. */\n  unselect(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IRegistrable\n\n/**\n * The interface for a Blockly component that can be registered.\n */\nexport interface IRegistrable {}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from './i_parameter_model.js';\n\n/**\n * A data model for a procedure.\n */\nexport interface IProcedureModel {\n  /** Sets the human-readable name of the procedure. */\n  setName(name: string): this;\n\n  /**\n   * Inserts a parameter into the list of parameters.\n   *\n   * To move a parameter, first delete it, and then re-insert.\n   */\n  insertParameter(parameterModel: IParameterModel, index: number): this;\n\n  /** Removes the parameter at the given index from the parameter list. */\n  deleteParameter(index: number): this;\n\n  /**\n   * Sets the return type(s) of the procedure.\n   *\n   * Pass null to represent a procedure that does not return.\n   */\n  setReturnTypes(types: string[] | null): this;\n\n  /**\n   * Sets whether this procedure is enabled/disabled. If a procedure is disabled\n   * all procedure caller blocks should be disabled as well.\n   */\n  setEnabled(enabled: boolean): this;\n\n  /** Returns the unique language-neutral ID for the procedure. */\n  getId(): string;\n\n  /** Returns the human-readable name of the procedure. */\n  getName(): string;\n\n  /** Returns the parameter at the given index in the parameter list. */\n  getParameter(index: number): IParameterModel;\n\n  /** Returns an array of all of the parameters in the parameter list. */\n  getParameters(): IParameterModel[];\n\n  /**\n   * Returns the return type(s) of the procedure.\n   *\n   * Null represents a procedure that does not return a value.\n   */\n  getReturnTypes(): string[] | null;\n\n  /**\n   * Returns whether the procedure is enabled/disabled. If a procedure is\n   * disabled, all procedure caller blocks should be disabled as well.\n   */\n  getEnabled(): boolean;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureModel} from './i_procedure_model.js';\n\nexport interface IProcedureMap extends Map<string, IProcedureModel> {\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this;\n\n  /** Returns all of the procedures stored in this map. */\n  getProcedures(): IProcedureModel[];\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Rect} from '../utils/rect.js';\nimport type {UiMetrics} from '../metrics_manager.js';\n// Former goog.module ID: Blockly.IPositionable\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that is positioned on top of the workspace.\n */\nexport interface IPositionable extends IComponent {\n  /**\n   * Positions the element. Called when the window is resized.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]): void;\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureModel} from './i_procedure_model';\n\n/**\n * A data model for a procedure.\n */\nexport interface IParameterModel {\n  /**\n   * Sets the name of this parameter to the given name.\n   */\n  setName(name: string): this;\n\n  /**\n   * Sets the types of this parameter to the given type.\n   */\n  setTypes(types: string[]): this;\n\n  /**\n   * Returns the name of this parameter.\n   */\n  getName(): string;\n\n  /**\n   * Return the types of this parameter.\n   */\n  getTypes(): string[];\n\n  /**\n   * Returns the unique language-neutral ID for the parameter.\n   *\n   * This represents the identify of the variable model which does not change\n   * over time.\n   */\n  getId(): string;\n\n  /** Sets the procedure model this parameter is associated with. */\n  setProcedureModel(model: IProcedureModel): this;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IMovable\n\n/**\n * The interface for an object that is movable.\n */\nexport interface IMovable {\n  /**\n   * Get whether this is movable or not.\n   *\n   * @returns True if movable.\n   */\n  isMovable(): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {\n  ContainerRegion,\n  ToolboxMetrics,\n  AbsoluteMetrics,\n  UiMetrics,\n} from '../metrics_manager.js';\nimport type {Size} from '../utils/size.js';\nimport type {Metrics} from '../utils/metrics.js';\n// Former goog.module ID: Blockly.IMetricsManager\n\n/**\n * Interface for a metrics manager.\n */\nexport interface IMetricsManager {\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean;\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion;\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics;\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link IMetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics;\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size;\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics;\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics;\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {KeyboardShortcut} from '../shortcut_registry.js';\n// Former goog.module ID: Blockly.IKeyboardAccessible\n\n/**\n * An interface for an object that handles keyboard shortcuts.\n */\nexport interface IKeyboardAccessible {\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(shortcut: KeyboardShortcut): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IFlyout\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {FlyoutDefinition} from '../utils/toolbox.js';\nimport type {Svg} from '../utils/svg.js';\nimport type {IRegistrable} from './i_registrable.js';\n\n/**\n * Interface for a flyout.\n */\nexport interface IFlyout extends IRegistrable {\n  /** Whether the flyout is laid out horizontally or not. */\n  horizontalLayout: boolean;\n\n  /** Is RTL vs LTR. */\n  RTL: boolean;\n\n  /** The target workspace */\n  targetWorkspace: WorkspaceSvg | null;\n\n  /** Margin around the edges of the blocks in the flyout. */\n  readonly MARGIN: number;\n\n  /** Does the flyout automatically close when a block is created? */\n  autoClose: boolean;\n\n  /** Corner radius of the flyout background. */\n  readonly CORNER_RADIUS: number;\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own svg element or be a g element nested inside a\n   * separate svg element.\n   *\n   * @param tagName The type of tag to put the flyout in. This should be <svg>\n   *     or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement;\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg): void;\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose(): void;\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number;\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The height of the flyout.\n   */\n  getHeight(): number;\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean;\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean): void;\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean): void;\n\n  /** Hide and empty the flyout. */\n  hide(): void;\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display in the flyout. This is either an array\n   *     of Nodes, a NodeList, a toolbox definition, or a string with the name\n   *     of the dynamic category.\n   */\n  show(flyoutDef: FlyoutDefinition | string): void;\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg;\n\n  /** Reflow blocks and their mats. */\n  reflow(): void;\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or by\n   *     dragging.\n   */\n  isScrollable(): boolean;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  getY(): number;\n\n  /** Position the flyout. */\n  position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *     otherwise.\n   */\n  isBlockCreatable(block: BlockSvg): boolean;\n\n  /** Scroll the flyout to the beginning of its contents. */\n  scrollToStart(): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDraggable\n\nimport type {IDeletable} from './i_deletable.js';\n\n/**\n * The interface for an object that can be dragged.\n */\nexport interface IDraggable extends IDeletable {}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Rect} from '../utils/rect.js';\n\nimport {IDraggable} from './i_draggable.js';\n\n// Former goog.module ID: Blockly.IDragTarget\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component with custom behaviour when a block or bubble is\n * dragged over or dropped on top of it.\n */\nexport interface IDragTarget extends IComponent {\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null;\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDrop(dragElement: IDraggable): void;\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(dragElement: IDraggable): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeleteArea\n\nimport type {IDragTarget} from './i_drag_target.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * Interface for a component that can delete a block or bubble that is dropped\n * on top of it.\n */\nexport interface IDeleteArea extends IDragTarget {\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeletable\n\n/**\n * The interface for an object that can be deleted.\n */\nexport interface IDeletable {\n  /**\n   * Get whether this object is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IContextMenu\n\nexport interface IContextMenu {\n  /**\n   * Show the context menu for this object.\n   *\n   * @param e Mouse event.\n   */\n  showContextMenu(e: Event): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Connection} from '../connection.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\n// Former goog.module ID: Blockly.IConnectionChecker\n\n/**\n * Class for connection type checking logic.\n */\nexport interface IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean;\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number;\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string;\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number;\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean;\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IComponent\n\n/**\n * The interface for a workspace component that can be registered with the\n * ComponentManager.\n */\nexport interface IComponent {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICollapsibleToolboxItem\n\nimport type {ISelectableToolboxItem} from './i_selectable_toolbox_item.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be collapsed.\n */\nexport interface ICollapsibleToolboxItem extends ISelectableToolboxItem {\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[];\n\n  /**\n   * Whether the toolbox item is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean;\n\n  /** Toggles whether or not the toolbox item is expanded. */\n  toggleExpanded(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Coordinate} from '../utils/coordinate.js';\n// Former goog.module ID: Blockly.IBubble\n\nimport type {IContextMenu} from './i_contextmenu.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * A bubble interface.\n */\nexport interface IBubble extends IDraggable, IContextMenu {\n  /**\n   * Return the coordinates of the top-left corner of this bubble's body\n   * relative to the drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate;\n\n  /**\n   * Return the root node of the bubble's SVG group.\n   *\n   * @returns The root SVG node of the bubble's group.\n   */\n  getSvgRoot(): SVGElement;\n\n  /**\n   * Sets whether or not this bubble is being dragged.\n   *\n   * @param adding True if dragging, false otherwise.\n   */\n  setDragging(dragging: boolean): void;\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   */\n  moveDuringDrag(newLoc: Coordinate): void;\n\n  /**\n   * Move the bubble to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   */\n  moveTo(x: number, y: number): void;\n\n  /**\n   * Update the style of this bubble when it is dragged over a delete area.\n   *\n   * @param enable True if the bubble is about to be deleted, false otherwise.\n   */\n  setDeleteStyle(enable: boolean): void;\n\n  /** Dispose of this bubble. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Rect} from '../utils/rect.js';\n// Former goog.module ID: Blockly.IBoundedElement\n\n/**\n * A bounded element interface.\n */\nexport interface IBoundedElement {\n  /**\n   * Returns the coordinates of a bounded element describing the dimensions of\n   * the element. Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounded element.\n   */\n  getBoundingRectangle(): Rect;\n\n  /**\n   * Move the element by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'user', 'bump', 'snap'...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {BlockSvg} from '../block_svg.js';\n// Former goog.module ID: Blockly.IBlockDragger\n\n/**\n * A block dragger interface.\n */\nexport interface IBlockDragger {\n  /**\n   * Start dragging a block.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean): void;\n\n  /**\n   * Execute a step of block dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  drag(e: Event, currentDragDeltaXY: Coordinate): void;\n\n  /**\n   * Finish a block drag and put the block back on the workspace.\n   *\n   * @param e The mouseup/touchend event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  endDrag(e: Event, currentDragDeltaXY: Coordinate): void;\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   */\n  getInsertionMarkers(): BlockSvg[];\n\n  /** Sever all links from this object and do any necessary cleanup. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IAutoHideable\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that can be automatically hidden.\n */\nexport interface IAutoHideable extends IComponent {\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *   Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationWithBlock\n\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\nimport type {Block} from '../block.js';\n\n/**\n * An AST node location that has an associated block.\n */\nexport interface IASTNodeLocationWithBlock extends IASTNodeLocation {\n  /**\n   * Get the source block associated with this node.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block | null;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationSvg\n\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\n\n/**\n * An AST node location SVG interface.\n */\nexport interface IASTNodeLocationSvg extends IASTNodeLocation {\n  /**\n   * Add the marker SVG to this node's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the SVG group.\n   */\n  setMarkerSvg(markerSvg: SVGElement | null): void;\n\n  /**\n   * Add the cursor SVG to this node's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the SVG group.\n   */\n  setCursorSvg(cursorSvg: SVGElement | null): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocation\n\n/**\n * An AST node location interface.\n */\nexport interface IASTNodeLocation {}\n", "/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./blockly_compressed'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./blockly_compressed'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly);\n  }\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly module; just a wrapper for blockly_compressed.js.\n */\n\nreturn Blockly;\n}));\n", "/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./blockly'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./blockly'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly);\n  }\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly core module for the browser. It includes blockly.js\n *               and adds a helper method for setting the locale.\n */\n\n/* eslint-disable */\n'use strict';\n\nreturn Blockly;\n}));\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for colour blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.colour\n\nimport type {Block} from '../../core/block.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {Order} from './javascript_generator.js';\n\nexport function colour_picker(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Colour picker.\n  const code = generator.quote_(block.getFieldValue('COLOUR'));\n  return [code, Order.ATOMIC];\n}\n\nexport function colour_random(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Generate a random colour.\n  const functionName = generator.provideFunction_(\n    'colourRandom',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * Math.pow(2, 24));\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`,\n  );\n  const code = functionName + '()';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function colour_rgb(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Compose a colour from RGB components expressed as percentages.\n  const red = generator.valueToCode(block, 'RED', Order.NONE) || 0;\n  const green = generator.valueToCode(block, 'GREEN', Order.NONE) || 0;\n  const blue = generator.valueToCode(block, 'BLUE', Order.NONE) || 0;\n  const functionName = generator.provideFunction_(\n    'colourRgb',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`,\n  );\n  const code = functionName + '(' + red + ', ' + green + ', ' + blue + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function colour_blend(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Blend two colours together.\n  const c1 = generator.valueToCode(block, 'COLOUR1', Order.NONE) || \"'#000000'\";\n  const c2 = generator.valueToCode(block, 'COLOUR2', Order.NONE) || \"'#000000'\";\n  const ratio = generator.valueToCode(block, 'RATIO', Order.NONE) || 0.5;\n  const functionName = generator.provideFunction_(\n    'colourBlend',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`,\n  );\n  const code = functionName + '(' + c1 + ', ' + c2 + ', ' + ratio + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for list blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.lists\n\nimport type {Block} from '../../core/block.js';\nimport type {CreateWithBlock} from '../../blocks/lists.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {NameType} from '../../core/names.js';\nimport {Order} from './javascript_generator.js';\n\nexport function lists_create_empty(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Create an empty list.\n  return ['[]', Order.ATOMIC];\n}\n\nexport function lists_create_with(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Create a list with any number of elements of any type.\n  const createWithBlock = block as CreateWithBlock;\n  const elements = new Array(createWithBlock.itemCount_);\n  for (let i = 0; i < createWithBlock.itemCount_; i++) {\n    elements[i] = generator.valueToCode(block, 'ADD' + i, Order.NONE) || 'null';\n  }\n  const code = '[' + elements.join(', ') + ']';\n  return [code, Order.ATOMIC];\n}\n\nexport function lists_repeat(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Create a list with one element repeated.\n  const functionName = generator.provideFunction_(\n    'listsRepeat',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`,\n  );\n  const element = generator.valueToCode(block, 'ITEM', Order.NONE) || 'null';\n  const repeatCount = generator.valueToCode(block, 'NUM', Order.NONE) || '0';\n  const code = functionName + '(' + element + ', ' + repeatCount + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function lists_length(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // String or array length.\n  const list = generator.valueToCode(block, 'VALUE', Order.MEMBER) || '[]';\n  return [list + '.length', Order.MEMBER];\n}\n\nexport function lists_isEmpty(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Is the string null or array empty?\n  const list = generator.valueToCode(block, 'VALUE', Order.MEMBER) || '[]';\n  return ['!' + list + '.length', Order.LOGICAL_NOT];\n}\n\nexport function lists_indexOf(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Find an item in the list.\n  const operator =\n    block.getFieldValue('END') === 'FIRST' ? 'indexOf' : 'lastIndexOf';\n  const item = generator.valueToCode(block, 'FIND', Order.NONE) || \"''\";\n  const list = generator.valueToCode(block, 'VALUE', Order.MEMBER) || '[]';\n  const code = list + '.' + operator + '(' + item + ')';\n  if (block.workspace.options.oneBasedIndex) {\n    return [code + ' + 1', Order.ADDITION];\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function lists_getIndex(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] | string {\n  // Get element at index.\n  // Note: Until January 2013 this block did not have MODE or WHERE inputs.\n  const mode = block.getFieldValue('MODE') || 'GET';\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const listOrder = where === 'RANDOM' ? Order.NONE : Order.MEMBER;\n  const list = generator.valueToCode(block, 'VALUE', listOrder) || '[]';\n\n  switch (where) {\n    case 'FIRST':\n      if (mode === 'GET') {\n        const code = list + '[0]';\n        return [code, Order.MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.shift()';\n        return [code, Order.MEMBER];\n      } else if (mode === 'REMOVE') {\n        return list + '.shift();\\n';\n      }\n      break;\n    case 'LAST':\n      if (mode === 'GET') {\n        const code = list + '.slice(-1)[0]';\n        return [code, Order.MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.pop()';\n        return [code, Order.MEMBER];\n      } else if (mode === 'REMOVE') {\n        return list + '.pop();\\n';\n      }\n      break;\n    case 'FROM_START': {\n      const at = generator.getAdjusted(block, 'AT');\n      if (mode === 'GET') {\n        const code = list + '[' + at + ']';\n        return [code, Order.MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.splice(' + at + ', 1)[0]';\n        return [code, Order.FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return list + '.splice(' + at + ', 1);\\n';\n      }\n      break;\n    }\n    case 'FROM_END': {\n      const at = generator.getAdjusted(block, 'AT', 1, true);\n      if (mode === 'GET') {\n        const code = list + '.slice(' + at + ')[0]';\n        return [code, Order.FUNCTION_CALL];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.splice(' + at + ', 1)[0]';\n        return [code, Order.FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return list + '.splice(' + at + ', 1);';\n      }\n      break;\n    }\n    case 'RANDOM': {\n      const functionName = generator.provideFunction_(\n        'listsGetRandomItem',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`,\n      );\n      const code = functionName + '(' + list + ', ' + (mode !== 'GET') + ')';\n      if (mode === 'GET' || mode === 'GET_REMOVE') {\n        return [code, Order.FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return code + ';\\n';\n      }\n      break;\n    }\n  }\n  throw Error('Unhandled combination (lists_getIndex).');\n}\n\nexport function lists_setIndex(block: Block, generator: JavascriptGenerator) {\n  // Set element at index.\n  // Note: Until February 2013 this block did not have MODE or WHERE inputs.\n  let list = generator.valueToCode(block, 'LIST', Order.MEMBER) || '[]';\n  const mode = block.getFieldValue('MODE') || 'GET';\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const value = generator.valueToCode(block, 'TO', Order.ASSIGNMENT) || 'null';\n  // Cache non-trivial values to variables to prevent repeated look-ups.\n  // Closure, which accesses and modifies 'list'.\n  function cacheList() {\n    if (list.match(/^\\w+$/)) {\n      return '';\n    }\n    const listVar = generator.nameDB_!.getDistinctName(\n      'tmpList',\n      NameType.VARIABLE,\n    )!;\n    const code = 'var ' + listVar + ' = ' + list + ';\\n';\n    list = listVar;\n    return code;\n  }\n  switch (where) {\n    case 'FIRST':\n      if (mode === 'SET') {\n        return list + '[0] = ' + value + ';\\n';\n      } else if (mode === 'INSERT') {\n        return list + '.unshift(' + value + ');\\n';\n      }\n      break;\n    case 'LAST':\n      if (mode === 'SET') {\n        let code = cacheList();\n        code += list + '[' + list + '.length - 1] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        return list + '.push(' + value + ');\\n';\n      }\n      break;\n    case 'FROM_START': {\n      const at = generator.getAdjusted(block, 'AT');\n      if (mode === 'SET') {\n        return list + '[' + at + '] = ' + value + ';\\n';\n      } else if (mode === 'INSERT') {\n        return list + '.splice(' + at + ', 0, ' + value + ');\\n';\n      }\n      break;\n    }\n    case 'FROM_END': {\n      const at = generator.getAdjusted(\n        block,\n        'AT',\n        1,\n        false,\n        Order.SUBTRACTION,\n      );\n      let code = cacheList();\n      if (mode === 'SET') {\n        code += list + '[' + list + '.length - ' + at + '] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        code +=\n          list +\n          '.splice(' +\n          list +\n          '.length - ' +\n          at +\n          ', 0, ' +\n          value +\n          ');\\n';\n        return code;\n      }\n      break;\n    }\n    case 'RANDOM': {\n      let code = cacheList();\n      const xVar = generator.nameDB_!.getDistinctName(\n        'tmpX',\n        NameType.VARIABLE,\n      );\n      code +=\n        'var ' + xVar + ' = Math.floor(Math.random() * ' + list + '.length);\\n';\n      if (mode === 'SET') {\n        code += list + '[' + xVar + '] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        code += list + '.splice(' + xVar + ', 0, ' + value + ');\\n';\n        return code;\n      }\n      break;\n    }\n  }\n  throw Error('Unhandled combination (lists_setIndex).');\n}\n\n/**\n * Returns an expression calculating the index into a list.\n * @param listName Name of the list, used to calculate length.\n * @param where The method of indexing, selected by dropdown in Blockly\n * @param opt_at The optional offset when indexing from start/end.\n * @returns Index expression.\n */\nconst getSubstringIndex = function (\n  listName: string,\n  where: string,\n  opt_at?: string,\n): string | undefined {\n  if (where === 'FIRST') {\n    return '0';\n  } else if (where === 'FROM_END') {\n    return listName + '.length - 1 - ' + opt_at;\n  } else if (where === 'LAST') {\n    return listName + '.length - 1';\n  } else {\n    return opt_at;\n  }\n};\n\nexport function lists_getSublist(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Get sublist.\n  // Dictionary of WHEREn field choices and their CamelCase equivalents.\n  const wherePascalCase = {\n    'FIRST': 'First',\n    'LAST': 'Last',\n    'FROM_START': 'FromStart',\n    'FROM_END': 'FromEnd',\n  };\n  type WhereOption = keyof typeof wherePascalCase;\n  const list = generator.valueToCode(block, 'LIST', Order.MEMBER) || '[]';\n  const where1 = block.getFieldValue('WHERE1') as WhereOption;\n  const where2 = block.getFieldValue('WHERE2') as WhereOption;\n  let code;\n  if (where1 === 'FIRST' && where2 === 'LAST') {\n    code = list + '.slice(0)';\n  } else if (\n    list.match(/^\\w+$/) ||\n    (where1 !== 'FROM_END' && where2 === 'FROM_START')\n  ) {\n    // If the list is a variable or doesn't require a call for length, don't\n    // generate a helper function.\n    let at1;\n    switch (where1) {\n      case 'FROM_START':\n        at1 = generator.getAdjusted(block, 'AT1');\n        break;\n      case 'FROM_END':\n        at1 = generator.getAdjusted(block, 'AT1', 1, false, Order.SUBTRACTION);\n        at1 = list + '.length - ' + at1;\n        break;\n      case 'FIRST':\n        at1 = '0';\n        break;\n      default:\n        throw Error('Unhandled option (lists_getSublist).');\n    }\n    let at2;\n    switch (where2) {\n      case 'FROM_START':\n        at2 = generator.getAdjusted(block, 'AT2', 1);\n        break;\n      case 'FROM_END':\n        at2 = generator.getAdjusted(block, 'AT2', 0, false, Order.SUBTRACTION);\n        at2 = list + '.length - ' + at2;\n        break;\n      case 'LAST':\n        at2 = list + '.length';\n        break;\n      default:\n        throw Error('Unhandled option (lists_getSublist).');\n    }\n    code = list + '.slice(' + at1 + ', ' + at2 + ')';\n  } else {\n    const at1 = generator.getAdjusted(block, 'AT1');\n    const at2 = generator.getAdjusted(block, 'AT2');\n    // The value for 'FROM_END' and'FROM_START' depends on `at` so\n    // we add it as a parameter.\n    const at1Param =\n      where1 === 'FROM_END' || where1 === 'FROM_START' ? ', at1' : '';\n    const at2Param =\n      where2 === 'FROM_END' || where2 === 'FROM_START' ? ', at2' : '';\n    const functionName = generator.provideFunction_(\n      'subsequence' + wherePascalCase[where1] + wherePascalCase[where2],\n      `\nfunction ${\n        generator.FUNCTION_NAME_PLACEHOLDER_\n      }(sequence${at1Param}${at2Param}) {\n  var start = ${getSubstringIndex('sequence', where1, 'at1')};\n  var end = ${getSubstringIndex('sequence', where2, 'at2')} + 1;\n  return sequence.slice(start, end);\n}\n`,\n    );\n    code =\n      functionName +\n      '(' +\n      list +\n      // The value for 'FROM_END' and 'FROM_START' depends on `at` so we\n      // pass it.\n      (where1 === 'FROM_END' || where1 === 'FROM_START' ? ', ' + at1 : '') +\n      (where2 === 'FROM_END' || where2 === 'FROM_START' ? ', ' + at2 : '') +\n      ')';\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function lists_sort(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Block for sorting a list.\n  const list =\n    generator.valueToCode(block, 'LIST', Order.FUNCTION_CALL) || '[]';\n  const direction = block.getFieldValue('DIRECTION') === '1' ? 1 : -1;\n  const type = block.getFieldValue('TYPE');\n  const getCompareFunctionName = generator.provideFunction_(\n    'listsGetSortCompare',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return String(a) > String(b) ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `,\n  );\n  return [\n    list +\n      '.slice().sort(' +\n      getCompareFunctionName +\n      '(\"' +\n      type +\n      '\", ' +\n      direction +\n      '))',\n    Order.FUNCTION_CALL,\n  ];\n}\n\nexport function lists_split(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Block for splitting text into a list, or joining a list into text.\n  let input = generator.valueToCode(block, 'INPUT', Order.MEMBER);\n  const delimiter = generator.valueToCode(block, 'DELIM', Order.NONE) || \"''\";\n  const mode = block.getFieldValue('MODE');\n  let functionName;\n  if (mode === 'SPLIT') {\n    if (!input) {\n      input = \"''\";\n    }\n    functionName = 'split';\n  } else if (mode === 'JOIN') {\n    if (!input) {\n      input = '[]';\n    }\n    functionName = 'join';\n  } else {\n    throw Error('Unknown mode: ' + mode);\n  }\n  const code = input + '.' + functionName + '(' + delimiter + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function lists_reverse(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Block for reversing a list.\n  const list =\n    generator.valueToCode(block, 'LIST', Order.FUNCTION_CALL) || '[]';\n  const code = list + '.slice().reverse()';\n  return [code, Order.FUNCTION_CALL];\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for logic blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.logic\n\nimport type {Block} from '../../core/block.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {Order} from './javascript_generator.js';\n\nexport function controls_if(block: Block, generator: JavascriptGenerator) {\n  // If/elseif/else condition.\n  let n = 0;\n  let code = '';\n  if (generator.STATEMENT_PREFIX) {\n    // Automatic prefix insertion is switched off for this block.  Add manually.\n    code += generator.injectId(generator.STATEMENT_PREFIX, block);\n  }\n  do {\n    const conditionCode =\n      generator.valueToCode(block, 'IF' + n, Order.NONE) || 'false';\n    let branchCode = generator.statementToCode(block, 'DO' + n);\n    if (generator.STATEMENT_SUFFIX) {\n      branchCode =\n        generator.prefixLines(\n          generator.injectId(generator.STATEMENT_SUFFIX, block),\n          generator.INDENT,\n        ) + branchCode;\n    }\n    code +=\n      (n > 0 ? ' else ' : '') +\n      'if (' +\n      conditionCode +\n      ') {\\n' +\n      branchCode +\n      '}';\n    n++;\n  } while (block.getInput('IF' + n));\n\n  if (block.getInput('ELSE') || generator.STATEMENT_SUFFIX) {\n    let branchCode = generator.statementToCode(block, 'ELSE');\n    if (generator.STATEMENT_SUFFIX) {\n      branchCode =\n        generator.prefixLines(\n          generator.injectId(generator.STATEMENT_SUFFIX, block),\n          generator.INDENT,\n        ) + branchCode;\n    }\n    code += ' else {\\n' + branchCode + '}';\n  }\n  return code + '\\n';\n}\n\nexport const controls_ifelse = controls_if;\n\nexport function logic_compare(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Comparison operator.\n  const OPERATORS = {\n    'EQ': '==',\n    'NEQ': '!=',\n    'LT': '<',\n    'LTE': '<=',\n    'GT': '>',\n    'GTE': '>=',\n  };\n  type OperatorOption = keyof typeof OPERATORS;\n  const operator = OPERATORS[block.getFieldValue('OP') as OperatorOption];\n  const order =\n    operator === '==' || operator === '!=' ? Order.EQUALITY : Order.RELATIONAL;\n  const argument0 = generator.valueToCode(block, 'A', order) || '0';\n  const argument1 = generator.valueToCode(block, 'B', order) || '0';\n  const code = argument0 + ' ' + operator + ' ' + argument1;\n  return [code, order];\n}\n\nexport function logic_operation(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Operations 'and', 'or'.\n  const operator = block.getFieldValue('OP') === 'AND' ? '&&' : '||';\n  const order = operator === '&&' ? Order.LOGICAL_AND : Order.LOGICAL_OR;\n  let argument0 = generator.valueToCode(block, 'A', order);\n  let argument1 = generator.valueToCode(block, 'B', order);\n  if (!argument0 && !argument1) {\n    // If there are no arguments, then the return value is false.\n    argument0 = 'false';\n    argument1 = 'false';\n  } else {\n    // Single missing arguments have no effect on the return value.\n    const defaultArgument = operator === '&&' ? 'true' : 'false';\n    if (!argument0) {\n      argument0 = defaultArgument;\n    }\n    if (!argument1) {\n      argument1 = defaultArgument;\n    }\n  }\n  const code = argument0 + ' ' + operator + ' ' + argument1;\n  return [code, order];\n}\n\nexport function logic_negate(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Negation.\n  const order = Order.LOGICAL_NOT;\n  const argument0 = generator.valueToCode(block, 'BOOL', order) || 'true';\n  const code = '!' + argument0;\n  return [code, order];\n}\n\nexport function logic_boolean(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Boolean values true and false.\n  const code = block.getFieldValue('BOOL') === 'TRUE' ? 'true' : 'false';\n  return [code, Order.ATOMIC];\n}\n\nexport function logic_null(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Null data type.\n  return ['null', Order.ATOMIC];\n}\n\nexport function logic_ternary(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Ternary operator.\n  const value_if =\n    generator.valueToCode(block, 'IF', Order.CONDITIONAL) || 'false';\n  const value_then =\n    generator.valueToCode(block, 'THEN', Order.CONDITIONAL) || 'null';\n  const value_else =\n    generator.valueToCode(block, 'ELSE', Order.CONDITIONAL) || 'null';\n  const code = value_if + ' ? ' + value_then + ' : ' + value_else;\n  return [code, Order.CONDITIONAL];\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for loop blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.loops\n\nimport * as stringUtils from '../../core/utils/string.js';\nimport type {Block} from '../../core/block.js';\nimport type {ControlFlowInLoopBlock} from '../../blocks/loops.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {NameType} from '../../core/names.js';\nimport {Order} from './javascript_generator.js';\n\nexport function controls_repeat_ext(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Repeat n times.\n  let repeats;\n  if (block.getField('TIMES')) {\n    // Internal number.\n    repeats = String(Number(block.getFieldValue('TIMES')));\n  } else {\n    // External number.\n    repeats = generator.valueToCode(block, 'TIMES', Order.ASSIGNMENT) || '0';\n  }\n  let branch = generator.statementToCode(block, 'DO');\n  branch = generator.addLoopTrap(branch, block);\n  let code = '';\n  const loopVar = generator.nameDB_!.getDistinctName(\n    'count',\n    NameType.VARIABLE,\n  );\n  let endVar = repeats;\n  if (!repeats.match(/^\\w+$/) && !stringUtils.isNumber(repeats)) {\n    endVar = generator.nameDB_!.getDistinctName(\n      'repeat_end',\n      NameType.VARIABLE,\n    );\n    code += 'var ' + endVar + ' = ' + repeats + ';\\n';\n  }\n  code +=\n    'for (var ' +\n    loopVar +\n    ' = 0; ' +\n    loopVar +\n    ' < ' +\n    endVar +\n    '; ' +\n    loopVar +\n    '++) {\\n' +\n    branch +\n    '}\\n';\n  return code;\n}\n\nexport const controls_repeat = controls_repeat_ext;\n\nexport function controls_whileUntil(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Do while/until loop.\n  const until = block.getFieldValue('MODE') === 'UNTIL';\n  let argument0 =\n    generator.valueToCode(\n      block,\n      'BOOL',\n      until ? Order.LOGICAL_NOT : Order.NONE,\n    ) || 'false';\n  let branch = generator.statementToCode(block, 'DO');\n  branch = generator.addLoopTrap(branch, block);\n  if (until) {\n    argument0 = '!' + argument0;\n  }\n  return 'while (' + argument0 + ') {\\n' + branch + '}\\n';\n}\n\nexport function controls_for(block: Block, generator: JavascriptGenerator) {\n  // For loop.\n  const variable0 = generator.getVariableName(block.getFieldValue('VAR'));\n  const argument0 =\n    generator.valueToCode(block, 'FROM', Order.ASSIGNMENT) || '0';\n  const argument1 = generator.valueToCode(block, 'TO', Order.ASSIGNMENT) || '0';\n  const increment = generator.valueToCode(block, 'BY', Order.ASSIGNMENT) || '1';\n  let branch = generator.statementToCode(block, 'DO');\n  branch = generator.addLoopTrap(branch, block);\n  let code;\n  if (\n    stringUtils.isNumber(argument0) &&\n    stringUtils.isNumber(argument1) &&\n    stringUtils.isNumber(increment)\n  ) {\n    // All arguments are simple numbers.\n    const up = Number(argument0) <= Number(argument1);\n    code =\n      'for (' +\n      variable0 +\n      ' = ' +\n      argument0 +\n      '; ' +\n      variable0 +\n      (up ? ' <= ' : ' >= ') +\n      argument1 +\n      '; ' +\n      variable0;\n    const step = Math.abs(Number(increment));\n    if (step === 1) {\n      code += up ? '++' : '--';\n    } else {\n      code += (up ? ' += ' : ' -= ') + step;\n    }\n    code += ') {\\n' + branch + '}\\n';\n  } else {\n    code = '';\n    // Cache non-trivial values to variables to prevent repeated look-ups.\n    let startVar = argument0;\n    if (!argument0.match(/^\\w+$/) && !stringUtils.isNumber(argument0)) {\n      startVar = generator.nameDB_!.getDistinctName(\n        variable0 + '_start',\n        NameType.VARIABLE,\n      );\n      code += 'var ' + startVar + ' = ' + argument0 + ';\\n';\n    }\n    let endVar = argument1;\n    if (!argument1.match(/^\\w+$/) && !stringUtils.isNumber(argument1)) {\n      endVar = generator.nameDB_!.getDistinctName(\n        variable0 + '_end',\n        NameType.VARIABLE,\n      );\n      code += 'var ' + endVar + ' = ' + argument1 + ';\\n';\n    }\n    // Determine loop direction at start, in case one of the bounds\n    // changes during loop execution.\n    const incVar = generator.nameDB_!.getDistinctName(\n      variable0 + '_inc',\n      NameType.VARIABLE,\n    );\n    code += 'var ' + incVar + ' = ';\n    if (stringUtils.isNumber(increment)) {\n      code += Math.abs(Number(increment)) + ';\\n';\n    } else {\n      code += 'Math.abs(' + increment + ');\\n';\n    }\n    code += 'if (' + startVar + ' > ' + endVar + ') {\\n';\n    code += generator.INDENT + incVar + ' = -' + incVar + ';\\n';\n    code += '}\\n';\n    code +=\n      'for (' +\n      variable0 +\n      ' = ' +\n      startVar +\n      '; ' +\n      incVar +\n      ' >= 0 ? ' +\n      variable0 +\n      ' <= ' +\n      endVar +\n      ' : ' +\n      variable0 +\n      ' >= ' +\n      endVar +\n      '; ' +\n      variable0 +\n      ' += ' +\n      incVar +\n      ') {\\n' +\n      branch +\n      '}\\n';\n  }\n  return code;\n}\n\nexport function controls_forEach(block: Block, generator: JavascriptGenerator) {\n  // For each loop.\n  const variable0 = generator.getVariableName(block.getFieldValue('VAR'));\n  const argument0 =\n    generator.valueToCode(block, 'LIST', Order.ASSIGNMENT) || '[]';\n  let branch = generator.statementToCode(block, 'DO');\n  branch = generator.addLoopTrap(branch, block);\n  let code = '';\n  // Cache non-trivial values to variables to prevent repeated look-ups.\n  let listVar = argument0;\n  if (!argument0.match(/^\\w+$/)) {\n    listVar = generator.nameDB_!.getDistinctName(\n      variable0 + '_list',\n      NameType.VARIABLE,\n    );\n    code += 'var ' + listVar + ' = ' + argument0 + ';\\n';\n  }\n  const indexVar = generator.nameDB_!.getDistinctName(\n    variable0 + '_index',\n    NameType.VARIABLE,\n  );\n  branch =\n    generator.INDENT +\n    variable0 +\n    ' = ' +\n    listVar +\n    '[' +\n    indexVar +\n    '];\\n' +\n    branch;\n  code += 'for (var ' + indexVar + ' in ' + listVar + ') {\\n' + branch + '}\\n';\n  return code;\n}\n\nexport function controls_flow_statements(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Flow statements: continue, break.\n  let xfix = '';\n  if (generator.STATEMENT_PREFIX) {\n    // Automatic prefix insertion is switched off for this block.  Add manually.\n    xfix += generator.injectId(generator.STATEMENT_PREFIX, block);\n  }\n  if (generator.STATEMENT_SUFFIX) {\n    // Inject any statement suffix here since the regular one at the end\n    // will not get executed if the break/continue is triggered.\n    xfix += generator.injectId(generator.STATEMENT_SUFFIX, block);\n  }\n  if (generator.STATEMENT_PREFIX) {\n    const loop = (block as ControlFlowInLoopBlock).getSurroundLoop();\n    if (loop && !loop.suppressPrefixSuffix) {\n      // Inject loop's statement prefix here since the regular one at the end\n      // of the loop will not get executed if 'continue' is triggered.\n      // In the case of 'break', a prefix is needed due to the loop's suffix.\n      xfix += generator.injectId(generator.STATEMENT_PREFIX, loop);\n    }\n  }\n  switch (block.getFieldValue('FLOW')) {\n    case 'BREAK':\n      return xfix + 'break;\\n';\n    case 'CONTINUE':\n      return xfix + 'continue;\\n';\n  }\n  throw Error('Unknown flow statement.');\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for math blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.math\n\nimport type {Block} from '../../core/block.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {Order} from './javascript_generator.js';\n\nexport function math_number(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Numeric value.\n  const number = Number(block.getFieldValue('NUM'));\n  const order = number >= 0 ? Order.ATOMIC : Order.UNARY_NEGATION;\n  return [String(number), order];\n}\n\nexport function math_arithmetic(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Basic arithmetic operators, and power.\n  const OPERATORS: Record<string, [string | null, Order]> = {\n    'ADD': [' + ', Order.ADDITION],\n    'MINUS': [' - ', Order.SUBTRACTION],\n    'MULTIPLY': [' * ', Order.MULTIPLICATION],\n    'DIVIDE': [' / ', Order.DIVISION],\n    'POWER': [null, Order.NONE], // Handle power separately.\n  };\n  type OperatorOption = keyof typeof OPERATORS;\n  const tuple = OPERATORS[block.getFieldValue('OP') as OperatorOption];\n  const operator = tuple[0];\n  const order = tuple[1];\n  const argument0 = generator.valueToCode(block, 'A', order) || '0';\n  const argument1 = generator.valueToCode(block, 'B', order) || '0';\n  let code;\n  // Power in JavaScript requires a special case since it has no operator.\n  if (!operator) {\n    code = 'Math.pow(' + argument0 + ', ' + argument1 + ')';\n    return [code, Order.FUNCTION_CALL];\n  }\n  code = argument0 + operator + argument1;\n  return [code, order];\n}\n\nexport function math_single(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Math operators with single operand.\n  const operator = block.getFieldValue('OP');\n  let code;\n  let arg;\n  if (operator === 'NEG') {\n    // Negation is a special case given its different operator precedence.\n    arg = generator.valueToCode(block, 'NUM', Order.UNARY_NEGATION) || '0';\n    if (arg[0] === '-') {\n      // --3 is not legal in JS.\n      arg = ' ' + arg;\n    }\n    code = '-' + arg;\n    return [code, Order.UNARY_NEGATION];\n  }\n  if (operator === 'SIN' || operator === 'COS' || operator === 'TAN') {\n    arg = generator.valueToCode(block, 'NUM', Order.DIVISION) || '0';\n  } else {\n    arg = generator.valueToCode(block, 'NUM', Order.NONE) || '0';\n  }\n  // First, handle cases which generate values that don't need parentheses\n  // wrapping the code.\n  switch (operator) {\n    case 'ABS':\n      code = 'Math.abs(' + arg + ')';\n      break;\n    case 'ROOT':\n      code = 'Math.sqrt(' + arg + ')';\n      break;\n    case 'LN':\n      code = 'Math.log(' + arg + ')';\n      break;\n    case 'EXP':\n      code = 'Math.exp(' + arg + ')';\n      break;\n    case 'POW10':\n      code = 'Math.pow(10,' + arg + ')';\n      break;\n    case 'ROUND':\n      code = 'Math.round(' + arg + ')';\n      break;\n    case 'ROUNDUP':\n      code = 'Math.ceil(' + arg + ')';\n      break;\n    case 'ROUNDDOWN':\n      code = 'Math.floor(' + arg + ')';\n      break;\n    case 'SIN':\n      code = 'Math.sin(' + arg + ' / 180 * Math.PI)';\n      break;\n    case 'COS':\n      code = 'Math.cos(' + arg + ' / 180 * Math.PI)';\n      break;\n    case 'TAN':\n      code = 'Math.tan(' + arg + ' / 180 * Math.PI)';\n      break;\n  }\n  if (code) {\n    return [code, Order.FUNCTION_CALL];\n  }\n  // Second, handle cases which generate values that may need parentheses\n  // wrapping the code.\n  switch (operator) {\n    case 'LOG10':\n      code = 'Math.log(' + arg + ') / Math.log(10)';\n      break;\n    case 'ASIN':\n      code = 'Math.asin(' + arg + ') / Math.PI * 180';\n      break;\n    case 'ACOS':\n      code = 'Math.acos(' + arg + ') / Math.PI * 180';\n      break;\n    case 'ATAN':\n      code = 'Math.atan(' + arg + ') / Math.PI * 180';\n      break;\n    default:\n      throw Error('Unknown math operator: ' + operator);\n  }\n  return [code, Order.DIVISION];\n}\n\nexport function math_constant(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Constants: PI, E, the Golden Ratio, sqrt(2), 1/sqrt(2), INFINITY.\n  const CONSTANTS: Record<string, [string, Order]> = {\n    'PI': ['Math.PI', Order.MEMBER],\n    'E': ['Math.E', Order.MEMBER],\n    'GOLDEN_RATIO': ['(1 + Math.sqrt(5)) / 2', Order.DIVISION],\n    'SQRT2': ['Math.SQRT2', Order.MEMBER],\n    'SQRT1_2': ['Math.SQRT1_2', Order.MEMBER],\n    'INFINITY': ['Infinity', Order.ATOMIC],\n  };\n  type ConstantOption = keyof typeof CONSTANTS;\n  return CONSTANTS[block.getFieldValue('CONSTANT') as ConstantOption];\n}\n\nexport function math_number_property(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Check if a number is even, odd, prime, whole, positive, or negative\n  // or if it is divisible by certain number. Returns true or false.\n  const PROPERTIES: Record<string, [string | null, Order, Order]> = {\n    'EVEN': [' % 2 === 0', Order.MODULUS, Order.EQUALITY],\n    'ODD': [' % 2 === 1', Order.MODULUS, Order.EQUALITY],\n    'WHOLE': [' % 1 === 0', Order.MODULUS, Order.EQUALITY],\n    'POSITIVE': [' > 0', Order.RELATIONAL, Order.RELATIONAL],\n    'NEGATIVE': [' < 0', Order.RELATIONAL, Order.RELATIONAL],\n    'DIVISIBLE_BY': [null, Order.MODULUS, Order.EQUALITY],\n    'PRIME': [null, Order.NONE, Order.FUNCTION_CALL],\n  };\n  type PropertyOption = keyof typeof PROPERTIES;\n  const dropdownProperty = block.getFieldValue('PROPERTY') as PropertyOption;\n  const [suffix, inputOrder, outputOrder] = PROPERTIES[dropdownProperty];\n  const numberToCheck =\n    generator.valueToCode(block, 'NUMBER_TO_CHECK', inputOrder) || '0';\n  let code;\n  if (dropdownProperty === 'PRIME') {\n    // Prime is a special case as it is not a one-liner test.\n    const functionName = generator.provideFunction_(\n      'mathIsPrime',\n      `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`,\n    );\n    code = functionName + '(' + numberToCheck + ')';\n  } else if (dropdownProperty === 'DIVISIBLE_BY') {\n    const divisor =\n      generator.valueToCode(block, 'DIVISOR', Order.MODULUS) || '0';\n    code = numberToCheck + ' % ' + divisor + ' === 0';\n  } else {\n    code = numberToCheck + suffix;\n  }\n  return [code, outputOrder];\n}\n\nexport function math_change(block: Block, generator: JavascriptGenerator) {\n  // Add to a variable in place.\n  const argument0 =\n    generator.valueToCode(block, 'DELTA', Order.ADDITION) || '0';\n  const varName = generator.getVariableName(block.getFieldValue('VAR'));\n  return (\n    varName +\n    ' = (typeof ' +\n    varName +\n    \" === 'number' ? \" +\n    varName +\n    ' : 0) + ' +\n    argument0 +\n    ';\\n'\n  );\n}\n\n// Rounding functions have a single operand.\nexport const math_round = math_single;\n// Trigonometry functions have a single operand.\nexport const math_trig = math_single;\n\nexport function math_on_list(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Math functions for lists.\n  const func = block.getFieldValue('OP');\n  let list;\n  let code;\n  switch (func) {\n    case 'SUM':\n      list = generator.valueToCode(block, 'LIST', Order.MEMBER) || '[]';\n      code = list + '.reduce(function(x, y) {return x + y;}, 0)';\n      break;\n    case 'MIN':\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = 'Math.min.apply(null, ' + list + ')';\n      break;\n    case 'MAX':\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = 'Math.max.apply(null, ' + list + ')';\n      break;\n    case 'AVERAGE': {\n      // mathMean([null,null,1,3]) === 2.0.\n      const functionName = generator.provideFunction_(\n        'mathMean',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`,\n      );\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'MEDIAN': {\n      // mathMedian([null,null,1,3]) === 2.0.\n      const functionName = generator.provideFunction_(\n        'mathMedian',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`,\n      );\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'MODE': {\n      // As a list of numbers can contain more than one mode,\n      // the returned result is provided as an array.\n      // Mode of [3, 'x', 'x', 1, 1, 2, '3'] -> ['x', 1].\n      const functionName = generator.provideFunction_(\n        'mathModes',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n        modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`,\n      );\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'STD_DEV': {\n      const functionName = generator.provideFunction_(\n        'mathStandardDeviation',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance = variance / n;\n  return Math.sqrt(variance);\n}\n`,\n      );\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'RANDOM': {\n      const functionName = generator.provideFunction_(\n        'mathRandomList',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`,\n      );\n      list = generator.valueToCode(block, 'LIST', Order.NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    default:\n      throw Error('Unknown operator: ' + func);\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function math_modulo(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Remainder computation.\n  const argument0 =\n    generator.valueToCode(block, 'DIVIDEND', Order.MODULUS) || '0';\n  const argument1 =\n    generator.valueToCode(block, 'DIVISOR', Order.MODULUS) || '0';\n  const code = argument0 + ' % ' + argument1;\n  return [code, Order.MODULUS];\n}\n\nexport function math_constrain(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Constrain a number between two limits.\n  const argument0 = generator.valueToCode(block, 'VALUE', Order.NONE) || '0';\n  const argument1 = generator.valueToCode(block, 'LOW', Order.NONE) || '0';\n  const argument2 =\n    generator.valueToCode(block, 'HIGH', Order.NONE) || 'Infinity';\n  const code =\n    'Math.min(Math.max(' +\n    argument0 +\n    ', ' +\n    argument1 +\n    '), ' +\n    argument2 +\n    ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function math_random_int(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Random integer between [X] and [Y].\n  const argument0 = generator.valueToCode(block, 'FROM', Order.NONE) || '0';\n  const argument1 = generator.valueToCode(block, 'TO', Order.NONE) || '0';\n  const functionName = generator.provideFunction_(\n    'mathRandomInt',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`,\n  );\n  const code = functionName + '(' + argument0 + ', ' + argument1 + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function math_random_float(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Random fraction between 0 and 1.\n  return ['Math.random()', Order.FUNCTION_CALL];\n}\n\nexport function math_atan2(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Arctangent of point (X, Y) in degrees from -180 to 180.\n  const argument0 = generator.valueToCode(block, 'X', Order.NONE) || '0';\n  const argument1 = generator.valueToCode(block, 'Y', Order.NONE) || '0';\n  return [\n    'Math.atan2(' + argument1 + ', ' + argument0 + ') / Math.PI * 180',\n    Order.DIVISION,\n  ];\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for procedure blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.procedures\n\nimport type {Block} from '../../core/block.js';\nimport type {IfReturnBlock} from '../../blocks/procedures.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {Order} from './javascript_generator.js';\n\nexport function procedures_defreturn(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Define a procedure with a return value.\n  const funcName = generator.getProcedureName(block.getFieldValue('NAME'));\n  let xfix1 = '';\n  if (generator.STATEMENT_PREFIX) {\n    xfix1 += generator.injectId(generator.STATEMENT_PREFIX, block);\n  }\n  if (generator.STATEMENT_SUFFIX) {\n    xfix1 += generator.injectId(generator.STATEMENT_SUFFIX, block);\n  }\n  if (xfix1) {\n    xfix1 = generator.prefixLines(xfix1, generator.INDENT);\n  }\n  let loopTrap = '';\n  if (generator.INFINITE_LOOP_TRAP) {\n    loopTrap = generator.prefixLines(\n      generator.injectId(generator.INFINITE_LOOP_TRAP, block),\n      generator.INDENT,\n    );\n  }\n  const branch = generator.statementToCode(block, 'STACK');\n  let returnValue = generator.valueToCode(block, 'RETURN', Order.NONE) || '';\n  let xfix2 = '';\n  if (branch && returnValue) {\n    // After executing the function body, revisit this block for the return.\n    xfix2 = xfix1;\n  }\n  if (returnValue) {\n    returnValue = generator.INDENT + 'return ' + returnValue + ';\\n';\n  }\n  const args = [];\n  const variables = block.getVars();\n  for (let i = 0; i < variables.length; i++) {\n    args[i] = generator.getVariableName(variables[i]);\n  }\n  let code =\n    'function ' +\n    funcName +\n    '(' +\n    args.join(', ') +\n    ') {\\n' +\n    xfix1 +\n    loopTrap +\n    branch +\n    xfix2 +\n    returnValue +\n    '}';\n  code = generator.scrub_(block, code);\n  // Add % so as not to collide with helper functions in definitions list.\n  // TODO(#7600): find better approach than casting to any to override\n  // CodeGenerator declaring .definitions protected.\n  (generator as AnyDuringMigration).definitions_['%' + funcName] = code;\n  return null;\n}\n\n// Defining a procedure without a return value uses the same generator as\n// a procedure with a return value.\nexport const procedures_defnoreturn = procedures_defreturn;\n\nexport function procedures_callreturn(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Call a procedure with a return value.\n  const funcName = generator.getProcedureName(block.getFieldValue('NAME'));\n  const args = [];\n  const variables = block.getVars();\n  for (let i = 0; i < variables.length; i++) {\n    args[i] = generator.valueToCode(block, 'ARG' + i, Order.NONE) || 'null';\n  }\n  const code = funcName + '(' + args.join(', ') + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function procedures_callnoreturn(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Call a procedure with no return value.\n  // Generated code is for a function call as a statement is the same as a\n  // function call as a value, with the addition of line ending.\n  const tuple = generator.forBlock['procedures_callreturn'](\n    block,\n    generator,\n  ) as [string, Order];\n  return tuple[0] + ';\\n';\n}\n\nexport function procedures_ifreturn(\n  block: Block,\n  generator: JavascriptGenerator,\n) {\n  // Conditionally return value from a procedure.\n  const condition =\n    generator.valueToCode(block, 'CONDITION', Order.NONE) || 'false';\n  let code = 'if (' + condition + ') {\\n';\n  if (generator.STATEMENT_SUFFIX) {\n    // Inject any statement suffix here since the regular one at the end\n    // will not get executed if the return is triggered.\n    code += generator.prefixLines(\n      generator.injectId(generator.STATEMENT_SUFFIX, block),\n      generator.INDENT,\n    );\n  }\n  if ((block as IfReturnBlock).hasReturnValue_) {\n    const value = generator.valueToCode(block, 'VALUE', Order.NONE) || 'null';\n    code += generator.INDENT + 'return ' + value + ';\\n';\n  } else {\n    code += generator.INDENT + 'return;\\n';\n  }\n  code += '}\\n';\n  return code;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for text blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.texts\n\nimport type {Block} from '../../core/block.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport type {JoinMutatorBlock} from '../../blocks/text.js';\nimport {Order} from './javascript_generator.js';\n\n/**\n * Regular expression to detect a single-quoted string literal.\n */\nconst strRegExp = /^\\s*'([^']|\\\\')*'\\s*$/;\n\n/**\n * Enclose the provided value in 'String(...)' function.\n * Leave string literals alone.\n * @param value Code evaluating to a value.\n * @returns Array containing code evaluating to a string\n *     and the order of the returned code.[string, number]\n */\nconst forceString = function (value: string): [string, Order] {\n  if (strRegExp.test(value)) {\n    return [value, Order.ATOMIC];\n  }\n  return ['String(' + value + ')', Order.FUNCTION_CALL];\n};\n\n/**\n * Returns an expression calculating the index into a string.\n * @param stringName Name of the string, used to calculate length.\n * @param where The method of indexing, selected by dropdown in Blockly\n * @param opt_at The optional offset when indexing from start/end.\n * @returns Index expression.\n */\nconst getSubstringIndex = function (\n  stringName: string,\n  where: string,\n  opt_at?: string,\n): string | undefined {\n  if (where === 'FIRST') {\n    return '0';\n  } else if (where === 'FROM_END') {\n    return stringName + '.length - 1 - ' + opt_at;\n  } else if (where === 'LAST') {\n    return stringName + '.length - 1';\n  } else {\n    return opt_at;\n  }\n};\n\nexport function text(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Text value.\n  const code = generator.quote_(block.getFieldValue('TEXT'));\n  return [code, Order.ATOMIC];\n}\n\nexport function text_multiline(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Text value.\n  const code = generator.multiline_quote_(block.getFieldValue('TEXT'));\n  const order = code.indexOf('+') !== -1 ? Order.ADDITION : Order.ATOMIC;\n  return [code, order];\n}\n\nexport function text_join(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Create a string made up of any number of elements of any type.\n  const joinBlock = block as JoinMutatorBlock;\n  switch (joinBlock.itemCount_) {\n    case 0:\n      return [\"''\", Order.ATOMIC];\n    case 1: {\n      const element =\n        generator.valueToCode(joinBlock, 'ADD0', Order.NONE) || \"''\";\n      const codeAndOrder = forceString(element);\n      return codeAndOrder;\n    }\n    case 2: {\n      const element0 =\n        generator.valueToCode(joinBlock, 'ADD0', Order.NONE) || \"''\";\n      const element1 =\n        generator.valueToCode(joinBlock, 'ADD1', Order.NONE) || \"''\";\n      const code = forceString(element0)[0] + ' + ' + forceString(element1)[0];\n      return [code, Order.ADDITION];\n    }\n    default: {\n      const elements = new Array(joinBlock.itemCount_);\n      for (let i = 0; i < joinBlock.itemCount_; i++) {\n        elements[i] =\n          generator.valueToCode(joinBlock, 'ADD' + i, Order.NONE) || \"''\";\n      }\n      const code = '[' + elements.join(',') + \"].join('')\";\n      return [code, Order.FUNCTION_CALL];\n    }\n  }\n}\n\nexport function text_append(block: Block, generator: JavascriptGenerator) {\n  // Append to a variable in place.\n  const varName = generator.getVariableName(block.getFieldValue('VAR'));\n  const value = generator.valueToCode(block, 'TEXT', Order.NONE) || \"''\";\n  const code = varName + ' += ' + forceString(value)[0] + ';\\n';\n  return code;\n}\n\nexport function text_length(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // String or array length.\n  const text = generator.valueToCode(block, 'VALUE', Order.MEMBER) || \"''\";\n  return [text + '.length', Order.MEMBER];\n}\n\nexport function text_isEmpty(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Is the string null or array empty?\n  const text = generator.valueToCode(block, 'VALUE', Order.MEMBER) || \"''\";\n  return ['!' + text + '.length', Order.LOGICAL_NOT];\n}\n\nexport function text_indexOf(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Search the text for a substring.\n  const operator =\n    block.getFieldValue('END') === 'FIRST' ? 'indexOf' : 'lastIndexOf';\n  const substring = generator.valueToCode(block, 'FIND', Order.NONE) || \"''\";\n  const text = generator.valueToCode(block, 'VALUE', Order.MEMBER) || \"''\";\n  const code = text + '.' + operator + '(' + substring + ')';\n  // Adjust index if using one-based indices.\n  if (block.workspace.options.oneBasedIndex) {\n    return [code + ' + 1', Order.ADDITION];\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function text_charAt(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Get letter at index.\n  // Note: Until January 2013 this block did not have the WHERE input.\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const textOrder = where === 'RANDOM' ? Order.NONE : Order.MEMBER;\n  const text = generator.valueToCode(block, 'VALUE', textOrder) || \"''\";\n  switch (where) {\n    case 'FIRST': {\n      const code = text + '.charAt(0)';\n      return [code, Order.FUNCTION_CALL];\n    }\n    case 'LAST': {\n      const code = text + '.slice(-1)';\n      return [code, Order.FUNCTION_CALL];\n    }\n    case 'FROM_START': {\n      const at = generator.getAdjusted(block, 'AT');\n      // Adjust index if using one-based indices.\n      const code = text + '.charAt(' + at + ')';\n      return [code, Order.FUNCTION_CALL];\n    }\n    case 'FROM_END': {\n      const at = generator.getAdjusted(block, 'AT', 1, true);\n      const code = text + '.slice(' + at + ').charAt(0)';\n      return [code, Order.FUNCTION_CALL];\n    }\n    case 'RANDOM': {\n      const functionName = generator.provideFunction_(\n        'textRandomLetter',\n        `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`,\n      );\n      const code = functionName + '(' + text + ')';\n      return [code, Order.FUNCTION_CALL];\n    }\n  }\n  throw Error('Unhandled option (text_charAt).');\n}\n\nexport function text_getSubstring(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Dictionary of WHEREn field choices and their CamelCase equivalents. */\n  const wherePascalCase = {\n    'FIRST': 'First',\n    'LAST': 'Last',\n    'FROM_START': 'FromStart',\n    'FROM_END': 'FromEnd',\n  };\n  type WhereOption = keyof typeof wherePascalCase;\n  // Get substring.\n  const where1 = block.getFieldValue('WHERE1') as WhereOption;\n  const where2 = block.getFieldValue('WHERE2') as WhereOption;\n  const requiresLengthCall =\n    where1 !== 'FROM_END' &&\n    where1 !== 'LAST' &&\n    where2 !== 'FROM_END' &&\n    where2 !== 'LAST';\n  const textOrder = requiresLengthCall ? Order.MEMBER : Order.NONE;\n  const text = generator.valueToCode(block, 'STRING', textOrder) || \"''\";\n  let code;\n  if (where1 === 'FIRST' && where2 === 'LAST') {\n    code = text;\n    return [code, Order.NONE];\n  } else if (text.match(/^'?\\w+'?$/) || requiresLengthCall) {\n    // If the text is a variable or literal or doesn't require a call for\n    // length, don't generate a helper function.\n    let at1;\n    switch (where1) {\n      case 'FROM_START':\n        at1 = generator.getAdjusted(block, 'AT1');\n        break;\n      case 'FROM_END':\n        at1 = generator.getAdjusted(block, 'AT1', 1, false, Order.SUBTRACTION);\n        at1 = text + '.length - ' + at1;\n        break;\n      case 'FIRST':\n        at1 = '0';\n        break;\n      default:\n        throw Error('Unhandled option (text_getSubstring).');\n    }\n    let at2;\n    switch (where2) {\n      case 'FROM_START':\n        at2 = generator.getAdjusted(block, 'AT2', 1);\n        break;\n      case 'FROM_END':\n        at2 = generator.getAdjusted(block, 'AT2', 0, false, Order.SUBTRACTION);\n        at2 = text + '.length - ' + at2;\n        break;\n      case 'LAST':\n        at2 = text + '.length';\n        break;\n      default:\n        throw Error('Unhandled option (text_getSubstring).');\n    }\n    code = text + '.slice(' + at1 + ', ' + at2 + ')';\n  } else {\n    const at1 = generator.getAdjusted(block, 'AT1');\n    const at2 = generator.getAdjusted(block, 'AT2');\n    // The value for 'FROM_END' and'FROM_START' depends on `at` so\n    // we add it as a parameter.\n    const at1Param =\n      where1 === 'FROM_END' || where1 === 'FROM_START' ? ', at1' : '';\n    const at2Param =\n      where2 === 'FROM_END' || where2 === 'FROM_START' ? ', at2' : '';\n    const functionName = generator.provideFunction_(\n      'subsequence' + wherePascalCase[where1] + wherePascalCase[where2],\n      `\nfunction ${\n        generator.FUNCTION_NAME_PLACEHOLDER_\n      }(sequence${at1Param}${at2Param}) {\n  var start = ${getSubstringIndex('sequence', where1, 'at1')};\n  var end = ${getSubstringIndex('sequence', where2, 'at2')} + 1;\n  return sequence.slice(start, end);\n}\n`,\n    );\n    code =\n      functionName +\n      '(' +\n      text +\n      // The value for 'FROM_END' and 'FROM_START' depends on `at` so we\n      // pass it.\n      (where1 === 'FROM_END' || where1 === 'FROM_START' ? ', ' + at1 : '') +\n      (where2 === 'FROM_END' || where2 === 'FROM_START' ? ', ' + at2 : '') +\n      ')';\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function text_changeCase(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Change capitalization.\n  const OPERATORS = {\n    'UPPERCASE': '.toUpperCase()',\n    'LOWERCASE': '.toLowerCase()',\n    'TITLECASE': null,\n  };\n  type OperatorOption = keyof typeof OPERATORS;\n  const operator = OPERATORS[block.getFieldValue('CASE') as OperatorOption];\n  const textOrder = operator ? Order.MEMBER : Order.NONE;\n  const text = generator.valueToCode(block, 'TEXT', textOrder) || \"''\";\n  let code;\n  if (operator) {\n    // Upper and lower case are functions built into generator.\n    code = text + operator;\n  } else {\n    // Title case is not a native JavaScript function.  Define one.\n    const functionName = generator.provideFunction_(\n      'textToTitleCase',\n      `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`,\n    );\n    code = functionName + '(' + text + ')';\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function text_trim(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Trim spaces.\n  const OPERATORS = {\n    'LEFT': \".replace(/^[\\\\s\\\\xa0]+/, '')\",\n    'RIGHT': \".replace(/[\\\\s\\\\xa0]+$/, '')\",\n    'BOTH': '.trim()',\n  };\n  type OperatorOption = keyof typeof OPERATORS;\n  const operator = OPERATORS[block.getFieldValue('MODE') as OperatorOption];\n  const text = generator.valueToCode(block, 'TEXT', Order.MEMBER) || \"''\";\n  return [text + operator, Order.FUNCTION_CALL];\n}\n\nexport function text_print(block: Block, generator: JavascriptGenerator) {\n  // Print statement.\n  const msg = generator.valueToCode(block, 'TEXT', Order.NONE) || \"''\";\n  return 'window.alert(' + msg + ');\\n';\n}\n\nexport function text_prompt_ext(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Prompt function.\n  let msg;\n  if (block.getField('TEXT')) {\n    // Internal message.\n    msg = generator.quote_(block.getFieldValue('TEXT'));\n  } else {\n    // External message.\n    msg = generator.valueToCode(block, 'TEXT', Order.NONE) || \"''\";\n  }\n  let code = 'window.prompt(' + msg + ')';\n  const toNumber = block.getFieldValue('TYPE') === 'NUMBER';\n  if (toNumber) {\n    code = 'Number(' + code + ')';\n  }\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport const text_prompt = text_prompt_ext;\n\nexport function text_count(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  const text = generator.valueToCode(block, 'TEXT', Order.NONE) || \"''\";\n  const sub = generator.valueToCode(block, 'SUB', Order.NONE) || \"''\";\n  const functionName = generator.provideFunction_(\n    'textCount',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`,\n  );\n  const code = functionName + '(' + text + ', ' + sub + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function text_replace(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  const text = generator.valueToCode(block, 'TEXT', Order.NONE) || \"''\";\n  const from = generator.valueToCode(block, 'FROM', Order.NONE) || \"''\";\n  const to = generator.valueToCode(block, 'TO', Order.NONE) || \"''\";\n  // The regex escaping code below is taken from the implementation of\n  // goog.string.regExpEscape.\n  const functionName = generator.provideFunction_(\n    'textReplace',\n    `\nfunction ${generator.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\\\[\\\\]{}+?*.$\\\\^|,:#<!\\\\\\\\])/g, '\\\\\\\\$1')\n                 .replace(/\\\\x08/g, '\\\\\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`,\n  );\n  const code = functionName + '(' + text + ', ' + from + ', ' + to + ')';\n  return [code, Order.FUNCTION_CALL];\n}\n\nexport function text_reverse(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  const text = generator.valueToCode(block, 'TEXT', Order.MEMBER) || \"''\";\n  const code = text + \".split('').reverse().join('')\";\n  return [code, Order.FUNCTION_CALL];\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for variable blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.variables\n\nimport type {Block} from '../../core/block.js';\nimport type {JavascriptGenerator} from './javascript_generator.js';\nimport {Order} from './javascript_generator.js';\n\nexport function variables_get(\n  block: Block,\n  generator: JavascriptGenerator,\n): [string, Order] {\n  // Variable getter.\n  const code = generator.getVariableName(block.getFieldValue('VAR'));\n  return [code, Order.ATOMIC];\n}\n\nexport function variables_set(block: Block, generator: JavascriptGenerator) {\n  // Variable setter.\n  const argument0 =\n    generator.valueToCode(block, 'VALUE', Order.ASSIGNMENT) || '0';\n  const varName = generator.getVariableName(block.getFieldValue('VAR'));\n  return varName + ' = ' + argument0 + ';\\n';\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file JavaScript code generator class, including helper methods for\n * generating JavaScript for blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript\n\nimport * as Variables from '../../core/variables.js';\nimport * as stringUtils from '../../core/utils/string.js';\nimport type {Block} from '../../core/block.js';\nimport {CodeGenerator} from '../../core/generator.js';\nimport {Names, NameType} from '../../core/names.js';\nimport type {Workspace} from '../../core/workspace.js';\nimport {inputTypes} from '../../core/inputs/input_types.js';\n\n/**\n * Order of operation ENUMs.\n * https://developer.mozilla.org/en/JavaScript/Reference/Operators/Operator_Precedence\n */\n// prettier-ignore\nexport enum Order {\n  ATOMIC = 0,            // 0 \"\" ...\n  NEW = 1.1,             // new\n  MEMBER = 1.2,          // . []\n  FUNCTION_CALL = 2,     // ()\n  INCREMENT = 3,         // ++\n  DECREMENT = 3,         // --\n  BITWISE_NOT = 4.1,     // ~\n  UNARY_PLUS = 4.2,      // +\n  UNARY_NEGATION = 4.3,  // -\n  LOGICAL_NOT = 4.4,     // !\n  TYPEOF = 4.5,          // typeof\n  VOID = 4.6,            // void\n  DELETE = 4.7,          // delete\n  AWAIT = 4.8,           // await\n  EXPONENTIATION = 5.0,  // **\n  MULTIPLICATION = 5.1,  // *\n  DIVISION = 5.2,        // /\n  MODULUS = 5.3,         // %\n  SUBTRACTION = 6.1,     // -\n  ADDITION = 6.2,        // +\n  BITWISE_SHIFT = 7,     // << >> >>>\n  RELATIONAL = 8,        // < <= > >=\n  IN = 8,                // in\n  INSTANCEOF = 8,        // instanceof\n  EQUALITY = 9,          // == != === !==\n  BITWISE_AND = 10,      // &\n  BITWISE_XOR = 11,      // ^\n  BITWISE_OR = 12,       // |\n  LOGICAL_AND = 13,      // &&\n  LOGICAL_OR = 14,       // ||\n  CONDITIONAL = 15,      // ?:\n  ASSIGNMENT = 16,       // = += -= **= *= /= %= <<= >>= ...\n  YIELD = 17,            // yield\n  COMMA = 18,            // ,\n  NONE = 99,             // (...)\n}\n\n/**\n * JavaScript code generator class.\n */\nexport class JavascriptGenerator extends CodeGenerator {\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: [Order, Order][] = [\n    // (foo()).bar -> foo().bar\n    // (foo())[0] -> foo()[0]\n    [Order.FUNCTION_CALL, Order.MEMBER],\n    // (foo())() -> foo()()\n    [Order.FUNCTION_CALL, Order.FUNCTION_CALL],\n    // (foo.bar).baz -> foo.bar.baz\n    // (foo.bar)[0] -> foo.bar[0]\n    // (foo[0]).bar -> foo[0].bar\n    // (foo[0])[1] -> foo[0][1]\n    [Order.MEMBER, Order.MEMBER],\n    // (foo.bar)() -> foo.bar()\n    // (foo[0])() -> foo[0]()\n    [Order.MEMBER, Order.FUNCTION_CALL],\n\n    // !(!foo) -> !!foo\n    [Order.LOGICAL_NOT, Order.LOGICAL_NOT],\n    // a * (b * c) -> a * b * c\n    [Order.MULTIPLICATION, Order.MULTIPLICATION],\n    // a + (b + c) -> a + b + c\n    [Order.ADDITION, Order.ADDITION],\n    // a && (b && c) -> a && b && c\n    [Order.LOGICAL_AND, Order.LOGICAL_AND],\n    // a || (b || c) -> a || b || c\n    [Order.LOGICAL_OR, Order.LOGICAL_OR],\n  ];\n\n  /** @param name Name of the language the generator is for. */\n  constructor(name = 'JavaScript') {\n    super(name);\n    this.isInitialized = false;\n\n    // Copy Order values onto instance for backwards compatibility\n    // while ensuring they are not part of the publically-advertised\n    // API.\n    //\n    // TODO(#7085): deprecate these in due course.  (Could initially\n    // replace data properties with get accessors that call\n    // deprecate.warn().)\n    for (const key in Order) {\n      // Must assign Order[key] to a temporary to get the type guard to work;\n      // see https://github.com/microsoft/TypeScript/issues/10530.\n      const value = Order[key];\n      // Skip reverse-lookup entries in the enum.  Due to\n      // https://github.com/microsoft/TypeScript/issues/55713 this (as\n      // of TypeScript 5.5.2) actually narrows the type of value to\n      // never - but that still allows the following assignment to\n      // succeed.\n      if (typeof value === 'string') continue;\n      (this as unknown as Record<string, Order>)['ORDER_' + key] = value;\n    }\n\n    // List of illegal variable names.  This is not intended to be a\n    // security feature.  Blockly is 100% client-side, so bypassing\n    // this list is trivial.  This is intended to prevent users from\n    // accidentally clobbering a built-in object or function.\n    //\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Keywords\n    this.addReservedWords(\n      'break,case,catch,class,const,continue,debugger,default,delete,do,' +\n        'else,export,extends,finally,for,function,if,import,in,instanceof,' +\n        'new,return,super,switch,this,throw,try,typeof,var,void,' +\n        'while,with,yield,' +\n        'enum,' +\n        'implements,interface,let,package,private,protected,public,static,' +\n        'await,' +\n        'null,true,false,' +\n        // Magic variable.\n        'arguments,' +\n        // Everything in the current environment (835 items in Chrome,\n        // 104 in Node).\n        Object.getOwnPropertyNames(globalThis).join(','),\n    );\n  }\n\n  /**\n   * Initialise the database of variable names.\n   *\n   * @param workspace Workspace to generate code from.\n   */\n  init(workspace: Workspace) {\n    super.init(workspace);\n\n    if (!this.nameDB_) {\n      this.nameDB_ = new Names(this.RESERVED_WORDS_);\n    } else {\n      this.nameDB_.reset();\n    }\n\n    this.nameDB_.setVariableMap(workspace.getVariableMap());\n    this.nameDB_.populateVariables(workspace);\n    this.nameDB_.populateProcedures(workspace);\n\n    const defvars = [];\n    // Add developer variables (not created or named by the user).\n    const devVarList = Variables.allDeveloperVariables(workspace);\n    for (let i = 0; i < devVarList.length; i++) {\n      defvars.push(\n        this.nameDB_.getName(devVarList[i], NameType.DEVELOPER_VARIABLE),\n      );\n    }\n\n    // Add user variables, but only ones that are being used.\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      defvars.push(\n        this.nameDB_.getName(variables[i].getId(), NameType.VARIABLE),\n      );\n    }\n\n    // Declare all of the variables.\n    if (defvars.length) {\n      this.definitions_['variables'] = 'var ' + defvars.join(', ') + ';';\n    }\n    this.isInitialized = true;\n  }\n\n  /**\n   * Prepend the generated code with the variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Convert the definitions dictionary into a list.\n    const definitions = Object.values(this.definitions_);\n    // Call Blockly.CodeGenerator's finish.\n    super.finish(code);\n    this.isInitialized = false;\n\n    this.nameDB_!.reset();\n    return definitions.join('\\n\\n') + '\\n\\n\\n' + code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.  A trailing semicolon is needed to make this legal.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    return line + ';\\n';\n  }\n\n  /**\n   * Encode a string as a properly escaped JavaScript string, complete with\n   * quotes.\n   *\n   * @param string Text to encode.\n   * @returns JavaScript string.\n   */\n  quote_(string: string): string {\n    // Can't use goog.string.quote since Google's style guide recommends\n    // JS string literals use single quotes.\n    string = string\n      .replace(/\\\\/g, '\\\\\\\\')\n      .replace(/\\n/g, '\\\\\\n')\n      .replace(/'/g, \"\\\\'\");\n    return \"'\" + string + \"'\";\n  }\n\n  /**\n   * Encode a string as a properly escaped multiline JavaScript string, complete\n   * with quotes.\n   * @param string Text to encode.\n   * @returns JavaScript string.\n   */\n  multiline_quote_(string: string): string {\n    // Can't use goog.string.quote since Google's style guide recommends\n    // JS string literals use single quotes.\n    const lines = string.split(/\\n/g).map(this.quote_);\n    return lines.join(\" + '\\\\n' +\\n\");\n  }\n\n  /**\n   * Common tasks for generating JavaScript from blocks.\n   * Handles comments for the specified block and any connected value blocks.\n   * Calls any statements following this block.\n   *\n   * @param block The current block.\n   * @param code The JavaScript code created for this block.\n   * @param thisOnly True to generate code for only this statement.\n   * @returns JavaScript code with comments and subsequent blocks added.\n   * @protected\n   */\n  scrub_(block: Block, code: string, thisOnly = false): string {\n    let commentCode = '';\n    // Only collect comments for blocks that aren't inline.\n    if (!block.outputConnection || !block.outputConnection.targetConnection) {\n      // Collect comment for this block.\n      let comment = block.getCommentText();\n      if (comment) {\n        comment = stringUtils.wrap(comment, this.COMMENT_WRAP - 3);\n        commentCode += this.prefixLines(comment + '\\n', '// ');\n      }\n      // Collect comments for all value arguments.\n      // Don't collect comments for nested statements.\n      for (let i = 0; i < block.inputList.length; i++) {\n        if (block.inputList[i].type === inputTypes.VALUE) {\n          const childBlock = block.inputList[i].connection!.targetBlock();\n          if (childBlock) {\n            comment = this.allNestedComments(childBlock);\n            if (comment) {\n              commentCode += this.prefixLines(comment, '// ');\n            }\n          }\n        }\n      }\n    }\n    const nextBlock =\n      block.nextConnection && block.nextConnection.targetBlock();\n    const nextCode = thisOnly ? '' : this.blockToCode(nextBlock);\n    return commentCode + code + nextCode;\n  }\n\n  /**\n   * Generate code representing the specified value input, adjusted to take into\n   * account indexing (zero- or one-based) and optionally by a specified delta\n   * and/or by negation.\n   *\n   * @param block The block.\n   * @param atId The ID of the input block to get (and adjust) the value of.\n   * @param delta Value to add.\n   * @param negate Whether to negate the value.\n   * @param order The highest order acting on this value.\n   * @returns The adjusted value or code that evaluates to it.\n   */\n  getAdjusted(\n    block: Block,\n    atId: string,\n    delta = 0,\n    negate = false,\n    order = Order.NONE,\n  ): string {\n    if (block.workspace.options.oneBasedIndex) {\n      delta--;\n    }\n    const defaultAtIndex = block.workspace.options.oneBasedIndex ? '1' : '0';\n\n    let orderForInput = order;\n    if (delta > 0) {\n      orderForInput = Order.ADDITION;\n    } else if (delta < 0) {\n      orderForInput = Order.SUBTRACTION;\n    } else if (negate) {\n      orderForInput = Order.UNARY_NEGATION;\n    }\n\n    let at = this.valueToCode(block, atId, orderForInput) || defaultAtIndex;\n\n    // Easy case: no adjustments.\n    if (delta === 0 && !negate) {\n      return at;\n    }\n    // If the index is a naked number, adjust it right now.\n    if (stringUtils.isNumber(at)) {\n      at = String(Number(at) + delta);\n      if (negate) {\n        at = String(-Number(at));\n      }\n      return at;\n    }\n    // If the index is dynamic, adjust it in code.\n    if (delta > 0) {\n      at = `${at} + ${delta}`;\n    } else if (delta < 0) {\n      at = `${at} - ${-delta}`;\n    }\n    if (negate) {\n      at = delta ? `-(${at})` : `-${at}`;\n    }\n    if (Math.floor(order) >= Math.floor(orderForInput)) {\n      at = `(${at})`;\n    }\n    return at;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Generating JavaScript for dynamic variable blocks.\n */\n\n// Former goog.module ID: Blockly.JavaScript.variablesDynamic\n\n// JavaScript is dynamically typed.\nexport {\n  variables_get as variables_get_dynamic,\n  variables_set as variables_set_dynamic,\n} from './variables.js';\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Instantiate a JavascriptGenerator and populate it with the\n * complete set of block generator functions for JavaScript.  This is\n * the entrypoint for javascript_compressed.js.\n */\n\n// Former goog.module ID: Blockly.JavaScript.all\n\nimport {JavascriptGenerator} from './javascript/javascript_generator.js';\nimport * as colour from './javascript/colour.js';\nimport * as lists from './javascript/lists.js';\nimport * as logic from './javascript/logic.js';\nimport * as loops from './javascript/loops.js';\nimport * as math from './javascript/math.js';\nimport * as procedures from './javascript/procedures.js';\nimport * as text from './javascript/text.js';\nimport * as variables from './javascript/variables.js';\nimport * as variablesDynamic from './javascript/variables_dynamic.js';\n\nexport * from './javascript/javascript_generator.js';\n\n/**\n * JavaScript code generator instance.\n * @type {!JavascriptGenerator}\n */\nexport const javascriptGenerator = new JavascriptGenerator();\n\n// Install per-block-type generator functions:\nconst generators: typeof javascriptGenerator.forBlock = {\n  ...colour,\n  ...lists,\n  ...logic,\n  ...loops,\n  ...math,\n  ...procedures,\n  ...text,\n  ...variables,\n  ...variablesDynamic,\n};\nfor (const name in generators) {\n  javascriptGenerator.forBlock[name] = generators[name];\n}\n", "/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./core', './javascript_compressed.js'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./core'), require('./javascript_compressed.js'));\n  } else { // Browser\n    root.BlocklyJavaScript = factory(root.Blockly, root.BlocklyJavaScript);\n  }\n}(this, function(Blockly, BlocklyJavaScript) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview JavaScript Generator module; just a wrapper for\n *     javascript_compressed.js.\n */\n\nreturn BlocklyJavaScript;\n}));\n"],
  "mappings": "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",
  "names": ["register", "validate", "unregister", "getItem", "hasItem", "getClass", "getObject", "getAllItems", "getClassFromOptions", "getWorkspaceById", "getAllWorkspaces", "registerWorkspace", "unregisterWorkpace", "getMainWorkspace", "setMainWorkspace", "getSelected", "setSelected", "getParentContainer", "setParentContainer", "svgResize", "getBlockTypeCounts", "jsonInitFactory", "defineBlocksWithJsonArray", "defineBlocksWithJsonArrayInternal", "getNextUniqueId", "genUid", "setRecordUndo", "getRecordUndo", "fire", "fireInternal", "fireNow", "filter", "clearPendingUndo", "isEnabled", "setGroupInternal", "getDescendantIds", "fromJson", "get", "disableOrphans", "longStart", "longStop", "clearTouchIdentifier", "shouldHandleEvent", "getTouchIdentifierFromEvent", "checkTouchIdentifier", "conditionalBind", "bind", "unbind", "isTargetInput", "isRightButton", "mouseToSvg", "getScrollDeltaPixels", "removeElem", "inject", "warn", "createSvgElement", "addClass", "removeClasses", "removeClass", "hasClass", "removeNode", "insertAfter", "containsNode", "setCssTransform", "startTextWidthCache", "stopTextWidthCache", "getTextWidth", "getFastTextWidth", "getFastTextWidthWithSizeString", "measureFontMetrics", "getSize", "getSizeInternal", "getSizeWithDisplay", "getComputedStyle", "getPageOffset", "getViewportPageOffset", "getBorderBox", "scrollIntoContainerView", "getContainerOffsetToScrollInto", "getRelativeXY", "getInjectionDivXY", "getViewportBBox", "getDocumentScroll", "screenToWsCoordinates", "wsToScreenCoordinates", "injectDependencies", "domToText", "sanitizeText", "convertToolboxDefToJson", "validateToolbox", "convertFlyoutDefToJsonArray", "hasCategories", "hasCategoriesInternal", "isCategoryCollapsible", "convertToToolboxJson", "xmlToJsonArray", "addAttributes", "parseToolboxTree", "getStartPositionRect", "getCornerOppositeToolbox", "bumpPositionRect", "alert", "setAlert", "confirm", "confirmInternal", "setConfirm", "prompt", "setPrompt", "isVariableBackedParameterModel", "isLegacyProcedureDefBlock", "isLegacyProcedureCallBlock", "flyoutCategory", "flyoutCategoryBlocks", "generateUniqueName", "generateUniqueNameInternal", "generateUniqueNameFromOptions", "createVariableButtonHandler", "promptName", "nameUsedWithOtherType", "nameUsedWithAnyType", "nameUsedWithConflictingParam", "checkForConflictingParamWithProcedureModels", "checkForConflictingParamWithLegacyProcedures", "generateVariableFieldDom", "createVariable", "getAddedVariables", "queueRender", "finishQueuedRenders", "triggerQueuedRenders", "alwaysImmediatelyRender", "queueBlock", "doRenders", "dequeueBlock", "shouldRenderRootBlock", "renderBlock", "workspaceToDom", "variablesToDom", "blockToDomWithXY", "fieldToDom", "allFieldsToDom", "blockToDom", "cloneShadow", "domToPrettyText", "clearWorkspaceAndLoadFromXml", "appendDomToWorkspace", "domToBlockInternal", "domToVariables", "mapSupportedXmlTags", "applyMutationTagNodes", "applyCommentTagNodes", "applyDataTagNodes", "applyFieldTagNodes", "findChildBlocks", "applyInputTagNodes", "applyNextTagNodes", "domToBlockHeadless", "domToField", "deleteNext", "isElement", "isSerializable", "save", "saveAttributes", "saveCoords", "saveExtraState", "saveIcons", "saveFields", "saveInputBlocks", "saveNextBlocks", "saveConnection", "append", "appendInternal", "appendPrivate", "loadCoords", "loadAttributes", "loadExtraState", "tryToConnectParent", "loadIcons", "loadFields", "loadInputBlocks", "loadNextBlocks", "loadConnection", "initBlock", "moveBlockToNotConflict", "blockOverlapsOtherExactly", "blockIsInSnapRadius", "copy", "copyInternal", "paste", "pasteFromData", "duplicate", "duplicateInternal", "setRole", "setState", "getDiv", "testOnly_setDiv", "createDom", "show", "hide", "isVisible", "hideIfOwner", "positionInternal", "positionWithAnchor", "calculateX", "calculateY", "isRepositionable", "repositionForWindowResize", "getCurrentBlock", "setCurrentBlock", "populate_", "position_", "createWidget_", "haltPropagation", "dispose", "commentDeleteOption", "commentDuplicateOption", "workspaceCommentOption", "toRadians", "toDegrees", "clamp", "setBoundsElement", "getOwner", "getContentDiv", "clearContent", "setColour", "showPositionedByBlock", "showPositionedByField", "getScaledBboxOfBlock", "getScaledBboxOfField", "showPositionedByRect", "getPositionBelowMetrics", "getPositionAboveMetrics", "getPositionTopOfPageMetrics", "getPositionX", "hideWithoutAnimation", "disposeUiEffect", "disposeUiStep", "connectionUiEffect", "disconnectUiEffect", "disconnectUiStep", "disconnectUiStop", "startsWith", "shortestStringLength", "commonWordPrefix", "commonWordSuffix", "wrapLine", "wrapScore", "wrapMutate", "wrapToText", "setCustomTooltip", "getCustomTooltip", "getTooltipOfObject", "getTargetObject", "bindMouseEvents", "unbindMouseEvents", "onMouseOver", "onMouseOut", "onMouseMove", "block", "unblock", "renderContent", "renderDefaultContent", "getPosition", "deepMerge", "hasBubble", "getHsvSaturation", "setHsvSaturation", "getHsvValue", "setHsvValue", "parse", "rgbToHex", "hexToRgb", "hsvToHex", "blend", "hueToHex", "tokenizeInterpolationInternal", "tokenizeInterpolation", "replaceMessageReferences", "checkMessageReferences", "parseBlockColour", "isProcedureBlock", "isObservable", "fromJsonInternal", "trimOptions", "applyTrim", "validateOptions", "isRegistered", "apply", "checkNoMutatorProperties", "checkXmlHooks", "checkJsonHooks", "checkMutatorDialog", "checkHasFunctionPair", "checkHasMutatorProperties", "getMutatorProperties", "mutatorPropertiesMatch", "runAfterPageLoad", "checkDropdownOptionsInTable", "extensionParentTooltip", "point", "curve", "moveTo", "moveBy", "lineTo", "line", "lineOnAxis", "arc", "allProcedures", "procTupleComparator", "isLegalName", "isNameUsed", "updateMutatorFlyout", "mutatorOpenListener", "mutatorChangeListener", "getCallers", "blockIsModernCallerFor", "isDynamicShape", "getParentConnection", "connectReciprocally", "getSingleConnection", "getConnectionForOrphanedOutput", "init", "stringButtonClickHandler", "numberButtonClickHandler", "colourButtonClickHandler", "resizeSvgContents", "isCopyable", "registerEscape", "registerDelete", "registerCopy", "registerCut", "registerPaste", "registerUndo", "registerRedo", "registerDefaultShortcuts", "saveProcedure", "saveParameter", "loadProcedure", "loadParameter", "load", "bumpObjectIntoBounds", "bumpIntoBoundsHandler", "extractObjectFromEvent", "bumpTopObjectsIntoBounds", "initIconData", "registerCleanup", "toggleOption_", "registerCollapse", "registerExpand", "addDeletableBlocks_", "getDeletableBlocks_", "deleteNext_", "registerDeleteAll", "registerWorkspaceOptions_", "registerDuplicate", "registerComment", "registerInline", "registerCollapseExpandBlock", "registerDisable", "registerHelp", "registerBlockOptions_", "registerDefaultOptions", "createMainWorkspace", "onKeyDown", "bindDocumentEvents", "loadSounds", "isIcon", "isPaster", "isSelectableToolboxItem", "hideChaff", "isRenderedElement", "type", "name", "registryItem", "opt_allowOverrides", "Type", "trim", "Error", "toLowerCase", "caselessName", "typeRegistry", "typeMap", "nameRegistry", "nameMap", "Object", "create", "String", "FIELD", "console", "opt_throwIfMissing", "msg", "opt_cased", "casedRegistry", "key", "keys", "options", "plugin", "plugins", "DEFAULT", "id", "WorkspaceDB_", "workspaces", "workspaceId", "push", "workspace", "mainWorkspace", "selected", "newSelection", "parentContainer", "newParent", "parentWorkspace", "svg", "getParentSvg", "cachedSize", "getCachedParentSvgSize", "div", "parentElement", "HTMLElement", "width", "offsetWidth", "height", "offsetHeight", "setAttribute", "setCachedParentSvgSize", "resize", "opt_stripFollowing", "typeCountsMap", "descendants", "getDescendants", "nextBlock", "getNextBlock", "index", "indexOf", "splice", "length", "i", "checkBlock", "jsonDef", "jsonInit", "jsonArray", "TEST_ONLY", "defineBlocks", "createBlockDefinitionsFromJsonArray", "blocks", "elem", "definition", "Blocks", "nextId", "toString", "internal", "newValue", "recordUndo", "event", "FIRE_QUEUE", "requestAnimationFrame", "setTimeout", "e", "queue", "eventWorkspace", "fireChangeListener", "workspaceIds", "Set", "map", "undoStack", "getUndoStack", "group", "undefined", "events", "queueIn", "forward", "slice", "reverse", "mergedQueue", "hash", "isNull", "isUiEvent", "UI", "blockId", "join", "lastEntry", "lastEvent", "MOVE", "moveEvent", "newParentId", "newInputName", "newCoordinate", "reason", "reasonSet", "concat", "Array", "from", "CHANGE", "element", "VIEWPORT_CHANGE", "viewportEvent", "viewTop", "viewLeft", "scale", "oldScale", "CLICK", "BUBBLE_OPEN", "unshift", "disable", "disabled", "enable", "getGroup", "setGroup", "state", "ids", "descendant", "json", "eventClass", "eventType", "EVENT", "CREATE", "getBlockById", "initialUndoFlag", "parent", "getParent", "children", "child", "setEnabled", "outputConnection", "previousConnection", "isDragging", "gesture", "longPid_", "handleRightClick", "LONGPRESS", "clearTimeout", "touchIdentifier_", "PointerEvent", "pointerId", "identifier", "node", "thisObject", "func", "opt_noCaptureIdentifier", "wrapFunc", "call", "bindData", "TOUCH_MAP", "addEventListener", "callback", "pop", "removeEventListener", "target", "isContentEditable", "getAttribute", "HTMLInputElement", "HTMLTextAreaElement", "ctrlKey", "MAC", "button", "matrix", "svgPoint", "createSVGPoint", "x", "clientX", "y", "clientY", "getScreenCTM", "inverse", "matrixTransform", "deltaMode", "deltaX", "deltaY", "LINE_MODE_MULTIPLIER", "PAGE_MODE_MULTIPLIER", "arr", "value", "cssContent", "injected", "content", "hasCss", "pathToMedia", "mediaPath", "replace", "cssNode", "document", "createElement", "cssTextNode", "createTextNode", "appendChild", "head", "insertBefore", "firstChild", "deprecationDate", "deletionDate", "opt_use", "attrs", "opt_parent", "createElementNS", "SVG_NS", "className", "classNames", "split", "every", "classList", "contains", "add", "remove", "parentNode", "removeChild", "newNode", "refNode", "siblingNode", "nextSibling", "transform", "style", "cacheReference", "cacheWidths", "textElement", "textContent", "baseVal", "getComputedTextLength", "fontSize", "fontWeight", "fontFamily", "text", "canvasContext", "computeCanvas", "body", "getContext", "font", "measureText", "span", "display", "position", "top", "left", "result", "baseline", "alignItems", "offsetTop", "originalDisplay", "originalVisibility", "visibility", "originalPosition", "Size", "property", "styles", "window", "getPropertyValue", "el", "pos", "Coordinate", "box", "getBoundingClientRect", "documentElement", "scrollCoord", "pageXOffset", "scrollLeft", "pageYOffset", "scrollTop", "parseFloat", "right", "bottom", "Rect", "container", "opt_center", "offset", "elementPos", "containerPos", "containerBorder", "relX", "relY", "elementSize", "spaceX", "clientWidth", "spaceY", "clientHeight", "Math", "min", "max", "xy", "parseInt", "r", "match", "XY_REGEX", "Number", "styleComponents", "XY_STYLE_REGEX", "scrollOffset", "win", "ws", "screenCoordinates", "screenX", "screenY", "boundingRect", "getInjectionDiv", "injectionDiv", "clientOffsetPixels", "mainOffsetPixels", "getOriginOffsetInPixels", "difference", "finalOffsetPixels", "finalOffsetMainWs", "workspaceCoordinates", "mainOffset", "dependencies", "DOMParser", "XMLSerializer", "domParser", "xmlSerializer", "tagName", "NAME_SPACE", "textToDom", "doc", "parseFromString", "getElementsByTagName", "nodeName", "dom", "serializeToString", "INVALID_CONTROL_CHARS", "charCodeAt", "toolboxDef", "Element", "toolboxJson", "toolboxKind", "toolboxContents", "FLYOUT_TOOLBOX_KIND", "CATEGORY_TOOLBOX_KIND", "flyoutDef", "isArray", "nodeType", "item", "toUpperCase", "categories", "categoryInfo", "contents", "Node", "childNodes", "obj", "j", "attributes", "attr", "parsedToolboxDef", "TypeError", "size", "horizontalPadding", "verticalPadding", "metrics", "hasVerticalScrollbar", "scrollbar", "canScrollVertically", "horizontal", "horizontalPosition", "LEFT", "absoluteMetrics", "RTL", "Scrollbar", "scrollbarThickness", "viewMetrics", "vertical", "verticalPosition", "TOP", "canScrollHorizontally", "toolboxMetrics", "Position", "horizontalLayout", "RIGHT", "BOTTOM", "startRect", "margin", "bumpDir", "savedPositions", "otherEl", "intersects", "bumpDirection", "UP", "message", "opt_callback", "alertImplementation", "alertFunction", "confirmImplementation", "confirmFunction", "defaultValue", "promptImplementation", "promptFunction", "param", "getVariableModel", "getProcedureDef", "getProcedureCall", "renameProcedure", "allUsedVarModels", "getAllBlocks", "variables", "blockVariables", "getVarModels", "variable", "getId", "values", "allDeveloperVariables", "getDeveloperVariables", "devVars", "xmlList", "registerButtonCallback", "getTargetWorkspace", "blockList", "variableModelList", "getVariablesOfType", "mostRecentVariable", "sort", "VariableModel", "compareByName", "VAR_LETTER_OPTIONS", "charAt", "getAllVariableNames", "startChar", "usedNames", "letters", "suffix", "letterIndex", "inUse", "potName", "opt_type", "promptAndCheckWithAlert", "defaultName", "Msg", "existing", "renameVariable", "promptText", "newName", "procedure", "renameVariableById", "defaultText", "newVar", "allVariables", "getVariableMap", "getAllVariables", "oldName", "getProcedureMap", "getProcedures", "procedures", "params", "getParameters", "procHasOld", "some", "procHasNew", "getName", "def", "blockHasOld", "blockHasNew", "variableModel", "field", "getOrCreateVariablePackage", "opt_name", "getVariable", "potentialVariableMap", "getPotentialVariableMap", "getVariableById", "isFlyout", "targetWorkspace", "originalVariables", "allCurrentVariables", "addedVariables", "paster", "PASTER", "Promise", "resolve", "afterRendersPromise", "afterRendersResolver", "animationRequestId", "cancelAnimationFrame", "JavaFx", "dirtyBlocks", "rootBlocks", "b", "has", "resizeContents", "blockOrigin", "getRelativeToSurfaceXY", "updateComponentLocations", "delete", "getChildren", "isDisposed", "renderEfficiently", "opt_noId", "treeXml", "variablesElement", "hasChildNodes", "comments", "getTopComments", "comment", "toXmlWithXY", "getTopBlocks", "variableList", "isInsertionMarker", "DocumentFragment", "getWidth", "round", "toXml", "inputList", "input", "fieldRow", "fieldDom", "isShadow", "mutationToDom", "mutation", "hasAttributes", "commentText", "getCommentText", "getIcon", "IconType", "COMMENT", "getBubbleSize", "pinned", "bubbleIsVisible", "commentElement", "data", "dataElement", "empty", "inputTypes", "DUMMY", "END_ROW", "childBlock", "connection", "targetBlock", "VALUE", "STATEMENT", "childShadow", "getShadowDom", "childElem", "NodeType", "ELEMENT_NODE", "inputsInline", "inputsInlineDefault", "isCollapsed", "isDeletable", "isMovable", "isEditable", "nextElem", "nextShadow", "nextConnection", "shadow", "cloneNode", "textNode", "removeAttribute", "TEXT_NODE", "lines", "blob", "indent", "substring", "xml", "setResizesEnabled", "clear", "blockIds", "domToWorkspace", "newBlockIds", "existingGroup", "variablesFirst", "xmlChild", "xmlChildElement", "blockX", "blockY", "isNaN", "rendered", "WorkspaceCommentSvg", "fromXmlRendered", "WorkspaceComment", "fromXml", "FINISHED_LOADING", "getBlocksBoundingBox", "bbox", "farY", "topX", "newLeftX", "Infinity", "newRightX", "newY", "blockXY", "offsetY", "ySeparation", "offsetX", "domToBlock", "xmlBlock", "variablesBeforeCreation", "topBlock", "topBlockSvg", "setConnectionTracking", "initSvg", "disposed", "initModel", "newVariables", "thisVariable", "VAR_CREATE", "xmlVariables", "childNodeMap", "next", "xmlChildren", "shouldCallInitSvg", "domToMutation", "setCommentText", "setBubbleSize", "setBubbleVisible", "xmlNode", "childBlockElement", "childShadowElement", "prototypeName", "getInput", "childBlockInfo", "setShadowDom", "isConnected", "parentConnection", "connectedToParentNext", "outerHTML", "newBlock", "xmlChildNameMap", "connect", "inline", "setInputsInline", "deletable", "setDeletable", "movable", "setMovable", "editable", "setEditable", "collapsed", "setCollapsed", "setShadow", "fieldName", "getField", "saveState", "loadState", "serializer", "SERIALIZER", "addCoordinates", "addInputBlocks", "addNextBlocks", "doFullSerialization", "saveIds", "isOwnDeletable", "isOwnMovable", "isOwnEditable", "extraState", "icons", "icon", "getIcons", "getType", "fields", "inputs", "connectionState", "getShadowState", "prevRecordUndo", "BLOCK_CREATE", "blockSvg", "MissingBlockType", "getSourceBlock", "RealChildOfShadow", "childConnection", "MissingConnection", "connected", "checker", "connectionChecker", "BadConnectionCheck", "getErrorMessage", "canConnectWithReason", "iconTypes", "iconType", "iconState", "constructor", "ICON", "UnregisteredIcon", "addIcon", "fieldState", "inputName", "setShadowState", "onLocationChange", "snapRadius", "config", "coord", "otherCoords", "otherBlock", "sum", "translate", "otherCoord", "abs", "getConnections_", "closest", "toCopy", "toCopyData", "stashedCopyData", "stashedWorkspace", "copyData", "coordinate", "getRootWorkspace", "toDuplicate", "roleName", "ROLE_ATTRIBUTE", "stateName", "ARIA_PREFIX", "containerDiv", "newDiv", "querySelector", "containerClassName", "newOwner", "rtl", "newDispose", "owner", "direction", "rendererClassName", "getRenderer", "getClassName", "themeClassName", "getTheme", "markFocused", "oldOwner", "viewportBBox", "anchorBBox", "widgetSize", "currentBlock", "dummyOwner", "menu", "menu_", "focus", "Menu", "Role", "MENU", "option", "menuItem", "MenuItem", "setRightToLeft", "MENUITEM", "addChild", "enabled", "onAction", "actionHandler", "scope", "menuSize", "menuDom", "render", "preventDefault", "stopPropagation", "callbackFactory", "select", "deleteOption", "duplicateOption", "wsCommentOption", "wsCommentOption.callback", "DEFAULT_SIZE", "finalOffset", "angleDegrees", "PI", "angleRadians", "lowerBound", "number", "upperBound", "temp", "arrow", "opacity", "transition", "ANIMATION_TIME", "boundsElem", "boundsElement", "backgroundColour", "borderColour", "backgroundColor", "borderColor", "opt_onHide", "opt_secondaryYOffset", "positionToField", "getSvgRoot", "scaledHeight", "scaledWidth", "bBox", "getScaledBBox", "primaryX", "primaryY", "secondaryY", "sourceBlock", "secondaryX", "onHide", "renderedClassName", "boundsInfo", "divSize", "xCoords", "initialX", "divX", "initialY", "finalX", "finalY", "PADDING_Y", "arrowX", "arrowY", "ARROW_SIZE", "BORDER_SIZE", "arrowAtTop", "arrowVisible", "sourceX", "boundsLeft", "boundsRight", "divWidth", "relativeArrowX", "horizPadding", "ARROW_HORIZONTAL_PADDING", "divOwner", "opt_withoutAnimation", "animateOutTimer", "getPositionMetrics", "floor", "svgGroup", "getAudioManager", "play", "getSvgXY", "clone", "cloneRect", "Date", "rect", "start", "workspaceScale", "percent", "getTime", "ripple", "Svg", "CIRCLE", "scaleAnimation", "ANIMATE", "opacityAnimation", "beginElement", "getHeightWidth", "magnitude", "atan", "DISPLACEMENT", "wobblingBlock", "DURATION", "skew", "sin", "WIGGLES", "val", "disconnectPid", "getTranslation", "str", "prefix", "array", "reduce", "a", "opt_shortest", "wordPrefix", "len", "letter", "substr", "wrap", "limit", "words", "score", "lastText", "lineCount", "lastScore", "wordBreaks", "steps", "insertedBreaks", "lineLengths", "linePunctuation", "maxLength", "pow", "bestScore", "bestBreaks", "mutatedWordBreaks", "mutatedScore", "isNumber", "test", "customFn", "customTooltip", "visible", "object", "tooltip", "mouseOverWrapper_", "mouseOutWrapper_", "blocked", "newElement", "currentTarget", "poisonedElement", "mouseOutPid", "_e", "showPid", "dx", "lastX", "pageX", "dy", "lastY", "pageY", "sqrt", "RADIUS_OK", "HOVER_MS", "tip", "LIMIT", "windowWidth", "windowHeight", "anchorX", "OFFSET_X", "anchorY", "OFFSET_Y", "scrollY", "MARGINS", "scrollX", "source", "hsvSaturation", "newSaturation", "hsvValue", "hex", "names", "rgb", "g", "colour", "h", "s", "v", "red", "green", "blue", "sextant", "remainder", "val1", "val2", "val3", "colour1", "colour2", "factor", "hex1", "hex2", "rgb1", "rgb2", "hue", "parseInterpolationTokens", "tokenizeNewlines", "tokens", "chars", "buffer", "c", "rawKey", "keyUpper", "bklyKey", "rawValue", "prototype", "mergedTokens", "interpolatedResult", "validSoFar", "msgTable", "m", "msgKey", "dereferenced", "errorMsg", "getProcedureModel", "doProcedureUpdate", "isProcedureDef", "startPublishing", "stopPublishing", "fieldClass", "fieldObject", "hasImages", "trimmedOptions", "label", "alt", "stringLabels", "shortest", "prefixLength", "suffixLength", "foundError", "tuple", "error", "src", "initFn", "allExtensions", "registerMixin", "mixinObj", "mixin", "registerMutator", "opt_helperFn", "opt_blockList", "errorPrefix", "hasMutatorDialog", "setMutator", "MutatorIcon", "isMutator", "extensionFn", "mutatorProperties", "mutationName", "properties", "compose", "decompose", "func1", "func2", "hasXmlHooks", "hasJsonHooks", "oldProperties", "newProperties", "fn", "readyState", "readyStateCheckInterval", "setInterval", "clearInterval", "buildTooltipForDropdown", "dropdownName", "lookupTable", "blockTypesChecked", "setTooltip", "getFieldValue", "dropdown", "FieldDropdown", "isOptionListDynamic", "getOptions", "buildTooltipWithFieldText", "msgTemplate", "getText", "tooltipWhenNotConnected", "getInputsInline", "command", "points", "flags", "radius", "iconConstructor", "root", "proceduresNoReturn", "p", "getReturnTypes", "pa", "getBlocksByType", "forEach", "proceduresReturn", "ta", "tb", "localeCompare", "sensitivity", "findLegalName", "isInFlyout", "opt_exclude", "Names", "equals", "excludeModel", "model", "rename", "UnattachedFieldError", "legalName", "setName", "getValue", "procedureBlock", "populateProcedures", "procedureList", "templateName", "args", "arg", "nameField", "xmlElement", "argBlock", "argValue", "DEFAULT_ARG", "fieldContent", "updateToolbox", "bubbleType", "isOpen", "TYPE", "getWorkspace", "addChangeListener", "BLOCK_DELETE", "BLOCK_CHANGE", "BLOCK_FIELD_INTERMEDIATE_CHANGE", "procName", "mutateCallers", "defBlock", "oldRecordUndo", "callers", "caller", "oldMutation", "oldMutationDom", "newMutationDom", "newMutation", "getDefinition", "shape", "isDynamic", "topConnection", "first", "second", "targetConnection", "orphanBlock", "foundConnection", "output", "typeChecker", "getConnectionChecker", "canConnect", "startBlock", "rendererClass", "RENDERER", "theme", "opt_rendererOverrides", "renderer", "firstVariable", "ShortcutRegistry", "registry", "escapeAction", "ESCAPE", "preconditionFn", "readOnly", "keyCodes", "KeyCodes", "ESC", "deleteShortcut", "DELETE", "Gesture", "inProgress", "checkAndDelete", "BACKSPACE", "ctrlC", "createSerializedKey", "C", "CTRL", "altC", "ALT", "metaC", "META", "copyShortcut", "COPY", "copyWorkspace", "ctrlX", "X", "altX", "metaX", "cutShortcut", "CUT", "BlockSvg", "ctrlV", "V", "altV", "metaV", "pasteShortcut", "PASTE", "ctrlZ", "Z", "altZ", "metaZ", "undoShortcut", "UNDO", "undo", "ctrlShiftZ", "SHIFT", "altShiftZ", "metaShiftZ", "ctrlY", "Y", "redoShortcut", "REDO", "proc", "returnTypes", "parameters", "getTypes", "types", "procedureModelClass", "parameterModelClass", "setReturnTypes", "entries", "insertParameter", "setTypes", "serializerMap", "deserializers", "priority", "WorkspaceSvg", "deserializer", "pluginState", "bounds", "objectMetrics", "getBoundingRectangle", "newYPosition", "leftClamp", "rightClamp", "newXPosition", "metricsManager", "getMetricsManager", "hasFixedEdges", "BUMP_EVENTS", "scrollMetricsInWsCoords", "getScrollMetrics", "wasBumped", "BLOCK_MOVE", "getRootBlock", "COMMENT_CREATE", "COMMENT_MOVE", "getCommentById", "commentId", "topBlocks", "getTopBoundedElements", "dragIconData", "location", "relativeCoords", "ContextMenuRegistry", "undoOption", "displayText", "scopeType", "ScopeType", "WORKSPACE", "weight", "redoOption", "getRedoStack", "cleanOption", "cleanUp", "shouldCollapse", "timeoutFn", "timeoutCounter", "ms", "DELAY", "collapseOption", "collapse", "expandOption", "deleteList", "eventGroup", "shift", "isDeadOrDying", "deletableBlocksLength", "cancelCurrentGesture", "deletableBlocks", "ok", "isDuplicatable", "BLOCK", "commentOption", "hasIcon", "CommentIcon", "inlineOption", "StatementInput", "collapseExpandOption", "disableOption", "getInheritedDisabled", "descendantCount", "helpOption", "helpUrl", "showHelp", "opt_options", "containerElement", "getElementById", "ownerDocument", "Options", "subContainer", "tabIndex", "State", "LABEL", "SVG", "HTML_NS", "XLINK_NS", "defs", "DEFS", "rnd", "random", "gridPattern", "Grid", "gridOptions", "wsOptions", "zoomOptions", "startScale", "languageTree", "flyout", "addFlyout", "hasTrashcan", "addTrashcan", "controls", "addZoomControls", "getThemeManager", "subscribe", "workspaceResizeHandler", "hideComponents", "setResizeHandlerWrapper", "toolbox", "getToolbox", "getFlyout", "scrollToStart", "trashcan", "zoomControls_", "moveOptions", "scrollbars", "ScrollbarPair", "setMetrics", "hasSounds", "documentEventsBound", "updateInverseScreenCTM", "IPAD", "unbindSounds", "soundBinds", "oldSoundBinding", "audioMgr", "preload", "initView", "getWeight", "applyColour", "hideForInsertionMarker", "updateEditable", "updateCollapsed", "isShownWhenCollapsed", "setOffsetInBlock", "onClick", "toolboxItem", "isSelectable", "opt_onlyClosePopups", "CONNECTION_CHECKER", "CURSOR", "INPUT", "TOOLBOX", "THEME", "TOOLBOX_ITEM", "FLYOUTS_VERTICAL_TOOLBOX", "FLYOUTS_HORIZONTAL_TOOLBOX", "METRICS_MANAGER", "BLOCK_DRAGGER", "$jscomp$tmp$exports$module$name", "draggingConnections", "soup", "soupLength", "VAR_DELETE", "VAR_RENAME", "BLOCK_DRAG", "SELECTED", "MARKER_MOVE", "TRASHCAN_OPEN", "TOOLBOX_ITEM_SELECT", "THEME_CHANGE", "COMMENT_DELETE", "COMMENT_CHANGE", "Abstract", "toJson", "isBlank", "run", "_forward", "getEventWorkspace_", "UiBase", "AbstractEvent", "opt_workspaceId", "Click", "opt_block", "opt_targetType", "targetType", "newEvent", "ClickTarget", "ZOOM_CONTROLS", "TOUCH_ENABLED", "globalThis", "rawUserAgent", "isJavaFx", "isWebKit", "isGecko", "isAndroid", "isIPad", "isIPhone", "isMac", "isTablet", "isMobile", "raw", "rawUpper", "maxTouchPoints", "GECKO", "ANDROID", "IPHONE", "MOBILE", "Capability", "name_", "POSITIONABLE", "DRAG_TARGET", "DELETE_AREA", "AUTOHIDEABLE", "ComponentManager", "componentData", "Map", "capabilityToComponentIds", "addComponent", "componentInfo", "component", "capabilities", "set", "stringCapabilities", "capability", "removeComponent", "addCapability", "getComponent", "hasCapability", "removeCapability", "getComponents", "sorted", "componentIds", "components", "componentDataList", "componentDatum", "tx", "ty", "distance", "COMMENT_NODE", "CLIPPATH", "FECOMPOSITE", "FECOMPONENTTRANSFER", "FEFLOOD", "FEFUNCA", "FEGAUSSIANBLUR", "FEPOINTLIGHT", "FESPECULARLIGHTING", "FILTER", "FOREIGNOBJECT", "G", "IMAGE", "LINE", "PATH", "PATTERN", "POLYGON", "RECT", "TEXT", "TSPAN", "getHeight", "other", "opt_pair", "opt_class", "opt_margin", "oldHostMetrics", "ratio", "origin", "startDragHandle", "handlePosition", "handleLength", "scrollbarLength", "startDragMouse", "containerVisible", "isHandleVisible", "onMouseMoveWrapper_", "onMouseUpWrapper_", "pair", "DEFAULT_SCROLLBAR_MARGIN", "outerSvg", "svgBackground", "svgHandle", "setInitialThickness", "lengthAttribute_", "positionAttribute_", "onMouseDownBarWrapper_", "onMouseDownBar", "onMouseDownHandleWrapper_", "onMouseDownHandle", "unsubscribe", "constrainHandleLength", "setHandleLength", "newLength", "constrainHandlePosition", "setHandlePosition", "newPosition", "setScrollbarLength", "newSize", "setPosition", "opt_metrics", "hostMetrics", "getMetrics", "metricsAreEquivalent", "resizeHorizontal", "resizeVertical", "updateMetrics", "requiresViewResize", "viewWidth", "viewHeight", "absoluteLeft", "absoluteTop", "resizeViewHorizontal", "resizeContentHorizontal", "viewSize", "xCoordinate", "scrollWidth", "setVisible", "maxScrollDistance", "maxHandleOffset", "handleOffset", "resizeViewVertical", "resizeContentVertical", "scrollHeight", "setContainerVisible", "visibilityChanged", "updateDisplay_", "setVisibleInternal", "mouseXY", "getInverseScreenCTM", "mouseLocation", "handleXY", "handleStart", "pageLength", "onMouseUpHandle", "onMouseMoveHandle", "getRatio_", "setOrigin", "DOWN", "SPRITE", "url", "ZoomControls", "boundEvents", "zoomResetGroup", "zoomOutGroup", "zoomInGroup", "HEIGHT", "WIDTH", "SMALL_SPACING", "LARGE_SPACING", "MARGIN_HORIZONTAL", "MARGIN_VERTICAL", "initialized", "createZoomOutSvg", "createZoomInSvg", "createZoomResetSvg", "getComponentManager", "cornerPosition", "positionRect", "zoomInTranslateY", "zoomOutTranslateY", "clip", "zoomoutSvg", "setAttributeNS", "zoom", "zoominSvg", "amount", "zoomCenter", "fireZoomEvent", "zoomresetSvg", "resetZoom", "log", "scaleSpeed", "beginCanvasTransition", "scrollCenter", "endCanvasTransition", "uiEvent", "MUTATOR", "WARNING", "CUSTOM", "setLocale", "locale", "k", "VarBase", "opt_variable", "varId", "VarCreate", "varType", "varName", "deleteVariableById", "opt_id", "id_", "var1", "var2", "CATEGORY_NAME", "disposed_", "isComment", "addTopComment", "xy_", "height_", "width_", "content_", "fireCreateEvent", "removeTopComment", "setHeight", "setWidth", "recordNew", "getContent", "setContent", "xmlComment", "info", "parseAttributes", "w", "xmlX", "xmlY", "commentX", "NaN", "commentY", "xmlH", "xmlW", "xmlId", "Selected", "opt_oldElementId", "opt_newElementId", "oldElementId", "newElementId", "WorkspaceCommentPaster", "commentState", "RESIZE_SIZE", "BORDER_RADIUS", "TEXTAREA_OFFSET", "onMouseMoveWrapper", "onMouseUpWrapper", "eventsInit", "deleteIconBorder", "deleteGroup", "resizeGroup", "foreignObject", "svgHandleTarget", "svgRectTarget", "textarea", "autoLayout", "focused", "svgRect_", "unselect", "opt_noSelect", "pathMouseDown", "updateMovable", "getBubbleCanvas", "getGesture", "handleBubbleStart", "showContextMenu", "oldId", "addSelect", "removeSelect", "blurFocus", "setFocus", "addFocus", "removeFocus", "layerManger", "getLayerManager", "hasLayer", "moveDuringDrag", "newLoc", "translation", "clearTransformAttributes", "commentBounds", "setDragging", "adding", "setDeleteStyle", "setAutoLayout", "_enable", "createEditor", "addResizeDom", "addDeleteDom", "setSize", "resizeMouseDown", "deleteMouseDown", "deleteMouseOut", "deleteMouseUp", "TOP_OFFSET", "unbindDragEvents", "startDrag", "resizeMouseUp", "resizeMouseMove", "newXY", "moveDrag", "resizeComment", "topOffset", "textOffset", "blur", "opt_wsWidth", "wsWidth", "WeakSet", "DeserializationError", "toDevString", "childState", "VARIABLES", "PROCEDURES", "BLOCKS", "saveBlock", "BlockSerializer", "blockStates", "BlockBase", "BlockCreate", "allShadowBlocks", "shadows", "ThemeChange", "opt_themeName", "themeName", "ViewportChange", "opt_top", "opt_left", "opt_scale", "opt_oldScale", "DEFAULT_SNAP_RADIUS", "dragRadius", "flyoutDragRadius", "connectingSnapRadius", "currentConnectionPreference", "bumpDelay", "ConnectionType", "INPUT_VALUE", "OUTPUT_VALUE", "NEXT_STATEMENT", "PREVIOUS_STATEMENT", "ConnectionDB", "connections", "addConnection", "yPos", "calculateIndexForYPos", "findIndexOfConnection", "conn", "bestGuess", "pointer", "pointerMin", "pointerMax", "pointerMid", "removeConnection", "getNeighbours", "maxRadius", "checkConnection", "yIndex", "currentX", "db", "currentY", "neighbours", "isInYRange", "baseY", "searchForClosest", "dxy", "baseX", "closestIndex", "bestConnection", "bestRadius", "distanceFrom", "dbList", "BlockPaster", "isCapacityAvailable", "typeCounts", "blockState", "GRID", "GRIDCELL", "GROUP", "LISTBOX", "MENUITEMCHECKBOX", "OPTION", "PRESENTATION", "ROW", "TREE", "TREEITEM", "menuItems", "onKeyDownHandler", "mouseLeaveHandler", "mouseEnterHandler", "clickHandler", "mouseOverHandler", "highlightedItem", "openingCoords", "handleMouseOver", "handleClick", "handleMouseEnter", "handleMouseLeave", "handleKeyEvent", "getElement", "preventScroll", "getMenuItem", "menuElem", "currentElement", "setHighlighted", "currentHighlighted", "ACTIVEDESCENDANT", "highlightNext", "highlightHelper", "highlightPrevious", "highlightFirst", "highlightLast", "startIndex", "delta", "oldCoords", "newCoords", "performAction", "shiftKey", "metaKey", "altKey", "highlighted", "opt_value", "rightToLeft", "highlight", "checked", "checkable", "checkbox", "contentDom", "DISABLED", "setCheckable", "setChecked", "nameDep", "registry_", "reset", "getContextMenuOptions", "menuOptions", "precondition", "menuOption", "getBoundsInfo", "boundPosition", "boundSize", "clientTop", "BUBBLE", "BubbleDragger", "bubble", "dragTarget_", "wouldDeleteBubble_", "startXY_", "startBubbleDrag", "moveToDragLayer", "dragBubble", "currentDragDeltaXY", "pixelsToWorkspaceUnits_", "oldDragTarget", "getDragTarget", "oldWouldDeleteBubble", "shouldDelete_", "updateCursorDuringBubbleDrag_", "onDragExit", "onDragEnter", "onDragOver", "dragTarget", "componentManager", "isDeleteArea", "wouldDelete", "endBubbleDrag", "shouldPreventMove", "onDrop", "fireMoveEvent_", "moveOffDragLayer", "setOldCoordinate", "pixelCoord", "COLLAPSE_CHARS", "DRAG_STACK", "OPPOSITE_TYPE", "RENAME_VARIABLE_ID", "DELETE_VARIABLE_ID", "WorkspaceDragger", "horizontalScrollEnabled_", "isMovableHorizontally", "verticalScrollEnabled_", "isMovableVertically", "startScrollXY_", "endDrag", "drag", "scroll", "ZOOM_IN_MULTIPLIER", "ZOOM_OUT_MULTIPLIER", "creatorWorkspace", "mouseDownXY", "startWorkspace_", "startIcon", "startField", "startBubble", "hasExceededDragRadius", "workspaceDragger", "blockDragger", "bubbleDragger", "isMultiTouch_", "isEnding_", "gestureHasStarted", "calledUpdateIsDragging", "cachedPoints", "startDistance", "previousScale", "currentDropdownOwner", "isPinchZoomEnabled", "mostRecentEvent", "healStack", "clearGesture", "updateFromEvent", "currentXY", "updateDragDelta", "changed", "updateIsDragging", "currentDragDelta", "updateIsDraggingFromFlyout", "isBlockCreatable", "isScrollable", "isDragTowardWorkspace", "updateScreenCalculationsIfScrolled", "createBlock", "updateIsDraggingBubble", "startDraggingBubble", "updateIsDraggingBlock", "startDraggingBlock", "updateIsDraggingWorkspace", "isDraggable", "BlockDraggerClass", "doStart", "pinch", "cancel", "pointerType", "handleTouchStart", "handleMove", "handleUp", "isMultiTouch", "handleTouchMove", "handleTouchEnd", "isBubbleClick", "doBubbleClick", "isFieldClick", "doFieldClick", "isIconClick", "doIconClick", "isBlockClick", "doBlockClick", "isWorkspaceClick", "doWorkspaceClick", "getTouchPoint", "pointers", "point0", "point1", "handlePinch", "moveDistance", "gestureScale", "bringBlockToFront", "handleWsStart", "setStartWorkspace", "fireWorkspaceClick", "handleFlyoutStart", "setStartFlyout", "handleBlockStart", "setStartBlock", "setStartBubble", "showEditor", "autoClose", "scheduleSnapAndBump", "bringToFront", "setStartField", "setStartIcon", "setTargetBlock", "hasStartBubble", "hasStartBlock", "isClickable", "isClickableInFlyout", "handleInFlyout", "hasStarted", "getInsertionMarkers", "getCurrentDragger", "currentGesture_", "pattern", "spacing", "line2", "line1", "snapToGrid", "shouldSnap", "getSpacing", "getPatternId", "update", "safeSpacing", "half", "end", "setLineAttributes", "x1", "x2", "y1", "y2", "MarkerManager", "cursorSvg_", "cursor_", "markers", "markerSvg_", "registerMarker", "marker", "unregisterMarker", "setDrawer", "makeMarkerDrawer", "setMarkerSvg", "getDrawer", "getCursor", "getMarker", "setCursor", "cursor", "drawer", "setCursorSvg", "cursorSvg", "getBlockCanvas", "markerSvg", "updateMarkers", "keyboardAccessibilityMode", "draw", "markerIds", "markerId", "LOCAL_MARKER", "Theme", "opt_blockStyles", "opt_categoryStyles", "opt_componentStyles", "startHats", "blockStyles", "categoryStyles", "componentStyles", "fontStyle", "setBlockStyle", "blockStyleName", "blockStyle", "setCategoryStyle", "categoryStyleName", "categoryStyle", "getComponentStyle", "componentName", "recursiveStyle", "setComponentStyle", "styleValue", "setFontStyle", "setStartHats", "defineTheme", "themeObj", "base", "defaultBlockStyles", "Classic", "toolboxJsonDef", "hasCollapse", "hasComments", "hasDisable", "rawHasTrashcan", "rawHasCollapse", "rawHasComments", "rawHasDisable", "rawHasSounds", "maxTrashcanContents", "toolboxAtStart", "toolboxPosition", "endsWith", "rawOneBasedIndex", "modalInputs", "oneBasedIndex", "maxBlocks", "maxInstances", "parseMoveOptions_", "hasScrollbars", "parseGridOptions_", "parseZoomOptions_", "parseThemeOptions_", "rendererOverrides", "move", "wheel", "maxScale", "minScale", "grid", "snap", "BlockChange", "opt_element", "opt_oldValue", "opt_newValue", "oldValue", "setValue", "oldState", "getExtraBlockState_", "JSON", "stringify", "Field", "validator", "DEFAULT_VALUE", "constants_", "mouseDownWrapper_", "textContent_", "textElement_", "borderRect_", "fieldGroup_", "tooltip_", "validator_", "maxDisplayLength", "sourceBlock_", "enabled_", "visible_", "isDirty_", "suffixField", "prefixField", "clickTarget_", "EDITABLE", "SERIALIZABLE", "value_", "size_", "SKIP_SETUP", "configure_", "setValidator", "setSourceBlock", "getConstants", "bindEvents_", "createBorderRect_", "createTextElement_", "isFullBlockField", "FIELD_BORDER_RECT_RADIUS", "FIELD_TEXT_BASELINE_CENTER", "clickTarget", "getClickTarget_", "onMouseDown_", "fieldElement", "_doFullSerialization", "legacyState", "saveLegacyState", "loadLegacyState", "callingClass", "showEditor_", "autoClosingFlyout", "isCurrentlyEditable", "handler", "getValidator", "getBorderRect", "getTextElement", "getTextContent", "render_", "nodeValue", "getDisplayText_", "updateSize_", "constants", "xOffset", "FIELD_BORDER_RECT_X_PADDING", "totalWidth", "totalHeight", "FIELD_TEXT_HEIGHT", "contentWidth", "FIELD_TEXT_FONTSIZE", "FIELD_TEXT_FONTWEIGHT", "FIELD_TEXT_FONTFAMILY", "FIELD_BORDER_RECT_HEIGHT", "positionTextElement_", "positionBorderRect_", "halfHeight", "FIELD_TEXT_BASELINE", "getAbsoluteXY_", "_", "NBSP", "getText_", "markDirty", "forceRerender", "bumpNeighbours", "fireChangeEvent", "classValidation", "doClassValidation_", "classValue", "processValidation_", "localValidation", "localValue", "doValueUpdate_", "validatedValue", "doValueInvalid_", "_invalidValue", "newTip", "getTooltip", "referencesVariables", "refreshVariableName", "getParentInput", "parentInput", "idx", "fieldRows", "getFlipRtl", "isTabNavigable", "onShortcut", "_shortcut", "updateMarkers_", "Symbol", "reservedWordsList", "opt_variablePrefix", "dbReverse", "variableMap", "variablePrefix", "reservedWords", "setVariableMap", "getNameForUserVariable", "populateVariables", "NameType", "VARIABLE", "nameOrId", "normalizedName", "DEVELOPER_VARIABLE", "typeDb", "safeName", "getDistinctName", "getUserNames", "userNames", "encodeURI", "name1", "name2", "PROCEDURE", "DEVELOPER_VARIABLE_TYPE", "ObservableProcedureMap", "existed", "Icon", "offsetInBlock", "workspaceLocation", "svgRoot", "pointerdownListener", "svgBlock", "updateSvgRootOffset", "menuGenerator", "svgArrow", "imageElement", "selectedMenuItem", "generatedOptions", "trimmed", "menuGenerator_", "selectedOption", "shouldAddBorderRect_", "FIELD_DROPDOWN_SVG_ARROW", "createSVGArrow_", "createTextArrow_", "FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW", "ARROW_CHAR", "FIELD_DROPDOWN_SVG_ARROW_SIZE", "FIELD_DROPDOWN_SVG_ARROW_DATAURI", "dropdownCreate", "menuElement", "FIELD_DROPDOWN_COLOURED_DIV", "primaryColour", "getColour", "colourTertiary", "dropdownDispose_", "image", "Image", "handleMenuActionEvent", "onItemSelected_", "useCache", "isValueValid", "fill", "colourSecondary", "colourPrimary", "renderSelectedImage", "renderSelectedText", "imageJson", "imageHeight", "imageWidth", "hasBorder", "FIELD_DROPDOWN_BORDER_RECT_HEIGHT", "IMAGE_Y_PADDING", "xPadding", "arrowWidth", "positionSVGArrow", "textWidth", "textPadding", "FIELD_DROPDOWN_SVG_ARROW_PADDING", "svgArrowSize", "CHECKMARK_OVERHANG", "MAX_MENU_HEIGHT_VH", "IMAGE_Y_OFFSET", "_a", "Bubble", "anchor", "ownerRect", "relativeLeft", "relativeTop", "embossGroup", "embossFilterId", "tail", "background", "BORDER_WIDTH", "contentContainer", "onMouseDown", "setAnchorLocation", "relayout", "positionByRect", "positionRelativeToAnchor", "renderTail", "setPositionRelativeToAnchor", "MIN_SIZE", "getViewMetrics", "optimalLeft", "getOptimalRelativeLeft", "optimalTop", "getOptimalRelativeTop", "topPosition", "MIN_BLOCK_HEIGHT", "startPosition", "endPosition", "bottomPosition", "closerPosition", "fartherPosition", "topPositionOverlap", "getOverlap", "startPositionOverlap", "closerPositionOverlap", "fartherPositionOverlap", "mostOverlap", "relativeMin", "workspaceRect", "getWorkspaceViewRect", "bubbleRight", "bubbleLeft", "getScrollbarThickness", "relBubbleX", "relBubbleY", "relAnchorX", "relAnchorY", "hypotenuse", "rise", "angle", "acos", "rightAngle", "rightRise", "rightRun", "cos", "thickness", "TAIL_THICKNESS", "backoffRatio", "ANCHOR_RADIUS", "baseX1", "baseY1", "radians", "TAIL_ANGLE", "swirlAngle", "swirlRise", "TAIL_BEND", "swirlRun", "baseX2", "baseY2", "lastChild", "_start", "DOUBLE_BORDER", "MiniWorkspaceBubble", "workspaceOptions", "validateWorkspaceOptions", "svgDialog", "miniWorkspace", "newWorkspaceSvg", "internalIsMutator", "getCanvas", "onWorkspaceChange", "updateBubbleSize", "addWorkspaceChangeListener", "listener", "bumpBlocksIntoBounds", "MARGIN", "currSize", "calculateWorkspaceSize", "MINIMUM_VIEW_CHANGE", "recordDragTargets", "workspaceSize", "getBBox", "flyoutScrollMetrics", "updateBlockStyles", "setStyle", "getStyleName", "flyoutWs", "SIZE", "WORKSPACE_MARGIN", "flyoutBlockTypes", "saveConnectionsListener", "updateWorkspacePid", "rootBlock", "miniWorkspaceBubble", "WEIGHT", "getAnchorLocation", "getMiniWorkspaceConfig", "getBubbleOwnerRect", "createRootBlock", "addSaveConnectionsListener", "createMiniWorkspaceChangeListener", "removeChangeListener", "midIcon", "flyoutWidth", "saveConnections", "isIgnorableMutatorEvent", "recomposeSourceBlock", "oldExtraState", "newExtraState", "reconnect", "connectionChild", "findParentWs", "WIN_KEY_FF_LINUX", "MAC_ENTER", "TAB", "NUM_CENTER", "ENTER", "PAUSE", "CAPS_LOCK", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "PLUS_SIGN", "PRINT_SCREEN", "INSERT", "ZERO", "ONE", "TWO", "THREE", "FOUR", "FIVE", "SIX", "SEVEN", "EIGHT", "NINE", "FF_SEMICOLON", "FF_EQUALS", "FF_DASH", "FF_HASH", "QUESTION_MARK", "AT_SIGN", "A", "B", "D", "E", "F", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "W", "WIN_KEY_RIGHT", "CONTEXT_MENU", "NUM_ZERO", "NUM_ONE", "NUM_TWO", "NUM_THREE", "NUM_FOUR", "NUM_FIVE", "NUM_SIX", "NUM_SEVEN", "NUM_EIGHT", "NUM_NINE", "NUM_MULTIPLY", "NUM_PLUS", "NUM_MINUS", "NUM_PERIOD", "NUM_DIVISION", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "NUMLOCK", "SCROLL_LOCK", "FIRST_MEDIA_KEY", "LAST_MEDIA_KEY", "SEMICOLON", "DASH", "EQUALS", "COMMA", "PERIOD", "SLASH", "APOSTROPHE", "TILDE", "SINGLE_QUOTE", "OPEN_SQUARE_BRACKET", "BACKSLASH", "CLOSE_SQUARE_BRACKET", "WIN_KEY", "MAC_FF_META", "MAC_WK_CMD_LEFT", "MAC_WK_CMD_RIGHT", "WIN_IME", "VK_NONAME", "PHANTOM", "aria", "arrayUtils", "browserEvents", "deprecation", "extensions", "idGenerator", "math", "parsing", "stringUtils", "svgMath", "svgPaths", "userAgent", "TextBubble", "paragraph", "stringToSvg", "setText", "createParagraph", "spans", "createSpans", "rightAlignSpans", "tspan", "maxWidth", "TextInputBubble", "resizePointerMoveListener", "resizePointerUpListener", "textChangeListeners", "sizeChangeListeners", "inputRoot", "textArea", "createResizeHandle", "onTextChange", "addTextChangeListener", "addSizeChangeListener", "bindTextAreaEvents", "onStartEdit", "onResizePointerDown", "widthMinusBorder", "heightMinusBorder", "onSizeChange", "onResizePointerUp", "onResizePointerMove", "DEFAULT_BUBBLE_WIDTH", "DEFAULT_BUBBLE_HEIGHT", "textBubble", "textInputBubble", "bubbleSize", "bubbleVisiblity", "anchorLocation", "oldText", "newText", "showEditableBubble", "showNonEditableBubble", "hideBubble", "WarningIcon", "textMap", "addMessage", "DuplicateIconType", "exceptions", "TypesContainer", "NONE", "HAT", "SPACER", "BETWEEN_ROW_SPACER", "IN_ROW_SPACER", "EXTERNAL_VALUE_INPUT", "INLINE_INPUT", "STATEMENT_INPUT", "CONNECTION", "PREVIOUS_CONNECTION", "NEXT_CONNECTION", "OUTPUT_CONNECTION", "CORNER", "LEFT_SQUARE_CORNER", "LEFT_ROUND_CORNER", "RIGHT_SQUARE_CORNER", "RIGHT_ROUND_CORNER", "JAGGED_EDGE", "TOP_ROW", "BOTTOM_ROW", "INPUT_ROW", "LEFT_CORNER", "RIGHT_CORNER", "nextTypeValue_", "hasOwnProperty", "isField", "isHat", "isSpacer", "isInRowSpacer", "isInput", "isExternalInput", "isInlineInput", "isStatementInput", "isPreviousConnection", "isNextConnection", "isPreviousOrNextConnection", "isLeftRoundedCorner", "isRightRoundedCorner", "isLeftSquareCorner", "isRightSquareCorner", "isCorner", "isJaggedEdge", "isRow", "row", "isBetweenRowSpacer", "isTopRow", "isBottomRow", "isTopOrBottomRow", "isInputRow", "Types", "Measurable", "centerline", "xPos", "notchOffset", "NOTCH_OFFSET_LEFT", "Row", "elements", "widthWithConnectedBlocks", "minWidth", "minHeight", "hasStatement", "hasExternalInput", "statementEdge", "hasJaggedEdge", "hasDummyInput", "hasInlineInput", "align", "getLastInput", "measure", "startsWithElemSpacer", "endsWithElemSpacer", "getFirstSpacer", "getLastSpacer", "BottomRow", "hasNextConnection", "descenderHeight", "hasLeftSquareCorner", "hasRightSquareCorner", "_block", "Connection", "connectionModel", "shapeFor", "InputConnection", "connectionOffsetY", "connectionOffsetX", "connectedBlock", "connectedBlockWidth", "connectedBlockHeight", "ExternalValueInput", "TAB_OFFSET_FROM_TOP", "MEDIUM_PADDING", "EXTERNAL_VALUE_INPUT_PADDING", "connectionHeight", "connectionWidth", "flipRtl", "Hat", "START_HAT", "ascenderHeight", "InRowSpacer", "SPACER_DEFAULT_HEIGHT", "InlineInput", "EMPTY_INLINE_INPUT_HEIGHT", "EMPTY_INLINE_INPUT_PADDING", "STATEMENT_BOTTOM_SPACER", "EMPTY_STATEMENT_INPUT_HEIGHT", "STATEMENT_INPUT_NOTCH_OFFSET", "InputRow", "connectedBlockWidths", "JaggedEdge", "JAGGED_TEETH", "NextConnection", "OutputConnection", "startX", "PreviousConnection", "RoundCorner", "opt_position", "CORNER_RADIUS", "SpacerRow", "precedesStatement", "followsStatement", "SquareCorner", "NO_PADDING", "TopRow", "capline", "hasPreviousConnection", "hasHat", "hat", "ADD_START_HATS", "prevBlock", "getPreviousBlock", "ConstantProvider", "SMALL_PADDING", "MEDIUM_LARGE_PADDING", "LARGE_PADDING", "TAB_HEIGHT", "TAB_VERTICAL_OVERLAP", "TAB_WIDTH", "NOTCH_WIDTH", "NOTCH_HEIGHT", "MIN_BLOCK_WIDTH", "EMPTY_BLOCK_SPACER_HEIGHT", "STATEMENT_INPUT_PADDING_LEFT", "BETWEEN_STATEMENT_PADDING_Y", "START_HAT_HEIGHT", "START_HAT_WIDTH", "JAGGED_TEETH_HEIGHT", "JAGGED_TEETH_WIDTH", "FIELD_BORDER_RECT_Y_PADDING", "FIELD_BORDER_RECT_COLOUR", "FIELD_COLOUR_FULL_BLOCK", "FIELD_TEXTINPUT_BOX_SHADOW", "FIELD_COLOUR_DEFAULT_WIDTH", "embossFilter", "disabledPatternId", "disabledPattern", "debugFilterId", "debugFilter", "CURSOR_COLOUR", "MARKER_COLOUR", "CURSOR_WS_WIDTH", "WS_CURSOR_HEIGHT", "CURSOR_STACK_PADDING", "CURSOR_BLOCK_PADDING", "CURSOR_STROKE_WIDTH", "FULL_BLOCK_FIELDS", "INSERTION_MARKER_COLOUR", "INSERTION_MARKER_OPACITY", "SHAPES", "PUZZLE", "NOTCH", "TALL_INPUT_FIELD_OFFSET_Y", "DUMMY_INPUT_SHADOW_MIN_HEIGHT", "DUMMY_INPUT_MIN_HEIGHT", "TOP_ROW_MIN_HEIGHT", "TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT", "BOTTOM_ROW_MIN_HEIGHT", "BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT", "START_POINT", "FIELD_COLOUR_DEFAULT_HEIGHT", "FIELD_CHECKBOX_X_OFFSET", "randomIdentifier", "makeJaggedTeeth", "makeNotch", "makeStartHat", "PUZZLE_TAB", "makePuzzleTab", "INSIDE_CORNERS", "makeInsideCorners", "OUTSIDE_CORNERS", "makeOutsideCorners", "setTheme", "validatedBlockStyle_", "setDynamicProperties_", "setFontConstants_", "setComponentConstants_", "fontMetrics", "getBlockStyleForColour", "createBlockStyle_", "getBlockStyle", "valid", "assign", "parsedColour", "generateSecondaryColour_", "generateTertiaryColour_", "inputColour", "mainPath", "path", "makeMainPath", "up", "back", "control1Y", "overlap", "control2Y", "endPoint1", "endPoint2", "pathUp", "pathDown", "dir", "outerWidth", "innerWidth", "pathLeft", "pathRight", "innerTopLeftCorner", "innerBottomLeftCorner", "pathTop", "pathBottom", "topLeft", "topRight", "bottomLeft", "bottomRight", "rightHeight", "selector", "injectCSS_", "feSpecularLighting", "createDebugFilter", "debugComponentTransfer", "cssArray", "getCSS_", "cssNodeId", "Drawer", "inlinePath_", "outlinePath_", "block_", "info_", "topLeft_", "drawOutline_", "drawInternals_", "pathObject", "setPath", "flipRTL", "recordSizeOnBlock_", "hideHiddenIcons_", "widthWithChildren", "drawTop_", "rows", "drawJaggedEdge_", "drawStatementInput_", "drawValueInput_", "drawRightSideRow_", "drawBottom_", "drawLeft_", "topRow", "positionPreviousConnection_", "startY", "positionExternalValueConnection_", "innerHeight", "positionStatementInputConnection_", "bottomRow", "elems", "positionNextConnection_", "rightCornerYOffset", "outlinePath", "positionOutputConnection_", "tabBottom", "drawInlineInput_", "layoutField_", "fieldInfo", "connectionTop", "connectionBottom", "positionInlineInputConnection_", "connX", "connInfo", "Align", "CENTRE", "FieldLabel", "textClass", "class", "setClass", "cssClass", "Input", "appendField", "insertFieldAt", "removeField", "opt_quiet", "renderList", "renderedConnection", "startTrackingAll", "stopTrackingAll", "setCheck", "check", "setAlign", "makeConnection", "makeConnection_", "DummyInput", "EndRowInput", "ValueInput", "RenderInfo", "inputRows", "renderer_", "isInline", "createRows_", "addElemSpacing_", "addRowSpacing_", "computeBounds_", "alignRowElements_", "finalize_", "populateTopRow_", "activeRow", "iconInfo", "lastInput", "shouldStartNewRow_", "addInput_", "populateBottomRow_", "hasPrevious", "cornerClass", "leftSquareCorner", "rightSquareCorner", "StatementInputMeasurable", "currInput", "prevInput", "oldElems", "getInRowSpacing_", "prev", "widestStatementRowFields", "blockWidth", "widestRowWithConnectedBlocks", "statementInput", "alignStatementRow_", "currentWidth", "missingSpace", "getDesiredRowWidth_", "desiredWidth", "addAlignmentPadding_", "_row", "firstSpacer", "lastSpacer", "oldRows", "makeSpacerRow_", "getSpacerRowHeight_", "getSpacerRowWidth_", "spacer", "_prev", "_next", "getElemCenterline_", "recordElemPositions_", "xCursor", "yCursor", "ASTNode", "opt_params", "wsCoordinate", "isConnectionLocation", "isConnectionType", "processParams", "getLocation", "getWsCoordinate", "isConnection", "findNextForInput", "curIdx", "NAVIGATE_ALL_FIELDS", "createFieldNode", "createInputNode", "findNextForField", "fieldIdx", "newInput", "findPrevForInput", "findPrevForField", "navigateBetweenStacks", "curLocation", "curLocationAsBlock", "curRoot", "resultIndex", "createStackNode", "findTopASTNodeForBlock", "createConnectionNode", "createBlockNode", "getOutAstNodeForBlock", "getTopStackBlock", "findFirstFieldOrInput", "STACK", "OUTPUT", "PREVIOUS", "NEXT", "in", "out", "blockPos", "DEFAULT_OFFSET_Y", "createWorkspaceNode", "createTopNode", "MarkerMove", "isCursor", "opt_oldNode", "opt_newNode", "oldNode", "CURSOR_CLASS", "MARKER_CLASS", "HEIGHT_MULTIPLIER", "MarkerSvg", "markerSvgRect_", "markerSvgLine_", "markerInput_", "markerBlock_", "svgGroup_", "currentMarkerSvg", "defaultColour", "colour_", "createDomInternal_", "setParent_", "curNode", "applyColour_", "showAtLocation_", "fireMarkerEvent", "animate", "connectionType", "curNodeAsConnection", "showWithBlock_", "showWithOutput_", "showWithInput_", "showWithNext_", "showWithPrevious_", "showWithField_", "showWithCoordinates_", "showWithStack_", "showWithBlockPrevOutput", "markerHeight", "markerOffset", "connectionShape", "positionPrevious_", "positionOutput_", "positionBlock_", "showCurrent_", "positionLine_", "positionRect_", "positionInput_", "getOffsetInBlock", "heightWidth", "yPadding", "markerPath", "curBlock", "getBlinkProperties_", "blinkProperties", "attributeName", "_curNode", "firstElementChild", "PathObject", "svgPath", "pathString", "updateShadow_", "updateDisabled_", "setClass_", "updateHighlighted", "updateSelected", "updateDraggingDelete", "updateInsertionMarker", "updateReplacementFade", "updateShapeForInputHighlight", "_conn", "shadowDom", "shadowState", "connect_", "parentBlock", "disconnectInternal", "orphan", "stashShadowState", "applyShadowState", "setReason", "setParent", "orphanConnection", "getConnectionForOrphanedConnection", "onFailedConnect", "setShadowStateInternal", "unplug", "isSuperior", "_otherConnection", "otherConnection", "disconnect", "getParentAndChildConnections", "respawnShadow_", "createShadowBlock", "connectionParent", "currentParent", "onCheckChanged_", "getCheck", "returnCurrent", "_maxLimit", "serializeShadow", "attemptToConnect", "blockShadow", "lastConnectionInStack", "CAN_CONNECT", "REASON_SELF_CONNECTION", "REASON_WRONG_TYPE", "REASON_TARGET_NULL", "REASON_CHECKS_FAILED", "REASON_DIFFERENT_WORKSPACES", "REASON_SHADOW_PARENT", "REASON_DRAG_CHECKS_FAILED", "REASON_PREVIOUS_AND_OUTPUT", "COLLAPSED_INPUT_NAME", "COLLAPSED_FIELD_NAME", "DUPLICATE_BLOCK_ERROR", "InsertionMarkerManager", "activeCandidate", "lastMarker", "lastOnStack", "wouldDeleteBlock", "fadedBlock", "highlightedBlock", "markerConnection", "firstMarker", "createMarkerBlock", "availableConnections", "initAvailableConnections", "disposeInsertionMarker", "updateAvailableConnections", "wouldConnectBlock", "applyConnections", "hidePreview", "local", "inferiorConnection", "then", "newCandidate", "getCandidate", "shouldDelete", "shouldUpdatePreviews", "maybeHidePreview", "maybeShowPreview", "imType", "setInsertionMarker", "sourceInput", "resultInput", "sourceField", "resultField", "available", "activeLocal", "activeClosest", "xDiff", "yDiff", "curDistance", "getStartRadius", "candidate", "myConnection", "neighbour", "showPreview", "getConnectionPreviewMethod", "method", "PREVIEW_TYPE", "INPUT_OUTLINE", "showInsertionInputOutline", "INSERTION_MARKER", "showInsertionMarker", "REPLACEMENT_FADE", "showReplacementFade", "shouldHighlightConnection", "localChanged", "unhighlight", "hideReplacementFade", "hideInsertionInputOutline", "hideInsertionMarker", "insertionMarker", "isLastInStack", "imConn", "getMatchingConnection", "originalOffsetToTarget", "originalOffsetInBlock", "imConnConst", "positionNearConnection", "markerConn", "imBlock", "markerOutput", "markerPrev", "highlightShapeForInput", "fadeForReplacement", "PreviewType", "Renderer", "overrides", "makeConstants_", "refreshDom", "previousConstants", "makeRenderInfo_", "makeDrawer_", "makePathObject", "orphanCanConnectAtEnd", "localType", "ThemeManager", "subscribedWorkspaces_", "componentDB", "prevTheme", "oldClassName", "newClassName", "refreshTheme", "componentList", "propertyName", "setProperty", "subscribeWorkspace", "unsubscribeWorkspace", "onCreateVariableButtonClick_String", "onCreateVariableButtonClick_Number", "onCreateVariableButtonClick_Colour", "ConnectionChecker", "opt_distance", "safety", "doSafetyChecks", "doTypeChecks", "doDragChecks", "errorCode", "superiorBlock", "inferiorBlock", "superiorConnection", "checkArrayOne", "checkArrayTwo", "canConnectToPrevious_", "VarDelete", "VarRename", "VariableMap", "deleteVariable", "conflictVar", "renameVariableWithConflict_", "renameVariableAndUses_", "updateVarName", "renameVarById", "variableId", "tempVar", "variableName", "uses", "getVariableUsesById", "procedureName", "deleteText", "confirmText", "deleteVariableInternal", "list", "getVariableTypes", "variableTypes", "flat", "Workspace", "internalIsFlyout", "isClearing", "MAX_UNDO", "connectionDBList", "topComments", "commentDB", "listeners", "undoStack_", "redoStack_", "blockDB", "typedBlocksDB", "procedureMap", "connectionCheckerClass", "sortObjects_", "SCAN_ANGLE", "aXY", "bXY", "addTopBlock", "removeTopBlock", "ordered", "addTypedBlock", "removeTypedBlock", "filtered", "remainingCapacity", "remainingCapacityOfType", "hasBlockLimits", "copyableBlocksCount", "redo", "inputStack", "outputStack", "inputEvent", "clearUndo", "setBlockById", "removeBlockById", "allInputsFilled", "opt_shadowBlocksAreFilled", "createPotentialVariableMap", "outerWs", "getById", "getAll", "SOUND_LIMIT", "WorkspaceAudio", "sounds", "lastSound_", "filenames", "audioTest", "filename", "ext", "canPlayType", "sound", "volume", "playPromise", "pause", "catch", "opt_volume", "now", "mySound", "LayerManager", "layers", "dragLayer", "createDragLayer", "blockLayer", "createLayer", "bubbleLayer", "translateLayers", "newCoord", "newScale", "layer", "layerNum", "getSvgGroup", "inserted", "sortedLayers", "num", "sib", "getBlockLayer", "getBubbleLayer", "ZOOM_TO_FIT_MARGIN", "resizeHandlerWrapper", "resizesEnabled", "isVisible_", "startScrollY", "startScrollX", "dragDeltaXY", "oldLeft", "oldTop", "inverseScreenCTM", "dummyWheelListener", "configureContextMenu", "lastRecordedPageScroll", "toolbox_", "inverseScreenCTMDirty", "highlightedBlocks", "toolboxCategoryCallbacks", "flyoutButtonCallbacks", "cachedParentSvg", "topBoundedElements", "dragTargetAreas", "layerManager", "MetricsManagerClass", "setTopLevelWorkspaceMetrics_", "audioManager", "markerManager", "Variables", "registerToolboxCategoryCallback", "VariablesDynamic", "Procedures", "themeManager_", "cachedParentSvgSize", "getMarkerManager", "setMetricsManager", "updateBlockStyles_", "refreshToolboxSelection", "ctm", "opt_backgroundClass", "svgBackground_", "svgBlockCanvas_", "svgBubbleCanvas_", "onMouseWheel_", "ToolboxClass", "CursorClass", "parentSvg", "newTrashcan", "svgTrashcan", "_workspace", "svgZoomControls", "HorizontalFlyout", "VerticalFlyout", "opt_own", "updateScreenCalculations_", "positionables", "getUiMetrics", "positionable", "currScroll", "maybeFireViewportChangeEvent", "imList", "highlightBlock", "opt_state", "pastedThing", "pasteBlock_", "pasteWorkspaceComment_", "jsonBlock", "collide", "allBlocks", "otherXY", "refreshSelection", "dragTargets", "targetArea", "getClientRect", "clientRect", "canWheelZoom", "canWheelMove", "scrollDelta", "commandKey", "PIXELS_PER_ZOOM_STEP", "topElements", "boundary", "topElement", "blockBoundary", "cursorY", "scaleChange", "getCTM", "center", "f", "setScale", "svgWidth", "svgHeight", "zoomToFit", "workspaceWidth", "workspaceHeight", "blocksBox", "doubleMargin", "blocksWidth", "blocksHeight", "ratioX", "ratioY", "centerOnBlock", "blockOnly", "pixelX", "pixelY", "reflow", "resizeView", "resizeContent", "getScale", "maxYScroll", "maxYDisplacement", "maxXDisplacement", "addTopBoundedElement", "removeTopBoundedElement", "reenabled", "getButtonCallback", "removeButtonCallback", "getToolboxCategoryCallback", "removeToolboxCategoryCallback", "isStart", "getGrid", "onlyClosePopups", "autoHideables", "autoHideable", "autoHide", "xyRatio", "TrashcanOpen", "opt_isOpen", "BlockDelete", "oldXml", "wasShadow", "oldJson", "Block", "hue_", "styleName_", "suppressPrefixSuffix", "contextMenu", "parentBlock_", "childBlocks_", "editable_", "movable_", "deletable_", "collapsed_", "isShadow_", "outputShape_", "isInsertionMarker_", "disposing", "onchangeWrapper_", "statementInputCount", "isInMutator", "doInit_", "onchange", "setOnChange", "disposeInternal", "destroy", "opt_healStack", "unplugFromRow_", "unplugFromStack_", "thisConnection", "getOnlyValueConnection_", "previousTarget", "nextTarget", "_all", "myConnections", "ignoreShadows", "getInputWithBlock", "getSurroundParent", "previous", "childBlocks", "isSimpleReporter", "otherConnections", "setHelpUrl", "getHue", "parsed", "onchangeFn", "getVars", "vars", "newId", "setFieldValue", "setPreviousStatement", "newBoolean", "opt_check", "setNextStatement", "setOutput", "setOutputShape", "outputShape", "getOutputShape", "ancestor", "opt_maxLength", "opt_emptyToken", "toTokens", "acc", "curr", "emptyToken", "checks", "shouldAddParens", "appendValueInput", "appendInput", "appendStatementInput", "appendDummyInput", "appendEndRowInput", "appendInputFromRegistry", "inputConstructor", "warningPrefix", "n", "jsonInitStyle_", "jsonInitColour_", "interpolate_", "localizedText", "localizedValue", "extensionNames", "styleError", "opt_disableCheck", "overwrites", "implicitAlign", "validateTokens_", "interpolateArguments_", "fieldStack", "isInputKeyword_", "inputFromJson_", "fieldFromJson_", "argsCount", "visitedArgsHash", "visitedArgsCount", "token", "newlineInput", "stringToFieldJson_", "dummyInput", "alignmentLookup", "alignment", "moveInputBefore", "refName", "inputIndex", "refIndex", "moveNumberedInputBefore", "RangeError", "removeInput", "getInputTargetBlock", "removeIcon", "setWarningText", "_text", "_opt_id", "_mutator", "find", "Marker", "getCurNode", "setCurNode", "Cursor", "BasicCursor", "getNextNode_", "validNode_", "getPreviousNode_", "isValid", "siblingOrParent", "findSiblingOrParent", "getRightMostChild", "nextNode", "registrationName", "TabNavigateCursor", "BUMP_RANDOMNESS", "RenderedConnection", "highlightPath", "dbOpposite", "trackedState", "TrackedState", "WILL_TRACK", "TRACKED", "bumpAwayFrom", "staticConnection", "updated", "moveToOffset", "blockTL", "tightenEfficiently", "maxLimit", "renderConstants", "yLen", "xLen", "setTracking", "doTracking", "UNTRACKED", "updateDisabled", "parentRendered", "childRendered", "warningTextDb", "warning", "mutator", "eventsInit_", "renderIsInProgress_", "visuallyDisabled", "bumpNeighboursPid", "dragging", "createIconPointerDownListener", "getColourSecondary", "getColourTertiary", "oldParent", "oldXY", "draggingBlock", "eventsEnabled", "currLoc", "curXY", "blockBounds", "updateCollapsed_", "collapsedInputName", "collapsedFieldName", "tab", "tabCursor", "currentNode", "nextField", "open", "generateContextMenu", "customContextMenu", "updateConnectionLocations", "updateIconLocations", "updateFieldLocations", "getCommentIcon", "timeout", "collapsedParent", "COLLAPSED_WARNING_ID", "removed", "styleObj", "track", "all", "oldGroup", "bumpNeighboursInternal", "sourceConnection", "tightenChildrenEfficiently", "nextHeightWidth", "tabHeight", "INLINE", "DragTarget", "_dragElement", "DeleteArea", "wouldDelete_", "couldConnect", "couldDeleteBlock", "updateWouldDelete_", "Trashcan", "isLidOpen", "minOpenness", "lidTask", "svgLid", "lidOpen", "flyoutWorkspaceOptions", "onDelete", "BODY_HEIGHT", "LID_HEIGHT", "SPRITE_LEFT", "SPRITE_TOP", "blockMouseDownWhenOpenable", "click", "mouseOver", "mouseOut", "animateLid", "setLidOpen", "hasContents", "contentsIsOpen", "openFlyout", "string", "blocklyStyle", "fireUiEvent", "closeFlyout", "emptyContents", "setMinOpenness", "trashRect", "MARGIN_HOTSPOT", "frames", "ANIMATION_FRAMES", "setLidAngle", "MAX_LID_ANGLE", "OPACITY_MIN", "OPACITY_MAX", "ANIMATION_LENGTH", "lidAngle", "openAtRight", "newMin", "closeLid", "trashcanOpen", "cleanedJson", "cleanBlockJson", "HAS_BLOCKS_LID_ANGLE", "cleanRec", "blockInfo", "shortcuts", "keyMap", "shortcut", "registeredShortcut", "addKeyMapping", "allowCollision", "shortcutName", "removeAllKeyMappings", "keyCode", "opt_allowCollision", "shortcutNames", "removeKeyMapping", "shortcutIdx", "setKeyMap", "newKeyMap", "getKeyMap", "legacyKeyMap", "getRegistry", "legacyRegistry", "serializeKeyEvent_", "getShortcutNamesByKeyCode", "getKeyCodesByShortcutName", "serializedKey", "modifier", "modifierKeys", "getModifierState", "checkModifiers_", "modifiers", "modifierKeyCode", "Shift", "Control", "Alt", "Meta", "ProcedureSerializer", "procState", "VariableSerializer", "variableStates", "varState", "priorities", "addHorizontal", "addVertical", "oldHostMetrics_", "corner_", "vScroll", "hScroll", "isPair", "resizeH", "resizeV", "setX", "setY", "MetricsManager", "workspace_", "getDimensionsPx_", "getFlyoutMetrics", "flyoutDimensions", "getToolboxMetrics", "toolboxDimensions", "getSvgMetrics", "getAbsoluteMetrics", "flyoutMetrics", "respectToolbox", "respectFlyout", "atTop", "opt_getWorkspaceCoordinates", "svgMetrics", "vertToolbox", "getContentMetrics", "blockBox", "getComputedFixedEdges_", "opt_viewMetrics", "hScrollEnabled", "vScrollEnabled", "edges", "getPaddedContent_", "contentMetrics", "contentBottom", "contentRight", "halfWidth", "opt_contentMetrics", "fixedEdges", "paddedContent", "scrollMetrics", "contentHeight", "contentTop", "contentLeft", "toolboxWidth", "toolboxHeight", "flyoutHeight", "FinishedLoading", "opt_workspace", "BlockDrag", "opt_isStart", "opt_blocks", "bumpIntoBounds", "BlockDragger", "wouldDeleteBlock_", "dragIconData_", "draggingBlock_", "draggedConnectionManager_", "fireDragStartEvent_", "shouldDisconnect_", "disconnectBlock_", "oldWouldDeleteBlock", "updateCursorDuringBlockDrag_", "fireDragEndEvent_", "getNewLocationAfterDrag_", "newValues", "maybeDeleteBlock_", "deleted", "updateBlockAfterMove_", "newLocation", "updateToolboxStyle_", "isEnd", "removeStyle", "addStyle", "oldCoordinate", "dragIcons_", "BlockFieldIntermediateChange", "BlockMove", "currentLocation_", "oldParentId", "parentId", "oldInputName", "blockConnection", "BubbleOpen", "opt_bubbleType", "BubbleType", "CommentBase", "opt_comment", "CommentCreateDeleteHelper", "CommentChange", "opt_oldContents", "opt_newContents", "oldContents_", "newContents_", "CommentCreate", "CommentDelete", "CommentMove", "comment_", "oldCoordinate_", "newCoordinate_", "current", "ToolboxItemSelect", "opt_oldItem", "opt_newItem", "oldItem", "newItem", "BaseConstantProvider", "GRID_UNIT", "CURSOR_RADIUS", "HEXAGONAL", "ROUND", "SQUARE", "SHAPE_IN_SHAPE_PADDING", "SELECTED_GLOW_COLOUR", "SELECTED_GLOW_SIZE", "REPLACEMENT_GLOW_COLOUR", "REPLACEMENT_GLOW_SIZE", "selectedGlowFilterId", "selectedGlowFilter", "replacementGlowFilterId", "SQUARED", "ROUNDED", "replacementGlowFilter", "STATEMENT_INPUT_SPACER_MIN_WIDTH", "MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH", "makeHexagonal", "makeRounded", "makeSquared", "rightWidth", "selectedGlowSize", "replacementGlowSize", "pathRightDown", "pathRightUp", "blockHeight", "remainingHeight", "maxHeight", "_height", "curveWidth", "quarterHeight", "innerTopRightCorner", "innerBottomRightCorner", "pathTopRight", "pathBottomRight", "selectedComponentTransfer", "replacementComponentTransfer", "BaseDrawer", "beginDrawing", "outputShapeType", "endDrawing", "hasStatementInput", "drawFlatTop_", "drawRightDynamicConnection_", "drawFlatBottom_", "drawLeftDynamicConnection_", "insideCorners", "cornerHeight", "bottomRightPath", "verticalPath", "setOutlinePath", "connectedBottomNextConnection", "FieldImage", "altText", "Y_PADDING", "setAlt", "setOnClickHandler", "FieldInput", "spellcheck_", "htmlInput_", "isTextValid_", "isBeingEdited_", "onKeyInputWrapper_", "onKeyDownWrapper_", "valueWhenEditorWasOpened_", "fullBlockClickTarget_", "spellcheck", "resizeEditor_", "htmlInput", "INVALID", "setSpellcheck", "quietInput", "showPromptEditor_", "showInlineEditor_", "getValueFromEditorText_", "onFinishEditing_", "widgetDispose_", "widgetCreate_", "borderRadius", "BORDERRADIUS", "strokeColour", "border", "boxShadow", "getEditorText_", "bindInputEvents_", "unbindInputEvents_", "_value", "onHtmlInputKeyDown_", "onHtmlInputChange_", "setEditorValue_", "bumped", "FieldTextInput", "BaseBottomRow", "BaseStatementInput", "RightConnectionShape", "BaseTopRow", "BaseRenderInfo", "isMultiRow", "rightSide", "rightAlignedDummyInputs", "WeakMap", "adjustXPosition_", "alignmentDivider", "notchTotalWidth", "minXPos", "prevSpacer", "nextSpacer", "hasPrevNotch", "hasNextNotch", "prevInRowSpacer", "finalizeOutputConnection_", "outputConnectionShape", "rightConnectionWidth", "finalizeHorizontalAlignment_", "totalNegativeSpacing", "lastElem", "leftNegPadding", "getNegativeSpacing_", "firstElem", "rightNegPadding", "minBlockWidth", "outerShape", "innerShape", "finalizeVerticalAlignment_", "firstRow", "hasSingleTextOrImageField", "hasNonShadowConnectedBlocks", "minVerticalTightNestingHeight", "BaseMarkerSvg", "markerCircle", "showWithInputOutput", "positionCircle", "BasePathObject", "svgPathSelected", "outlines", "remainingOutlines", "outline", "getOutlinePath", "removeOutlinePath", "BaseRenderer", "FieldAngle", "clockwise", "CLOCKWISE", "OFFSET", "WRAP", "symbol_", "gauge", "mode", "Mode", "COMPASS", "PROTRACTOR", "updateGraph", "editor", "dropdownDispose", "HALF", "touchAction", "circle", "RADIUS", "onMouseMove_", "ownerSVGElement", "displayMouseOrKeyboardValue", "wrapValue", "clockwiseFlag", "angle1", "largeFlag", "multiplier", "isFinite", "FieldCheckbox", "checkChar", "CHECK_CHAR", "checkCharacter", "getValueBoolean", "setCheckCharacter", "character", "convertValueToBool_", "FieldColour", "highlightedIndex", "picker", "titles", "colours", "columns", "colourOptions", "colourTitles", "borderRect", "setColours", "setColumns", "cell", "handled", "moveHighlightBy", "getHighlighted", "COLOURS", "COLUMNS", "setHighlightedCell", "onMouseEnter", "onMouseLeave", "cellId", "TITLES", "selectedColour", "table", "EXPANDED", "ROWCOUNT", "COLCOUNT", "title", "FieldLabelSerializable", "FieldMultilineInput", "textGroup", "maxLines_", "isOverflowedY_", "maxLines", "setMaxLines", "textLines", "displayLinesNumber", "currentChild", "lineHeight", "nodes", "actualEditorLines", "dummyTextElement", "lineWidth", "paddingX", "paddingY", "padding", "getMaxLines", "FieldNumber", "precision", "min_", "max_", "precision_", "decimalPlaces", "setConstraints", "setMinInternal", "setMaxInternal", "setPrecisionInternal", "setMin", "getMin", "setMax", "getMax", "setPrecision", "precisionString", "toLocaleString", "maximumFractionDigits", "decimalIndex", "getPrecision", "toFixed", "VALUEMIN", "VALUEMAX", "FieldVariable", "defaultType", "defaultVariableName", "variableType", "typeIsAllowed", "typeList", "isInArray", "FlyoutButton", "isLabel_", "svgText", "callbackKey", "TEXT_MARGIN_X", "TEXT_MARGIN_Y", "updateTransform", "onMouseUp", "isLabel", "getButtonText", "FlyoutMetricsManager", "flyout_", "getBoundingBox_", "blockBoundingBox", "FlyoutItemType", "BUTTON", "Flyout", "filterWrapper", "reflowWrapper", "mats", "buttons_", "permanentlyDisabled", "recycledBlocks", "SCROLLBAR_MARGIN", "dragAngleRange_", "setMetrics_", "toolboxPosition_", "tabWidth_", "rectMap_", "GAP_X", "GAP_Y", "wheel_", "filterForCapacity", "getFlyoutScale", "setAutoClose", "updateDisplay", "positionAt_", "listen", "clearOldBlocks", "getDynamicCategoryContents", "parsedContent", "flyoutInfo", "createFlyoutInfo", "layout_", "gaps", "emptyRecycledBlocks", "defaultGap", "categoryName", "parsedDynamicContent", "dynamicContents", "dynamicGaps", "createFlyoutBlock", "addBlockGap", "addSeparatorGap", "createButton", "fnToApply", "btnInfo", "curButton", "getRecycledBlock", "blockType", "gap", "sepInfo", "newGap", "oldBlocks", "blockIsRecyclable_", "recycleBlock", "addBlockListeners_", "blockMouseDown", "originalBlock", "placeNewBlock", "initFlyoutButton_", "buttonSvg", "createRect_", "blockHW", "moveRectToBlock_", "reflowInternal_", "oldBlock", "svgRootOld", "positionNewBlock", "flyoutOffsetPixels", "oldBlockPos", "oldBlockOffsetPixels", "getX", "getY", "targetWorkspaceViewMetrics", "setBackgroundPath", "cursorX", "moveX", "dragDirection", "atan2", "range", "flyoutRect", "BIG_NUM", "buttons", "atRight", "oldX", "newX", "registryName", "CodeGenerator", "forBlock", "FUNCTION_NAME_PLACEHOLDER_", "STATEMENT_SUFFIX", "STATEMENT_PREFIX", "INFINITE_LOOP_TRAP", "INDENT", "COMMENT_WRAP", "ORDER_OVERRIDES", "isInitialized", "RESERVED_WORDS_", "definitions_", "functionNames_", "nameDB_", "FUNCTION_NAME_PLACEHOLDER_REGEXP_", "RegExp", "workspaceToCode", "code", "blockToCode", "scrubNakedValue", "injectId", "codeString", "finish", "prefixLines", "allNestedComments", "opt_thisOnly", "scrub_", "SyntaxError", "valueToCode", "outerOrder", "innerOrder", "parensNeeded", "outerOrderClass", "innerOrderClass", "statementToCode", "addLoopTrap", "branch", "addReservedWords", "provideFunction_", "desiredName", "functionName", "codeText", "oldCodeText", "getVariableName", "getProcedureName", "_opt_thisOnly", "DARK_PATH_OFFSET", "MAX_BOTTOM_WIDTH", "Highlighter", "inlineSteps_", "steps_", "RTL_", "highlightConstants_", "getHighlightConstants", "highlightOffset", "outsideCornerPaths_", "OUTSIDE_CORNER", "insideCornerPaths_", "INSIDE_CORNER", "puzzleTabPaths_", "notchPaths_", "startPaths_", "jaggedTeethPaths_", "getPath", "drawTopCorner", "drawValueInput", "belowTabHeight", "drawStatementInput", "drawRightSideRow", "rightEdge", "drawBottomRow", "cornerElem", "drawLeft", "drawInlineInput", "connectionRight", "bottomHighlightWidth", "aboveTabHeight", "highlighter_", "setHighlightPath", "HighlightConstantProvider", "constantProvider", "makeInsideCorner", "makeOutsideCorner", "distance45outside", "SQRT1_2", "pathTopRtl", "pathBottomRtl", "pathBottomLtr", "distance45inside", "topLeftCornerHighlightRtl", "topLeftCornerHighlightLtr", "bottomLeftStartY", "bottomLeftPath", "highlightRtlUp", "highlightRtlDown", "verticalOverlap", "highlightLtrUp", "highlightLtrDown", "hatHeight", "pathRtl", "pathLtr", "BaseInlineInput", "hasExternalInputs", "nextRightEdge", "rowNextRightEdges", "prevRightEdge", "heightWithoutHat", "diff", "colourDark", "svgPathDark", "svgPathLight", "highlightConstants", "makeHighlightConstants_", "Zelos", "ToolboxItem", "toolboxItemDef", "parentToolbox", "level_", "parent_", "getLevel", "toolboxItemDef_", "parentToolbox_", "getClickTarget", "isCollapsible", "setVisible_", "_isVisible", "ToolboxCategory", "categoryDef", "labelDom_", "iconDom_", "rowContents_", "rowDiv_", "htmlDiv_", "isDisabled_", "isHidden_", "flyoutItems_", "cssConfig_", "makeDefaultCssConfig_", "parseCategoryDef_", "parseContents_", "createDom_", "flyoutItem", "itemDef", "getColour_", "createContainer_", "LEVEL", "createRowContainer_", "pointerEvents", "createRowContentsContainer_", "createIconDom_", "createLabelDom_", "LABELLEDBY", "addColourBorder_", "rowDiv", "nestedPadding", "paddingRight", "paddingLeft", "contentsContainer", "toolboxIcon", "isHorizontal", "toolboxLabel", "borderWidth", "borderRight", "borderLeft", "styleName", "getColourfromStyle_", "parseColour_", "colourValue", "openIcon_", "iconDiv", "closedIconClass", "closeIcon_", "openIconClass", "getSelectedItem", "clearSelection", "allAncestorsExpanded_", "category", "isExpanded", "isSelected", "defaultBackgroundColour", "setDisabled", "isDisabled", "getContents", "updateFlyoutContents", "newDefinition", "kind", "custom", "categorystyle", "cssconfig", "hidden", "ToolboxSeparator", "separatorDef", "CollapsibleToolboxCategory", "subcategoriesDiv_", "expanded_", "toolboxItems_", "cssConfig", "prevIsFlyoutItem", "createToolboxItem_", "ToolboxItemClass", "setExpanded", "subCategories", "getChildToolboxItems", "createSubCategoriesDom_", "subcategories", "newCategory", "newCategoryDiv", "handleToolboxItemResize", "childToolboxItems", "toggleExpanded", "Toolbox", "contentsDiv_", "HtmlDiv", "contents_", "previouslySelectedItem_", "selectedItem_", "boundEvents_", "toolboxDef_", "horizontalLayout_", "contentMap_", "createFlyout_", "themeManager", "createContentsContainer_", "attachEvents_", "toolboxContainer", "flexDirection", "clickEvent", "onClick_", "keyDownEvent", "onKeyDown_", "itemId", "getToolboxItemById", "setSelectedItem", "selectNext_", "selectPrevious_", "selectParent_", "selectChild_", "renderContents_", "fragment", "createDocumentFragment", "addToolboxItem_", "toolboxItemDom", "getToolboxItems", "toolboxRect", "_couldConnect", "updateCursorDeleteStyle_", "getPreviouslySelectedItem", "workspaceMetrics", "toolboxDiv", "childAsCategory", "shouldDeselectItem_", "deselectItem_", "shouldSelectItem_", "selectItem_", "updateFlyout_", "fireSelectEvent_", "selectItemByPosition", "oldElement", "collapsibleItem", "nextItemIdx", "nextItem", "prevItemIdx", "prevItem", "VERSION", "ALIGN_LEFT", "ALIGN_CENTRE", "ALIGN_RIGHT", "DUMMY_INPUT", "TOOLBOX_AT_TOP", "TOOLBOX_AT_BOTTOM", "TOOLBOX_AT_LEFT", "TOOLBOX_AT_RIGHT", "VARIABLE_CATEGORY_NAME", "VARIABLE_DYNAMIC_CATEGORY_NAME", "PROCEDURE_CATEGORY_NAME", "Workspace.prototype.newBlock", "WorkspaceSvg.prototype.newBlock", "WorkspaceSvg.newTrashcan", "WorkspaceCommentSvg.prototype.showContextMenu", "MiniWorkspaceBubble.prototype.newWorkspaceSvg", "Names.prototype.populateProcedures", "flattenedProcedures", "DropDownDiv", "dropDownDiv", "connectionTypes", "ContextMenu", "ContextMenuItems", "Css", "Events", "Extensions", "ShortcutItems", "Themes", "Tooltip", "Touch", "WidgetDiv", "Xml", "blockAnimations", "blockRendering", "bubbles", "bumpObjects", "clipboard", "common", "dialog", "fieldRegistry", "geras", "minimalist", "renderManagement", "serialization", "thrasos", "uiPosition", "utils", "zelos", "defineProperties", "Blockly", "HSV_SATURATION", "HSV_VALUE", "colour_picker", "block", "generator", "quote_", "getFieldValue", "code", "Order", "ATOMIC", "colour_random", "provideFunction_", "FUNCTION_NAME_PLACEHOLDER_", "functionName", "FUNCTION_CALL", "colour_rgb", "red", "valueToCode", "NONE", "green", "blue", "colour_blend", "c1", "c2", "ratio", "lists_create_empty", "lists_create_with", "elements", "Array", "itemCount_", "i", "join", "lists_repeat", "element", "repeatCount", "lists_length", "MEMBER", "lists_isEmpty", "LOGICAL_NOT", "lists_indexOf", "operator", "item", "workspace", "options", "oneBasedIndex", "ADDITION", "lists_getIndex", "mode", "where", "list", "at", "getAdjusted", "Error", "lists_setIndex", "cacheList", "match", "listVar", "nameDB_", "getDistinctName", "NameType", "VARIABLE", "value", "ASSIGNMENT", "SUBTRACTION", "xVar", "lists_getSublist", "wherePascalCase", "where1", "where2", "at1", "at2", "getSubstringIndex", "lists_sort", "direction", "type", "getCompareFunctionName", "lists_split", "input", "delimiter", "lists_reverse", "controls_if", "n", "STATEMENT_PREFIX", "injectId", "conditionCode", "branchCode", "statementToCode", "STATEMENT_SUFFIX", "prefixLines", "INDENT", "getInput", "logic_compare", "OPERATORS", "order", "EQUALITY", "RELATIONAL", "argument0", "argument1", "logic_operation", "LOGICAL_AND", "LOGICAL_OR", "defaultArgument", "logic_negate", "logic_boolean", "logic_null", "logic_ternary", "value_if", "CONDITIONAL", "value_then", "value_else", "controls_repeat_ext", "repeats", "getField", "String", "Number", "branch", "addLoopTrap", "loopVar", "endVar", "isNumber", "controls_whileUntil", "until", "controls_for", "variable0", "getVariableName", "increment", "up", "step", "Math", "abs", "startVar", "incVar", "controls_forEach", "indexVar", "controls_flow_statements", "xfix", "loop", "getSurroundLoop", "suppressPrefixSuffix", "math_number", "number", "UNARY_NEGATION", "math_arithmetic", "tuple", "MULTIPLICATION", "DIVISION", "math_single", "arg", "math_constant", "CONSTANTS", "math_number_property", "PROPERTIES", "MODULUS", "dropdownProperty", "suffix", "inputOrder", "outputOrder", "numberToCheck", "divisor", "math_change", "varName", "math_on_list", "func", "math_modulo", "math_constrain", "argument2", "math_random_int", "math_random_float", "math_atan2", "procedures_defreturn", "funcName", "getProcedureName", "xfix1", "loopTrap", "INFINITE_LOOP_TRAP", "returnValue", "xfix2", "args", "variables", "getVars", "length", "scrub_", "definitions_", "procedures_callreturn", "procedures_callnoreturn", "forBlock", "procedures_ifreturn", "hasReturnValue_", "text", "text_multiline", "multiline_quote_", "indexOf", "text_join", "forceString", "codeAndOrder", "element0", "element1", "text_append", "text_length", "text_isEmpty", "text_indexOf", "substring", "text_charAt", "text_getSubstring", "requiresLengthCall", "text_changeCase", "text_trim", "text_print", "text_prompt_ext", "text_count", "sub", "text_replace", "from", "to", "text_reverse", "variables_get", "variables_set", "NEW", "INCREMENT", "DECREMENT", "BITWISE_NOT", "UNARY_PLUS", "TYPEOF", "VOID", "DELETE", "AWAIT", "EXPONENTIATION", "BITWISE_SHIFT", "IN", "INSTANCEOF", "BITWISE_AND", "BITWISE_XOR", "BITWISE_OR", "YIELD", "COMMA", "JavascriptGenerator", "CodeGenerator", "constructor", "name", "ORDER_OVERRIDES", "isInitialized", "key", "addReservedWords", "Object", "getOwnPropertyNames", "globalThis", "init", "reset", "Names", "RESERVED_WORDS_", "setVariableMap", "getVariableMap", "populateVariables", "populateProcedures", "defvars", "devVarList", "allDeveloperVariables", "push", "getName", "DEVELOPER_VARIABLE", "allUsedVarModels", "getId", "finish", "definitions", "values", "scrubNakedValue", "line", "string", "replace", "split", "map", "lines", "thisOnly", "commentCode", "outputConnection", "targetConnection", "comment", "getCommentText", "wrap", "COMMENT_WRAP", "inputList", "inputTypes", "VALUE", "childBlock", "connection", "targetBlock", "allNestedComments", "nextBlock", "nextConnection", "nextCode", "blockToCode", "atId", "delta", "negate", "defaultAtIndex", "orderForInput", "floor", "$jscomp$tmp$exports$module$name", "listName", "opt_at", "controls_ifelse", "controls_repeat", "math_round", "math_trig", "procedures_defnoreturn", "strRegExp", "test", "stringName", "text_prompt", "javascriptGenerator", "generators", "colour", "lists", "logic", "loops", "math", "procedures", "variablesDynamic"]
}
