import{o as I,c as T,bH as k,by as M,bl as e,a as t,aC as ye,F as A,aV as w,b as p,f as y,m as l,bc as n,l as B,n as He,g as Ee,aK as Me,_ as Se,p as Ie,q as Te,at as Qe,bx as We,cj as K}from"./index-df7e4a51.js";import{D as X,b as Ze,S as Ke,P as et,W as tt,G as lt,A as ue,V as J,M as j,L as $e,B as ke,a as Ce,E as ee,Q as te,c as q,d as nt}from"./three.module-2fa5ea98.js";import{G as ot,O as st}from"./GLTFLoader-8d8d2fbb.js";import{D as at}from"./DRACOLoader-40a28629.js";import{i as S,s as V,p as E,c as P,a as o,b as a,d as Fe,e as re,N as it,f as ut,g as rt,h as De,j as ct,k as _t,l as dt,m as mt,n as ft,o as vt,q as pt,r as bt,t as ht,u as le,v as gt,w as Le,x as Ne,y as xt,z as wt,A as yt,B as $t,C as kt,D as Ct,E as Vt,F as Et,G as Mt,H as St,I as It,J as Tt,K as Je,L as Ft,M as Dt,O as Lt,P as Ve,Q as Nt,R as Jt,S as qt,T as At,U as Ot,V as Rt,W as Pt,X as Bt,Y,Z as Gt,_ as U,$ as H,a0 as ne,a1 as Xt}from"./bbb_Aqw.vue_vue_type_style_index_0_lang-9407596a.js";import{E as R}from"./el-dialog-c0f3d22c.js";import{i as qe}from"./index-c13506ae.js";const jt=["disabled","title"],Yt=["disabled","title"],zt=["disabled"],Ut={__name:"contorl",setup(x){const r=()=>{P.value=!P.value,P.value?controls.enabled=!1:controls.enabled=!0},c=()=>{o.value=0,a.value=[],a.value=Fe.concat()},f=()=>{E.value=!E.value},h=()=>{if(V.value){const d=a.value[o.value].logJson.event.name;for(;a.value[o.value].logJson.event.name===d&&!(o.value===a.value.length-1||o.value===0);)o.value++;re.value=1,V.value=!1}};return(d,s)=>(I(),T(A,null,[k(t("div",null,[t("button",{disabled:e(V),onClick:f,class:ye({playbuttonstyle:e(E),stopbuttonstyle:!e(E)}),title:e(E)?"播放":e(V)?"请处理事件":"暂停"},null,10,jt)],512),[[M,!e(S)]]),k(t("div",null,[t("button",{disabled:!e(V),onClick:h,class:"eventbuttonstyle",title:e(V)?"事件跳过":"无事件"},null,8,Yt)],512),[[M,!e(S)]]),k(t("div",null,[t("button",{disabled:e(V),onClick:c,class:"replaybuttonstyle",title:"重播"},null,8,zt)],512),[[M,!e(S)]]),k(t("div",null,[t("button",{onClick:r,class:ye({genbuttonstyle:e(P),bugenbuttonstyle:!e(P)}),title:"镜头跟随"},null,2)],512),[[M,!e(S)]])],64))}};const Ht=t("br",null,null,-1),Qt=t("br",null,null,-1),Wt=t("br",null,null,-1),Zt=t("br",null,null,-1),Kt=t("br",null,null,-1),el=t("br",null,null,-1),tl=t("br",null,null,-1),ll=t("br",null,null,-1),nl=t("br",null,null,-1),ol=t("br",null,null,-1),sl=t("br",null,null,-1),al=t("br",null,null,-1),il=t("br",null,null,-1),ul=t("br",null,null,-1),rl=t("br",null,null,-1),cl=t("br",null,null,-1),_l=t("br",null,null,-1),dl={__name:"Contral_Net",setup(x){const r=w(!1),c=()=>{r.value=!0};return(f,h)=>{const d=B,s=R;return I(),T(A,null,[k(p(d,{class:"EXButton",onClick:c},{default:y(()=>[l("控制台")]),_:1},512),[[M,!e(S)]]),p(s,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=_=>r.value=_),title:"控制台","custom-class":"custom-dialog",modal:!1,draggable:"","close-on-click-modal":!1,"modal-class":"kk-dialog-class"},{default:y(()=>[l(" 开始节点："+n(e(it)),1),Ht,l(" 目标节点："+n(e(ut)),1),Qt,Wt,l(" 当前进度量："+n(e(rt)),1),Zt,l(" 控制台设置速度："+n(e(De)),1),Kt,el,l(" 货物状态："+n(e(ct)),1),tl,l(" 工作状态："+n(e(_t)),1),ll,nl,l(" 1级故障码:"+n(e(dt)),1),ol,l(" 2级故障码:"+n(e(mt)),1),sl,al,l(" 电池状态："+n(e(ft)),1),il,l(" 任务状态："+n(e(vt)),1),ul,l(" 任务号："+n(e(pt)),1),rl,l(" 动作key："+n(e(bt)),1),cl,l(" heading:"+n(e(ht)),1),_l]),_:1},8,["modelValue"])],64)}}};const ml=t("br",null,null,-1),fl=t("br",null,null,-1),vl=t("br",null,null,-1),pl=t("br",null,null,-1),bl=t("br",null,null,-1),hl={__name:"Info_box",setup(x){let r="AGV状态";return(c,f)=>e(le)?(I(),T("div",{key:0,class:"info-text",style:He({left:e(Le)+"px",top:e(Ne)+"px"})},[l(n(e(r)),1),ml,l(" 时间："+n(e(a)[e(o)].logDateTime),1),fl,l(" 车体软件版本："+n(),1),vl,l(" 车号："+n(),1),pl,l(" 模式："+n(e(gt)),1),bl],4)):Ee("",!0)}};const gl=t("br",null,null,-1),xl=t("br",null,null,-1),wl=t("br",null,null,-1),yl=t("br",null,null,-1),$l=t("br",null,null,-1),kl=t("br",null,null,-1),Cl=t("br",null,null,-1),Vl=t("br",null,null,-1),El=t("br",null,null,-1),Ml=t("br",null,null,-1),Sl=t("br",null,null,-1),Il=t("br",null,null,-1),Tl=t("br",null,null,-1),Fl=t("br",null,null,-1),Dl=t("br",null,null,-1),Ll=t("br",null,null,-1),Nl={__name:"AGV_device",setup(x){const r=w(!1),c=()=>{r.value=!0};return(f,h)=>{const d=B,s=R;return I(),T(A,null,[k(p(d,{class:"EXButtonDEV",onClick:c},{default:y(()=>[l("车体设备")]),_:1},512),[[M,!e(S)]]),p(s,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=_=>r.value=_),title:"车体设备","custom-class":"custom-dialog",modal:!1,draggable:"","close-on-click-modal":!1,"modal-class":"kk-dialog-class"},{default:y(()=>[l(" 转盘纵向开关："+n(e(a)[e(o)].logJson.equipmentInfo.rack.turn_axis.bZero?"🔴":"🟢"),1),gl,l(" 转盘横向开关："+n(e(a)[e(o)].logJson.equipmentInfo.rack.turn_axis.bLevel?"🔴":"🟢"),1),xl,l(" 转盘位置:"+n(e(a)[e(o)].trunpan.toFixed(3)),1),wl,yl,l(" 举升高位开关："+n(e(a)[e(o)].logJson.equipmentInfo.rack.lifter_axis.bTop?"🔴":"🟢"),1),$l,l(" 举升零位开关："+n(e(a)[e(o)].logJson.equipmentInfo.rack.lifter_axis.bBottom?"🔴":"🟢"),1),kl,l(" 举升位置："+n(e(a)[e(o)].lifter.toFixed(3)),1),Cl,Vl,l(" 当前设备状态："+n(e(xt)),1),El,l(" 当前设备任务号："+n(e(wt)),1),Ml,l(" 当前设备任务状态："+n(e(yt)),1),Sl,l(" 当前设备故障码:  "+n(e($t)),1),Il,l(" 当前设备动作步骤: "+n(e(kt)),1),Tl,l(" 当前动作轴id: "+n(),1),Fl,l(" 当前动作轴位置: "+n(),1),Dl,l(" 当前动作轴开关状态: "+n(),1),Ll]),_:1},8,["modelValue"])],64)}}};const Jl=t("br",null,null,-1),ql=t("br",null,null,-1),Al=t("br",null,null,-1),Ol=t("br",null,null,-1),Rl=t("br",null,null,-1),Pl=t("br",null,null,-1),Bl=t("br",null,null,-1),Gl=t("br",null,null,-1),Xl=t("br",null,null,-1),jl=t("br",null,null,-1),Yl=t("br",null,null,-1),zl=t("br",null,null,-1),Ul=t("br",null,null,-1),Hl=t("div",{class:"bingzhuang",id:"main1",style:{width:"300px",height:"300px"}},null,-1),Ql={__name:"AGV_Nav",setup(x){const r=w(!1),c=()=>{r.value=!0},f=()=>{const h=document.getElementById("main1"),d=qe(h),s=[{value:Math.round(Math.random()*1e3),name:"占用一"},{value:Math.round(Math.random()*1e3),name:"占用二"},{value:Math.round(Math.random()*1e3),name:"占用三"},{value:Math.round(Math.random()*1e3),name:"占用四"},{value:Math.round(Math.random()*1e3),name:"占用五"}],_={title:{text:"占用",textStyle:{color:"black"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,data:s.map(g=>g.name)},series:[{name:"测试数据",type:"pie",radius:"50%",center:["50%","50%"],data:s,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};setInterval(()=>{s.forEach(g=>{g.value=Math.round(Math.random()*1e3)}),d.setOption({series:[{data:s}]})},1e3),d.setOption(_)};return(h,d)=>{const s=B,_=R;return I(),T(A,null,[k(p(s,{class:"EXButtonNAV",onClick:c},{default:y(()=>[l("导航")]),_:1},512),[[M,!e(S)]]),p(_,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=g=>r.value=g),title:"导航","custom-class":"custom-dialog",onOpened:f,modal:!1,draggable:"","close-on-click-modal":!1,"modal-class":"kk-dialog-class"},{default:y(()=>[l(" 导航软件版本："+n(e(Ct)),1),Jl,l(" 导航环境模型版本："+n(e(Vt)),1),ql,Al,l(" 目标位置:"+n(e(Et))+" ",1),Ol,l(" 当前位置："+n(e(Mt)),1),Rl,l(" 理论位置："+n(e(St)),1),Pl,Bl,l(" 左右偏差："+n(e(It)),1),Gl,l(" 角度偏差："+n((e(Tt)*180/Math.PI).toFixed(3)),1),Xl,jl,l(" 发送速度："+n(),1),Yl,l(" 发送舵角："+n(),1),zl,Ul,Hl]),_:1},8,["modelValue"])],64)}}},Ae={__name:"Ele_chart",setup(x){const r=w(null),c=(()=>{let s=new Date,_=[],g=5;for(;g--;)_.unshift(s.toLocaleTimeString().replace(/^\D*/,"")),s=new Date(+s-500);return _})(),f=(()=>{let s=[],_=5;for(;_--;)s.push(Math.round(Math.random()*1e3));return s})(),h=(()=>{let s=[],_=5;for(;_--;)s.push(Math.round(Math.random()*1e3));return s})();let d={title:{text:"车速",textStyle:{color:"white"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{},toolbox:{show:!0,feature:{dataView:{readOnly:!1},magicType:{type:["bar","line","stack"]},restore:{},saveAsImage:{}},bottom:10},xAxis:{type:"category",data:c,boundaryGap:!0},yAxis:{type:"value"},series:[{data:f,type:"line",name:"实际",color:"green",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{data:h,name:"理论",type:"line",color:"yellow",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};return Me(()=>{const s=qe(r.value);setInterval(()=>{let _=(Je.value*1e3).toFixed(2),g=new Date().toLocaleTimeString().replace(/^\D*/,"");c.shift(),c.push(g),f.shift(),f.push(_),h.shift(),h.push(De.value),s.setOption({xAxis:[{data:c}],series:[{data:f},{data:h}]})},400),s.setOption(d)}),(s,_)=>(I(),T("div",{class:"chart",id:"main2",style:{width:450+"px",height:200+"px"},ref_key:"main2",ref:r},null,512))}};const b=x=>(Ie("data-v-3276ecdc"),x=x(),Te(),x),Wl=b(()=>t("br",null,null,-1)),Zl=b(()=>t("br",null,null,-1)),Kl=b(()=>t("br",null,null,-1)),en=b(()=>t("br",null,null,-1)),tn=b(()=>t("br",null,null,-1)),ln=b(()=>t("br",null,null,-1)),nn=b(()=>t("br",null,null,-1)),on=b(()=>t("br",null,null,-1)),sn=b(()=>t("br",null,null,-1)),an=b(()=>t("br",null,null,-1)),un=b(()=>t("br",null,null,-1)),rn=b(()=>t("br",null,null,-1)),cn=b(()=>t("br",null,null,-1)),_n=b(()=>t("br",null,null,-1)),dn=b(()=>t("br",null,null,-1)),mn=b(()=>t("br",null,null,-1)),fn=b(()=>t("br",null,null,-1)),vn=b(()=>t("br",null,null,-1)),pn=b(()=>t("br",null,null,-1)),bn=b(()=>t("br",null,null,-1)),hn=b(()=>t("br",null,null,-1)),gn=b(()=>t("br",null,null,-1)),xn=b(()=>t("br",null,null,-1)),wn=b(()=>t("br",null,null,-1)),yn=b(()=>t("br",null,null,-1)),$n=b(()=>t("br",null,null,-1)),kn=b(()=>t("br",null,null,-1)),Cn={__name:"AGV_ELE",setup(x){const r=w(!1),c=()=>{r.value=!0},f=()=>{Y.value<Gt.value-1?Y.value++:Y.value=0,console.log(Y.value),Ve.value="驱动轴"+Y.value.toString(),U(),H()};return(h,d)=>{const s=B,_=R;return I(),T(A,null,[k(p(s,{class:"EXButtonELE",onClick:c},{default:y(()=>[l("电器模块")]),_:1},512),[[M,!e(S)]]),p(_,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=g=>r.value=g),title:"电器模块","custom-class":"custom-dialog",modal:!1,draggable:"","close-on-click-modal":!1,"modal-class":"kk-dialog-class"},{default:y(()=>[l(" 保险杠状态："+n(e(Ft)),1),Wl,l(" 急停触发："+n(e(Dt)),1),Zl,l(" pls状态："+n(e(Lt)),1),Kl,en,l(" 二维码:"),tn,l(" x:"+n(e(a)[e(o)].logJson.electricalModule.sensor.camera.fx.toFixed(4)),1),ln,l(" y:"+n(e(a)[e(o)].logJson.electricalModule.sensor.camera.fy.toFixed(4)),1),nn,l(" 角度:"+n(e(a)[e(o)].logJson.electricalModule.sensor.camera.fthita.toFixed(4)),1),on,sn,l(" 电量百分比："+n(e(a)[e(o)].logJson.electricalModule.sensor.battmetr.fCapPercent.toFixed(2)),1),an,l(" 电池状态："+n(e(a)[e(o)].logJson.electricalModule.sensor.battmetr.sState),1),un,rn,l(" 磁导航偏差1:"+n(e(a)[e(o)].logJson.electricalModule.sensor.magnetic.fDev[0]),1),cn,l(" 磁导航偏差2:"+n(e(a)[e(o)].logJson.electricalModule.sensor.magnetic.fDev[1]),1),_n,l(" 磁导航状态:"+n(e(a)[e(o)].logJson.electricalModule.sensor.magnetic.sGrade),1),dn,mn,l(" 惯导："+n(),1),fn,l(" 切换驱动单元："),p(s,{class:"buttonstyle",onClick:f},{default:y(()=>[l(n(e(Ve)),1)]),_:1}),vn,l(" 轮伺服实际速度："+n(e(Je)),1),pn,l(" 轮伺服状态码："+n(e(Nt)),1),bn,l(" 轮伺服错误码："+n(e(Jt)),1),hn,l(" 舵伺服实际位置："+n(e(qt)),1),gn,l(" 舵伺服状态码："+n(e(At)),1),xn,l(" 舵伺服错误码："+n(e(Ot)),1),wn,l(" 舵限位开关："+n(e(Rt)),1),yn,l(" 舵限位开关："+n(e(Pt)),1),$n,l(" 舵零位开关："+n(e(Bt)),1),kn,p(Ae)]),_:1},8,["modelValue"])],64)}}},Vn=Se(Cn,[["__scopeId","data-v-3276ecdc"]]);const En=t("br",null,null,-1),Mn=t("br",null,null,-1),Sn=t("br",null,null,-1),In=t("br",null,null,-1),Tn={__name:"event",setup(x){w(0);const r=w(!1),c=()=>{r.value=!0};return(f,h)=>{const d=B,s=R;return I(),T(A,null,[k(p(d,{class:"EVENTButton",onClick:c},{default:y(()=>[l("事件信息")]),_:1},512),[[M,!f.importflag]]),p(s,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=_=>r.value=_),title:"事件信息","custom-class":"custom-dialog",modal:!1,draggable:"","close-on-click-modal":!1,"modal-class":"kk-dialog-class"},{default:y(()=>[l(" 发送时间："+n(e(a)[e(o)].logDateTime),1),En,l(" 事件："+n(e(a)[e(o)].logJson.event.name),1),Mn,l(" 原因："+n(e(a)[e(o)].logJson.event.detail),1),Sn,l(" AGV建议:"+n(e(a)[e(o)].logJson.event.advise),1),In]),_:1},8,["modelValue"])],64)}}};const Fn=t("br",null,null,-1),Dn=t("br",null,null,-1),Ln=t("br",null,null,-1),Nn={__name:"screen_info",setup(x,{expose:r}){const c=w(!1),f=w(!1);return r({handleMouseClick:d=>{const s=ne.intersectObjects([d]);s.length>0&&(console.log("modelname:",s[0].object.name),s[0].object.name==="screen"||s[0].object.name==="screen1"||s[0].object.name==="screen2"||s[0].object.name==="screen3"||s[0].object.name==="screen4"?(f.value=!0,c.value=!0):(c.value=!1,f.value=!1))}}),(d,s)=>{const _=R;return I(),T(A,null,[p(_,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=g=>f.value=g),title:"屏幕2","custom-class":"custom-dialog2",onOpened:d.openDialog,modal:!1},{default:y(()=>[p(Ae)]),_:1},8,["modelValue","onOpened"]),p(_,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=g=>c.value=g),title:"屏幕","custom-class":"custom-dialog3",modal:!1},{default:y(()=>[l(" 屏幕型号:"+n(),1),Fn,l(" 通讯类型:"+n(),1),Dn,l(" 手控设备信息:"+n(),1),Ln]),_:1},8,["modelValue"])],64)}}},Jn=t("br",null,null,-1),qn=t("br",null,null,-1),An=t("br",null,null,-1),On=t("br",null,null,-1),Rn=t("br",null,null,-1),Pn=t("br",null,null,-1),Bn=t("br",null,null,-1),Gn=t("br",null,null,-1),Xn=t("br",null,null,-1),jn=t("br",null,null,-1),Yn=t("br",null,null,-1),zn=t("br",null,null,-1),Un={__name:"wheel_info",setup(x,{expose:r}){const c=w(!1),f=w(!1);return r({handleMouseClickwheel:d=>{const s=ne.intersectObjects([d]);s.length>0&&(s[0].object.name==="rightwheel"||s[0].object.name==="rightwheel1"||s[0].object.name==="rightwheel2"?c.value=!0:c.value=!1,s[0].object.name==="leftwheel"||s[0].object.name==="leftwheel1"||s[0].object.name==="leftwheel2"?f.value=!0:f.value=!1)}}),(d,s)=>{const _=R;return I(),T(A,null,[p(_,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=g=>c.value=g),title:"右轮","custom-class":"custom-dialog3",modal:!1},{default:y(()=>[l(" 驱动内坐标X:"+n(),1),Jn,l(" 驱动内坐标Y:"+n(),1),qn,l(" 电机减速比:"+n(),1),An,l(" 车轮直径:"+n(),1),On,l(" 码盘线束:"+n(),1),Rn,l(" 最大转速:"+n(),1),Pn]),_:1},8,["modelValue"]),p(_,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=g=>f.value=g),title:"左轮","custom-class":"custom-dialog2",modal:!1},{default:y(()=>[l(" 驱动内坐标X:"+n(),1),Bn,l(" 驱动内坐标Y:"+n(),1),Gn,l(" 电机减速比:"+n(),1),Xn,l(" 车轮直径:"+n(),1),jn,l(" 码盘线束:"+n(),1),Yn,l(" 最大转速:"+n(),1),zn]),_:1},8,["modelValue"])],64)}}};const Hn=x=>(Ie("data-v-0b230482"),x=x(),Te(),x),Qn={class:"home"},Wn={class:"choose"},Zn=Hn(()=>t("div",{class:"choose-title"},"控制：",-1)),Kn={class:"file-upload"},eo={class:"logprocess"},to=["disabled","max"],lo=["disabled","title"],no=["disabled","title"],oo={key:0},z=500,so={__name:"index",setup(x){w(0);const r=w(null),c=w(null),f=new ot,h=new at;h.setDecoderPath("https://asdqvqw.github.io/whwtest.github.io/draco/"),f.setDRACOLoader(h);const d=w(0),s=new X(16777215,1);s.position.set(0,0,10);const _=new X(16777215,1);_.position.set(0,0,-10);const g=new X(16777215,1);g.position.set(10,0,0);const ce=new X(16777215,1);ce.position.set(-10,0,0);const _e=new X(16777215,1);_e.position.set(0,10,0);let Q,W,v,de=w(null),Oe=7;const oe=new Ze,F=new Ke,O=new et(75,window.innerWidth/window.innerHeight,.1,1e3);O.position.set(0,2,6);const Re=i=>{const u=i.target.files[0],m=new FileReader;m.onload=C=>{const L=String(C.target.result);Pe(L)},m.readAsText(u)},Pe=i=>{K.success("开始导入数据...");const u=i.split("[INFO | ");for(let m=1;m<u.length;m++){const C=u[m],L=C.indexOf("]"),D=C.substring(0,L).trim(),G=C.substring(L+3).trim(),$=JSON.parse(G),N=$.navInfo.fRealX.toFixed(3),pe=$.navInfo.fRealY.toFixed(3),be=0,he=($.navInfo.fRealThita*180/Math.PI).toFixed(3),ge=$.equipmentInfo.rack.turn_axis.fAxisPosition/1e3,xe=$.equipmentInfo.rack.lifter_axis.fAxisPosition,we=$.uAgvType;a.value.push({logDateTime:D,logJson:$,realx:N,realy:pe,realthita:he,realz:be,trunpan:ge,lifter:xe,agvType:we}),Fe.push({logDateTime:D,logJson:$,realx:N,realy:pe,realthita:he,realz:be,trunpan:ge,lifter:xe,agvType:we})}K.success("开始导入模型..."),Xt.parsedLogData_b=a.value,d.value=a.value.length-1,a.value[0].agvType===0?(f.load("./main/test.glb",m=>{v=m.scene,v.position.set(0,0,0),v.scale.set(1,.6,.7),v.rotation.set(0,j.degToRad(90),0),F.add(v),me(),fe(),ve()},m=>{console.log(m.loaded/m.total*100+"% loaded")},m=>{console.error("Error loading model:",m)}),K.success("导入完成")):K.error("没有匹配模型"),S.value=!1,Be()},Be=()=>{const i=new $e({color:255,linewidth:1}),u=a.value.map(N=>new J(N.realx,N.realz,-N.realy)),m=new ke().setFromPoints(u);let C=new Ce(m,i);const L=new $e({color:16711680,linewidth:1}),D=a.value.map(N=>new J(N.logJson.tcInfo.iDevX/1e3,0,-N.logJson.tcInfo.iDevY/1e3)),G=new ke().setFromPoints(D);let $=new Ce(G,L);o.value=0,F.add(C),F.add($),ae()},Ge=()=>{if(v&&o.value>0){o.value--;const i=a.value[o.value];v.position.set(i.realx,0,-i.realy);const u=new ee(0,j.degToRad(a.value[o.value-1].realthita),0,"XYZ"),m=new te().setFromEuler(u);v.setRotationFromQuaternion(m),U(),H()}},Xe=()=>{if(v&&E.value&&o.value>0){o.value--;const i=a.value[o.value];v.position.set(i.realx,0,-i.realy);const u=new ee(0,j.degToRad(a.value[o.value-1].realthita),0,"XYZ"),m=new te().setFromEuler(u);v.setRotationFromQuaternion(m),U(),H()}},je=()=>{if(v&&E.value&&o.value<a.value.length-1){o.value++;const i=a.value[o.value];v.position.set(i.realx,0,-i.realy);const u=new ee(0,j.degToRad(a.value[o.value+1].realthita),0,"XYZ"),m=new te().setFromEuler(u);v.setRotationFromQuaternion(m),U(),H()}},Ye=i=>{oe.x=i.clientX/window.innerWidth*2-1,oe.y=-(i.clientY/window.innerHeight)*2+1,ne.setFromCamera(oe,O),v!==void 0&&(ne.intersectObjects([v]).length>0?(Le.value=i.clientX+10,Ne.value=i.clientY+10,le.value=!0):le.value=!1)},ze=()=>{le.value=!1},Z=new tt({antialias:!0});Z.setSize(window.innerWidth,window.innerHeight);const Ue=()=>{if(v&&!E.value&&!V.value&&a.value[o.value]&&a.value[o.value+1]){o.value++;const i=a.value[o.value];v.position.set(i.realx,0,-i.realy);const u=new ee(0,j.degToRad(a.value[o.value].realthita),0,"XYZ"),m=new te().setFromEuler(u);v.setRotationFromQuaternion(m),U(),H(),a.value[o.value].logJson.nAgvState===3&&a.value[o.value].logJson.event.name!==""&&(re.value=2,V.value=!0)}};let se=0;const ae=()=>{se++,se>=Oe&&(Ue(),se=0),P.value&&v&&(O.position.copy(v.position),O.position.y+=6,O.lookAt(v.position)),Z.render(F,O),Q&&Q.update(),requestAnimationFrame(ae)},me=()=>{v.traverse(i=>{if(i.name==="upDown"&&(i.rotation.y=a.value[o.value].trunpan.toFixed(2),i.position.y=a.value[o.value].lifter+1e3),i.name==="leftwheel"&&(i.rotation.z+=a.value[o.value].logJson.electricalModule.kinematic.drive[0].wheel.fServoSpeed.toFixed(5)*.5),i.name==="rightwheel"&&(i.rotation.z+=a.value[o.value].logJson.electricalModule.kinematic.drive[1].wheel.fServoSpeed.toFixed(5)*.5),i.name==="rightwheel"&&(i.rotation.z+=a.value[o.value].logJson.electricalModule.kinematic.drive[1].wheel.fServoSpeed.toFixed(5)*.5),i.name==="turnnei")if(a.value[o.value].logJson.equipmentInfo.rack.turn_axis.bLevel){const u=new q({color:16711680});i.material=u}else{const u=new q({color:65280});i.material=u}if(i.name==="turnwai")if(a.value[o.value].logJson.equipmentInfo.rack.turn_axis.bZero){const u=new q({color:16711680});i.material=u}else{const u=new q({color:65280});i.material=u}if(i.name==="liftertop")if(a.value[o.value].logJson.equipmentInfo.rack.lifter_axis.bTop){const u=new q({color:16711680});i.material=u}else{const u=new q({color:65280});i.material=u}if(i.name==="lifterbuttom")if(a.value[o.value].logJson.equipmentInfo.rack.lifter_axis.bBottom){const u=new q({color:16711680});i.material=u}else{const u=new q({color:65280});i.material=u}}),requestAnimationFrame(me)},fe=()=>{v.traverse(i=>{if(i.name==="screen2"){const u=Math.random()*16777215;i.material.color.setHex(u)}}),setTimeout(fe,200)};let ie=1;const ve=()=>{const u={1:{on:65280,off:16777215},2:{on:16711680,off:16777215}}[re.value],m=u.on,C=u.off,L=(D,G)=>{D.traverse($=>{$ instanceof nt&&($.material.color.clone(),$.material.color.set(G))})};v.traverse(D=>{D.name==="light"&&(ie===1?L(D,m):L(D,C))}),ie=1-ie,setTimeout(ve,500)};return Me(()=>{window.addEventListener("mousemove",Ye),window.addEventListener("mouseout",ze),window.addEventListener("click",()=>{r.value.handleMouseClick(v)}),window.addEventListener("click",()=>{c.value.handleMouseClickwheel(v)}),de.value.appendChild(Z.domElement),W=new lt(z,z),W.material.opacity=.3,W.material.transparent=!0,F.add(W);const i=new ue(new J(1,0,0),new J(0,0,0),z/2,16711680),u=new ue(new J(0,0,0),new J(0,0,0),z/2,65280),m=new ue(new J(0,0,-1),new J(0,0,0),z/2,255);F.add(i,u,m),Q=new st(O,Z.domElement),Q.update(),F.add(s),F.add(_),F.add(g),F.add(ce),F.add(_e),ae()}),(i,u)=>{const m=B;return I(),T("div",Qn,[t("div",{class:"canvas-container",ref_key:"canvasDom",ref:de},null,512),t("div",Wn,[Zn,k(t("div",Kn,[t("input",{ref:"importInput",type:"file",accept:".log",style:{display:"none"},onChange:Re},null,544),p(m,{onClick:u[0]||(u[0]=C=>i.$refs.importInput.click()),class:"buttonstyle"},{default:y(()=>[l(" 导入 ")]),_:1})],512),[[M,e(S)]]),k(t("div",eo,[l(" 回放进度:"+n(e(V)?"请处理事件":e(a)[e(o)]===void 0?"":e(a)[e(o)].logDateTime)+" ",1),k(t("input",{disabled:e(V),type:"range",style:{width:"100%"},"onUpdate:modelValue":u[1]||(u[1]=C=>Qe(o)?o.value=C:null),min:"0",max:d.value,step:"1",onChange:Ge},null,40,to),[[We,e(o)]])],512),[[M,!e(S)]]),p(Ut),k(t("div",null,[t("button",{disabled:!e(E)||e(o)===e(a).length+1,onClick:Xe,class:"next2playbuttonstyle",title:e(E)?"上一步":"请暂停"},null,8,lo),t("button",{disabled:!e(E)||e(o)===e(a).length-1,onClick:je,class:"nextplaybuttonstyle",title:e(E)?"下一步":"请暂停"},null,8,no)],512),[[M,!e(S)]]),p(hl)]),p(Nl),p(Vn),e(V)?(I(),T("div",oo,[p(Tn)])):Ee("",!0),p(Ql),p(Nn,{ref_key:"screenRef",ref:r},null,512),p(Un,{ref_key:"wheelRef",ref:c},null,512),p(dl)])}}},fo=Se(so,[["__scopeId","data-v-0b230482"]]);export{fo as default};
