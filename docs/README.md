# V型槽

[toc]

## 任务流程

### 1 充电

``` mermaid
graph TB
title:充电
A((start))-->1(发送充电指令并维持10s)
1-->2{判断充电方向&&充电接触器}
2--满足-->3(正常充电)
2--不满足-->4(结束充电)
4-->5(上报控制台)
```

### 2 取货任务

#### 2.1 主轴取满卷

```mermaid
graph TD
title:取货任务
A((start))-->1(工位前预动作点停车)
1-->2{判断举升高度和货物类型是否匹配任务}
2-->|正常|18{是否轮廓导航}
2-->|异常|19(取送货任务不安全事件)
18-->|是|3{判断轮廓位置和地图实际位置偏差}
18-->|否|17{判断前后磁带导航数值范围以及差值}
3-->20{是否正常}
17-->20{是否正常}
20-->|正常|4(运行到工位点)
20-->|超限|e1
4-->5(动作前检查e3,e4,e5,e14)
5-->6(根据目标高度和当前高度做上升或下降标记)
6-->7(举升上升到控制台下发高度e7,e8,e9,e10,e12)
7-->15{判断主轴是否有货}
15-->|是|B((end))
15-->|否|e16
```

|保护|名称|
|---|---|
|e1|导航误差超限|
|e2|左右磁导航偏差过大|
|e3|未发现地标|
|e4|举升任务高度错误|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|副轴货物状态异常|
|e12|主轴货物状态异常|
|e13|副轴货物存在|
|e14|主轴货物存在|
|e15|副轴货物不存在|
|e16|主轴货物不存在|

#### 2.2 辅轴取空卷

```mermaid
graph TD
title:取货任务
A((start))-->1(工位前预动作点停车)
1-->2{判断举升高度和货物类型是否匹配任务}
2-->|正常|18{是否轮廓导航}
2-->|异常|19(取送货任务不安全事件)
18-->|是|3{判断轮廓位置和地图实际位置偏差}
18-->|否|17{判断前后磁带导航数值范围以及差值}
3-->20{是否正常}
17-->20{是否正常}
20-->|正常|4(运行到工位点)
20-->|超限|e1
4-->5(动作前检查e3,e4,e5,e13)
5-->6(根据目标高度和当前高度做上升或下降标记)
6-->7(举升上升到控制台下发高度e7,e8,e9,e10,e11)
7-->15{判断辅轴是否有货}
15-->|是|B((end))
15-->|否|e15
```

|保护|名称|
|---|---|
|e1|导航误差超限|
|e2|左右磁导航偏差过大|
|e3|未发现地标|
|e4|举升任务高度错误|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|副轴货物状态异常|
|e12|主轴货物状态异常|
|e13|副轴货物存在|
|e14|主轴货物存在|
|e15|副轴货物不存在|
|e16|主轴货物不存在|

### 3 送货任务

#### 3.1 主轴送满卷

```mermaid
graph TB
title:送货任务
A((start))-->1(工位前预动作点停车)
1-->2{判断举升高度和货物类型是否匹配任务}
2-->|正常|18{是否轮廓导航}
2-->|异常|19(取送货任务不安全事件)
18-->|是|3{判断轮廓位置和地图实际位置偏差}
18-->|否|17{判断前后磁带导航数值范围以及差值}
3-->20{是否正常}
17-->20{是否正常}
20-->|正常|4(运行到工位点)
20-->|超限|e1
4-->5(动作前检查e3,e4,e5,e16)
5-->6(根据目标高度和当前高度做上升或下降标记)
6-->7(举升下降到控制台下发高度e7,e8,e9,e10,e12)
7-->8{判断主轴是否无货}
8-->|是|B((end))
8-->|否|e14
```

|保护|名称|
|---|---|
|e1|导航误差超限|
|e2|左右磁导航偏差过大|
|e3|未发现地标|
|e4|举升任务高度错误|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|副轴货物状态异常|
|e12|主轴货物状态异常|
|e13|副轴货物存在|
|e14|主轴货物存在|
|e15|副轴货物不存在|
|e16|主轴货物不存在|

#### 3.2 辅轴送空卷

```mermaid
graph TB
title:送货任务
A((start))-->1(工位前预动作点停车)
1-->2{判断举升高度和货物类型是否匹配任务}
2-->|正常|18{是否轮廓导航}
2-->|异常|19(取送货任务不安全事件)
18-->|是|3{判断轮廓位置和地图实际位置偏差}
18-->|否|17{判断前后磁带导航数值范围以及差值}
3-->20{是否正常}
17-->20{是否正常}
20-->|正常|4(运行到工位点)
20-->|超限|e1
4-->5(动作前检查e3,e4,e5,e15)
5-->6(根据目标高度和当前高度做上升或下降标记)
6-->7(举升下降到控制台下发高度e7,e8,e9,e10,e11)
7-->8{判断主轴是否无货}
8-->|是|B((end))
8-->|否|e13
```

|保护|名称|
|---|---|
|e1|导航误差超限|
|e2|左右磁导航偏差过大|
|e3|未发现地标|
|e4|举升任务高度错误|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|副轴货物状态异常|
|e12|主轴货物状态异常|
|e13|副轴货物存在|
|e14|主轴货物存在|
|e15|副轴货物不存在|
|e16|主轴货物不存在|

## 异常保护

### 1 行走保护

#### 1.1 上线前检测

```mermaid
graph TB
title:上线前检查
A((start))-->1(尝试上线)
1-->2(检测伺服铁电记录的编码器值与MRC控制器铁电记录的编码器值)
2-->3{两种编码器值是否一致}
3-->|否|4(上线页面提示禁止上线)
3-->|是|B((end))
4-->5(手动复位设备后重新上线)
5-->1
```

#### 1.2 行走误差

```mermaid
graph TB
title:行走误差
A((start))-->1(路段上运行中)
1-->2(检测实时坐标与地图坐标的误差)
2-->3{误差是否超限}
3-->|是|e1
3-->|否|B((end))
```

|保护|名称|
|---|---|
|e1|导航误差超限|

#### 1.3 位置跳变

```mermaid
graph TB
title:位置跳变
A((start))-->1(路段上运行中)
1-->2(检测设备编码器位置是否跳变)
2-->3{位置是否跳变}
3-->|是|e1
3-->|否|B((end))
```

|保护|名称|
|---|---|
|e1|设备伺服位置异常|

#### 1.4 货物偏载检测

```mermaid
graph TB
title:货物偏载检测
A((start))-->1(低位带货运行中)
1-->2(检测V型槽货物是否偏载)
2-->3{是否都为触发状态}
3-->|否|e1
3-->|是|B((end))
```

|保护|名称|
|---|---|
|e1|V槽货物偏载|

#### 1.5 同步开关检测

```mermaid
graph TB
title:同步开关检测
A((start))-->1(路段上运行中)
1-->2{同步开关是否能够检测到信号}
2-->|否|e1
2-->|是|B((end))
```

|保护|名称|
|---|---|
|e1|同步开关错误|

#### 1.6 货物状态异常检测

```mermaid
graph TB
title:货物状态异常检测
A((start))-->1(路段上运行中)
1-->2(检测V型槽处货物状态)
2-->3{是否跳变}
3-->|是|4(上报控制台)
3-->|否|B((end))
```

|保护|名称|
|---|---|
|e1|货物状态跳变|

#### 1.7 进工位安全检测

``` mermaid
graph TB
title:进工位安全检测
A((start))-->1(根据数据区判断取送货类型)
1-->2{是否为取货任务}
2-->|是|3(检测货物状态以及举升高度)
2-->|否|4(检测货物状态以及举升高度)
3-->5{是否正确}
4-->5{是否正确}
5-->|是|B((end))
5-->|否|e1
```

|保护|名称|
|---|---|
|e1|取送货任务不安全|

### 2 取货保护

|保护|名称|
|---|---|
|e1|举升伺服未上电|
|e2|急停按下|
|e3|未发现地标|
|e4|左右磁导航偏差过大|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|举升任务高度错误|
|e12|副轴货物状态异常|
|e13|主轴货物状态异常|
|e14|副轴货物存在|
|e15|主轴货物存在|
|e16|副轴货物不存在|
|e17|主轴货物不存在|

### 3 送货保护

|保护|名称|
|---|---|
|e1|举升伺服未上电|
|e2|急停按下|
|e3|未发现地标|
|e4|左右磁导航偏差过大|
|e5|举升伺服故障|
|e6|整体轴伺服报错|
|e7|举升编码器同步错误|
|e8|同步开关错误|
|e9|位置开关校验高度错误|
|e10|高度校验位置开关错误|
|e11|举升任务高度错误|
|e12|副轴货物状态异常|
|e13|主轴货物状态异常|
|e14|副轴货物存在|
|e15|主轴货物存在|
|e16|副轴货物不存在|
|e17|主轴货物不存在|
